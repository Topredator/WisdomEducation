/*!
 * 
 *    Git Hash: ddeb90a1749619f4990d8c1b66d83659dadd71d6
 * 
 *   Create At: 1/5/2022, 7:48:02 PM
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WhiteBoardSDK=t():e.WhiteBoardSDK=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=412)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(47),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){e.exports={default:n(186),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(20),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,n){"use strict";t.__esModule=!0;var r=o(n(127)),a=o(n(86)),i=o(n(20));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,i.default)(t)));e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},function(e,t,n){e.exports={default:n(146),__esModule:!0}},function(e,t){var n=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},,function(e,t,n){var r=n(12),a=n(6),i=n(26),o=n(27),s=n(33),u=function(e,t,n){var c,l,d,f=e&u.F,p=e&u.G,h=e&u.S,g=e&u.P,v=e&u.B,y=e&u.W,m=p?a:a[t]||(a[t]={}),b=m.prototype,w=p?r:h?r[t]:(r[t]||{}).prototype;for(c in p&&(n=t),n)(l=!f&&w&&void 0!==w[c])&&s(m,c)||(d=l?w[c]:n[c],m[c]=p&&"function"!=typeof w[c]?n[c]:v&&l?i(d,r):y&&w[c]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):g&&"function"==typeof d?i(Function.call,d):d,g&&((m.virtual||(m.virtual={}))[c]=d,e&u.R&&b&&!b[c]&&o(b,c,d)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){e.exports={default:n(180),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(5)),a=c(n(0)),i=c(n(1)),o=c(n(20)),s=n(54),u=n(142);function c(e){return e&&e.__esModule?e:{default:e}}var l=void 0,d={type:"",boardName:"whiteboard",pageIndex:"0",dependOn:void 0,timestamp:0},f=!1;function p(e,t,n,r){var a=!1;return d.pageIndex!==n||d.boardName!==r?a=!0:d.inProgress?(e!==d.type||(void 0===t?"undefined":(0,o.default)(t))!==(0,o.default)(d.dependOn)||"string"==typeof t&&t!==d.dependOn||Array.isArray(t)&&Array.isArray(d.dependOn)&&t.join(",")!==d.dependOn.join(",")||f||-1!==["undo","redo","image"].indexOf(e))&&(a=!0):a=!0,a}var h=function(){function e(t){(0,a.default)(this,e),this.type="base",this.app=t,this.opsManager=t.opsManager,this.registerHooks()}return(0,i.default)(e,[{key:"registerHooks",value:function(){}},{key:"eventsToListen",value:function(){return{exec:{value:!1,information:{args:"",message:"执行"+this.type+"事件"}},activate:{value:!1,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"execCommand",value:function(){console.warn("DEV--\x3e","若设置了exec为true，请继承execCommand函数，并作出对应的处理。")}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"opIdForseen",value:function(e,t){return p(e,t,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName)?this.opsManager.currPage.getNextOpId():this.opsManager.currPage.getOpId()}},{key:"dispatch",value:function(e){if(e.hasOwnProperty("type"))if(s.globalSnapshotTypes.indexOf(e.type)>-1)this.dispatchGlobalAction(e);else if("page"===e.type)this.dispatchPageAction(e);else if("board"===e.type||"transDoc"===e.type)this.dispatchBoardAction(e);else{var t=this.app.room.boards[this.app.room.currIndex],n=Date.now()+this.app.ntpTimeDiff,r=void 0;if(e.reuseOpType)r=this.app.account+"-"+e.reuseOpType,delete e.reuseOpType;else{var a=p(e.type,e.dependOn,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName);f=!1,d={type:e.type,dependOn:e.dependOn,timestamp:n,pageIndex:this.opsManager.currPage.pageIndex,boardName:this.opsManager.currPage.boardName,inProgress:e.inProgress},a&&this.opsManager.currPage.prepareNewOpId(),r=this.opsManager.currPage.getOpId()}var i={category:"inPageOp",board:this.app.room.currIndex,page:t.currIndex,time:n,uid:this.app.account,opId:r,data:e};this.app.room.dispatch(i)}else{var o={opId:this.opsManager.currPage.getOpId(),data:e};this.app.room.dispatch(o)}}},{key:"dispatchFromPage",value:function(e,t){var n=Date.now()+this.app.ntpTimeDiff;t.prepareNewOpId();var r={category:"inPageOp",board:t.boardName,page:Number(t.pageIndex),time:n,uid:this.app.account,opId:t.getOpId(),data:e};d={type:e.type,dependOn:e.dependOn,timestamp:n,pageIndex:t.pageIndex,boardName:t.boardName,inProgress:e.inProgress},this.app.room.dispatch(r)}},{key:"dispatchPageAction",value:function(e){var t=Date.now()+this.app.ntpTimeDiff,n={category:"pageOp",board:this.app.room.currIndex,time:t,uid:this.app.account,opId:(0,u.v4)(),data:e};this.app.room.dispatch(n)}},{key:"dispatchBoardAction",value:function(e){var t={category:"boardOp",time:Date.now()+this.app.ntpTimeDiff,uid:this.app.account,opId:(0,u.v4)(),data:e};this.app.room.dispatch(t)}},{key:"dispatchGlobalAction",value:function(e){var t=void 0,n=Date.now()+this.app.ntpTimeDiff;e.reuseOpType?(t=this.app.account+"-"+e.reuseOpType,delete e.reuseOpType):(l&&!f||(l=(0,u.v4)(),f=!1),t=l);var r={category:"globalOp",time:n,uid:this.app.account,opId:t,data:e};this.app.room.dispatch(r)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=this.app.dispatcher).emit.apply(t,[e].concat(r))}},{key:"draw",value:function(e,t,n){console.warn("DEV--\x3e","请实现"+this.type+"子类中draw函数。")}},{key:"preview",value:function(e,t,n){this.draw(e,t,n)}},{key:"hide",value:function(e,t,n){}},{key:"mergePartial",value:function(e,t){return t.hasOwnProperty("category")?t.time>=e.time?t:e:(0,r.default)((0,r.default)({},e),{data:(0,r.default)((0,r.default)({},e.data),t.data)})}},{key:"beginBatch",value:function(){f=!0}},{key:"isKeyDown",value:function(e){return this.app.container.isKeyDown(e)}},{key:"getOpTypeByOpId",value:function(e){return this.opsManager.drawOpsOfPage.hasOwnProperty(e)?this.opsManager.drawOpsOfPage[e].data.type:void 0}},{key:"isMouseDown",get:function(){return this.app.container.isMouseDown}},{key:"logger",get:function(){return this.app.logger}},{key:"opsOfPage",get:function(){return this.opsManager.currPage.opQueue}},{key:"drawOpsOfPage",get:function(){return this.opsManager.drawOpsOfPage}}]),e}();t.default=h},function(e,t,n){var r=n(79)("wks"),a=n(60),i=n(12).Symbol,o="function"==typeof i;(e.exports=function(e){return r[e]||(r[e]=o&&i[e]||(o?i:a)("Symbol."+e))}).store=r},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){e.exports={default:n(245),__esModule:!0}},function(e,t,n){e.exports={default:n(169),__esModule:!0}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(23),a=n(106),i=n(74),o=Object.defineProperty;t.f=n(17)?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),a)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){e.exports=!n(28)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLineFromPointsY=t.getVerticalLineY=t.getXFromCoefAndOffset=t.getLineCoef=t.getArrowPoints=void 0,t.distSqrt=a,t.dist=i,t.rectCollide=function(e,t){return!(e.sx>t.sx+t.w||e.sx+e.w<t.sx||e.sy>t.sy+t.h||e.sy+e.h<t.sy)},t.pointCollideWithPoint=function(e,t,n){return a(e,t)<=n*n},t.pointCollideWithLine=function(e,t,n,r){return i(e,t)+i(e,n)-i(t,n)<=r},t.pointInRect=function(e,t){return t[0]>e.sx&&t[0]<e.sx+e.w&&t[1]>e.sy&&t[1]<e.sy+e.h},t.getTransformedBoundary=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{factor:1,coordinate:0},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{factor:1,coordinate:0},o=a.factor*(t.sx-a.coordinate)+a.coordinate,s=i.factor*(t.sy-i.coordinate)+i.coordinate;o+=n||0,s+=r||0;var u=t.w*a.factor,c=t.h*i.factor;u<0&&(o+=u,u=-u);c<0&&(s+=c,c=-c);t.fixRealWorldHeight&&e&&(c=t.fixRealWorldHeight/e);return{sx:o,sy:s,w:u,h:c}},t.getTransformedPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{factor:1,coordinate:0},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{factor:1,coordinate:0},i=r.factor*(e[0]-r.coordinate)+r.coordinate,o=a.factor*(e[1]-a.coordinate)+a.coordinate;return[i+=t||0,o+=n||0]},t.combineBoundary=function(e,t){var n=(0,r.min)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),a=(0,r.min)(e.sy,t.sy,e.sy+e.h,t.sy+t.h),i=(0,r.max)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),o=(0,r.max)(e.sy,t.sy,e.sy+e.h,t.sy+t.h);return{sx:n,sy:a,w:i-n,h:o-a}},t.getBoundaryBoxFromTwoPoints=function(e,t){var n=(0,r.min)(e[0],t[0]),a=(0,r.max)(e[0],t[0]),i=(0,r.min)(e[1],t[1]),o=(0,r.max)(e[1],t[1]);return{sx:n,sy:i,w:a-n,h:o-i}};var r=n(184);function a(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function i(e,t){return Math.sqrt(a(e,t))}t.getArrowPoints=function(e,t){var n=5*e,r=2*e,a=o(t),i=t[1][0]-t[0][0]>0?s(t[1],a,n):2*t[1][0]-s(t[1],a,n),l=t[1][0]-t[0][0]==0?t[1][1]+(t[1][1]-t[0][1]>0?n:-n):c(t,i),d=s(t[1],-1/a,r),f=t[1][1]-t[0][1]==0?t[1][1]-r:u(t[1],a,d),p=2*t[1][0]-s(t[1],-1/a,r);return[[i,l],[d,f],[p,t[1][1]-t[0][1]==0?t[1][1]+r:u(t[1],a,p)]]};var o=t.getLineCoef=function(e){return(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0},s=t.getXFromCoefAndOffset=function(e,t,n){return Math.sqrt(Math.pow(n,2)/(Math.pow(t,2)+1))+e[0]},u=t.getVerticalLineY=function(e,t,n){return(e[0]-n)/t+e[1]},c=t.getLineFromPointsY=function(e,t){return Math.max(-1e6,(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0)*(t-e[0][0])+e[0][1]}},function(e,t,n){e.exports={default:n(166),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r=o(n(151)),a=o(n(65)),i="function"==typeof a.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof a.default&&"symbol"===i(r.default)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":void 0===e?"undefined":i(e)}},function(e,t,n){e.exports=n(310)},,function(e,t,n){var r=n(15);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var a=(o=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),i=r.sources.map((function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"}));return[n].concat(i).concat([a]).join("\n")}var o;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},a=0;a<this.length;a++){var i=this[a][0];null!=i&&(r[i]=!0)}for(a=0;a<e.length;a++){var o=e[a];null!=o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var r,a,i={},o=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===a&&(a=r.apply(this,arguments)),a}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},u=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=s.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),c=null,l=0,d=[],f=n(205);function p(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=i[r.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](r.parts[o]);for(;o<r.parts.length;o++)a.parts.push(b(r.parts[o],t))}else{var s=[];for(o=0;o<r.parts.length;o++)s.push(b(r.parts[o],t));i[r.id]={id:r.id,refs:1,parts:s}}}}function h(e,t){for(var n=[],r={},a=0;a<e.length;a++){var i=e[a],o=t.base?i[0]+t.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};r[o]?r[o].parts.push(s):n.push(r[o]={id:o,parts:[s]})}return n}function g(e,t){var n=u(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=d[d.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var a=u(e.insertAt.before,n);n.insertBefore(t,a)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function y(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return m(t,e.attrs),g(e,t),t}function m(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function b(e,t){var n,r,a,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var o=l++;n=c||(c=y(t)),r=x.bind(null,n,o,!1),a=x.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),g(e,t),t}(t),r=M.bind(null,n,t),a=function(){v(n),n.href&&URL.revokeObjectURL(n.href)}):(n=y(t),r=k.bind(null,n),a=function(){v(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else a()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=h(e,t);return p(n,t),function(e){for(var r=[],a=0;a<n.length;a++){var o=n[a];(s=i[o.id]).refs--,r.push(s)}e&&p(h(e,t),t);for(a=0;a<r.length;a++){var s;if(0===(s=r[a]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete i[s.id]}}}};var w,_=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function x(e,t,n,r){var a=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=_(t,a);else{var i=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function k(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function M(e,t,n){var r=n.css,a=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&a;(t.convertToAbsoluteUrls||i)&&(r=f(r)),a&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var o=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(e,t,n){var r=n(58);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(16),a=n(45);e.exports=n(17)?function(e,t,n){return r.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeToastIntercept=exports.interceptShowToast=exports.hideToast=exports.showToast=void 0;var _typeof2=__webpack_require__(20),_typeof3=_interopRequireDefault(_typeof2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_stringify=__webpack_require__(19),_stringify2=_interopRequireDefault(_stringify),_classCallCheck2=__webpack_require__(0),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_toastCtrl=__webpack_require__(206),_toastCtrl2=_interopRequireDefault(_toastCtrl);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var ToastClass=function ToastClass(){var _this=this;(0,_classCallCheck3.default)(this,ToastClass),this.show=function(e){var t=e.msg,n=e.time,r=void 0===n?2:n,a=e.type,i=void 0===a?"info":a,o=e.top,s=void 0===o?30:o,u={msgType:e.msgType,args:e.args,msg:t.constructor===String?t:(0,_stringify2.default)(t),time:r,type:i,top:s};if("function"==typeof _this.interceptShowFn){var c=_this.interceptShowFn((0,_assign2.default)({},u));if(!c)return;"object"===(void 0===c?"undefined":(0,_typeof3.default)(c))&&(u=c)}u&&_toastCtrl2.default.show(u)},this.hide=function(){if("function"==typeof _this.interceptHideFn&&!_this.interceptHideFn())return;_toastCtrl2.default.hide()},this.interceptShow=function(fn){if("string"==typeof fn)try{fn=eval(fn)}catch(e){return console.error(e),void console.error("interceptShowToast如果参数为string，该string需要能够被eval解析: "+fn)}"function"!=typeof fn?console.error("interceptShowToast的参数必须为函数"):_this.interceptShowFn=fn},this.interceptHide=function(e){"function"!=typeof e?console.error("Toast.interceptHide的参数必须为函数"):_this.interceptHideFn=e},this.removeIntercept=function(){_this.interceptShowFn=void 0,_this.interceptHideFn=void 0}};window.__newb__=window.__newb__||{},window.__newb__.Toast||(window.__newb__.Toast=new ToastClass);var showToast=exports.showToast=window.__newb__.Toast.show,hideToast=exports.hideToast=window.__newb__.Toast.hide,interceptShowToast=exports.interceptShowToast=window.__newb__.Toast.interceptShow,removeToastIntercept=exports.removeToastIntercept=window.__newb__.Toast.removeIntercept},function(e,t,n){var r=n(75),a=n(76);e.exports=function(e){return r(a(e))}},function(e,t,n){e.exports={default:n(171),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={SYNCHRONIZING:"SYNCHRONIZING",ON_CONNECTED:"ON_CONNECTED",ON_WILL_RECONNECT:"ON_WILL_RECONNECT",ON_DISCONNECTED:"ON_DISCONNECTED",NETWORK_INSTABLE:"NETWORK_INSTABLE",SYNC_FAIL:"SYNC_FAIL",DELAY_DISPATCH_WHILE_NETWORK_INSTABLE:"DELAY_DISPATCH_WHILE_NETWORK_INSTABLE",START_BROADCAST:"START_BROADCAST",STOP_BROADCAST:"STOP_BROADCAST",SWITCH_TO_FOLLOWER:"SWITCH_TO_FOLLOWER",SWITCH_TO_FREE_OBSERVER:"SWITCH_TO_FREE_OBSERVER",NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER:"NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER",NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER:"NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER",RECEIVE_STOP_BROADCAST:"RECEIVE_STOP_BROADCAST",RECEIVE_START_BROADCAST:"RECEIVE_START_BROADCAST",CURRENT_USER_IS_BROADCASTER:"CURRENT_USER_IS_BROADCASTER",CURRENT_USER_IS_FOLLOWER:"CURRENT_USER_IS_FOLLOWER",CURRENT_USER_IS_FREE_OBSERVER:"CURRENT_USER_IS_FREE_OBSERVER",FILE_SIZE_EXCEED_LIMIT:"FILE_SIZE_EXCEED_LIMIT",FILE_ACCEPTED_TYPE_LIMIT:"FILE_ACCEPTED_TYPE_LIMIT",FILE_UPLOAD_FAIL:"FILE_UPLOAD_FAIL",FILE_IS_UPLOADING:"FILE_IS_UPLOADING",FILE_TRANSCODE_SUCCEED:"FILE_TRANSCODE_SUCCEED",FILE_TRANSCODE_FAIL:"FILE_TRANSCODE_FAIL",VIDEO_UPLOAD_FAIL:"VIDEO_UPLOAD_FAIL",AUDIO_UPLOAD_FAIL:"AUDIO_UPLOAD_FAIL",VIDEO_TYPE_NOT_ALLOWED:"VIDEO_TYPE_NOT_ALLOWED",AUDIO_TYPE_NOT_ALLOWED:"AUDIO_TYPE_NOT_ALLOWED",PIC_UPLOAD_FAIL:"PIC_UPLOAD_FAIL",LOG_FILE_UPLOAD_THROTTLE:"LOG_FILE_UPLOAD_THROTTLE",LOG_FILE_IS_UPLOADING:"LOG_FILE_IS_UPLOADING",LOG_FILE_UPLOAD_SUCCEED:"LOG_FILE_UPLOAD_SUCCEED",LOG_FILE_UPLOAD_FAIL:"LOG_FILE_UPLOAD_FAIL",ONE_MEDIA_LIMIT:"ONE_MEDIA_LIMIT",IOS_NOT_SUPPORT_TEXT:"IOS_NOT_SUPPORT_TEXT"}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(76);e.exports=function(e){return Object(r(e))}},function(e,t,n){"use strict";t.__esModule=!0;var r=i(n(253)),a=i(n(9));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(e);!(r=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElementPartOutOfContainer=t.filterNonMediaOpIds=t.transformPropertyOverwriteOp=t.drawUserName=t.roundRect=t.arrayDeduce=t.idsChanged=t.snapshotSelectable=t.findOpsUnderMouse=t.findOpsUnderRect=void 0;var r=u(n(5)),a=u(n(9)),i=u(n(14)),o=u(n(35)),s=n(18);function u(e){return e&&e.__esModule?e:{default:e}}t.findOpsUnderRect=function(e,t,n){if(0===t.length)return[];var r=(0,s.getBoundaryBoxFromTwoPoints)(t[0],t[t.length-1]),a=[];for(var i in n){var o=n[i];if(o.data.boundary&&l(o)){var u=(0,s.getTransformedBoundary)(e,o.data.boundary,o.data.dx,o.data.dy,o.data.scaleX,o.data.scaleY);(0,s.rectCollide)(u,r)&&a.push(i)}}return a},t.findOpsUnderMouse=function(e,t,n,r){if(0===t.length)return[];for(var a=(0,s.getBoundaryBoxFromTwoPoints)(t[0],t[t.length-1]),u=(0,o.default)(t[t.length-1],2),c=u[0],d=u[1],f=(0,i.default)(n),p=(f=f.sort((function(e,t){var r=n[e],a=n[t];return r.data.type===a.data.type?0:"video"===r.data.type||"audio"===r.data.type?-1:"video"===a.data.type||"audio"===a.data.type?1:"image"===r.data.type?-1:"image"===r.data.type?1:0}))).length-1;p>=0;p--){var h=n[f[p]],g=r.opMap[h.data.type];if(h.data.boundary&&l(h)){var v=(0,s.getTransformedBoundary)(e,h.data.boundary,h.data.dx,h.data.dy,h.data.scaleX,h.data.scaleY);if((0,s.rectCollide)(v,a)){if(!g||!("ifMouseOnOp"in g))return[f[p]];if(g.ifMouseOnOp(h,c,d))return[f[p]]}}}return[]};var c=["mouse-pointer","eraser"],l=t.snapshotSelectable=function(e){return!(-1!==c.indexOf(e.data.type)||e.data.locked)},d=(t.idsChanged=function(e,t){if(e.length!==t.length)return!0;var n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(e);!(n=(o=s.next()).done);n=!0){var u=o.value;if(-1===t.indexOf(u))return!0}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return!1},t.arrayDeduce=function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(e);!(r=(s=u.next()).done);r=!0){var c=s.value;-1===t.indexOf(c)&&n.push(c)}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n},t.roundRect=function(e,t,n,r,a,i,o){e.beginPath(),e.moveTo(t+i,n),e.lineTo(t+r-i,n),e.quadraticCurveTo(t+r,n,t+r,n+i),e.lineTo(t+r,n+a-i),e.quadraticCurveTo(t+r,n+a,t+r-i,n+a),e.lineTo(t+i,n+a),e.quadraticCurveTo(t,n+a,t,n+a-i),e.lineTo(t,n+i),e.quadraticCurveTo(t,n,t+i,n),e.closePath(),"stroke"===o?e.stroke():e.fill()});t.drawUserName=function(e){var t=e.ctx,n=e.account,r=e.scale,a=e.px,i=e.py,o=e.bgColor,s=e.fontSize,u=void 0===s?24:s,c=e.textPadding,l=void 0===c?15:c,f=e.rectMarginBottom,p=void 0===f?15:f,h=e.radius,g=void 0===h?10:h,v=(u+12)/r;l/=r,p/=r,u/=r,g/=r;var y="white"===o||"rgb(255,255,255)"===o?"black":"white";t.beginPath(),t.font=u+"px Arial";var m=t.measureText(n).width;t.fillStyle=o,d(t,a-m/2-l,i-p-v,m+2*l,v,g,"fill"),t.fillStyle=y,t.textAlign="left",t.textBaseline="middle",t.fillText(n,a-m/2,i-p-v/2)},t.transformPropertyOverwriteOp=function(e,t){var n=t.data,a=(0,r.default)({},e.data);for(var i in n)"dependOn"!==i&&(a[i]=n[i]);return"text"===e.data.type&&(a.dx=0,a.dy=0,a.scaleX={coordinate:0,factor:1},a.scaleY={coordinate:0,factor:1}),(0,r.default)({},e,{data:a})},t.filterNonMediaOpIds=function(e,t){return t.filter((function(t){if(e.drawOpsOfPage.hasOwnProperty(t)){var n=e.drawOpsOfPage[t];if("audio"!==n.data.type&&"video"!==n.data.type)return!0}return!1}))},t.getElementPartOutOfContainer=function(e,t){var n=e.sx,r=e.sy,a=n+e.w,i=r+e.h,o=t.getContainerWorldRect(),s=Math.max(0,o.centerX-o.width/2-n),u=Math.max(0,a-(o.centerX+o.width/2)),c=Math.max(0,o.centerY-o.height/2-r),l=Math.max(0,i-(o.centerY+o.height/2));return s>0||u>0||c>0||l>0?{left:s,right:u,top:c,bottom:l}:null}},function(e,t,n){"use strict";var r=n(153)(!0);n(81)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";var r=d(n(55)),a=d(n(31)),i=d(n(86)),o=d(n(9)),s=d(n(5)),u=d(n(20)),c=d(n(0)),l=d(n(1));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){(0,c.default)(this,e),Array.isArray(t)||(t=[]),this._args=t,this.taps=[],this.interceptors=[],this.call=this._call,this.promise=this._promise,this.callAsync=this._callAsync,this._x=void 0}return(0,l.default)(e,[{key:"compile",value:function(e){throw new Error("Abstract: should be overriden")}},{key:"_createCall",value:function(e){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:e})}},{key:"tap",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tap(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"sync",fn:t},e)).name||""===e.name)throw new Error("Missing name for tap");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapAsync",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tapAsync(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"async",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapAsync");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapPromise",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,u.default)(e))||null===e)throw new Error("Invalid arguments to tapPromise(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"promise",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapPromise");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"_runRegisterInterceptors",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=(0,o.default)(this.interceptors);!(t=(a=i.next()).done);t=!0){var s=a.value;if(s.register){var u=s.register(e);void 0!==u&&(e=u)}}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}return e}},{key:"withOptions",value:function(e){var t=function(t){return(0,s.default)({},e,"string"==typeof t?{name:t}:t)};e=(0,s.default)({},e,this._withOptions);var n=this._withOptionsBase||this,r=(0,i.default)(n);return r.tapAsync=function(e,r){return n.tapAsync(t(e),r)},r.tap=function(e,r){return n.tap(t(e),r)},r.tapPromise=function(e,r){return n.tapPromise(t(e),r)},r._withOptions=e,r._withOptionsBase=n,r}},{key:"isUsed",value:function(){return this.taps.length>0||this.interceptors.length>0}},{key:"intercept",value:function(e){if(this._resetCompilation(),this.interceptors.push((0,s.default)({},e)),e.register)for(var t=0;t<this.taps.length;t++)this.taps[t]=e.register(this.taps[t])}},{key:"_resetCompilation",value:function(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}},{key:"_insert",value:function(e){this._resetCompilation();var t=void 0;"string"==typeof e.before?t=new a.default([e.before]):Array.isArray(e.before)&&(t=new a.default(e.before));var n=0;"number"==typeof e.stage&&(n=e.stage);for(var r=this.taps.length;r>0;){r--;var i=this.taps[r];this.taps[r+1]=i;var o=i.stage||0;if(t){if(t.has(i.name)){t.delete(i.name);continue}if(t.size>0)continue}if(!(o>n)){r++;break}}this.taps[r]=e}}]),e}();function p(e,t){return function(){return this[e]=this._createCall(t),this[e].apply(this,arguments)}}(0,r.default)(f.prototype,{_call:{value:p("call","sync"),configurable:!0,writable:!0},_promise:{value:p("promise","promise"),configurable:!0,writable:!0},_callAsync:{value:p("callAsync","async"),configurable:!0,writable:!0}}),e.exports=f},function(e,t){!function(n){"object"==typeof t&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EventEmitter3=n()}((function(){return function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){return a(t[o][1][e]||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,a="~";function i(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new o(n,r||e,i),u=a?a+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(a=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=a?a+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o},c.prototype.listenerCount=function(e){var t=a?a+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,r,i,o){var s=a?a+e:e;if(!this._events[s])return!1;var u,c=this._events[s],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,o),!0}for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];c.fn.apply(c.context,u)}else for(var d,f=c.length,p=0;p<f;p++)switch(c[p].once&&this.removeListener(e,c[p].fn,void 0,!0),l){case 1:c[p].fn.call(c[p].context);break;case 2:c[p].fn.call(c[p].context,t);break;case 3:c[p].fn.call(c[p].context,t,n);break;case 4:c[p].fn.call(c[p].context,t,n,r);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c[p].fn.apply(c[p].context,u)}return!0},c.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,r){var i=a?a+e:e;if(!this._events[i])return this;if(!t)return u(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||u(this,i);else{for(var s=0,c=[],l=o.length;s<l;s++)(o[s].fn!==t||r&&!o[s].once||n&&o[s].context!==n)&&c.push(o[s]);c.length?this._events[i]=1===c.length?c[0]:c:u(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=a?a+e:e,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=a,c.EventEmitter=c,void 0!==t&&(t.exports=c)},{}]},{},[1])(1)}))},function(e,t){e.exports={}},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(118),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},function(e,t,n){"use strict";var r=o(n(9)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),this.config=t,this.options=void 0,this._args=void 0}return(0,i.default)(e,[{key:"create",value:function(e){this.init(e);var t=void 0;switch(this.options.type){case"sync":t=new Function(this.args(),'"use strict";\n'+this.header()+this.content({onError:function(e){return"throw "+e+";\n"},onResult:function(e){return"return "+e+";\n"},resultReturns:!0,onDone:function(){return""},rethrowIfPossible:!0}));break;case"async":t=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.content({onError:function(e){return"_callback("+e+");\n"},onResult:function(e){return"_callback(null, "+e+");\n"},onDone:function(){return"_callback();\n"}}));break;case"promise":var n=!1,r=this.content({onError:function(e){return n=!0,"_error("+e+");\n"},onResult:function(e){return"_resolve("+e+");\n"},onDone:function(){return"_resolve();\n"}}),a="";a+='"use strict";\n',a+="return new Promise((_resolve, _reject) => {\n",n&&(a+="var _sync = true;\n",a+="function _error(_err) {\n",a+="if(_sync)\n",a+="_resolve(Promise.resolve().then(() => { throw _err; }));\n",a+="else\n",a+="_reject(_err);\n",a+="};\n"),a+=this.header(),a+=r,n&&(a+="_sync = false;\n"),a+="});\n",t=new Function(this.args(),a)}return this.deinit(),t}},{key:"setup",value:function(e,t){e._x=t.taps.map((function(e){return e.fn}))}},{key:"init",value:function(e){this.options=e,this._args=e.args.slice()}},{key:"deinit",value:function(){this.options=void 0,this._args=void 0}},{key:"header",value:function(){var e="";this.needContext()?e+="var _context = {};\n":e+="var _context;\n",e+="var _x = this._x;\n",this.options.interceptors.length>0&&(e+="var _taps = this.taps;\n",e+="var _interceptors = this.interceptors;\n");for(var t=0;t<this.options.interceptors.length;t++){var n=this.options.interceptors[t];n.call&&(e+=this.getInterceptor(t)+".call("+this.args({before:n.context?"_context":void 0})+");\n")}return e}},{key:"needContext",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=(0,r.default)(this.options.taps);!(e=(a=i.next()).done);e=!0){if(a.value.context)return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"callTap",value:function(e,t){for(var n=t.onError,r=t.onResult,a=t.onDone,i=t.rethrowIfPossible,o="",s=!1,u=0;u<this.options.interceptors.length;u++){var c=this.options.interceptors[u];c.tap&&(s||(o+="var _tap"+e+" = "+this.getTap(e)+";\n",s=!0),o+=this.getInterceptor(u)+".tap("+(c.context?"_context, ":"")+"_tap"+e+");\n")}o+="var _fn"+e+" = "+this.getTapFn(e)+";\n";var l=this.options.taps[e];switch(l.type){case"sync":i||(o+="var _hasError"+e+" = false;\n",o+="try {\n"),o+=r?"var _result"+e+" = _fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n":"_fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n",i||(o+="} catch(_err) {\n",o+="_hasError"+e+" = true;\n",o+=n("_err"),o+="}\n",o+="if(!_hasError"+e+") {\n"),r&&(o+=r("_result"+e)),a&&(o+=a()),i||(o+="}\n");break;case"async":var d="";d+=r?"(_err"+e+", _result"+e+") => {\n":"_err"+e+" => {\n",d+="if(_err"+e+") {\n",d+=n("_err"+e),d+="} else {\n",r&&(d+=r("_result"+e)),a&&(d+=a()),d+="}\n",d+="}",o+="_fn"+e+"("+this.args({before:l.context?"_context":void 0,after:d})+");\n";break;case"promise":o+="var _hasResult"+e+" = false;\n",o+="var _promise"+e+" = _fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n",o+="if (!_promise"+e+" || !_promise"+e+".then)\n",o+="  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise"+e+" + ')');\n",o+="_promise"+e+".then(_result"+e+" => {\n",o+="_hasResult"+e+" = true;\n",r&&(o+=r("_result"+e)),a&&(o+=a()),o+="}, _err"+e+" => {\n",o+="if(_hasResult"+e+") throw _err"+e+";\n",o+=n("_err"+e),o+="});\n"}return o}},{key:"callTapsSeries",value:function(e){var t=this,n=e.onError,r=e.onResult,a=e.resultReturns,i=e.onDone,o=e.doneReturns,s=e.rethrowIfPossible;if(0===this.options.taps.length)return i();for(var u=this.options.taps.findIndex((function(e){return"sync"!==e.type})),c=a||o||!1,l="",d=i,f=function(e){var a=e;d!==i&&"sync"!==t.options.taps[a].type&&(l+="function _next"+a+"() {\n",l+=d(),l+="}\n",d=function(){return(c?"return ":"")+"_next"+a+"();\n"});var o=d,f=function(e){return e?"":i()},p=t.callTap(a,{onError:function(e){return n(a,e,o,f)},onResult:r&&function(e){return r(a,e,o,f)},onDone:!r&&o,rethrowIfPossible:s&&(u<0||a<u)});d=function(){return p}},p=this.options.taps.length-1;p>=0;p--)f(p);return l+=d()}},{key:"callTapsLooping",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;if(0===this.options.taps.length)return n();var a=this.options.taps.every((function(e){return"sync"===e.type})),i="";a||(i+="var _looper = () => {\n",i+="var _loopAsync = false;\n"),i+="var _loop;\n",i+="do {\n",i+="_loop = false;\n";for(var o=0;o<this.options.interceptors.length;o++){var s=this.options.interceptors[o];s.loop&&(i+=this.getInterceptor(o)+".loop("+this.args({before:s.context?"_context":void 0})+");\n")}return i+=this.callTapsSeries({onError:t,onResult:function(e,t,n,r){var i="";return i+="if("+t+" !== undefined) {\n",i+="_loop = true;\n",a||(i+="if(_loopAsync) _looper();\n"),i+=r(!0),i+="} else {\n",i+=n(),i+="}\n"},onDone:n&&function(){var e="";return e+="if(!_loop) {\n",e+=n(),e+="}\n"},rethrowIfPossible:r&&a}),i+="} while(_loop);\n",a||(i+="_loopAsync = true;\n",i+="};\n",i+="_looper();\n"),i}},{key:"callTapsParallel",value:function(e){var t=this,n=e.onError,r=e.onResult,a=e.onDone,i=e.rethrowIfPossible,o=e.onTap,s=void 0===o?function(e,t){return t()}:o;if(this.options.taps.length<=1)return this.callTapsSeries({onError:n,onResult:r,onDone:a,rethrowIfPossible:i});var u="";u+="do {\n",u+="var _counter = "+this.options.taps.length+";\n",a&&(u+="var _done = () => {\n",u+=a(),u+="};\n");for(var c=function(e){var o=function(){return a?"if(--_counter === 0) _done();\n":"--_counter;"},c=function(e){return e||!a?"_counter = 0;\n":"_counter = 0;\n_done();\n"};u+="if(_counter <= 0) break;\n",u+=s(e,(function(){return t.callTap(e,{onError:function(t){var r="";return r+="if(_counter > 0) {\n",r+=n(e,t,o,c),r+="}\n"},onResult:r&&function(t){var n="";return n+="if(_counter > 0) {\n",n+=r(e,t,o,c),n+="}\n"},onDone:!r&&function(){return o()},rethrowIfPossible:i})}),o,c)},l=0;l<this.options.taps.length;l++)c(l);return u+="} while(false);\n"}},{key:"args",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.before,n=e.after,r=this._args;return t&&(r=[t].concat(r)),n&&(r=r.concat(n)),0===r.length?"":r.join(", ")}},{key:"getTapFn",value:function(e){return"_x["+e+"]"}},{key:"getTap",value:function(e){return"_taps["+e+"]"}},{key:"getInterceptor",value:function(e){return"_interceptors["+e+"]"}}]),e}();e.exports=s},function(e,t,n){n(155);for(var r=n(12),a=n(27),i=n(40),o=n(11)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<s.length;u++){var c=s[u],l=r[c],d=l&&l.prototype;d&&!d[o]&&a(d,o,c),i[c]=i.Array}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(344),a=n(223),i=n(345);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|h(t,n),a=(e=s(e,r)).write(t,n);a!==r&&(e=e.slice(0,a));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|p(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):f(e,t);if("Buffer"===t.type&&i(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=s(e,t<0?0:0|p(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function h(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return U(e).length;default:if(r)return F(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,a);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,a){var i,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){var l=-1;for(i=n;i<s;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*o}else-1!==l&&(i-=i-l),l=-1}else for(n+u>s&&(n=s-u),i=n;i>=0;i--){for(var d=!0,f=0;f<u;f++)if(c(e,i+f)!==c(t,f)){d=!1;break}if(d)return i}return-1}function b(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function w(e,t,n,r){return W(F(t,e.length-n),e,n,r)}function _(e,t,n,r){return W(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function x(e,t,n,r){return _(e,t,n,r)}function k(e,t,n,r){return W(U(t),e,n,r)}function M(e,t,n,r){return W(function(e,t){for(var n,r,a,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,a=n%256,i.push(a),i.push(r);return i}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var i,o,s,u,c=e[a],l=null,d=c>239?4:c>223?3:c>191?2:1;if(a+d<=n)switch(d){case 1:c<128&&(l=c);break;case 2:128==(192&(i=e[a+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:i=e[a+1],o=e[a+2],128==(192&i)&&128==(192&o)&&(u=(15&c)<<12|(63&i)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:i=e[a+1],o=e[a+2],s=e[a+3],128==(192&i)&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&i)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),a+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return d(null,e)},u.allocUnsafeSlow=function(e){return d(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},u.byteLength=h,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):g.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,a){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(i,o),c=this.slice(r,a),l=e.slice(t,n),d=0;d<s;++d)if(c[d]!==l[d]){i=c[d],o=l[d];break}return i<o?-1:o<i?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return x(this,e,t,n);case"base64":return k(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function P(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=t;i<n;++i)a+=z(e[i]);return a}function E(e,t,n){for(var r=e.slice(t,n),a="",i=0;i<r.length;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,r,a,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,i=Math.min(e.length-n,2);a<i;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function A(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,i=Math.min(e.length-n,4);a<i;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function L(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,n,r,i){return i||L(e,0,n,4),a.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,i){return i||L(e,0,n,8),a.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var a=t-e;n=new u(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},u.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=t,a=1,i=this[e+--r];r>0&&(a*=256);)i+=this[e+--r]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),a.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),a.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),a.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),a.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||N(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||N(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):A(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):A(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);N(this,e,t,n,a-1,-a)}var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);N(this,e,t,n,a-1,-a)}var i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):A(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):A(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,i=r-n;if(this===e&&n<t&&t<r)for(a=i-1;a>=0;--a)e[a+t]=this[a+n];else if(i<1e3||!u.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=u.isBuffer(e)?e:F(new u(e,r).toString()),s=o.length;for(i=0;i<n-t;++i)this[i+t]=o[i%s]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function z(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e,t){var n;t=t||1/0;for(var r=e.length,a=null,i=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function U(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}}).call(this,n(73))},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(107),a=n(80);e.exports=Object.keys||function(e){return r(e,a)}},function(e,t,n){e.exports={default:n(167),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(0)),a=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}var o=new(function(){function e(){(0,r.default)(this,e),this.strokeColor="rgb(0,0,0)",this.pointsPerBatch=1,this.strokeWidth=5,this.opacity=1}return(0,a.default)(e,[{key:"setStrokeColor",value:function(e){this.strokeColor=e}},{key:"setStrokeWidth",value:function(e){this.strokeWidth=e}},{key:"setOpacity",value:function(e){this.opacity=e}}]),e}());t.default=o},function(e,t){e.exports=!0},function(e,t,n){var r=n(16).f,a=n(33),i=n(11)("toStringTag");e.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){var r=n(26),a=n(111),i=n(112),o=n(23),s=n(59),u=n(84),c={},l={};(t=e.exports=function(e,t,n,d,f){var p,h,g,v,y=f?function(){return e}:u(e),m=r(n,d,t?2:1),b=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(i(y)){for(p=s(e.length);p>b;b++)if((v=t?m(o(h=e[b])[0],h[1]):m(e[b]))===c||v===l)return v}else for(g=y.call(e);!(h=g.next()).done;)if((v=a(g,m,h.value,t))===c||v===l)return v}).BREAK=c,t.RETURN=l},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,d=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):d=-1,c.length&&p())}function p(){if(!l){var e=s(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++d<t;)u&&u[d].run();d=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.snapshotOutOfNormalFlowTypes=["background","pan","zoom","mouse-pointer","select","select-hover","laser","camera-bound"],t.globalSnapshotTypes=["camera-bound"],t.cameraSnapshotTypes=["pan","zoom","camera-bound","reset-camera","fit-to-content","fit-to-doc","resize-camera"]},function(e,t,n){e.exports={default:n(261),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertToCameraBoundSnapshot=void 0;var r=l(n(2)),a=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(19)),c=l(n(10));function l(e){return e&&e.__esModule?e:{default:e}}t.convertToCameraBoundSnapshot=function(e,t){var n=e.getNextCameraBound(t);return(n.width>1e5||n.height>1e5)&&(n.width>n.height?(n.height=1e5*n.height/n.width,n.width=1e5):(n.width=1e5*n.width/n.height,n.height=1e5)),!n.width||!n.height||n.width<0||n.height<0?(e.app.logger.warn("[白板] boundary计算结果不可用，这次camera bound转换返回原值",(0,u.default)(n)),e.app.logger.warn("[白板] container宽高为",e.app.container.width,e.app.container.height),e.app.logger.warn("[白板] 快照类型",t.type),{type:"camera-bound",boundary:{centerX:e.centerX,centerY:e.centerY,width:e.width,height:e.height},skipUndo:!0,animate:!1,reuseOpType:"camera-bound"}):{type:"camera-bound",boundary:n,skipUndo:!0,animate:t.animate,reuseOpType:"camera-bound"}};var d=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="camera-bound",e.description="视角位置",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"camera-bound:send":{value:this.sendCameraBound.bind(this),information:{args:"boundary: {centerX: number, centerY: number, width: number, width: number}, animate: boolean",message:"发送当前用户的camera-bound，常用于主播同步自己的camera-bound"}}}}},{key:"sendCameraBound",value:function(e,t){this.dispatch({type:"camera-bound",boundary:e,skipUndo:!0,animate:t,reuseOpType:"camera-bound"})}}]),t}(c.default);t.default=d},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(13),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,n){return function r(a,o){try{var s=t[a](o),u=s.value}catch(e){return void n(e)}if(!s.done)return i.default.resolve(u).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(u)}("next")}))}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(77),a=Math.min;e.exports=function(e){return e>0?a(r(e),9007199254740991):0}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(23),a=n(120),i=n(80),o=n(78)("IE_PROTO"),s=function(){},u=function(){var e,t=n(89)("iframe"),r=i.length;for(t.style.display="none",n(121).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[i[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:a(n,t)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){t.f=n(11)},function(e,t,n){e.exports={default:n(157),__esModule:!0}},function(e,t){},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var r=i(n(20)),a=i(n(86));function i(e){return e&&e.__esModule?e:{default:e}}var o={};function s(e,t,n){n||(n=Error);var r=function(e){var n,r;function i(n,r,a){return e.call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,r,a))||this}return r=e,(n=i).prototype=(0,a.default)(r.prototype),n.prototype.constructor=n,n.__proto__=r,i}(n);r.prototype.name=n.name,r.prototype.code=e,o[e]=r}function u(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}s("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),s("ERR_INVALID_ARG_TYPE",(function(e,t,n){var a,i,o,s;if("string"==typeof t&&(i="not ",t.substr(!o||o<0?0:+o,i.length)===i)?(a="must not be",t=t.replace(/^not /,"")):a="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))s="The ".concat(e," ").concat(a," ").concat(u(t,"type"));else{var c=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";s='The "'.concat(e,'" ').concat(c," ").concat(a," ").concat(u(t,"type"))}return s+=". Received type ".concat(void 0===n?"undefined":(0,r.default)(n))}),TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=o},function(e,t,n){"use strict";(function(t){var r,a=n(14);var i=((r=a)&&r.__esModule?r:{default:r}).default||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=d;var o=n(224),s=n(229);n(67)(d,o);for(var u=i(s.prototype),c=0;c<u.length;c++){var l=u[c];d.prototype[l]||(d.prototype[l]=s.prototype[l])}function d(e){if(!(this instanceof d))return new d(e);o.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",f)))}function f(){this._writableState.ended||t.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(d.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this,n(52))},function(e,t,n){e.exports={default:n(143),__esModule:!0}},function(e,t,n){var r=n(61),a=n(45),i=n(30),o=n(74),s=n(33),u=n(106),c=Object.getOwnPropertyDescriptor;t.f=n(17)?c:function(e,t){if(e=i(e),t=o(t,!0),u)try{return c(e,t)}catch(e){}if(s(e,t))return a(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(53),a=n(11)("toStringTag"),i="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?n:i?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(15);e.exports=function(e,t){if(!r(e))return e;var n,a;if(t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;if("function"==typeof(n=e.valueOf)&&!r(a=n.call(e)))return a;if(!t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(53);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(79)("keys"),a=n(60);e.exports=function(e){return r[e]||(r[e]=a(e))}},function(e,t,n){var r=n(6),a=n(12),i=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(49)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){"use strict";var r=n(49),a=n(8),i=n(108),o=n(27),s=n(40),u=n(154),c=n(50),l=n(90),d=n(11)("iterator"),f=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,n,h,g,v,y){u(n,t,h);var m,b,w,_=function(e){if(!f&&e in S)return S[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},x=t+" Iterator",k="values"==g,M=!1,S=e.prototype,T=S[d]||S["@@iterator"]||g&&S[g],I=T||_(g),O=g?k?_("entries"):I:void 0,P="Array"==t&&S.entries||T;if(P&&(w=l(P.call(new e)))!==Object.prototype&&w.next&&(c(w,x,!0),r||"function"==typeof w[d]||o(w,d,p)),k&&T&&"values"!==T.name&&(M=!0,I=function(){return T.call(this)}),r&&!y||!f&&!M&&S[d]||o(S,d,I),s[t]=I,s[x]=p,g)if(m={values:k?I:_("values"),keys:v?I:_("keys"),entries:O},y)for(b in m)b in S||i(S,b,m[b]);else a(a.P+a.F*(f||M),t,m);return m}},function(e,t,n){var r=n(60)("meta"),a=n(15),i=n(33),o=n(16).f,s=0,u=Object.isExtensible||function(){return!0},c=!n(28)((function(){return u(Object.preventExtensions({}))})),l=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},d=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!i(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&d.NEED&&u(e)&&!i(e,r)&&l(e),e}}},function(e,t,n){var r=n(12),a=n(6),i=n(49),o=n(64),s=n(16).f;e.exports=function(e){var t=a.Symbol||(a.Symbol=i?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,n){var r=n(72),a=n(11)("iterator"),i=n(40);e.exports=n(6).getIteratorMethod=function(e){if(null!=e)return e[a]||e["@@iterator"]||i[r(e)]}},function(e,t,n){var r=n(15);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){e.exports={default:n(191),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(9)),a=f(n(2)),i=f(n(0)),o=f(n(1)),s=f(n(3)),u=f(n(4)),c=n(184),l=f(n(10)),d=f(n(48));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="",e.shouldSaniteEp=!1,e.movedDuringMouseDown=!1,e.points=[],e.sampleSeq=0,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pageChange.tap("PageChange",this.handlePageChange.bind(this))}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handlePageChange",value:function(){this.beginBatch(),this.sampleSeq=0,this.points=[],this.movedDuringMouseDown=!1}},{key:"handleMouseMove",value:function(e,t,r){if(this.isMouseDown||this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(199)+") 0 17, auto":document.body.style.cursor="auto",this.isMouseDown){this.movedDuringMouseDown=!0,t=Number(t.toFixed(1)),r=Number(r.toFixed(1)),this.points.push([t,r]);try{this.dispatch(this.getSnapshot(!0))}catch(e){this.logger.warn("[白板] MouseMoveDrawOp MouseMove Error: "+e)}this.sampleSeq+=1}}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.points=[[t,n]],this.movedDuringMouseDown=!1,this.sampleSeq=0}},{key:"handleMouseUp",value:function(e,t,n){if(this.isMouseDown&&this.movedDuringMouseDown){t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.points.push([t,n]);try{this.dispatch(this.getSnapshot(!1))}catch(e){this.logger.warn("[白板] MouseMoveDrawOp MouseUp Error: "+e)}this.movedDuringMouseDown=!1,this.points=[]}}},{key:"getTwoPointShapeCommonProperty",value:function(e){var t={type:this.type,boundary:this.getBoundaryRectOfLine(),sp:this.sp,ep:this.ep,lineWidth:this.lineWidth,inProgress:e.inProgress,opacity:this.opacity};return"stroke"===e.strokeOrFill?t.stroke=this.color:"fill"===e.strokeOrFill?t.fill=this.color:t.color=this.color,t}},{key:"getFreeDrawCommonProperty",value:function(e){var t={type:this.type,boundary:this.getBoundaryRectOfFreeDraw(),lineWidth:this.lineWidth,inProgress:e.inProgress,opacity:this.opacity};return t.color=this.color,t}},{key:"getBoundaryRectOfFreeDraw",value:function(){var e=this.points;if(0===e.length)throw this.logger.warn("[白板] 涂鸦没有记录任何数据"),new Error("涂鸦没有记录任何数据");var t=e[0][0],n=e[0][1],a=t,i=n,o=!0,s=!1,u=void 0;try{for(var l,d=(0,r.default)(e);!(o=(l=d.next()).done);o=!0){var f=l.value;t=(0,c.min)(f[0],t),n=(0,c.min)(f[1],n),a=(0,c.max)(f[0],a),i=(0,c.max)(f[1],i)}}catch(e){s=!0,u=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw u}}return{sx:t,sy:n,w:Number((a-t).toFixed(2)),h:Number((i-n).toFixed(2))}}},{key:"getBoundaryRectOfLine",value:function(){var e=(0,c.min)(this.sp[0],this.ep[0]),t=(0,c.min)(this.sp[1],this.ep[1]),n=(0,c.max)(this.sp[0],this.ep[0]),r=(0,c.max)(this.sp[1],this.ep[1]);return{sx:e,sy:t,w:Number((n-e).toFixed(2)),h:Number((r-t).toFixed(2))}}},{key:"strokeOrFill",value:function(e,t){e.save(),e.lineWidth=t.lineWidth,t.opacity&&(e.globalAlpha=Number(t.opacity)),t.stroke?(e.strokeStyle=t.stroke,e.stroke()):t.fill&&(e.fillStyle=t.fill,e.fill()),e.restore()}},{key:"sanityEp",value:function(e){return e[0]-this.sp[0]>=0&&e[0]-this.sp[0]<1&&(e[0]=this.sp[0]+1),e[1]-this.sp[1]>=0&&e[1]-this.sp[1]<1&&(e[1]=this.sp[1]+1),e}},{key:"lineWidth",get:function(){return Number(d.default.strokeWidth)}},{key:"opacity",get:function(){return Number(d.default.opacity)}},{key:"color",get:function(){return d.default.strokeColor}},{key:"sp",get:function(){return this.points[0]}},{key:"ep",get:function(){var e=this.points[this.points.length-1];return this.shouldSaniteEp&&(e=this.sanityEp(e)),e}}]),t}(l.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.shouldDispatch=function(e){var t=e.vision.mode;return"broadcaster"===t||"freeObserver"===t}},function(e,t,n){var r=n(15),a=n(12).document,i=r(a)&&r(a.createElement);e.exports=function(e){return i?a.createElement(e):{}}},function(e,t,n){var r=n(33),a=n(34),i=n(78)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){var r=n(107),a=n(80).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,a)}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(27);e.exports=function(e,t,n){for(var a in t)n&&e[a]?e[a]=t[a]:r(e,a,t[a]);return e}},function(e,t,n){var r=n(8),a=n(6),i=n(28);e.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*i((function(){n(1)})),"Object",o)}},function(e,t,n){e.exports={default:n(193),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=!0;t.LOG=r,t.setLOG=function(e){t.LOG=r=e}},function(e,t,n){"use strict";e.exports=function(e,t){return"string"!=typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),/["'() \t\n]/.test(e)||t?'"'+e.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataReportConnError=t.DataReportRunError=void 0;var r=s(n(220)),a=s(n(5)),i=s(n(19)),o=s(n(237));function s(e){return e&&e.__esModule?e:{default:e}}t.DataReportRunError={Board_Lost:3,Page_Lost:4},t.DataReportConnError={Get_Channel_Error:1,IM_Join_Channel_Error:2,IM_Create_Channel_Error:3,Socket_Conn_Closed:4,HeartBeat_Timeout:5,Socket_Closed:6,Sync_Timeout:7,Resend_Count_Exceed_Max:8};t.default=function(e,t,n,s){fetch(e,{method:"post",headers:{"content-type":"application/json"},body:(0,i.default)({common:{device_id:"",session_id:(0,o.default)(n),sdk_type:"whiteboard",ver:"2.0"},event:(0,r.default)({},t,(0,a.default)((0,a.default)({},s),{sdkVersion:"3.7.5"}))})})}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DPI=void 0;var r=f(n(70)),a=f(n(35)),i=f(n(41)),o=f(n(9)),s=f(n(0)),u=f(n(1)),c=n(139),l=n(18),d=n(256);function f(e){return e&&e.__esModule?e:{default:e}}var p=t.DPI=window.devicePixelRatio||1,h=0,g=function(){function e(t){var n=this;(0,s.default)(this,e),this.elInitW=1920,this.elInitH=1080,this.interactionEnabled=!0,this.streamFixedWidth=0,this.isLandscape=!1,this.elesToResize=[],this.top=0,this.left=0,this.keyPressed={},this.maybeClick=!1,this.mouseEventCache=[],this.isMouseDown=!1,this.sx=0,this.sy=0,this.lastMx=0,this.lastMy=0,this.lastClientX=0,this.lastClientY=0,this.lastTPos=[],this.lastSingleTPos=[],this.histScaleP=.5,this.currTC=0,this.inPan=!1,this._resize=function(e){var t,r=n.el.getBoundingClientRect();n.containerRect=r,n.app.ifDeviceSupportOrientation&&(n.isLandscape=r.width>r.height);var a=!0,i=!1,s=void 0;try{for(var u,c=(0,o.default)(n.elesToResize);!(a=(u=c.next()).done);a=!0){var l=u.value;l.style.width=r.width+"px",l.style.height=r.height+"px",n.streamFixedWidth>0&&l===n.streamCanvas?(l.width=(0,d.evenify)(n.streamFixedWidth),l.height=(0,d.evenify)(l.width*r.height/r.width)):l instanceof HTMLCanvasElement&&(l!==n.streamCanvas||n.keepStreamDPI?(l.width=(0,d.evenify)(r.width*p),l.height=(0,d.evenify)(r.height*p)):(l.width=(0,d.evenify)(r.width),l.height=(0,d.evenify)(r.height)))}}catch(e){i=!0,s=e}finally{try{!a&&c.return&&c.return()}finally{if(i)throw s}}n.top=r.top,n.left=r.left,n.setElePosition(n.backgroundEl,"fixed"),n.setElePosition(n.h5El,"fixed"),n.setElePosition(n.imageEl,"fixed"),n.setElePosition(n.domEl,"fixed"),n.setElePosition(n.textAreaEl,"fixed"),n.dispatcher.emit("container:resize"),n.ctx.lineCap="round",n.ctx.lineJoin="round",n.frontCtx.lineCap="round",n.frontCtx.lineJoin="round",n.laserCtx.lineCap="round",n.laserCtx.lineJoin="round",n.streamCtx&&(n.streamCtx.lineCap="round",n.streamCtx.lineJoin="round"),e&&(null===(t=n.opsManager)||void 0===t||t.resize(e,r.width,r.height)),n.streamCanvas&&n.dispatcher.emit("event:appState:change","streamSize",{width:n.streamCanvas.width,height:n.streamCanvas.height}),n.app.room.refresh()},this.unbindEvents=function(){var e;window.ResizeObserver&&(null===(e=n._ro)||void 0===e||e.disconnect()),window.removeEventListener("scroll",n._resize,!0),window.removeEventListener("resize",n._resize),window.removeEventListener("orientationchange",n._resize),window.removeEventListener("mousewheel",n._mousewheel,{capture:!1}),window.removeEventListener("wheel",n._mousewheel,{capture:!1}),document.removeEventListener("gesturestart",n._zoom),document.removeEventListener("gesturechange",n._zoom),document.removeEventListener("gestureend",n._zoom),(0,c.off)(n.el,"mousedown",n.mousedown),(0,c.off)(n.el,"mouseleave",n._mouseleave),(0,c.off)(window.document,"mousemove",n.mousemove),(0,c.off)(window.document,"mouseup",n.mouseup),(0,c.off)(n.el,"touchstart",n._touchdown),(0,c.off)(n.el,"touchmove",n._touchmove),(0,c.off)(n.el,"touchend",n._touchup),(0,c.off)(window.document,"keyup",n._keyup),(0,c.off)(window.document,"keydown",n._keydown),(0,c.off)(document.body,"contextmenu",n._contextmenu)},this.getEventClientPos=function(e){var t=void 0,r=void 0;return e.touches&&e.touches.length>0?(t=e.touches[0].clientX,r=e.touches[0].clientY):(t=e.clientX,r=e.clientY),t-=n.left,r-=n.top,[].concat((0,i.default)(n.app.camera.convertToPointInWorld(t,r)),[t,r])},this.getTouchEventClientPos=function(e){for(var t=[],n=0;n<e.touches.length;n++)t.push(e.touches[n].clientX),t.push(e.touches[n].clientY);return t},this._contextmenu=function(e){e.preventDefault()},this._touchdown=function(e){n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n.mouseEventCache=[];var t=e.touches.length;n.inPan=!1,n.currTC=t,n.lastAction=void 0,n.histScaleP=.5,1===t?n.mousedown(e):(n.mouseup(e),2===t&&(n.lastTPos=n.getTouchEventClientPos(e)))},this._touchmove=function(e){var t,r,a,i,o,s=e.touches.length;if(1===s&&n.inPan){var u=n.getTouchEventClientPos(e);n.lastSingleTPos.length>0&&(null===(t=n.opsManager)||void 0===t||t.pan(e,u[0]-n.lastSingleTPos[0],u[1]-n.lastSingleTPos[1])),n.lastSingleTPos=u}else if(1===s)n.mousemove(e);else if(2===s){var c=n.getTouchEventClientPos(e),l=(0,d.deltaXY)(n.lastTPos,c),f=(0,d.pinchScale)(n.lastTPos,c),p=(0,d.fingerDiff)(n.lastTPos,c);n.lastTPos=c;var h=Math.abs(l[0])/2+Math.abs(l[1])/2,g=Math.abs(1-f),v=(0,d.scaleProb)(p,h,g);v+n.histScaleP<.75&&h>.5?(null===(r=n.opsManager)||void 0===r||r.pan(e,l[0],l[1]),n.lastAction="pan"):v+n.histScaleP>=1.25&&g>.007?(f=Math.max(Math.min(f,1.2),.8),null===(a=n.opsManager)||void 0===a||a.scale(e,f,c[0]/2+c[2]/2,c[1]/2+c[3]/2),n.lastAction="scale"):"pan"===n.lastAction?null===(i=n.opsManager)||void 0===i||i.pan(e,l[0],l[1]):"move"===n.lastAction&&(null===(o=n.opsManager)||void 0===o||o.scale(e,f,c[0]/2+c[2]/2,c[1]/2+c[3]/2)),n.histScaleP=.8*n.histScaleP+.2*v}},this._touchup=function(e){var t=e.touches.length;n.lastSingleTPos=[],0===t?(n.mouseup(e),n.inPan=!1):1===t&&n.currTC>1?n.inPan=!0:n.inPan=!1,n.currTC=t},this.mousedown=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((n.interactionEnabled||t)&&!n.isMouseDown){var r=n.getEventClientPos(e),i=(0,a.default)(r,4),o=i[0],s=i[1],u=i[2],c=i[3];n.lastMx=o,n.lastMy=s,n.lastClientX=u,n.lastClientY=c,n.isMouseDown=!0,n.maybeClick=!0,n.sx=o,n.sy=s,n.mouseEventCache.push({type:"mousedown",args:[e,n.sx,n.sy,u,c]}),n.mouseEmitTimer=setTimeout((function(){n.maybeClick=!1,n._emitMouseEvents()}),150)}},this.mousemove=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n.interactionEnabled||r){var i=n.getEventClientPos(e),o=(0,a.default)(i,4),s=o[0],u=o[1],c=o[2],d=o[3];n.lastMx=s,n.lastMy=u,n.lastClientX=c,n.lastClientY=d,n.maybeClick&&(n.maybeClick=(0,l.distSqrt)([s,u],[n.sx,n.sy])<=5),n.maybeClick?n.mouseEventCache.push({type:"mousemove",args:[e,s,u,c,d]}):(n.mouseEmitTimer&&(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n._emitMouseEvents()),null===(t=n.opsManager)||void 0===t||t.mousemove(e,s,u,c,d))}},this.mouseup=function(e){var t,r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((n.interactionEnabled||a)&&n.isMouseDown){var i=[n.lastMx,n.lastMy,n.lastClientX,n.lastClientY],o=i[0],s=i[1],u=i[2],c=i[3];n.maybeClick?(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n.mouseEventCache=[],n.maybeClick=!1,null===(r=n.opsManager)||void 0===r||r.click(e,o,s,u,c)):(n.mouseEmitTimer&&(n.mouseEmitTimer=clearTimeout(n.mouseEmitTimer),n._emitMouseEvents()),n.mouseEventCache=[],null===(t=n.opsManager)||void 0===t||t.mouseup(e,o,s,u,c)),n.isMouseDown=!1}},this._mouseleave=function(e){var t,r=n.getEventClientPos(e),i=(0,a.default)(r,4),o=i[0],s=i[1],u=i[2],c=i[3];null===(t=n.opsManager)||void 0===t||t.mouseleave(e,o,s,u,c)},this._zoom=function(e){var t;if(n.isTargetOnContainer(e.target)){var r=n.getEventClientPos(e),i=(0,a.default)(r,4),o=i[0],s=i[1],u=i[2],c=i[3];return null===(t=n.opsManager)||void 0===t||t.mousewheel(e,o,s,u,c),e.preventDefault()}},this._mousewheel=function(e){var t,i;if(n.isTargetOnContainer(e.target)){var o=navigator.platform.toUpperCase().indexOf("MAC")>=0,s=navigator.userAgent.toUpperCase().indexOf("FIREFOX")>=0;if(o&&!s&&(0,r.default)(e.deltaX)&&(0,r.default)(e.deltaY)){if((h+=1)>2){var u=Math.max(Math.abs(e.deltaX),Math.abs(e.deltaY))/50,c=1.5*e.deltaX,l=1.5*e.deltaY;u>1&&(c/=u,l/=u),null===(t=n.opsManager)||void 0===t||t.pan(e,-c,-l)}}else{var d=n.getEventClientPos(e),f=(0,a.default)(d,4),p=f[0],g=f[1],v=f[2],y=f[3];null===(i=n.opsManager)||void 0===i||i.mousewheel(e,p,g,v,y),h=0}e.preventDefault()}},this._keyup=function(e){var t;if(e&&e.key){var r=e.key.toLocaleLowerCase();null===(t=n.opsManager)||void 0===t||t.keyup(e),n.keyPressed[r]=!1}},this._keydown=function(e){var t;if(e&&e.key){var r=e.key.toLocaleLowerCase();n.keyPressed[r]=!0,null===(t=n.opsManager)||void 0===t||t.keydown(e)}},this.app=t,this.dispatcher=t.dispatcher,this.el=document.createElement("div"),this.el.style.userSelect="none",this.el.style.position="relative",this.el.style.width="100%",this.el.style.height="100%",this.el.id="yunxin-whiteboard",this.setBackgroundColor();var u=this.setupCanvasElement("bg-canvas");this.bgCanvas=u.canvas,this.bgCtx=u.ctx,this.backgroundEl=this.setupDivElement("bg-el"),this.h5El=this.setupDivElement("h5-el"),this.imageEl=this.setupDivElement("image-el"),u=this.setupCanvasElement("anchor-canvas"),this.canvas=u.canvas,this.ctx=u.ctx,u=this.setupCanvasElement("inc-canvas"),this.frontCanvas=u.canvas,this.frontCtx=u.ctx,this.domEl=this.setupDivElement("dom-el"),this.textAreaEl=this.setupDivElement("toolbar-el"),u=this.setupCanvasElement("laser-canvas"),this.laserCanvas=u.canvas,this.laserCtx=u.ctx}return(0,u.default)(e,[{key:"disableInteraction",value:function(){this.interactionEnabled=!1}},{key:"enableInteraction",value:function(){this.interactionEnabled=!0}},{key:"setBackgroundColor",value:function(){this.el.style.backgroundColor=this.app.appConfig.canvasBgColor}},{key:"getStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.el.getBoundingClientRect();this.streamFixedWidth=e.width?e.width:0;var r=!e.hasOwnProperty("keepDPI")||e.keepDPI;this.keepStreamDPI=r;var a=e.width?e.width:r?n.width*p:n.width,i=a*n.height/n.width;if(a=(0,d.evenify)(a),i=(0,d.evenify)(i),!this.streamCanvas){var o=this.setupCanvasElement("stream-canvas");this.streamCanvas=o.canvas,this.streamCanvas.style.visibility="hidden",this.streamCtx=o.ctx}return this.streamCanvas.width=a,this.streamCanvas.height=i,this.streamCanvas.style.width=n.width+"px",this.streamCanvas.style.height=n.height+"px",this.streamCtx&&(this.streamCtx.lineCap="round",this.streamCtx.lineJoin="round"),this.streamCanvas&&this.dispatcher.emit("event:appState:change","streamSize",{width:this.streamCanvas.width,height:this.streamCanvas.height}),t||!this.stream?(this.stopStream(),this.stream=this.streamCanvas.captureStream(),this.stream):this.stream}},{key:"stopStream",value:function(){if(this.stream){var e=this.stream.getTracks(),t=!0,n=!1,r=void 0;try{for(var a,i=(0,o.default)(e);!(t=(a=i.next()).done);t=!0){a.value.stop()}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}this.stream=void 0}}},{key:"appendTo",value:function(e){e.style.overflow="hidden",e.appendChild(this.el),this._resize(),this.dispatcher.emit("container:set"),this._bindEvents(e)}},{key:"addOpsManager",value:function(e){this.opsManager=e}},{key:"isKeyDown",value:function(e){return this.keyPressed.hasOwnProperty(e)&&this.keyPressed[e]}},{key:"resize",value:function(){this._resize()}},{key:"isTargetOnContainer",value:function(e){for(;e;){if(e===this.el)return!0;e=e.parentNode}return!1}},{key:"setupDivElement",value:function(e){var t=document.createElement("div");return t.style.pointerEvents="none",t.style.transformOrigin="left top",t.className=e,this.el.appendChild(t),t}},{key:"setupCanvasElement",value:function(e){var t=document.createElement("canvas");this.setElePosition(t),t.className=e,t.style.pointerEvents="none";var n=t.getContext("2d");return this.el.appendChild(t),this.elesToResize.push(t),{canvas:t,ctx:n}}},{key:"_bindEvents",value:function(e){var t,n=this;this.unbindEvents(),window.ResizeObserver&&(this._ro=new window.ResizeObserver((function(e,t){n._resize(!0)})),null===(t=this._ro)||void 0===t||t.observe(e)),window.addEventListener("scroll",this._resize,!0),window.addEventListener("resize",this._resize),window.addEventListener("orientationchange",this._resize),(0,c.on)(this.el,"mousedown",this.mousedown),(0,c.on)(this.el,"mouseleave",this._mouseleave),(0,c.on)(window.document,"mousemove",this.mousemove),(0,c.on)(window.document,"mouseup",this.mouseup),window.addEventListener("wheel",this._mousewheel,{passive:!1,capture:!1}),window.addEventListener("mousewheel",this._mousewheel,{passive:!1,capture:!1}),document.addEventListener("gesturestart",this._zoom),document.addEventListener("gesturechange",this._zoom),document.addEventListener("gestureend",this._zoom),(0,c.on)(this.el,"touchstart",this._touchdown),(0,c.on)(this.el,"touchmove",this._touchmove),(0,c.on)(this.el,"touchend",this._touchup),(0,c.on)(window.document,"keyup",this._keyup),(0,c.on)(window.document,"keydown",this._keydown),(0,c.on)(document.body,"contextmenu",this._contextmenu)}},{key:"destroy",value:function(){this.unbindEvents(),this.stopStream()}},{key:"setElePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"absolute";"absolute"===t?(e.style.position=t,e.style.left="0px",e.style.right="0px",e.style.top="0px",e.style.bottom="0px"):(e.style.position="fixed",e.style.left=this.left+"px",e.style.width=this.width+"px",e.style.top=this.top+"px",e.style.height=this.height+"px")}},{key:"_emitMouseEvents",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=(0,o.default)(this.mouseEventCache);!(e=(r=a.next()).done);e=!0){var s,u=r.value;(s=this.opsManager)[u.type].apply(s,(0,i.default)(u.args))}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}this.mouseEventCache=[]}},{key:"width",get:function(){return this.containerRect?this.containerRect.width:this.canvas.width}},{key:"height",get:function(){return this.containerRect?this.containerRect.height:this.canvas.height}}]),e}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(9)),a=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(4)),c=n(18),l=p(n(201)),d=p(n(48)),f=n(36);function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="select",e.lineWidth=0,e.fillColor="rgba(230, 100, 100, 0.4)",e.eleContainerColor="rgb(0, 0, 0)",e.eleContainerWidth=2,e.eleContainerPadding=3,e.activate=!1,e.selectedOpIds=[],e.inProgressSelectedOpIds=[],e.description="选择操作工具。\n首先使用op:select:activate设置画布为选择模式。通过。然后画布会监听鼠标动作，生成选择框。具体用法如下：",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getSelectedIds",value:function(){return this.selectedOpIds.slice()}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"select:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置选择框线段宽度"}},"select:fill:color":{value:this.setFillColor.bind(this),information:{args:"color: ColorString",message:"设置选择框填充色"}},"select:stroke:color":{value:this.setStrokeColor.bind(this),information:{args:"color: ColorString",message:"设置选择框填充色"}},"select:eleContainer:color":{value:this.setEleContainerColor.bind(this),information:{args:"color: ColorString",message:"设置被选中元素包含盒颜色"}},"select:eleContainer:width":{value:this.setEleContainerWidth.bind(this),information:{args:"width: number",message:"设置被选中元素包含盒线段宽度"}},"select:eleContainerPadding":{value:this.setEleContainerPadding.bind(this),information:{args:"width: number",message:"设置被选中元素包含盒的padding"}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this)),this.opsManager.hooks.pageChange.tap("pageChange",this.handlePageChange.bind(this))}},{key:"handlePageChange",value:function(e){e.uid===this.app.account&&this.selectedOpIds.length>0&&this.dispatch(this.getSnapshot([]))}},{key:"handleOpChange",value:function(e){var t;"select"!==e&&"select"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&this.dispatch(this.getSnapshot([])),this.beginBatch()}},{key:"postMouseUp",value:function(e){this.dispatch(this.getSnapshot(e)),this.lastSelectedOpIds=e}},{key:"postClick",value:function(e){if(0===e.length&&Date.now()-this.opsManager.opMap.text.blurAt<100)return;this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return{type:"select",sp:this.sp,ep:this.ep,inProgress:!1,selectedOpIds:e.slice(),reuseOpType:"select",skipUndo:!0,color:d.default.strokeColor,nickname:this.app.nickname}}},{key:"draw",value:function(e,t){var n=e.data.color?e.data.color:"rgb(0,0,0)";this.drawSelectBox(e,t);var r=this.drawSelectedElementBox(e,t,n);if(!e.data.inProgress&&e.uid!==this.app.account&&Array.isArray(r)&&1===r.length){var a=r[0].sx+r[0].w/2,i=r[0].sy;if(!this.app.appConfig.showSelectNickname)return;(0,f.drawUserName)({ctx:t,account:e.data.nickname?e.data.nickname:e.uid,scale:this.app.camera.scale,px:a,py:i,bgColor:n,fontSize:16,textPadding:8,radius:6})}}},{key:"drawSelectBox",value:function(e,t){var n=e.data,r=void 0,a=void 0;if(Array.isArray(n.points)&&n.points.length>=2?(r=n.points[0],a=n.points[n.points.length-1]):n.sp&&n.ep&&(n.sp[0]===n.ep[0]&&n.sp[1]===n.ep[1]||(r=n.sp,a=n.ep)),n.inProgress&&r&&a){var i=(0,c.getBoundaryBoxFromTwoPoints)(r,a),o=i.sx,s=i.sy,u=i.w,l=i.h;t.beginPath(),this.strokeColor&&this.lineWidth&&(t.strokeStyle=this.strokeColor,t.lineWidth=this.lineWidth,t.strokeRect(o,s,u,l)),this.fillColor&&(t.fillStyle=this.fillColor,t.fillRect(o,s,u,l))}}},{key:"drawSelectedElementBox",value:function(e,n,a){var i=this,o=e.data,s=o.selectedOpIds.filter((function(e){return i.drawOpsOfPage[e]})),u=this.eleContainerPadding;if(0!==s.length){var l=s.map((function(e){var t=i.drawOpsOfPage[e];return(0,c.getTransformedBoundary)(i.app.camera.scale,t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)}));o.inProgress||(l=[l.reduce((function(e,t){return(0,c.combineBoundary)(e,t)}))]),n.strokeStyle=a,n.fillStyle=a,n.lineWidth=this.eleContainerWidth;var d=5/this.app.camera.scale,f=!0,p=!1,h=void 0;try{for(var g,v=(0,r.default)(l);!(f=(g=v.next()).done);f=!0){var y=g.value;n.beginPath(),n.strokeRect(y.sx-u,y.sy-u,y.w+2*u,y.h+2*u),!o.inProgress&&this.opsManager.currOp instanceof t&&(n.fillRect(y.sx-u-d/2,y.sy-u-d/2,d,d),n.fillRect(y.sx+y.w+u-d/2,y.sy+y.h+u-d/2,d,d),n.fillRect(y.sx+y.w+u-d/2,y.sy-u-d/2,d,d),n.fillRect(y.sx-u-d/2,y.sy+y.h+u-d/2,d,d))}}catch(e){p=!0,h=e}finally{try{!f&&v.return&&v.return()}finally{if(p)throw h}}return l}}},{key:"setSelectedOpIds",value:function(e){this.selectedOpIds.join(",")!==e.join(",")&&(this.emit("event:appState:change","selectChange",this.selectedOpIds.slice(),e.slice(),(0,f.filterNonMediaOpIds)(this,e)),this.opsManager.hooks.selectChange.call(this.selectedOpIds.slice(),e.slice()),this.selectedOpIds=e,this.dispatch(this.getSnapshot(e.slice())))}},{key:"setInProgressSelectedOpIds",value:function(e){this.inProgressSelectedOpIds=e.slice()}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setFillColor",value:function(e){this.fillColor=e}},{key:"setStrokeColor",value:function(e){this.strokeColor=e}},{key:"setEleContainerColor",value:function(e){this.eleContainerColor=e}},{key:"setEleContainerWidth",value:function(e){this.eleContainerWidth=e}},{key:"setEleContainerPadding",value:function(e){this.eleContainerPadding=e}}]),t}(l.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FONTSIZE=void 0;var r=o(n(5)),a=o(n(14)),i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}t.DEFAULT_FONTSIZE=32;t.default=function e(t){var n=this;(0,i.default)(this,e),this.setAppConfig=function(e){var t,i,o;if(0===(0,a.default)(e).length)n.app.logger.error("[白板]","调用了setAppConfig, 但传入的参数为空",e);else for(var s in e)"canvasBgColor"===s?(n.config.canvasBgColor=e.canvasBgColor,n.app.container.setBackgroundColor(),null===(t=n.app.previewFactory)||void 0===t||t.setBackgroundColor()):"canvas_bg_color"===s?(n.config.canvasBgColor=e.canvas_bg_color,n.app.container.setBackgroundColor(),null===(i=n.app.previewFactory)||void 0===i||i.setBackgroundColor()):"previewMode"===s?(n.config.previewMode=e.previewMode,null===(o=n.app.previewFactory)||void 0===o||o.refreshPreviewsOfCurrBoard(!0)):n.config.hasOwnProperty(s)?n.config[s]=e[s]:(n.app.logger.error("[白板]","setAppConfig传入的参数键值"+s+"不是有效的配置项"),n.app.logger.error("[白板]","目前支持的配置项有："+(0,a.default)(n.config)));(0,r.default)(n.config,e),n.app.emit("event:appState:change","config",n.config)},this.getAppConfig=function(){return n.config},this.app=t,this.config={canvasBgColor:"#f5f5f7",showCursorNickname:!1,showSelectNickname:!1,showLaserNickname:!1,cameraTransformEnabled:!0,allowReplaceActiveBroadcaster:!0,zoomSensitivity:.91,staticDocType:"template",previewMode:"fitDoc",previewCustomBg:!1,disableAutoResize:!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaResource=t.mediaResourceLoaded=t.getResource=t.resourceLoaded=t.fetchMediaResource=t.fetchResource=void 0;var r=s(n(9)),a=s(n(288)),i=n(29),o=s(n(32));function s(e){return e&&e.__esModule?e:{default:e}}var u={},c={},l={},d={},f={},p=t.fetchResource=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u.hasOwnProperty(e)||(l[e]=new Image,l[e].crossOrigin="anonymous",l[e].src=e,n?(u[e]=new Image,u[e].src=e):u[e]=l[e]),"function"==typeof t&&g(e,"",t)},h=t.fetchMediaResource=function(e,t,n,r){if(!c.hasOwnProperty(e))if(c[e]=document.createElement(n),"audio"===n){var a=document.createElement("source");a.src=e,a.setAttribute("type",t),c[e].appendChild(a)}else c[e].src=e+"#t=0.1";"function"==typeof r&&g(e,t,r,n)},g=function(e,t,n,a){d[e]=d[e]||[],d[e].push(n);var s=a?c[e]:u[e];a?s.onloadedmetadata=function(){var t=d[e]||[],n=!0,a=!1,i=void 0;try{for(var o,u=(0,r.default)(t);!(n=(o=u.next()).done);n=!0){(0,o.value)(s)}}catch(e){a=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}}:s.onload=function(){var t=d[e]||[],n=!0,a=!1,i=void 0;try{for(var o,u=(0,r.default)(t);!(n=(o=u.next()).done);n=!0){(0,o.value)(s)}}catch(e){a=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}},s.onerror=function(r){f[e]||(f[e]=0),console.error("[白板] "+a+"资源 [url: "+e+"] 第"+f[e]+"加载失败"),console.error(r);var s=a?"video"===a?o.default.VIDEO_UPLOAD_FAIL:o.default.AUDIO_UPLOAD_FAIL:o.default.PIC_UPLOAD_FAIL,l=f[e]<3,g=a?"video"===a?"视频":"音频":"图片";if(f[e]>0&&(0,i.showToast)({type:"error",msg:g+"加载失败"+(l?", 5s后将尝试重新加载("+(f[e]+1)+"/3)":""),time:3,msgType:s}),delete u[e],delete c[e],delete d[e],l){var v=f[e]>0?5e3:100;setTimeout((function(){console.warn("[白板] "+(a?"文件":"图片")+"加载失败，第"+f[e]+"次重新加载: "+e),a?h(e,t,a,n):p(e,n,!0)}),v)}f[e]+=1}};t.resourceLoaded=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?l[e]:u[e];return n&&n.complete&&n.width>0&&n.height>0},t.getResource=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?l[e]:u[e]},t.mediaResourceLoaded=function(e,t){if("video"===t){var n=c[e];return n&&n.videoWidth>0&&n.videoHeight>0&&n.readyState>=1}var r=c[e];return r&&r.readyState>=1},t.getMediaResource=function(e){return c[e]};u.imageLoading=new Image,u.imageLoading.src=a.default,l.imageLoading=new Image,l.imageLoading.src=a.default,l.imageLoading.setAttribute("crossorigin","anonymous")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.transformOp=function(e,t,n){var r=e.opsManager.opMap[n.data.type];try{return"transformOp"in r?r.transformOp(t,n):t}catch(n){return e.logger.warn("transform op error"),e.logger.warn(t),e.logger.warn(n),t}},t.opNeedRefresh=function(e,t){return(!(-1!==["select","laser","text"].indexOf(t.data.type)||-1!==e.opsManager.drawOpTypes.indexOf(t.data.type))||!t.data.inProgress)&&"mouse-pointer"!==t.data.type},t.getSelectedOpIds=function(e){var t=[],n=e.lastSelectOfUser[e.app.account];return n&&(t=n.data.selectedOpIds.slice()),t=t.filter((function(t){return e.drawOpQueue.hasOwnProperty(t)&&!e.drawOpQueue[t].data.locked}))},t.clearCtx=function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)},t.fillCtx=function(e){e.fillRect(0,0,e.canvas.width,e.canvas.height)}},function(e,t,n){"use strict";var r=u(n(21)),a=u(n(57)),i=u(n(1)),o=u(n(13)),s=u(n(0));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StreamReader=t.EndOfStreamError=void 0;var c=n(232),l=n(232);Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return l.EndOfStreamError}});var d=function e(){var t=this;(0,s.default)(this,e),this.promise=new o.default((function(e,n){t.reject=n,t.resolve=e}))},f=function(){function e(t){var n=this;if((0,s.default)(this,e),this.s=t,this.endOfStream=!1,this.peekQueue=[],!t.read||!t.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",(function(){return n.reject(new c.EndOfStreamError)})),this.s.once("error",(function(e){return n.reject(e)})),this.s.once("close",(function(){return n.reject(new Error("Stream closed"))}))}var t,n,o;return(0,i.default)(e,[{key:"peek",value:(o=(0,a.default)(r.default.mark((function e(t,n,a){var i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.read(t,n,a);case 2:return i=e.sent,this.peekQueue.push(t.slice(n,n+i)),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"read",value:(n=(0,a.default)(r.default.mark((function e(t,n,a){var i,o,s,u,l,d;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a){e.next=2;break}return e.abrupt("return",0);case 2:if(0!==this.peekQueue.length||!this.endOfStream){e.next=4;break}throw new c.EndOfStreamError;case 4:for(i=a,o=0;this.peekQueue.length>0&&i>0;)s=this.peekQueue.pop(),u=Math.min(s.length,i),s.copy(t,n+o,0,u),o+=u,i-=u,u<s.length&&this.peekQueue.push(s.slice(u));case 7:if(!(i>0)||this.endOfStream){e.next=18;break}return l=Math.min(i,1048576),e.next=11,this._read(t,n+o,l);case 11:if(d=e.sent,o+=d,!(d<l)){e.next=15;break}return e.abrupt("break",18);case 15:i-=d,e.next=7;break;case 18:return e.abrupt("return",o);case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"_read",value:(t=(0,a.default)(r.default.mark((function e(t,n,a){var i,o=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.request){e.next=2;break}throw new Error("Concurrent read operation?");case 2:if(!(i=this.s.read(a))){e.next=8;break}return i.copy(t,n),e.abrupt("return",i.length);case 8:return this.request={buffer:t,offset:n,length:a,deferred:new d},this.s.once("readable",(function(){o.tryRead()})),e.abrupt("return",this.request.deferred.promise.then((function(e){return e}),(function(e){throw e})));case 11:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"tryRead",value:function(){var e=this,t=this.s.read(this.request.length);t?(t.copy(this.request.buffer,this.request.offset),this.request.deferred.resolve(t.length),this.request=null):this.s.once("readable",(function(){e.tryRead()}))}},{key:"reject",value:function(e){this.endOfStream=!0,this.request&&(this.request.deferred.reject(e),this.request=null)}}]),e}();t.StreamReader=f},function(e,t,n){e.exports=!n(17)&&!n(28)((function(){return 7!=Object.defineProperty(n(89)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(33),a=n(30),i=n(149)(!1),o=n(78)("IE_PROTO");e.exports=function(e,t){var n,s=a(e),u=0,c=[];for(n in s)n!=o&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~i(c,n)||c.push(n));return c}},function(e,t,n){e.exports=n(27)},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(53);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(23);e.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&r(i.call(e)),t}}},function(e,t,n){var r=n(40),a=n(11)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||i[a]===e)}},function(e,t,n){"use strict";var r=n(16).f,a=n(62),i=n(93),o=n(26),s=n(92),u=n(51),c=n(81),l=n(109),d=n(124),f=n(17),p=n(82).fastKey,h=n(85),g=f?"_s":"size",v=function(e,t){var n,r=p(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){s(e,l,t,"_i"),e._t=t,e._i=a(null),e._f=void 0,e._l=void 0,e[g]=0,null!=r&&u(r,n,e[c],e)}));return i(l.prototype,{clear:function(){for(var e=h(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[g]=0},delete:function(e){var n=h(this,t),r=v(n,e);if(r){var a=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=a),a&&(a.p=i),n._f==r&&(n._f=a),n._l==r&&(n._l=i),n[g]--}return!!r},forEach:function(e){h(this,t);for(var n,r=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!v(h(this,t),e)}}),f&&r(l.prototype,"size",{get:function(){return h(this,t)[g]}}),l},def:function(e,t,n){var r,a,i=v(e,t);return i?i.v=n:(e._l=i={i:a=p(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=i),r&&(r.n=i),e[g]++,"F"!==a&&(e._i[a]=i)),e},getEntry:v,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=h(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),n?"entries":"values",!n,!0),d(t)}}},function(e,t,n){"use strict";var r=n(12),a=n(8),i=n(82),o=n(28),s=n(27),u=n(93),c=n(51),l=n(92),d=n(15),f=n(50),p=n(16).f,h=n(173)(0),g=n(17);e.exports=function(e,t,n,v,y,m){var b=r[e],w=b,_=y?"set":"add",x=w&&w.prototype,k={};return g&&"function"==typeof w&&(m||x.forEach&&!o((function(){(new w).entries().next()})))?(w=t((function(t,n){l(t,w,e,"_c"),t._c=new b,null!=n&&c(n,y,t[_],t)})),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in x)||m&&"clear"==e||s(w.prototype,e,(function(n,r){if(l(this,w,e),!t&&m&&!d(n))return"get"==e&&void 0;var a=this._c[e](0===n?0:n,r);return t?this:a}))})),m||p(w.prototype,"size",{get:function(){return this._c.size}})):(w=v.getConstructor(t,e,y,_),u(w.prototype,n),i.NEED=!0),f(w,e),k[e]=w,a(a.G+a.W+a.F,k),m||v.setStrong(w,e,y),w}},function(e,t,n){var r=n(72),a=n(177);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return a(this)}}},function(e,t,n){"use strict";var r=n(8);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var r=n(8),a=n(58),i=n(26),o=n(51);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,s,u=arguments[1];return a(this),(t=void 0!==u)&&a(u),null==e?new this:(n=[],t?(r=0,s=i(u,arguments[2],2),o(e,!1,(function(e){n.push(s(e,r++))}))):o(e,!1,n.push,n),new this(n))}})}},function(e,t,n){e.exports={default:n(182),__esModule:!0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(16),a=n(23),i=n(46);e.exports=n(17)?Object.defineProperties:function(e,t){a(e);for(var n,o=i(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){var r=n(12).document;e.exports=r&&r.documentElement},function(e,t,n){"use strict";var r=n(12),a=n(33),i=n(17),o=n(8),s=n(108),u=n(82).KEY,c=n(28),l=n(79),d=n(50),f=n(60),p=n(11),h=n(64),g=n(83),v=n(158),y=n(110),m=n(23),b=n(15),w=n(34),_=n(30),x=n(74),k=n(45),M=n(62),S=n(159),T=n(71),I=n(63),O=n(16),P=n(46),E=T.f,C=O.f,N=S.f,D=r.Symbol,A=r.JSON,L=A&&A.stringify,R=p("_hidden"),j=p("toPrimitive"),B={}.propertyIsEnumerable,z=l("symbol-registry"),F=l("symbols"),U=l("op-symbols"),W=Object.prototype,Y="function"==typeof D&&!!I.f,H=r.QObject,q=!H||!H.prototype||!H.prototype.findChild,Q=i&&c((function(){return 7!=M(C({},"a",{get:function(){return C(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=E(W,t);r&&delete W[t],C(e,t,n),r&&e!==W&&C(W,t,r)}:C,G=function(e){var t=F[e]=M(D.prototype);return t._k=e,t},X=Y&&"symbol"==typeof D.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof D},V=function(e,t,n){return e===W&&V(U,t,n),m(e),t=x(t,!0),m(n),a(F,t)?(n.enumerable?(a(e,R)&&e[R][t]&&(e[R][t]=!1),n=M(n,{enumerable:k(0,!1)})):(a(e,R)||C(e,R,k(1,{})),e[R][t]=!0),Q(e,t,n)):C(e,t,n)},Z=function(e,t){m(e);for(var n,r=v(t=_(t)),a=0,i=r.length;i>a;)V(e,n=r[a++],t[n]);return e},K=function(e){var t=B.call(this,e=x(e,!0));return!(this===W&&a(F,e)&&!a(U,e))&&(!(t||!a(this,e)||!a(F,e)||a(this,R)&&this[R][e])||t)},J=function(e,t){if(e=_(e),t=x(t,!0),e!==W||!a(F,t)||a(U,t)){var n=E(e,t);return!n||!a(F,t)||a(e,R)&&e[R][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=N(_(e)),r=[],i=0;n.length>i;)a(F,t=n[i++])||t==R||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===W,r=N(n?U:_(e)),i=[],o=0;r.length>o;)!a(F,t=r[o++])||n&&!a(W,t)||i.push(F[t]);return i};Y||(s((D=function(){if(this instanceof D)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===W&&t.call(U,n),a(this,R)&&a(this[R],e)&&(this[R][e]=!1),Q(this,e,k(1,n))};return i&&q&&Q(W,e,{configurable:!0,set:t}),G(e)}).prototype,"toString",(function(){return this._k})),T.f=J,O.f=V,n(91).f=S.f=$,n(61).f=K,I.f=ee,i&&!n(49)&&s(W,"propertyIsEnumerable",K,!0),h.f=function(e){return G(p(e))}),o(o.G+o.W+o.F*!Y,{Symbol:D});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)p(te[ne++]);for(var re=P(p.store),ae=0;re.length>ae;)g(re[ae++]);o(o.S+o.F*!Y,"Symbol",{for:function(e){return a(z,e+="")?z[e]:z[e]=D(e)},keyFor:function(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in z)if(z[t]===e)return t},useSetter:function(){q=!0},useSimple:function(){q=!1}}),o(o.S+o.F*!Y,"Object",{create:function(e,t){return void 0===t?M(e):Z(M(e),t)},defineProperty:V,defineProperties:Z,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var ie=c((function(){I.f(1)}));o(o.S+o.F*ie,"Object",{getOwnPropertySymbols:function(e){return I.f(w(e))}}),A&&o(o.S+o.F*(!Y||c((function(){var e=D();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],a=1;arguments.length>a;)r.push(arguments[a++]);if(n=t=r[1],(b(t)||void 0!==e)&&!X(e))return y(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!X(t))return t}),r[1]=t,L.apply(A,r)}}),D.prototype[j]||n(27)(D.prototype,j,D.prototype.valueOf),d(D,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},function(e,t,n){"use strict";var r=n(58);function a(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new a(e)}},function(e,t,n){"use strict";var r=n(12),a=n(6),i=n(16),o=n(17),s=n(11)("species");e.exports=function(e){var t="function"==typeof a[e]?a[e]:r[e];o&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(11)("iterator"),a=!1;try{var i=[7][r]();i.return=function(){a=!0},Array.from(i,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var i=[7],o=i[r]();o.next=function(){return{done:n=!0}},i[r]=function(){return o},e(i)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(16),a=n(45);e.exports=function(e,t,n){t in e?r.f(e,t,a(0,n)):e[t]=n}},function(e,t,n){e.exports={default:n(188),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PlatformArray=["android","ios","pc","mac","pad","web"],t.TouchPlatformArray=["android","ios","pad"];var r=t.PluginType=void 0;!function(e){e[e.OneMotion=0]="OneMotion"}(r||(t.PluginType=r={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultFontName=t.CustomFontName=void 0;var r=i(n(0)),a=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}var o=t.CustomFontName="customWBFont",s=t.DefaultFontName="defaultWBFont",u=["embedded-opentype","woff","truetype","svg","opentype","woff2"],c=new(function(){function e(){(0,r.default)(this,e),this.fontFamily="",this.fontFaceSet=!1,this.appendFontFaceStyle([{url:"https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.ttf",format:"truetype"},{url:"https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.woff",format:"woff"},{url:"https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.woff2",format:"woff2"}],s)}return(0,a.default)(e,[{key:"getFontFamily",value:function(){return this.fontFamily&&this.fontFaceSet?'"'+this.fontFamily+'", "'+o+'"':this.fontFamily?this.fontFamily:this.fontFaceSet?o:'"Helvetica", "'+s+'"'}},{key:"setFontFamily",value:function(e){this.fontFamily=e}},{key:"setFontFace",value:function(e){this.fontFaceSet=!0,this.appendFontFaceStyle(e,o)}},{key:"appendFontFaceStyle",value:function(e,t){var n=document;try{if(n&&n.fonts&&n.fonts.check&&n.fonts.check("12px '"+t+"'"))return}catch(e){console.error("检测字体是否存在抛出异常",e)}var r=e.map((function(e){return e.format&&-1===u.indexOf(e.format)?(console.error("[白板] 字体format应该为以下值中的一个: "+u.join(",")+", 或者不设置format"),'url("'+e.url+'")'):e.format?'url("'+e.url+'") format("'+e.format+'")':'url("'+e.url+'")'})).join(",\n"),a=document.createElement("style");a.setAttribute("type","text/css"),a.appendChild(document.createTextNode('\n@font-face {\n    font-family: "'+t+'";\n    src: '+r+";\n}\n")),document.head.appendChild(a)}}]),e}());t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.isIosDevice=function(){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBackgroundImagePorperPosition=t.getImageProperPosition=t.draw=t.addImage=void 0;var r=n(103),a=n(36),i=n(130);t.addImage=function(e,t,n){var a=e.app.room.currBoard,i=e.opsManager.currPage;if(n&&void 0!==n.boardName&&void 0!==n.pageName){var o=e.app.room.getPage(n.boardName,n.pageName);o&&(i=o)}else if(n&&void 0!==n.pageName){var s=e.app.room.getPage(a.boardName,n.pageName);s&&(i=s)}if((0,r.resourceLoaded)(t)){var u=(0,r.getResource)(t),c=(null==n?void 0:n.width)?n.width:u.width,l=(null==n?void 0:n.height)?n.height:u.height;e.dispatchImage(t,c,l,i)}else(null==n?void 0:n.width)&&(null==n?void 0:n.height)?e.dispatchImage(t,null==n?void 0:n.width,null==n?void 0:n.height,i):(i.addWaitingResource(t),(0,r.fetchResource)(t,(function(r){var a=(null==n?void 0:n.width)?n.width:r.width,o=(null==n?void 0:n.height)?n.height:r.height;e.dispatchImage(t,a,o,i),i.removeWaitingResource(t)})))},t.draw=function(e,t,n,o){var s=o.page,u=o.div,c=o.preview,l=o.id,d=o.supportToDataUrl;if((0,r.resourceLoaded)(t)&&!c&&u&&l&&!(0,i.isIosDevice)()){var f=u.querySelector("[id='"+l+"']");f||((f="background"===o.type?(0,r.getResource)(t):(0,r.getResource)(t).cloneNode(!0)).id=""+l,f.style.userSelect="none",f.style.pointerEvents="none",f.style.position="absolute",f.style.imageRendering="-webkit-optimize-contrast",u.appendChild(f)),f.width=n.w,f.height=n.h,f.style.left=n.sx+"px",f.style.top=n.sy+"px";var p=(0,a.getElementPartOutOfContainer)(n,o.page.app.camera);f.style.clipPath=p?"inset("+p.top+"px "+p.right+"px "+p.bottom+"px "+p.left+"px)":"none"}else d&&(0,r.resourceLoaded)(t,!0)?e.drawImage((0,r.getResource)(t,!0),n.sx,n.sy,n.w,n.h):!d&&(0,r.resourceLoaded)(t)?e.drawImage((0,r.getResource)(t,!1),n.sx,n.sy,n.w,n.h):(0,r.resourceLoaded)("imageLoading")&&e.drawImage((0,r.getResource)("imageLoading"),n.sx+5,n.sy+5,Math.max(0,n.w-10),Math.max(0,n.h-10));(0,r.resourceLoaded)(t)||(s.addWaitingResource(t),(0,r.fetchResource)(t,(function(){s.removeWaitingResource(t)})))},t.getImageProperPosition=function(e,t,n){var r=e.app.container.width,a=e.app.container.height;return t>r&&n<a?(n=n*r/t,t=r):t<r&&n>a?(t=t*a/n,n=a):t>r&&n>a&&(t/n>r/a?(n=n*r/t,t=r):(t=t*a/n,n=a)),t/=e.app.camera.scale,n/=e.app.camera.scale,{sx:e.app.camera.centerX-t/2,sy:e.app.camera.centerY-n/2,width:t,height:n}},t.getBackgroundImagePorperPosition=function(e,t,n){return{sx:-t/2,sy:-n/2,width:t,height:n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"subMany",value:function(e){for(var t in e)this.on(t,e[t])}},{key:"destroy",value:function(){var e=this;this.eventNames().forEach((function(t){e.removeAllListeners(t)}))}}]),t}(u(n(39)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=void 0,a=(t.transitionToCameraBound=function(e,t,n){var r=t,i=e.centerX,o=e.centerY,s=e.width,u=e.height,c=e.app.isRecordPlayer?1:15;a({total:c,worker:function(t){var n=(t+1)/c;e.setCameraBound({centerX:r.centerX*n+i*(1-n),centerY:r.centerY*n+o*(1-n),width:r.width*n+s*(1-n),height:r.height*n+u*(1-n)})},callback:n})},t.animate=function(e){cancelAnimationFrame(r),i(0,e)}),i=(t.stopTransitionToCameraBound=function(){cancelAnimationFrame(r)},function e(t,n){t>=n.total?"function"==typeof n.callback&&n.callback():r=requestAnimationFrame((function(){n.worker(t),e(t+1,n)}))})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(19)),a=s(n(14)),i=s(n(5)),o=s(n(20));function s(e){return e&&e.__esModule?e:{default:e}}t.default={isUndefined:function(e){return void 0===e},isDOM:function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,o.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,o.default)(e))&&1===e.nodeType&&"string"==typeof e.nodeName},isValidString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isFunction:function(e){return"function"==typeof e},isNumber:function(e){return"number"==typeof e},isValidArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isValidHexColor:function(e){return/^#[0-9abcdef]{6}$/gi.test(e)},isObject:function(e){return"object"===(void 0===e?"undefined":(0,o.default)(e))},isValidObject:function(e){if("object"!==(void 0===e?"undefined":(0,o.default)(e)))return!1;if(e=(0,i.default)({},e),a.default&&0===(0,a.default)(e).length)return!1;try{return"{}"!==(0,r.default)(e)}catch(e){return!1}},validate:function(e,t,n,i){var o=this,s=[];return(0,a.default)(i).map((function(e){var t=i[e],a=n[e];if(o.isUndefined(a))t.isRequire&&s.push({key:e,message:e+" is required"});else{switch(t.type.toLowerCase()){case"dom":o.isDOM(a)||s.push({key:e,message:"Expected dom, but get other type"});break;case"string":o.isValidString(a)||s.push({key:e,message:"Expected string, but get other type"});break;case"boolean":o.isBoolean(a)||s.push({key:e,message:"Expected boolean, but get other type"});break;case"function":o.isFunction(a)||s.push({key:e,message:"Expected function, but get other type"});break;case"number":o.isNumber(a)||s.push({key:e,message:"Expected number, but get other type"});break;case"object":o.isObject(a)||s.push({key:e,message:"Expected object, but get other type"});break;case"array":o.isValidArray(a)||s.push({key:e,message:"Expected array, but get other type"});break;default:s.push({key:e,message:e+"的类型未知: "+t.type.toLowerCase()})}t.enum&&-1===t.enum.indexOf(a)&&s.push({key:e,message:"Expected "+e+" to be one of "+(0,r.default)(t.enum)+", but it is not"})}})),s.length>0&&(e.error("[白板]",t+"参数异常"),e.error("[白板]","错误信息：",s),e.error("[白板]","参数为：",n)),0===s.length}}},function(e,t,n){"use strict";var r=n(68).codes.ERR_STREAM_PREMATURE_CLOSE;function a(){}e.exports=function e(t,n,i){if("function"==typeof n)return e(t,null,n);n||(n={}),i=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];e.apply(this,r)}}}(i||a);var o=n.readable||!1!==n.readable&&t.readable,s=n.writable||!1!==n.writable&&t.writable,u=function(){t.writable||l()},c=t._writableState&&t._writableState.finished,l=function(){s=!1,c=!0,o||i.call(t)},d=t._readableState&&t._readableState.endEmitted,f=function(){o=!1,d=!0,s||i.call(t)},p=function(e){i.call(t,e)},h=function(){var e;return o&&!d?(t._readableState&&t._readableState.ended||(e=new r),i.call(t,e)):s&&!c?(t._writableState&&t._writableState.ended||(e=new r),i.call(t,e)):void 0},g=function(){t.req.on("finish",l)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?s&&!t._writableState&&(t.on("end",u),t.on("close",u)):(t.on("complete",l),t.on("abort",h),t.req?g():t.on("request",g)),t.on("end",f),t.on("finish",l),!1!==n.error&&t.on("error",p),t.on("close",h),function(){t.removeListener("complete",l),t.removeListener("abort",h),t.removeListener("request",g),t.req&&t.req.removeListener("finish",l),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",l),t.removeListener("end",f),t.removeListener("error",p),t.removeListener("close",h)}}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=function(e,t,n){e.addEventListener(t,n)},t.off=function(e,t,n){e.removeEventListener(t,n)}},,,function(e,t,n){"use strict";var r;n.r(t),n.d(t,"v1",(function(){return g})),n.d(t,"v3",(function(){return S})),n.d(t,"v4",(function(){return T})),n.d(t,"v5",(function(){return P})),n.d(t,"NIL",(function(){return E})),n.d(t,"version",(function(){return C})),n.d(t,"validate",(function(){return s})),n.d(t,"stringify",(function(){return f})),n.d(t,"parse",(function(){return v}));var a=new Uint8Array(16);function i(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(a)}var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var s=function(e){return"string"==typeof e&&o.test(e)},u=[],c=0;c<256;++c)u.push((c+256).toString(16).substr(1));var l,d,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n},p=0,h=0;var g=function(e,t,n){var r=t&&n||0,a=t||new Array(16),o=(e=e||{}).node||l,s=void 0!==e.clockseq?e.clockseq:d;if(null==o||null==s){var u=e.random||(e.rng||i)();null==o&&(o=l=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==s&&(s=d=16383&(u[6]<<8|u[7]))}var c=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:h+1,v=c-p+(g-h)/1e4;if(v<0&&void 0===e.clockseq&&(s=s+1&16383),(v<0||c>p)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=c,h=g,d=s;var y=(1e4*(268435455&(c+=122192928e5))+g)%4294967296;a[r++]=y>>>24&255,a[r++]=y>>>16&255,a[r++]=y>>>8&255,a[r++]=255&y;var m=c/4294967296*1e4&268435455;a[r++]=m>>>8&255,a[r++]=255&m,a[r++]=m>>>24&15|16,a[r++]=m>>>16&255,a[r++]=s>>>8|128,a[r++]=255&s;for(var b=0;b<6;++b)a[r+b]=o[b];return t||f(a)};var v=function(e){if(!s(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};var y=function(e,t,n){function r(e,r,a,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=v(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(r),o.set(e,r.length),(o=n(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,a){i=i||0;for(var s=0;s<16;++s)a[i+s]=o[s];return a}return f(o)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r};function m(e){return 14+(e+64>>>9<<4)+1}function b(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function w(e,t,n,r,a,i){return b((o=b(b(t,e),b(r,i)))<<(s=a)|o>>>32-s,n);var o,s}function _(e,t,n,r,a,i,o){return w(t&n|~t&r,e,t,a,i,o)}function x(e,t,n,r,a,i,o){return w(t&r|n&~r,e,t,a,i,o)}function k(e,t,n,r,a,i,o){return w(t^n^r,e,t,a,i,o)}function M(e,t,n,r,a,i,o){return w(n^(t|~r),e,t,a,i,o)}var S=y("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r=0;r<n;r+=8){var a=e[r>>5]>>>r%32&255,i=parseInt("0123456789abcdef".charAt(a>>>4&15)+"0123456789abcdef".charAt(15&a),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var n=1732584193,r=-271733879,a=-1732584194,i=271733878,o=0;o<e.length;o+=16){var s=n,u=r,c=a,l=i;n=_(n,r,a,i,e[o],7,-680876936),i=_(i,n,r,a,e[o+1],12,-389564586),a=_(a,i,n,r,e[o+2],17,606105819),r=_(r,a,i,n,e[o+3],22,-1044525330),n=_(n,r,a,i,e[o+4],7,-176418897),i=_(i,n,r,a,e[o+5],12,1200080426),a=_(a,i,n,r,e[o+6],17,-1473231341),r=_(r,a,i,n,e[o+7],22,-45705983),n=_(n,r,a,i,e[o+8],7,1770035416),i=_(i,n,r,a,e[o+9],12,-1958414417),a=_(a,i,n,r,e[o+10],17,-42063),r=_(r,a,i,n,e[o+11],22,-1990404162),n=_(n,r,a,i,e[o+12],7,1804603682),i=_(i,n,r,a,e[o+13],12,-40341101),a=_(a,i,n,r,e[o+14],17,-1502002290),r=_(r,a,i,n,e[o+15],22,1236535329),n=x(n,r,a,i,e[o+1],5,-165796510),i=x(i,n,r,a,e[o+6],9,-1069501632),a=x(a,i,n,r,e[o+11],14,643717713),r=x(r,a,i,n,e[o],20,-373897302),n=x(n,r,a,i,e[o+5],5,-701558691),i=x(i,n,r,a,e[o+10],9,38016083),a=x(a,i,n,r,e[o+15],14,-660478335),r=x(r,a,i,n,e[o+4],20,-405537848),n=x(n,r,a,i,e[o+9],5,568446438),i=x(i,n,r,a,e[o+14],9,-1019803690),a=x(a,i,n,r,e[o+3],14,-187363961),r=x(r,a,i,n,e[o+8],20,1163531501),n=x(n,r,a,i,e[o+13],5,-1444681467),i=x(i,n,r,a,e[o+2],9,-51403784),a=x(a,i,n,r,e[o+7],14,1735328473),r=x(r,a,i,n,e[o+12],20,-1926607734),n=k(n,r,a,i,e[o+5],4,-378558),i=k(i,n,r,a,e[o+8],11,-2022574463),a=k(a,i,n,r,e[o+11],16,1839030562),r=k(r,a,i,n,e[o+14],23,-35309556),n=k(n,r,a,i,e[o+1],4,-1530992060),i=k(i,n,r,a,e[o+4],11,1272893353),a=k(a,i,n,r,e[o+7],16,-155497632),r=k(r,a,i,n,e[o+10],23,-1094730640),n=k(n,r,a,i,e[o+13],4,681279174),i=k(i,n,r,a,e[o],11,-358537222),a=k(a,i,n,r,e[o+3],16,-722521979),r=k(r,a,i,n,e[o+6],23,76029189),n=k(n,r,a,i,e[o+9],4,-640364487),i=k(i,n,r,a,e[o+12],11,-421815835),a=k(a,i,n,r,e[o+15],16,530742520),r=k(r,a,i,n,e[o+2],23,-995338651),n=M(n,r,a,i,e[o],6,-198630844),i=M(i,n,r,a,e[o+7],10,1126891415),a=M(a,i,n,r,e[o+14],15,-1416354905),r=M(r,a,i,n,e[o+5],21,-57434055),n=M(n,r,a,i,e[o+12],6,1700485571),i=M(i,n,r,a,e[o+3],10,-1894986606),a=M(a,i,n,r,e[o+10],15,-1051523),r=M(r,a,i,n,e[o+1],21,-2054922799),n=M(n,r,a,i,e[o+8],6,1873313359),i=M(i,n,r,a,e[o+15],10,-30611744),a=M(a,i,n,r,e[o+6],15,-1560198380),r=M(r,a,i,n,e[o+13],21,1309151649),n=M(n,r,a,i,e[o+4],6,-145523070),i=M(i,n,r,a,e[o+11],10,-1120210379),a=M(a,i,n,r,e[o+2],15,718787259),r=M(r,a,i,n,e[o+9],21,-343485551),n=b(n,s),r=b(r,u),a=b(a,c),i=b(i,l)}return[n,r,a,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(m(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}));var T=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=r[a];return t}return f(r)};function I(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function O(e,t){return e<<t|e>>>32-t}var P=y("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var a=0;a<r.length;++a)e.push(r.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,o=Math.ceil(i/16),s=new Array(o),u=0;u<o;++u){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=e[64*u+4*l]<<24|e[64*u+4*l+1]<<16|e[64*u+4*l+2]<<8|e[64*u+4*l+3];s[u]=c}s[o-1][14]=8*(e.length-1)/Math.pow(2,32),s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<o;++d){for(var f=new Uint32Array(80),p=0;p<16;++p)f[p]=s[d][p];for(var h=16;h<80;++h)f[h]=O(f[h-3]^f[h-8]^f[h-14]^f[h-16],1);for(var g=n[0],v=n[1],y=n[2],m=n[3],b=n[4],w=0;w<80;++w){var _=Math.floor(w/20),x=O(g,5)+I(_,v,y,m)+b+t[_]+f[w]>>>0;b=m,m=y,y=O(v,30)>>>0,v=g,g=x}n[0]=n[0]+g>>>0,n[1]=n[1]+v>>>0,n[2]=n[2]+y>>>0,n[3]=n[3]+m>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),E="00000000-0000-0000-0000-000000000000";var C=function(e){if(!s(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},function(e,t,n){n(144),e.exports=n(6).Number.isInteger},function(e,t,n){var r=n(8);r(r.S,"Number",{isInteger:n(145)})},function(e,t,n){var r=n(15),a=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&a(e)===e}},function(e,t,n){n(147),e.exports=n(6).Object.assign},function(e,t,n){var r=n(8);r(r.S+r.F,"Object",{assign:n(148)})},function(e,t,n){"use strict";var r=n(17),a=n(46),i=n(63),o=n(61),s=n(34),u=n(75),c=Object.assign;e.exports=!c||n(28)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var n=s(e),c=arguments.length,l=1,d=i.f,f=o.f;c>l;)for(var p,h=u(arguments[l++]),g=d?a(h).concat(d(h)):a(h),v=g.length,y=0;v>y;)p=g[y++],r&&!f.call(h,p)||(n[p]=h[p]);return n}:c},function(e,t,n){var r=n(30),a=n(59),i=n(150);e.exports=function(e){return function(t,n,o){var s,u=r(t),c=a(u.length),l=i(o,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(77),a=Math.max,i=Math.min;e.exports=function(e,t){return(e=r(e))<0?a(e+t,0):i(e,t)}},function(e,t,n){e.exports={default:n(152),__esModule:!0}},function(e,t,n){n(37),n(43),e.exports=n(64).f("iterator")},function(e,t,n){var r=n(77),a=n(76);e.exports=function(e){return function(t,n){var i,o,s=String(a(t)),u=r(n),c=s.length;return u<0||u>=c?e?"":void 0:(i=s.charCodeAt(u))<55296||i>56319||u+1===c||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):i:e?s.slice(u,u+2):o-56320+(i-55296<<10)+65536}}},function(e,t,n){"use strict";var r=n(62),a=n(45),i=n(50),o={};n(27)(o,n(11)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(o,{next:a(1,n)}),i(e,t+" Iterator")}},function(e,t,n){"use strict";var r=n(156),a=n(109),i=n(40),o=n(30);e.exports=n(81)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t,n){n(122),n(66),n(160),n(161),e.exports=n(6).Symbol},function(e,t,n){var r=n(46),a=n(63),i=n(61);e.exports=function(e){var t=r(e),n=a.f;if(n)for(var o,s=n(e),u=i.f,c=0;s.length>c;)u.call(e,o=s[c++])&&t.push(o);return t}},function(e,t,n){var r=n(30),a=n(91).f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==i.call(e)?function(e){try{return a(e)}catch(e){return o.slice()}}(e):a(r(e))}},function(e,t,n){n(83)("asyncIterator")},function(e,t,n){n(83)("observable")},function(e,t,n){var r=n(23),a=n(58),i=n(11)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[i])?t:a(n)}},function(e,t,n){var r,a,i,o=n(26),s=n(247),u=n(121),c=n(89),l=n(12),d=l.process,f=l.setImmediate,p=l.clearImmediate,h=l.MessageChannel,g=l.Dispatch,v=0,y={},m=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},b=function(e){m.call(e.data)};f&&p||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++v]=function(){s("function"==typeof e?e:Function(e),t)},r(v),v},p=function(e){delete y[e]},"process"==n(53)(d)?r=function(e){d.nextTick(o(m,e,1))}:g&&g.now?r=function(e){g.now(o(m,e,1))}:h?(i=(a=new h).port2,a.port1.onmessage=b,r=o(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),m.call(e)}}:function(e){setTimeout(o(m,e,1),0)}),e.exports={set:f,clear:p}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(23),a=n(15),i=n(123);e.exports=function(e,t){if(r(e),a(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){var r=n(6),a=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},function(e,t,n){n(168);var r=n(6).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(8);r(r.S+r.F*!n(17),"Object",{defineProperty:n(16).f})},function(e,t,n){n(170),e.exports=n(6).Object.keys},function(e,t,n){var r=n(34),a=n(46);n(94)("keys",(function(){return function(e){return a(r(e))}}))},function(e,t,n){n(66),n(37),n(43),n(172),n(176),n(178),n(179),e.exports=n(6).Set},function(e,t,n){"use strict";var r=n(113),a=n(85);e.exports=n(114)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(a(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){var r=n(26),a=n(75),i=n(34),o=n(59),s=n(174);e.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,d=6==e,f=5==e||d,p=t||s;return function(t,s,h){for(var g,v,y=i(t),m=a(y),b=r(s,h,3),w=o(m.length),_=0,x=n?p(t,w):u?p(t,0):void 0;w>_;_++)if((f||_ in m)&&(v=b(g=m[_],_,y),e))if(n)x[_]=v;else if(v)switch(e){case 3:return!0;case 5:return g;case 6:return _;case 2:x.push(g)}else if(l)return!1;return d?-1:c||l?l:x}}},function(e,t,n){var r=n(175);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(15),a=n(110),i=n(11)("species");e.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),r(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var r=n(8);r(r.P+r.R,"Set",{toJSON:n(115)("Set")})},function(e,t,n){var r=n(51);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t,n){n(116)("Set")},function(e,t,n){n(117)("Set")},function(e,t,n){n(43),n(37),e.exports=n(181)},function(e,t,n){var r=n(23),a=n(84);e.exports=n(6).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){n(37),n(183),e.exports=n(6).Array.from},function(e,t,n){"use strict";var r=n(26),a=n(8),i=n(34),o=n(111),s=n(112),u=n(59),c=n(126),l=n(84);a(a.S+a.F*!n(125)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,a,d,f=i(e),p="function"==typeof this?this:Array,h=arguments.length,g=h>1?arguments[1]:void 0,v=void 0!==g,y=0,m=l(f);if(v&&(g=r(g,h>2?arguments[2]:void 0,2)),null==m||p==Array&&s(m))for(n=new p(t=u(f.length));t>y;y++)c(n,y,v?g(f[y],y):f[y]);else for(d=m.call(f),n=new p;!(a=d.next()).done;y++)c(n,y,v?o(d,g,[a.value,y],!0):a.value);return n.length=y,n}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.min=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Math.min(e,t)}))},t.max=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Math.max(e,t)}))}},function(e,t,n){"use strict";var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(38),l=new(function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.resultReturns,a=e.onDone,i=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,n){return t(n)},onResult:function(e,t,r){return"if("+t+" !== undefined) {\n"+n(t)+";\n} else {\n"+r()+"}\n"},resultReturns:r,onDone:a,rethrowIfPossible:i})}}]),t}(n(42))),d=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncBailHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncBailHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){n(187),e.exports=n(6).Object.getPrototypeOf},function(e,t,n){var r=n(34),a=n(90);n(94)("getPrototypeOf",(function(){return function(e){return a(r(e))}}))},function(e,t,n){n(189),e.exports=n(6).Object.setPrototypeOf},function(e,t,n){var r=n(8);r(r.S,"Object",{setPrototypeOf:n(190).set})},function(e,t,n){var r=n(15),a=n(23),i=function(e,t){if(a(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(26)(Function.call,n(71).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return i(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:i}},function(e,t,n){n(192);var r=n(6).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){var r=n(8);r(r.S,"Object",{create:n(62)})},function(e,t,n){n(66),n(37),n(43),n(194),n(195),n(196),n(197),e.exports=n(6).Map},function(e,t,n){"use strict";var r=n(113),a=n(85);e.exports=n(114)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(a(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(a(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(8);r(r.P+r.R,"Map",{toJSON:n(115)("Map")})},function(e,t,n){n(116)("Map")},function(e,t,n){n(117)("Map")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(n(41)),a=g(n(5)),i=g(n(2)),o=g(n(0)),s=g(n(1)),u=g(n(3)),c=g(n(4)),l=n(18),d=g(n(87)),f=g(n(48)),p=n(273),h=n(96);function g(e){return e&&e.__esModule?e:{default:e}}var v=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="pen",e.description="涂鸦操作工具。\n首先使用op:pen:activate设置画布为涂鸦模式。通过op:pen:lineWidth, op:pen:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){var t=this.points,n=this.opsManager.currPage.getOpId(),r=this.app.room.opIdSnapshotMap[n];if(!r||!r.snapshot.hasOwnProperty("category"))return(0,a.default)({points:t.slice(),total:t.length},this.getFreeDrawCommonProperty({inProgress:e}));var i={boundary:this.getBoundaryRectOfFreeDraw()};return this.sampleSeq>0&&e?(0,a.default)((0,a.default)({},i),{points:t.slice(t.length-f.default.pointsPerBatch),total:t.length}):this.sampleSeq>0?(0,a.default)((0,a.default)({},i),{points:t.slice(t.length-f.default.pointsPerBatch),total:t.length,inProgress:e}):(0,a.default)({points:t.slice(),total:t.length},this.getFreeDrawCommonProperty({inProgress:e}))}},{key:"_draw",value:function(e,t){var n=e.data,r=n.points.map((function(e){return e?(0,l.getTransformedPoint)(e,n.dx,n.dy,n.scaleX,n.scaleY):e}));return(0,p.drawCurve)(t,r,.5),r}},{key:"draw",value:function(e,t){var n=e.data;this._draw(e,t),this.strokeOrFill(t,{stroke:n.color,lineWidth:n.lineWidth,opacity:n.opacity})}},{key:"ifMouseOnOp",value:function(e,t,n){var r=this.app.container.ctx;return this._draw(e,r),r.lineWidth=e.data.lineWidth+20,r.strokeStyle="rgba(0,0,0,0)",r.stroke(),r.isPointInStroke(t,n)}},{key:"mergePartial",value:function(e,t){var n=this._mergePartial(e,t);return n.data.points.length!==n.data.total&&this.logger.warn("merge ........",e,t),n}},{key:"_mergePartial",value:function(e,t){try{var n=t.data.total-e.data.total;if(0===n)return(0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)((0,a.default)({},e.data),t.data),{points:e.data.points})});if(n<0){var i=t.data.total-t.data.points.length,o=t.data.total;return(0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)((0,a.default)({},e.data),t.data),{total:e.data.total,boundary:e.data.boundary,points:[].concat((0,r.default)(e.data.points.slice(0,i)),(0,r.default)(t.data.points),(0,r.default)(e.data.points.slice(o)))})})}if(n<=t.data.points.length){var s=t.data.points.length-n;return(0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)((0,a.default)({},e.data),t.data),{points:e.data.points.concat(t.data.points.slice(s))})})}var u=n-t.data.points.length;return(0,a.default)((0,a.default)({},e),{data:(0,a.default)((0,a.default)((0,a.default)({},e.data),t.data),{points:[].concat((0,r.default)(e.data.points),(0,r.default)(new Array(u)),(0,r.default)(t.data.points))})})}catch(n){return h.LOG&&this.logger.warn("[白板] mergePartial error",e,t),e}}}]),t}(d.default);t.default=v},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMi41Mzg2IDIuNDYwMzRDMTMuMTUyNCAxLjg0NjU2IDE0LjE0NzUgMS44NDY1NSAxNC43NjEzIDIuNDYwMzRMMTcuNTM5NyA1LjIzODcxQzE4LjE1MzQgNS44NTI0OSAxOC4xNTM0IDYuODQ3NjIgMTcuNTM5NyA3LjQ2MTRMNy44MDEyMiAxNy4xOTk4QzcuNTQyMjIgMTcuNDU4OCA3LjIwMDkgMTcuNjE5MiA2LjgzNjIyIDE3LjY1MzRMMy4xODEyNyAxNy45OTUyQzIuNTA3MTMgMTguMDU4MiAxLjk0MTc2IDE3LjQ5MjkgMi4wMDQ4MSAxNi44MTg3TDIuMzQ2NjQgMTMuMTYzOEMyLjM4MDc1IDEyLjc5OTEgMi41NDExNSAxMi40NTc4IDIuODAwMTUgMTIuMTk4OEwxMi41Mzg2IDIuNDYwMzRaTTEzLjkyNzggMy4yOTM4NUMxMy43NzQzIDMuMTQwNCAxMy41MjU2IDMuMTQwNCAxMy4zNzIxIDMuMjkzODVMMy42MzM2NiAxMy4wMzIzQzMuNTY4OTEgMTMuMDk3IDMuNTI4ODEgMTMuMTgyNCAzLjUyMDI4IDEzLjI3MzVMMy4xODk0OSAxNi44MTA1TDYuNzI2NDYgMTYuNDc5N0M2LjgxNzYzIDE2LjQ3MTIgNi45MDI5NiAxNi40MzExIDYuOTY3NyAxNi4zNjYzTDE2LjcwNjIgNi42Mjc4OUMxNi44NTk2IDYuNDc0NDUgMTYuODU5NiA2LjIyNTY2IDE2LjcwNjIgNi4wNzIyMkwxMy45Mjc4IDMuMjkzODVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjYyMjQgOS41NDUxOEwxMC40NTQ4IDUuMzc3NjJMMTEuMjg4MyA0LjU0NDExTDE1LjQ1NTkgOC43MTE2N0wxNC42MjI0IDkuNTQ1MThaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(41)),a=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4)),c=n(18);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="line",e.description="绘制线段。\n首先使用op:line:activate设置画布为线段模式。通过op:line:lineWidth, op:line:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({inProgress:e})}},{key:"getBoundaryRect",value:function(){return this.getBoundaryRectOfLine()}},{key:"draw",value:function(e,t){var n=e.data,a=this.getStartEndPointFromSnapshot(n),i=a.sp,o=a.ep;t.beginPath(),t.moveTo.apply(t,(0,r.default)((0,c.getTransformedPoint)(i,n.dx,n.dy,n.scaleX,n.scaleY))),t.lineTo.apply(t,(0,r.default)((0,c.getTransformedPoint)(o,n.dx,n.dy,n.scaleX,n.scaleY))),this.strokeOrFill(t,{stroke:n.color,lineWidth:n.lineWidth,opacity:n.opacity})}},{key:"ifMouseOnOp",value:function(e,t,n){var a=this.app.container.ctx,i=e.data,o=this.getStartEndPointFromSnapshot(i),s=o.sp,u=o.ep;return a.beginPath(),a.moveTo.apply(a,(0,r.default)((0,c.getTransformedPoint)(s,i.dx,i.dy,i.scaleX,i.scaleY))),a.lineTo.apply(a,(0,r.default)((0,c.getTransformedPoint)(u,i.dx,i.dy,i.scaleX,i.scaleY))),a.strokeStyle="rgba(0,0,0,0)",a.lineWidth=i.lineWidth+20,a.stroke(),a.isPointInStroke(t,n)}},{key:"getStartEndPointFromSnapshot",value:function(e){var t=void 0,n=void 0;return Array.isArray(e.points)?(t=e.points[0],n=e.points[e.points.length-1]):(t=e.sp,n=e.ep),{sp:t,ep:n}}}]),t}(l(n(87)).default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(10)),c=n(36),l=d(n(48));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.points=[],e.lastSelectedOpIds=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"postMouseUp",value:function(e){}},{key:"postClick",value:function(e){}},{key:"postMouseMove",value:function(e,t){}},{key:"handleMouseDown",value:function(e,t,n){t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.dispatch(this.getSelectionSnapshot(!1,[])),this.points=[[t,n]];var r=(0,c.findOpsUnderMouse)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage,this.opsManager);this.dispatch(this.getSelectionSnapshot(!0,r)),this.lastSelectedOpIds=r}},{key:"handleMouseMove",value:function(e,t,n){t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.isMouseDown?this.points.push([t,n]):this.points=[[t,n]];var r=void 0;if(this.isMouseDown)r=(0,c.findOpsUnderRect)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage),this.dispatch(this.getSelectionSnapshot(!0,r));else{var a=(0,c.findOpsUnderMouse)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage,this.opsManager);r=(0,c.arrayDeduce)(a,this.opsManager.selectedOpIds),(0,c.idsChanged)(r,this.lastSelectedOpIds)&&this.dispatch(this.getSelectionSnapshot(!0,r,!0))}this.lastSelectedOpIds=r,this.postMouseMove(e,r)}},{key:"handleMouseUp",value:function(e,t,n){if(this.isMouseDown){t=Number(t.toFixed(1)),n=Number(n.toFixed(1));var r=this.isMouseDown?(0,c.findOpsUnderRect)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage):(0,c.findOpsUnderMouse)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage,this.opsManager);this.postMouseUp(r)}}},{key:"handleClick",value:function(e,t,n){t=Number(t.toFixed(2)),n=Number(n.toFixed(2)),this.points=[[t,n]];var r=(0,c.findOpsUnderMouse)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage,this.opsManager);this.postClick(r)}},{key:"getSelectionSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{type:"select",sp:this.sp,ep:this.ep,inProgress:e,selectedOpIds:t.slice(),reuseOpType:n?"select-hover":"select",skipUndo:!0,color:l.default.strokeColor,nickname:this.app.nickname}}},{key:"sp",get:function(){return this.points.length>0?this.points[0]:void 0}},{key:"ep",get:function(){return this.points.length>0?this.points[this.points.length-1]:void 0}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(2)),a=c(n(0)),i=c(n(1)),o=c(n(3)),s=c(n(4)),u=n(18);function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="rect",e.shouldSaniteEp=!0,e.description="绘制矩形。\n首先使用op:rect:activate设置画布为矩形模式。通过op:rect:lineWidth, op:rect:stroke, op:rect:fill设置矩形的宽度和颜色。然后画布会监听鼠标动作，生成矩形。具体用法如下：",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({strokeOrFill:"stroke",inProgress:e})}},{key:"draw",value:function(e,t){var n=e.data,r=(0,u.getTransformedPoint)(n.sp,n.dx,n.dy,n.scaleX,n.scaleY),a=(0,u.getTransformedPoint)(n.ep,n.dx,n.dy,n.scaleX,n.scaleY);t.beginPath(),t.rect(r[0],r[1],a[0]-r[0],a[1]-r[1]),this.strokeOrFill(t,{stroke:n.stroke,fill:n.fill,lineWidth:n.lineWidth,opacity:n.opacity})}}]),t}(c(n(87)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(2)),a=c(n(0)),i=c(n(1)),o=c(n(3)),s=c(n(4)),u=n(18);function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="ellipse",e.shouldSaniteEp=!0,e.description="绘制椭圆形",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({strokeOrFill:"stroke",inProgress:e})}},{key:"draw",value:function(e,t){var n=e.data,r=(0,u.getTransformedPoint)(n.sp,n.dx,n.dy,n.scaleX,n.scaleY),a=(0,u.getTransformedPoint)(n.ep,n.dx,n.dy,n.scaleX,n.scaleY),i=r[0]/2+a[0]/2,o=r[1]/2+a[1]/2,s=Math.abs(a[0]-r[0])/2,c=Math.abs(a[1]-r[1])/2;t.beginPath(),t.ellipse(i,o,s,c,0,0,2*Math.PI,!0),this.strokeOrFill(t,{stroke:n.stroke,fill:n.fill,lineWidth:n.lineWidth,opacity:n.opacity})}},{key:"ifMouseOnOp",value:function(e,t,n){var r=this.app.container.ctx,a=e.data,i=(0,u.getTransformedPoint)(a.sp,a.dx,a.dy,a.scaleX,a.scaleY),o=(0,u.getTransformedPoint)(a.ep,a.dx,a.dy,a.scaleX,a.scaleY),s=i[0]/2+o[0]/2,c=i[1]/2+o[1]/2,l=Math.abs(o[0]-i[0])/2,d=Math.abs(o[1]-i[1])/2;return r.beginPath(),r.ellipse(s,c,l,d,0,0,2*Math.PI,!0),r.fillStyle="rgba(0,0,0,0)",r.fill(),r.isPointInPath(t,n)}}]),t}(c(n(87)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MIN_FONT_SIZE=t.MAX_FONT_SIZE=t.printTextInMultiLine=void 0;var r,a=n(9),i=(r=a)&&r.__esModule?r:{default:r};t.testFontSizeText=function(e){var t=Number(e);return isNaN(t)?"nan":t>o?"exceed_max":t<=s?"exceed_min":"valid"};t.printTextInMultiLine=function(e,t,n,r,a){var o=t.split(/\r?\n/g),s=0,u=!0,c=!1,l=void 0;try{for(var d,f=(0,i.default)(o);!(u=(d=f.next()).done);u=!0){var p=d.value;e.fillText(p,n,r+a*s),s++}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}};var o=t.MAX_FONT_SIZE=999,s=t.MIN_FONT_SIZE=12},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var a,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(a=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(a)+")")}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(0)),a=o(n(1)),i=o(n(207));function o(e){return e&&e.__esModule?e:{default:e}}var s=void 0,u=function(){function e(){(0,r.default)(this,e)}return(0,a.default)(e,null,[{key:"createInstance",value:function(){return this._instance=this._instance||new i.default,this._instance}},{key:"show",value:function(e){var t=this,n=e.time,r=void 0===n?3:n;this._instance||this.createInstance(),this._instance.show(e),s&&clearTimeout(s),r&&(s=setTimeout((function(){t.hide()}),1e3*r))}},{key:"hide",value:function(){s&&clearTimeout(s),this._instance&&this._instance.hide()}},{key:"destory",value:function(){this._instance&&(this._instance.destroy(),this._instance=null)}}]),e}();t.default=u,u._instance=null},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(70)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}n(208);var s=function(){function e(){(0,a.default)(this,e),this.toastDiv=document.createElement("div"),this.toastDiv.className="whiteboard-toast",this.toastDiv.onclick=this.hide.bind(this),document.body.appendChild(this.toastDiv)}return(0,i.default)(e,[{key:"show",value:function(e){var t=this.toastDiv;t.style.display="block","warn"===e.type?(t.style.color="#8a6d3b",t.style.backgroundColor="#fcf8e3",t.style.borderColor="#faebcc"):"info"===e.type?(t.style.color="#31708f",t.style.backgroundColor="#d9edf7",t.style.borderColor="#bce8f1"):"error"===e.type?(t.style.color="#a94442",t.style.backgroundColor="#f2dede",t.style.borderColor="#ebccd1"):(t.style.color="#3c763d",t.style.backgroundColor="#dff0d8",t.style.borderColor="#d6e9c6"),(0,r.default)(e.top)&&(t.style.top=e.top+"px"),t.innerHTML=e.msg}},{key:"hide",value:function(){this.toastDiv&&(this.toastDiv.style.display="none")}},{key:"destroy",value:function(){this.toastDiv&&(document.body.removeChild(this.toastDiv),this.toastDiv=null)}}]),e}();t.default=s},function(e,t,n){var r=n(209);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(25)(r,a);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(24)(!1)).push([e.i,".whiteboard-toast {\n    display: none;\n    position: fixed;\n    left: 50%;\n    transform: translate(-50%);\n    top: 200px;\n    padding: 8px 15px;\n    margin-bottom: 20px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    color: #3c763d;\n    background-color: #dff0d8;\n    border-color: #d6e9c6;\n    z-index: 100;\n}",""])},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTIiIHk9IjEuNDQyMjkiIHdpZHRoPSI4LjM4OTY3IiBoZWlnaHQ9IjE0LjY4MTkiIHJ4PSIxIiB0cmFuc2Zvcm09InJvdGF0ZSg0NSAxMiAxLjQ0MjI5KSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuNTg0NSA4Ljg1Nzc5TDEwLjUxNjkgMTQuNzkwMiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuMjI0NjQgMTcuNjgxOEgxNS43NjA0IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=y(n(35)),a=y(n(5)),i=y(n(2)),o=y(n(0)),s=y(n(1)),u=y(n(3)),c=y(n(4)),l=y(n(10)),d=n(18),f=n(103),p=n(131),h=n(36),g=y(n(309)),v=y(n(322));function y(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.mediaPlugins={},e.description="多媒体文件类操作",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.app.on("event:deletePage",this.handleDeletePage.bind(this))}},{key:"handleDeletePage",value:function(e){if(e)for(var t in e.drawOpQueue)this.mediaPlugins.hasOwnProperty(t)&&(this.mediaPlugins[t].destroy(),delete this.mediaPlugins[t])}},{key:"destroy",value:function(){for(var e in this.mediaPlugins)this.mediaPlugins[e].destroy(),delete this.mediaPlugins[e]}},{key:"getMediaPluginByType",value:function(e){return"video"===e?g.default:v.default}},{key:"addMedia",value:function(e,t){var n=this,r=this.app.room.currBoard,a=this.opsManager.currPage;if(t&&void 0!==t.boardName&&void 0!==t.pageName){var i=this.app.room.getPage(t.boardName,t.pageName);i&&(a=i)}else if(t&&void 0!==t.pageName){var o=this.app.room.getPage(r.boardName,t.pageName);o&&(a=o)}if((0,f.mediaResourceLoaded)(e,this.type)){var s=(0,f.getMediaResource)(e),u=this.getMediaPluginByType(this.type).getElementWidth(t.width,s),c=this.getMediaPluginByType(this.type).getElementHeight(u,s);this.dispatchMedia({url:e,title:t.title,width:u,height:c,page:a,sourceType:t.sourceType})}else a.addWaitingResource(e),(0,f.fetchMediaResource)(e,t.sourceType,this.type,(function(r){var i=n.getMediaPluginByType(n.type).getElementWidth(t.width,r),o=n.getMediaPluginByType(n.type).getElementHeight(i,r);n.dispatchMedia({url:e,title:t.title,width:i,height:o,page:a,sourceType:t.sourceType}),a.removeWaitingResource(e)}))}},{key:"dispatchMedia",value:function(e){var t=(0,p.getImageProperPosition)(this,e.width,e.height),n=t.sx,r=t.sy,i=t.width,o=t.height,s={};"audio"===this.type&&(s.fixRealWorldHeight=v.default.getElementHeight()),e.page?this.dispatchFromPage({type:this.type,url:e.url,skipUndo:!1,title:e.title?e.title:"",sourceType:e.sourceType,boundary:(0,a.default)({w:i,h:o,sx:n,sy:r},s)},e.page):this.dispatch({type:this.type,url:e.url,skipUndo:!1,title:e.title?e.title:"",sourceType:e.sourceType,boundary:(0,a.default)({w:i,h:o,sx:n,sy:r},s)})}},{key:"preview",value:function(){}},{key:"draw",value:function(e,t,n){if(!this.mediaPlugins[e.opId]){var a=this.getMediaPluginByType(e.data.type);this.mediaPlugins[e.opId]=new a(e,this.app,this)}var i=this.mediaPlugins[e.opId],o=e.data,s=(0,d.getTransformedBoundary)(this.app.camera.scale,o.boundary,o.dx,o.dy,o.scaleX,o.scaleY),u=this.app.container.el,c=o.url;if((0,f.mediaResourceLoaded)(c,this.type)&&u){var l=u.querySelector("[id='"+e.opId+"']");l||((l=document.createElement("div")).style.position="fixed",l.id=""+e.opId,l.className="video-plugin-container",u.insertBefore(l,this.app.container.imageEl),i.mountElement(l,c));var p=this.app.camera.convertWorldPointInContainer(s.sx,s.sy),h=(0,r.default)(p,2),g=h[0],v=h[1],y=this.app.camera.convertWorldPointInContainer(s.sx+s.w,s.sy+s.h),m=(0,r.default)(y,2),b=m[0],w=m[1];l.style.width=b-g+"px",l.style.height=w-v+"px",l.style.left=g+this.app.container.left+"px",l.style.top=v+this.app.container.top+"px",i.onReceiveAttributes(e),i.onSizeChange({width:b-g,height:w-v})}var _=e.data.sourceType;(0,f.mediaResourceLoaded)(c,this.type)||(n.page.addWaitingResource(c),(0,f.fetchMediaResource)(c,_,this.type,(function(){n.page.removeWaitingResource(c)})))}},{key:"hide",value:function(e,t,n){var r=this.mediaPlugins[e.opId];r&&(r.destroy(),delete this.mediaPlugins[e.opId])}},{key:"transformOp",value:function(e,t){return(0,h.transformPropertyOverwriteOp)(e,t)}}]),t}(l.default);t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(5)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{emitEvent:!0};(0,a.default)(this,e),this.isDragging=!1,this.lastPercent=0,this.onMouseDown=function(e){e.stopPropagation(),e.preventDefault(),t.isDragging=!0,t.lastPercent=-1,t.onMouseMove(e)},this.onMouseMove=function(e){if(t.isDragging){e.stopPropagation(),e.preventDefault();var n=t.getPercent(e);t.lastPercent=n,t.seekListener&&t.seekListener(n,!0),t.updateProgress(n)}},this.onMouseUp=function(e){if(t.isDragging){e.stopPropagation(),e.preventDefault();var n=t.lastPercent;t.updateProgress(n),t.seekListener&&t.seekListener(n,!1)}t.isDragging=!1},this.getPercent=function(e){var n=0,r=t.widget.getBoundingClientRect().left;n=e.type.search(/mouse|click/)>-1?e.clientX-r:e.touches[0].clientX-r;var a=t.widget.offsetWidth;return n<0&&(n=0),n>a&&(n=a),n/a};var o=document.createElement("div");(0,r.default)(o.style,{flex:"auto",height:"4px",position:"relative",pointerEvents:i.emitEvent?"auto":"none",cursor:i.emitEvent?"pointer":"auto"});var s=document.createElement("div"),u=document.createElement("div");o.appendChild(s),o.appendChild(u);var c={height:"100%",position:"absolute",top:"50%",transform:"translateY(-50%)"};(0,r.default)(s.style,(0,r.default)({width:"100%",backgroundColor:"rgb(0,0,0)"},c)),(0,r.default)(u.style,(0,r.default)({width:100*n+"%",backgroundColor:"rgb(255,255,255)"},c)),this.widget=o,this.frontBar=u,i.emitEvent&&this.bindEvents()}return(0,i.default)(e,[{key:"addSeekListener",value:function(e){this.seekListener=e}},{key:"bindEvents",value:function(){this.widget.addEventListener("mousedown",this.onMouseDown),this.widget.addEventListener("touchstart",this.onMouseDown),window.document.addEventListener("mousemove",this.onMouseMove),window.document.addEventListener("touchmove",this.onMouseMove),window.document.addEventListener("mouseup",this.onMouseUp),window.document.addEventListener("touchend",this.onMouseUp)}},{key:"destroy",value:function(){this.widget.removeEventListener("mousedown",this.onMouseDown),this.widget.removeEventListener("touchstart",this.onMouseDown),window.document.removeEventListener("mousemove",this.onMouseMove),window.document.removeEventListener("touchmove",this.onMouseMove),window.document.removeEventListener("mouseup",this.onMouseUp),window.document.removeEventListener("touchend",this.onMouseUp),this.seekListener=void 0}},{key:"updateProgress",value:function(e){this.lastPercent=e,this.frontBar.style.width=100*e+"%"}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=w(n(5)),a=w(n(21)),i=w(n(2)),o=w(n(0)),s=w(n(1)),u=w(n(3)),c=w(n(4)),l=w(n(13)),d=n(103),f=w(n(312)),p=w(n(214)),h=w(n(313)),g=w(n(314)),v=w(n(315));n(316);var y=n(319),m=n(215),b=n(130);function w(e){return e&&e.__esModule?e:{default:e}}var _=function(e,t,n,r){return new(n||(n=l.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},x=function(e){return new l.default((function(t){return setTimeout(t,e)}))},k=(0,b.isIosDevice)(),M=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.selfMute=!k,e.count=0,e.lastTimeCalibrateCheck=null,e.isWaiting=!1,e.onPageInVisible=function(){e.media&&e.media.pause()},e.onPageVisible=function(){e.boardName===e.app.room.currIndex&&e.pageName===e.app.room.currBoard.currIndex.toString()&&e.setNativeInitState()},e.onContainerMouseOver=function(){var t;null===(t=e.mediaDiv)||void 0===t||t.classList.add("visible")},e.onContainerMouseMove=function(){var t;clearTimeout(e.mediaDivHideTimer),e.mediaDivHideTimer=void 0,null===(t=e.mediaDiv)||void 0===t||t.classList.add("visible")},e.onContainerMouseLeave=function(){e.mediaDivHideTimer||(e.mediaDivHideTimer=setTimeout((function(){var t;null===(t=e.mediaDiv)||void 0===t||t.classList.remove("visible"),e.mediaDivHideTimer=void 0}),1500))},e.onMediaWait=function(){e.isWaiting=!0},e.onMediaCanPlay=function(){clearTimeout(e.canPlayTimer),e.canPlayTimer=setTimeout((function(){if(e.isWaiting&&e.media){e.isWaiting=!1;var t=e.getCurrTimeFromData(e.data);Math.abs(t-e.media.currentTime)>1.5&&e.setNativeCurrTime(e.data)}}),30)},e.onDurationChange=function(){e.media&&(e.duration=e.media.duration,e.updateTimeLabel(e.data.seek))},e.onTimeUpdate=function(){var t;if(e.media){e.updateTimeLabel(e.media.currentTime),"number"!=typeof e.duration||isNaN(e.duration)||null===(t=e.progressController)||void 0===t||t.updateProgress(e.media.currentTime/e.duration);var n=e.getNtpTime();if(null===e.lastTimeCalibrateCheck||n-e.lastTimeCalibrateCheck>5e3){var r=e.getCurrTimeFromData(e.data);Math.abs(r-e.media.currentTime)>1.2&&e.setNativeCurrTime(e.data),e.lastTimeCalibrateCheck=n}}},e.onMediaEnd=function(){if(e.isCreator()&&!e.isInReplay()&&e.media&&e.duration){var t=e.media.currentTime-e.duration;e.count<100&&(e.count++,console.warn("media end","video time",e.media.currentTime,"duration",e.duration),console.warn("")),Math.abs(t)<1&&e.putAttributes({ended:!0,seek:"number"==typeof e.duration?e.duration:0,play:!1})}},e.onPlayClick=function(t){t.stopPropagation(),t.preventDefault(),e.media&&(e.data.ended?e.onNativePlayChange(!0,0):e.onNativePlayChange(!e.data.play,e.media.currentTime))},e.onDeleteClick=function(t){t.stopPropagation(),t.preventDefault(),e.app.deleteElementByOpIds([e.opId])},e.onSelfMuteClick=function(){e.selfMute=!e.selfMute,e.updateSelfMute()},e.eventStopPropagation=function(e){e.stopPropagation()},e.setNativeInitState=function(){return _(e,void 0,void 0,a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.data.hasOwnProperty("play")&&this.setNativePlayState(this.data.play),!this.data.hasOwnProperty("seek")){e.next=6;break}if(!k){e.next=5;break}return e.next=5,x(300);case 5:this.setNativeCurrTime(this.data);case 6:case"end":return e.stop()}}),e,this)})))},e.onNativePlayChange=function(t,n){e.isCreator()&&!e.isInReplay()&&e.putAttributes({play:t,seek:n,seekTime:e.getNtpTime()/1e3,ended:!1})},e.onNativeSeek=function(t){e.isCreator()&&!e.isInReplay()&&e.putAttributes({seek:t,seekTime:e.getNtpTime()/1e3})},e.setNativePlayState=function(t){return _(e,void 0,void 0,a.default.mark((function e(){var n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.media,this.updatePlayIcon("boolean"==typeof t&&t),!t||!n){e.next=15;break}return e.prev=3,e.next=6,n.play();case 6:e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(3),""+e.t0.name!="NotAllowedError"&&""+e.t0.name!="AbortError"){e.next=13;break}return e.next=13,n.play();case 13:e.next=18;break;case 15:if(!n){e.next=18;break}return e.next=18,n.pause();case 18:case"end":return e.stop()}}),e,this,[[3,8]])})))},e.getTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e){return e<10?"0"+e:""+e},r=(e=~~e)%60,a=(e=~~((e-=r)/60))%60,i=~~(e/60);return 0===i&&!1===t?n(a)+":"+n(r):i+":"+n(a)+":"+n(r)},e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"getNtpTime",value:function(){return Date.now()+this.ntpTimeDiff}},{key:"mountElement",value:function(e,t){var n=(0,d.getMediaResource)(t).cloneNode(!0);e.appendChild(this.createHeader()),e.appendChild(n),e.className="neteaseyunxin-wb-media-container "+this.type,n.preload="metadata",(0,r.default)(n.style,{userSelect:"none",width:"100%",height:"100%",pointerEvents:"none"}),n.controls=!1,n.playsInline=!0,n.disablePictureInPicture=!0,n.muted=this.selfMute,this.duration=n.duration,this.media=n,e.appendChild(this.createControllor()),this.mediaDiv=e,this.addContainerListener(),this.addMediaListener(),this.setNativeInitState(),"function"==typeof this.unregisterVisibleChangeListener&&this.unregisterVisibleChangeListener(),this.unregisterVisibleChangeListener=(0,m.registerVisibleChangeHandler)(this.onPageVisible,this.onPageInVisible)}},{key:"onPrePageChange",value:function(e){this.media&&e===this.app.account&&this.data.play&&this.putAttributes({play:!1,seek:this.media.currentTime,seekTime:this.getNtpTime()/1e3,ended:!1})}},{key:"onPlaySpeedChange",value:function(e){this.media&&(this.media.playbackRate=e)}},{key:"onAttributeUpdated",value:function(e){return _(this,void 0,void 0,a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.play===this.data.play&&!this.isInReplay()){t.next=5;break}return n=e.play,this.isInReplay()&&(n=n&&"play"===this.replayMode()),t.next=5,this.setNativePlayState(n);case 5:(e.seek!==this.data.seek||e.seekTime!==this.data.seekTime||this.app.isRecordPlayer)&&this.setNativeCurrTime(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"addContainerListener",value:function(){this.mediaDiv&&(this.mediaDiv.addEventListener("mouseover",this.onContainerMouseOver),this.mediaDiv.addEventListener("mouseleave",this.onContainerMouseLeave),this.mediaDiv.addEventListener("touchstart",this.onContainerMouseOver),this.mediaDiv.addEventListener("touchmove",this.onContainerMouseMove),window.document.addEventListener("touchend",this.onContainerMouseLeave))}},{key:"addMediaListener",value:function(){var e=this;this.media&&(this.media.addEventListener("durationchange",this.onDurationChange),this.media.addEventListener("timeupdate",this.onTimeUpdate),this.media.addEventListener("ended",this.onMediaEnd),this.media.addEventListener("waiting",this.onMediaWait),this.media.addEventListener("canplay",this.onMediaCanPlay)),this.isCreator()&&!this.isInReplay()&&(this.playWidget&&this.playWidget.addEventListener("click",this.onPlayClick),this.progressController&&this.progressController.addSeekListener((function(t,n){if("number"==typeof e.duration&&!isNaN(e.duration)){var r=t*e.duration;n&&e.media?(e.media.pause(),e.media.currentTime=r):e.media&&(e.setNativePlayState(e.data.play),e.onNativeSeek(r))}}))),this.deleteIcon&&this.deleteIcon.addEventListener("click",this.onDeleteClick),this.selfMuteIcon&&this.selfMuteIcon.addEventListener("click",this.onSelfMuteClick),this.playWidget&&this.playWidget.addEventListener("click",this.eventStopPropagation),this.selfMuteIcon&&this.selfMuteIcon.addEventListener("click",this.eventStopPropagation),this.deleteIcon&&this.deleteIcon.addEventListener("click",this.eventStopPropagation)}},{key:"onPluginWillDestroy",value:function(){this.media&&(this.media.removeEventListener("durationchange",this.onDurationChange),this.media.removeEventListener("timeupdate",this.onTimeUpdate),this.media.removeEventListener("ended",this.onMediaEnd),this.media.removeEventListener("waiting",this.onMediaWait),this.media.removeEventListener("canplay",this.onMediaCanPlay)),"function"==typeof this.unregisterVisibleChangeListener&&this.unregisterVisibleChangeListener(),this.isCreator()&&!this.isInReplay()&&(this.playWidget&&this.playWidget.removeEventListener("click",this.onPlayClick),this.progressController&&this.progressController.destroy()),this.deleteIcon&&this.deleteIcon.removeEventListener("click",this.onDeleteClick),this.selfMuteIcon&&this.selfMuteIcon.removeEventListener("click",this.onSelfMuteClick),this.playWidget&&this.playWidget.removeEventListener("click",this.eventStopPropagation),this.selfMuteIcon&&this.selfMuteIcon.removeEventListener("click",this.eventStopPropagation),this.deleteIcon&&this.deleteIcon.removeEventListener("click",this.eventStopPropagation)}},{key:"getCurrTimeFromData",value:function(e){var t=0;if(this.app.isRecordPlayer)if(e.hasOwnProperty("seek")&&e.play){var n=this.replaySeekDiff();t=e.seek+n}else e.hasOwnProperty("seek")&&(t=e.seek);else e.play&&e.seekTime&&e.hasOwnProperty("seek")?t=e.seek+this.getNtpTime()/1e3-e.seekTime:e.hasOwnProperty("seek")&&(t=e.seek);return"number"!=typeof this.duration||isNaN(this.duration)||(t=Math.min(t,this.duration)),t}},{key:"setNativeCurrTime",value:function(e){var t=this.getCurrTimeFromData(e),n=this.media;n&&(n.currentTime=t)}},{key:"createHeader",value:function(){var e=document.createElement("div");e.className="header";var t=document.createElement("div");t.className="title",t.innerText=this.getTitle(),e.appendChild(t);var n=document.createElement("div");return n.className="close icon",e.appendChild(n),this.deleteIcon=n,this.headerWidget=e,e}},{key:"createControlContainer",value:function(){var e=document.createElement("div");return e.className="control-container",e}},{key:"createPlayWidget",value:function(){var e=document.createElement("div");return e.className="play-icon",this.playWidget=e,(0,r.default)(e.style,{pointerEvents:this.isCreator()&&!this.isInReplay()?"auto":"none",cursor:this.isCreator()&&!this.isInReplay()?"pointer":"auto"}),e}},{key:"createTimeIndicator",value:function(){var e=document.createElement("div"),t=document.createElement("span");return e.className="time-container",t.className="time-text",this.timeIndicator=t,this.timeWidget=e,e.appendChild(t),e}},{key:"createVolumeWidget",value:function(){var e=document.createElement("div");(0,r.default)(e.style,{display:"inline-flex",height:"40px",color:"white",flexDirection:"row",alignItems:"center",verticalAlign:"top",marginRight:"16px"});var t=document.createElement("div");(0,y.appendTooltip)(t,"开关本端声音");var n=this.selfMute?v.default:g.default;return(0,r.default)(t.style,{display:"inline-block",height:"20px",width:"20px",backgroundImage:"url("+n+")",backgroundSize:"contain",pointerEvents:"auto",cursor:"pointer",marginLeft:"10px"}),e.appendChild(t),this.selfMuteIcon=t,e}},{key:"updatePlayIcon",value:function(e){if(this.playWidget){var t=e?h.default:p.default;this.playWidget.style.backgroundImage="url("+t+")"}}},{key:"updateTimeLabel",value:function(e){var t=!1,n="00:00";e||(e=0),"number"!=typeof this.duration||isNaN(this.duration)||(t=this.duration>=3600,n=this.getTime(this.duration,t));var r=this.getTime(e,t)+" / "+n;this.timeIndicator&&(this.timeIndicator.innerText=r)}},{key:"updateSelfMute",value:function(){var e=this.selfMute?v.default:g.default;if(this.selfMuteIcon&&(this.selfMuteIcon.style.backgroundImage="url("+e+")"),this.media){this.media.muted=this.selfMute;var t=this.data.play;this.isInReplay()&&(t=t&&"play"===this.replayMode()),this.setNativePlayState(t),this.setNativeCurrTime(this.data)}}},{key:"ntpTimeDiff",get:function(){return this.app.ntpTimeDiff}}]),t}(f.default);t.default=M},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTI0MjE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTgwMCAtODAwIDI2MjQgMjYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIxMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNOTEyLjcyNDg4NCA0MjkuMzU1NjgxTDIwOC43OTc1NDUgMTMuMTk4NjM4QzE1MS42MDM0NDktMjAuNTk3ODc0IDY0LjAxMjQ5IDEyLjE5ODc0MSA2NC4wMTI0OSA5NS43OTAxMTJWOTI3LjkwNDIxOWMwIDc0Ljk5MjI1OSA4MS4zOTE1OTkgMTIwLjE4NzU5NCAxNDQuNzg1MDU1IDgyLjU5MTQ3NWw3MDMuOTI3MzM5LTQxNS45NTcwNjRjNjIuNzkzNTE4LTM2Ljk5NjE4MSA2Mi45OTM0OTgtMTI4LjE4Njc2OCAwLTE2NS4xODI5NDl6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyMTMyIj48L3BhdGg+PC9zdmc+"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=void 0,a=void 0;void 0!==document.hidden?(r="hidden",a="visibilitychange"):void 0!==document.msHidden?(r="msHidden",a="msvisibilitychange"):void 0!==document.webkitHidden&&(r="webkitHidden",a="webkitvisibilitychange");t.registerVisibleChangeHandler=function(e,t){function n(){document[r]?t():e()}return document.addEventListener(a,n,!1),function(){document.removeEventListener(a,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),a=s(n(1)),i=s(n(217)),o=n(218);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,n,a){(0,r.default)(this,e),this.pages={},this.pageNames=[],this.newPageIndex=1,this.hasDoc=!1,this.app=t,this.dispatch=t.dispatcher,this.boardName=n,this.displayName=a,this.pages={0:new i.default(t,n,"0")},this.pageNames=["0"],this.currIndex=0}return(0,a.default)(e,[{key:"getPageByIndex",value:function(e){return this.pages[this.pageNames[e]]}},{key:"getPageNameByAnimPageIndex",value:function(e){for(var t=this.payloadOfPages,n=0;n<t.length;n++){var r=t[n];if(r&&r.animPageIndex===e)return this.pageNames[n]}return null}},{key:"getCurrPageIndex",value:function(){return this.pageNames.indexOf(this.currIndex.toString())}},{key:"getPageSnapshots",value:function(){var e=this;return this.app.room.boardOps[this.boardName].pageSnapshotIds.map((function(t){return e.app.room.opIdSnapshotMap[t]})).filter((function(e){return"goto"!==e.snapshot.data.action}))}},{key:"getPageBuiltInIndex",value:function(e){return Number(this.pageNames[e])}},{key:"addOpInBoard",value:function(e){var t=e.data,n=t.action,r=t.page,a=t.insertAfter;"add"===n&&(0,o.addPage)(this,a,e),"goto"===n&&(0,o.gotoPage)(this,r,e),"delete"===n&&(0,o.deletePage)(this,r,e),this.app.opsManager.hooks.addOpHook.call(e,!0)}},{key:"addTransDocOp",value:function(e,t){var n=this.app.opsManager.opMap.transDoc;this.transDocSnapshot?this.transDocSnapshot.opId!==e.data.dependOn?this.logger.warn("[白板] transDocOp添加的snapshot有问题",this.transDocSnapshot,e):this.transDocSnapshot=n.transformOp(this.transDocSnapshot,e):this.transDocSnapshot=e;try{if(this.transDocSnapshot.data.transDocData){var r=Number(this.getPageNameByAnimPageIndex(this.transDocSnapshot.data.transDocData.animPageIndex));null!==this.transDocSnapshot.data.transDocData.animPageIndex&&r!==this.currIndex&&(0,o.gotoPage)(this,r,e)}n.apply(this.transDocSnapshot,t)}catch(e){this.logger.error("[白板] transDoc.apply",e)}}},{key:"previewDoc",value:function(e){try{if(this.transDocSnapshot)this.app.opsManager.opMap.transDoc.previewDoc(this.transDocSnapshot,e)}catch(e){this.logger.error("[白板] previewDoc",e)}}},{key:"updateDocClipPath",value:function(){this.transDocSnapshot&&this.app.opsManager.opMap.transDoc.updateDocClipPath(this.transDocSnapshot)}},{key:"logger",get:function(){return this.app.logger}},{key:"currPage",get:function(){return this.pages[this.currIndex]}},{key:"payloadOfPages",get:function(){var e=this;return this.pageNames.map((function(t){return e.pages[t].payload}))}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(0)),a=d(n(1)),i=n(103),o=n(142),s=n(328),u=n(329),c=n(104),l=n(330);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t,n,a){(0,r.default)(this,e),this.drawOpQueue={},this.hiddenOpQueue={},this.lastSelectOfUser={},this.lastInProgressSelectOfUser={},this.lastInProgressSnapshotOfUser={},this.lastLaserOfUser={},this.lastMousePointerOfUser={},this.blockedResourceList=[],this._currOpId=(0,o.v4)(),this._nextOpId=(0,o.v4)(),this.app=t,this.opsManager=t.opsManager,this.boardName=n,this.pageIndex=a,window.page=this}return(0,a.default)(e,[{key:"getBoard",value:function(){return this.app.room.boards[this.boardName]}},{key:"prepareNewOpId",value:function(){this._currOpId=this._nextOpId,this._nextOpId=(0,o.v4)()}},{key:"getOpId",value:function(){return this.app.account+"-"+this._currOpId}},{key:"getNextOpId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?(this.prepareNewOpId(),this.getOpId()):this.app.account+"-"+this._nextOpId}},{key:"setBackgroundSnapshot",value:function(e){this.backgroundSnapshot=e,this.getBoard().hasDoc=!0}},{key:"hasMedia",value:function(e){for(var t in this.drawOpQueue)if(this.drawOpQueue[t].data.type===e)return!0;return!1}},{key:"getAnimPageIndex",value:function(){return this.payload&&this.payload.hasOwnProperty("animPageIndex")?this.payload.animPageIndex:null}},{key:"setPayload",value:function(e){this.payload=e}},{key:"addWaitingResource",value:function(e){-1!==this.blockedResourceList.indexOf(e)||(0,i.resourceLoaded)(e)||this.blockedResourceList.push(e)}},{key:"removeWaitingResource",value:function(e){var t=this.blockedResourceList.indexOf(e);t>-1&&(this.blockedResourceList.splice(t,1),this.blocked||(this.app.opsManager.hooks.pageReady.call(this.boardName,this.pageIndex),this.isCurrPage&&(this.app.room.pageToRefresh=this)))}},{key:"addOpInPage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"none"===e.opId?(this.logger.warn("[白板]","snapshot no opid",e),!1):(this.lastInProgressSnapshotOfUser.hasOwnProperty(e.uid)&&-1===["mouse-pointer"].indexOf(e.data.type)&&(e.data.inProgress&&e.opId===this.lastInProgressSnapshotOfUser[e.uid].snapshot.opId||delete this.lastInProgressSnapshotOfUser[e.uid]),"background"===e.data.type&&(this.setBackgroundSnapshot(e),this.cleanNonCanvasElements(!0)),(0,c.opNeedRefresh)(this,e)&&!this.app.room.isReceivingBatchSnapshots&&this.calcDrawOpQueue(),this.app.room.isReceivingBatchSnapshots||((0,c.opNeedRefresh)(this,e)?(-1!==["undo","redo","clear"].indexOf(e.data.type)&&this.cleanNonCanvasElements(!1),t&&this.boardName===this.app.room.currIndex&&this.pageIndex===this.app.room.currBoard.currIndex.toString()&&(this.app.room.pageToRefresh=this)):(0,l.addIncrementSnapshot)(this,e)),this.opsManager.hooks.addOpHook.call(e),(0,c.opNeedRefresh)(this,e))}},{key:"calcDrawOpQueue",value:function(){(0,u.calcDrawOpQueue)(this,this.app.room.isReceivingBatchSnapshots)}},{key:"cleanNonCanvasElements",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,s.cleanNonCanvasElements)(this,e)}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.refresh)(this,e)}},{key:"incRefresh",value:function(){(0,s.drawInProgressSnapshots)(this)}},{key:"refreshOnStreamCanvas",value:function(){(0,s.refreshOnStreamCanvas)(this)}},{key:"logger",get:function(){return this.app.logger}},{key:"opQueue",get:function(){var e=this.app.room;try{return e.boardOps[this.boardName].pages[this.pageIndex].inPageSnapshotIds.map((function(t){return e.opIdSnapshotMap[t].snapshot}))}catch(e){return[]}}},{key:"isCurrPage",get:function(){return this.app.room.currBoard.currPage===this}},{key:"bgCtx",get:function(){return this.app.container.bgCtx}},{key:"ctx",get:function(){return this.app.container.ctx}},{key:"frontCtx",get:function(){return this.app.container.frontCtx}},{key:"laserCtx",get:function(){return this.app.container.laserCtx}},{key:"width",get:function(){return this.app.container.width}},{key:"height",get:function(){return this.app.container.height}},{key:"blocked",get:function(){return this.blockedResourceList.length>0}}]),e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deletePage=t.gotoPage=t.addPage=void 0;var r=i(n(14)),a=i(n(217));function i(e){return e&&e.__esModule?e:{default:e}}t.addPage=function(e,t,n,r){e.app.emit("event:prePageChange",n),e.pages[e.newPageIndex]=new a.default(e.app,e.boardName,e.newPageIndex.toString()),r?e.pages[e.newPageIndex].setPayload(r):"pageOp"===n.category&&e.pages[e.newPageIndex].setPayload(n.data.payload),t=void 0===t?e.pageNames.length-1:t,e.pageNames.splice(t+1,0,e.newPageIndex.toString()),e.app.room.isReceivingBatchSnapshots||(e.pages[e.newPageIndex].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[e.newPageIndex]),e.currIndex=e.newPageIndex,e.newPageIndex+=1,e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(n),s(e.app)},t.gotoPage=function(e,t,n){if(!e.pages.hasOwnProperty(t))return e.logger.error("[白板] goto的页面不存在, 不执行goto动作");e.app.emit("event:prePageChange",n),e.currIndex=Number(t),e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(n),s(e.app),e.app.room.isReceivingBatchSnapshots||(e.pages[t].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[t])},t.deletePage=function(e,t,n){if(e.pages.hasOwnProperty(t))if(1===(0,r.default)(e.pages).length)e.logger.error("[白板]","不能删除最后一页");else{e.app.emit("event:prePageChange",n),e.app.emit("event:deletePage",e.pages[t]),delete e.pages[t];var a=e.pageNames.indexOf(t.toString());-1!==a&&e.pageNames.splice(a,1);var i=a;a===e.pageNames.length&&(i=a-1),e.currIndex=Number(e.pageNames[i]),e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(n),s(e.app),e.app.room.isReceivingBatchSnapshots||(e.pages[e.currIndex].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[e.currIndex])}else e.logger.error("[白板]","删除页面:"+t+", 但是页面不存在")};var o=void 0;function s(e){clearTimeout(o),o=setTimeout((function(){var t=e.room.currBoard.currIndex;e.preparePreview([t-2,t-1,t,t+1,t+2])}),0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getCameraBoundFromGlobalOp=function(e,t){var n=e.app.camera,r=e.app.vision;if("camera-bound"===t.data.type){if(n.cameraBoundByUser[t.uid]=t.data.boundary,"freeObserver"===r.mode&&t.uid===e.app.account)return t.data.boundary;if("broadcaster"===r.mode&&t.uid===e.app.account)return t.data.boundary;if("follower"===r.mode&&t.uid===r.broadcaster)return t.data.boundary;if("follower"===r.mode&&t.uid===e.app.account)return t.data.boundary}return null},t.shouldCacheSnapshot=function(e){return!!e.category&&(!("boardOp"!==e.category||"add"!==e.data.action||!e.data.tmpl)||("boardOp"===e.category&&"addTransDoc"===e.data.action||("video"===e.data.type||"audio"===e.data.type||"image"===e.data.type)))};var r=void 0;t.fitToContentAfterBoardChange=function(e){clearTimeout(r),e.isReceivingBatchSnapshots&&"data"!==e.batchSource||(r=setTimeout((function(){(e.app.hasBackground()||e.app.hasTransDoc())&&e.app.fitToContent(!1)}),0))}},function(e,t,n){"use strict";t.__esModule=!0;var r,a=n(47),i=(r=a)&&r.__esModule?r:{default:r};t.default=function(e,t,n){return t in e?(0,i.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.popupFileChooserAndUpload=t.uploadAndAddResource=t.constraintByType=void 0;var r=l(n(13)),a=l(n(5)),i=n(29),o=l(n(32)),s=n(222),u=l(n(343)),c=n(380);function l(e){return e&&e.__esModule?e:{default:e}}window.__wbResLocal__||(window.__wbResLocal__={drawPlugin:void 0,resourceDimensions:{},resourceType:"image",resourcePageName:void 0,resourceBoardName:void 0},window.addEventListener("load",(function(){v()})));var d=t.constraintByType={image:{acceptTypes:["jpg","jpeg","png","bmp","webp"],sizeLimit:10485760},video:{acceptTypes:["mp4","m3u8","m3u","move","quicktime"],sizeLimit:209715200},audio:{acceptTypes:["mp3","aac","mpeg"],sizeLimit:10485760}},f=t.uploadAndAddResource=function(e,t,n,r){var s=r.type,u=r.sourceType,l=r.pageName,d=r.boardName;if(!t.dataURL&&!t.fileInput)return e.logger.error("[白板] uploadAndAddResource dataURL和fileInput至少提供一个");if(t.dataURL&&!t.fileName)return e.logger.error("[白板] uploadAndAddResource 提供了dataURL时，必须同时提供fileName");if(e.logger.log("[白板] 已选择"+s+"文件，现在开始上传文件"),"image"!==s&&""===u)return e.logger.warn("[白板] 上传"+s+"时必须传入sourceType");e.nim;(0,c.uploadMedia)(e,(0,a.default)((0,a.default)({},t),{mediaType:r.type,uploadprogress:function(e){e&&"string"==typeof e.percentageText&&(0,i.showToast)({msg:"文件上传进度"+e.percentageText,time:1e5,type:"info",msgType:o.default.FILE_IS_UPLOADING})},done:function(t,r){(0,i.hideToast)(),t?(e.logger.error("[白板] 文件上传失败",t),(0,i.showToast)({msg:"上传失败",type:"error",time:3,msgType:o.default.FILE_UPLOAD_FAIL})):(e.logger.log("[白板] 上传"+s+"文件成功"),(0,i.showToast)({msg:s+"上传成功",type:"success",time:3,msgType:o.default.FILE_UPLOAD_FAIL}),"image"===s?e.addImage({url:r.url,width:n.width,height:n.height,pageName:l,boardName:d}):"video"===s?e.addVideo({url:r.url,width:n.width,pageName:l,boardName:d,sourceType:u}):"audio"===s&&e.addAudio({url:r.url,width:n.width,pageName:l,boardName:d,sourceType:u}))}})),(0,i.showToast)({msg:"上传文件中...",time:1e5,type:"info",msgType:o.default.FILE_IS_UPLOADING})},p=(t.popupFileChooserAndUpload=function(e,t){window.__wbResLocal__.drawPlugin=e,window.__wbResLocal__.resourceDimensions={width:t.width,height:t.height},window.__wbResLocal__.resourceType=t.type,window.__wbResLocal__.resourcePageName=t.pageName,window.__wbResLocal__.resourceBoardName=t.boardName;var n=g();n.accept=p().map((function(e){return"."+e})).join(","),n.value="",n.onchange=h,n.click()},function(){return d[window.__wbResLocal__.resourceType].acceptTypes}),h=function(e){var t=window.__wbResLocal__,n=t.drawPlugin,a=t.resourceType,c=t.resourceDimensions,l=t.resourcePageName,h=t.resourceBoardName,g=e.target,v=e.target.files[0],y=d[window.__wbResLocal__.resourceType].sizeLimit,m=p();if(v&&v.size&&v.size>y)return g.value="",(0,i.showToast)({msg:"文件大小不能超过"+Math.round(y/1024/1024)+"M",type:"error",msgType:o.default.FILE_SIZE_EXCEED_LIMIT});var b=v.name.split("."),w=b[b.length-1],_=-1!==m.indexOf(w.toLowerCase());_||(g&&g.files&&g.files.length>0&&(w=g.files[0].type),_=(0,s.isValidMediaType)(w,a));var x=r.default.resolve();_||(x=u.default.fromBlob(v).then((function(e){e.mime&&(0,s.isValidMediaType)(e.mime,a)?(_=!0,w=e.mime):e.ext&&(0,s.isValidMediaType)(e.ext,a)?(_=!0,w=e.ext):_=!1}))),x.then((function(){if(!_)return g.value="",(0,i.showToast)({msg:"当前仅支持"+m.join(",")+"格式文件",time:3,type:"error",msgType:o.default.FILE_ACCEPTED_TYPE_LIMIT});f(n,{fileInput:g},c,{type:a,pageName:l,boardName:h,sourceType:w})}))},g=function(){var e=document.getElementById("netease-wb-resource-input");return e||v()},v=function(){var e=document.createElement("input");return document.body.appendChild(e),e.id="netease-wb-resource-input",e.style.position="absolute",e.style.visibility="hidden",e.type="file",e.style.width="0",e.style.height="0",e.style.top="-100px",e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidMediaType=t.getTransformedMediaType=void 0;var r,a=n(9),i=(r=a)&&r.__esModule?r:{default:r},o=n(221);t.getTransformedMediaType=function(e,t){var n=o.constraintByType[t].acceptTypes,r=!0,a=!1,s=void 0;try{for(var u,c=(0,i.default)(n);!(r=(u=c.next()).done);r=!0){var l=u.value;if(e===l)return t+"/"+e;if(e===t+"/"+l)return e}}catch(e){a=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw s}}return null},t.isValidMediaType=function(e,t){var n=o.constraintByType[t].acceptTypes,r=!0,a=!1,s=void 0;try{for(var u,c=(0,i.default)(n);!(r=(u=c.next()).done);r=!0){var l=u.value;if(e===l)return!0;if(e===t+"/"+l)return!0}}catch(e){a=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw s}}return!1}},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,a){var i,o,s=8*a-r-1,u=(1<<s)-1,c=u>>1,l=-7,d=n?a-1:0,f=n?-1:1,p=e[t+d];for(d+=f,i=p&(1<<-l)-1,p>>=-l,l+=s;l>0;i=256*i+e[t+d],d+=f,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=r;l>0;o=256*o+e[t+d],d+=f,l-=8);if(0===i)i=1-c;else{if(i===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),i-=c}return(p?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,a,i){var o,s,u,c=8*i-a-1,l=(1<<c)-1,d=l>>1,f=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,h=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(o++,u/=2),o+d>=l?(s=0,o=l):o+d>=1?(s=(t*u-1)*Math.pow(2,a),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,a),o=0));a>=8;e[n+p]=255&s,p+=h,s/=256,a-=8);for(o=o<<a|s,c+=a;c>0;e[n+p]=255&o,p+=h,o/=256,c-=8);e[n+p-h]|=128*g}},function(e,t,n){"use strict";(function(t,r){var a,i=s(n(65)),o=s(n(2));function s(e){return e&&e.__esModule?e:{default:e}}e.exports=O,O.ReadableState=I;n(225).EventEmitter;var u=function(e,t){return e.listeners(t).length},c=n(226),l=n(44).Buffer,d=t.Uint8Array||function(){};var f,p=n(348);f=p&&p.debuglog?p.debuglog("stream"):function(){};var h,g,v,y=n(349),m=n(227),b=n(228).getHighWaterMark,w=n(68).codes,_=w.ERR_INVALID_ARG_TYPE,x=w.ERR_STREAM_PUSH_AFTER_EOF,k=w.ERR_METHOD_NOT_IMPLEMENTED,M=w.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(67)(O,c);var S=m.errorOrDestroy,T=["error","close","destroy","pause","resume"];function I(e,t,r){a=a||n(69),e=e||{},"boolean"!=typeof r&&(r=t instanceof a),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=b(this,e,"readableHighWaterMark",r),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(h||(h=n(230).StringDecoder),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function O(e){if(a=a||n(69),!(this instanceof O))return new O(e);var t=this instanceof a;this._readableState=new I(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function P(e,t,n,r,a){f("readableAddChunk",t);var i,s=e._readableState;if(null===t)s.reading=!1,function(e,t){if(f("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?N(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,D(e)))}(e,s);else if(a||(i=function(e,t){var n;r=t,l.isBuffer(r)||r instanceof d||"string"==typeof t||void 0===t||e.objectMode||(n=new _("chunk",["string","Buffer","Uint8Array"],t));var r;return n}(s,t)),i)S(e,i);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||(0,o.default)(t)===l.prototype||(t=function(e){return l.from(e)}(t)),r)s.endEmitted?S(e,new M):E(e,s,t,!0);else if(s.ended)S(e,new x);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?E(e,s,t,!1):A(e,s)):E(e,s,t,!1)}else r||(s.reading=!1,A(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function E(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&N(e)),A(e,t)}Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),O.prototype.destroy=m.destroy,O.prototype._undestroy=m.undestroy,O.prototype._destroy=function(e,t){t(e)},O.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=l.from(e,t),t=""),n=!0),P(this,e,t,!1,n)},O.prototype.unshift=function(e){return P(this,e,null,!0,!1)},O.prototype.isPaused=function(){return!1===this._readableState.flowing},O.prototype.setEncoding=function(e){h||(h=n(230).StringDecoder);var t=new h(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,a="";null!==r;)a+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==a&&this._readableState.buffer.push(a),this._readableState.length=a.length,this};function C(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=1073741824?e=1073741824:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function N(e){var t=e._readableState;f("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(D,e))}function D(e){var t=e._readableState;f("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,z(e)}function A(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(L,e,t))}function L(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(f("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function R(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function j(e){f("readable nexttick read 0"),e.read(0)}function B(e,t){f("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),z(e),t.flowing&&!t.reading&&e.read(0)}function z(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function F(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function U(e){var t=e._readableState;f("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(W,t,e))}function W(e,t){if(f("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function Y(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}O.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?U(this):N(this),null;if(0===(e=C(e,t))&&t.ended)return 0===t.length&&U(this),null;var r,a=t.needReadable;return f("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",a=!0),t.ended||t.reading?f("reading or ended",a=!1):a&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=C(n,t))),null===(r=e>0?F(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&U(this)),null!==r&&this.emit("data",r),r},O.prototype._read=function(e){S(this,new k("_read()"))},O.prototype.pipe=function(e,t){var n=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,t);var i=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?s:v;function o(t,r){f("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,f("cleanup"),e.removeListener("close",h),e.removeListener("finish",g),e.removeListener("drain",c),e.removeListener("error",p),e.removeListener("unpipe",o),n.removeListener("end",s),n.removeListener("end",v),n.removeListener("data",d),l=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}function s(){f("onend"),e.end()}a.endEmitted?r.nextTick(i):n.once("end",i),e.on("unpipe",o);var c=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&u(e,"data")&&(t.flowing=!0,z(e))}}(n);e.on("drain",c);var l=!1;function d(t){f("ondata");var r=e.write(t);f("dest.write",r),!1===r&&((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==Y(a.pipes,e))&&!l&&(f("false write response, pause",a.awaitDrain),a.awaitDrain++),n.pause())}function p(t){f("onerror",t),v(),e.removeListener("error",p),0===u(e,"error")&&S(e,t)}function h(){e.removeListener("finish",g),v()}function g(){f("onfinish"),e.removeListener("close",h),v()}function v(){f("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",p),e.once("close",h),e.once("finish",g),e.emit("pipe",n),a.flowing||(f("pipe resume"),n.resume()),e},O.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,a=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<a;i++)r[i].emit("unpipe",this,{hasUnpiped:!1});return this}var o=Y(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},O.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t),a=this._readableState;return"data"===e?(a.readableListening=this.listenerCount("readable")>0,!1!==a.flowing&&this.resume()):"readable"===e&&(a.endEmitted||a.readableListening||(a.readableListening=a.needReadable=!0,a.flowing=!1,a.emittedReadable=!1,f("on readable",a.length,a.reading),a.length?N(this):a.reading||r.nextTick(j,this))),n},O.prototype.addListener=O.prototype.on,O.prototype.removeListener=function(e,t){var n=c.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(R,this),n},O.prototype.removeAllListeners=function(e){var t=c.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||r.nextTick(R,this),t},O.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(B,e,t))}(this,e)),e.paused=!1,this},O.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},O.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var a in e.on("end",(function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(a){(f("wrapped data"),n.decoder&&(a=n.decoder.write(a)),n.objectMode&&null==a)||(n.objectMode||a&&a.length)&&(t.push(a)||(r=!0,e.pause()))})),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var i=0;i<T.length;i++)e.on(T[i],this.emit.bind(this,T[i]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof i.default&&(O.prototype[i.default.asyncIterator]=function(){return void 0===g&&(g=n(365)),g(this)}),Object.defineProperty(O.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(O.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(O.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),O._fromList=F,Object.defineProperty(O.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof i.default&&(O.from=function(e,t){return void 0===v&&(v=n(366)),v(O,e,t)})}).call(this,n(73),n(52))},function(e,t,n){"use strict";var r,a="object"==typeof Reflect?Reflect:null,i=a&&"function"==typeof a.apply?a.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function a(){void 0!==i&&e.removeListener("error",i),n([].slice.call(arguments))}var i;"error"!==t&&(i=function(n){e.removeListener(t,a),r(n)},e.once("error",i)),e.once(t,a)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var a,i,o,s;if(c(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),o=i[t]),void 0===o)o=i[t]=n,++e._eventsCount;else if("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(a=l(e))>0&&o.length>a&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,console&&console.warn&&console.warn(s)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=f.bind(r);return a.listener=n,r.wrapFn=a,a}function h(e,t,n){var r=e._events;if(void 0===r)return[];var a=r[t];return void 0===a?[]:"function"==typeof a?n?[a.listener||a]:[a]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(a):v(a,a.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var u=a[e];if(void 0===u)return!1;if("function"==typeof u)i(u,this,t);else{var c=u.length,l=v(u,c);for(n=0;n<c;++n)i(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,a,i,o;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){o=n[i].listener,a=i;break}if(a<0)return this;0===a?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,a),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var a,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(a=i[r])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},s.prototype.listenerCount=g,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";e.exports=n(225).EventEmitter},function(e,t,n){"use strict";(function(t){function n(e,t){a(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function a(e,t){e.emit("error",t)}e.exports={destroy:function(e,i){var o=this,s=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return s||u?(i?i(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,t.nextTick(a,this,e)):t.nextTick(a,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!i&&e?o._writableState?o._writableState.errorEmitted?t.nextTick(r,o):(o._writableState.errorEmitted=!0,t.nextTick(n,o,e)):t.nextTick(n,o,e):i?(t.nextTick(r,o),i(e)):t.nextTick(r,o)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this,n(52))},function(e,t,n){"use strict";var r=n(68).codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,a){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,a,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new r(a?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}}},function(e,t,n){"use strict";(function(t,r){var a,i=u(n(47)),o=u(n(360)),s=u(n(65));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var a=r.callback;t.pendingcb--,a(n),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=P,P.WritableState=O;var l={deprecate:n(363)},d=n(226),f=n(44).Buffer,p=t.Uint8Array||function(){};var h,g=n(227),v=n(228).getHighWaterMark,y=n(68).codes,m=y.ERR_INVALID_ARG_TYPE,b=y.ERR_METHOD_NOT_IMPLEMENTED,w=y.ERR_MULTIPLE_CALLBACK,_=y.ERR_STREAM_CANNOT_PIPE,x=y.ERR_STREAM_DESTROYED,k=y.ERR_STREAM_NULL_VALUES,M=y.ERR_STREAM_WRITE_AFTER_END,S=y.ERR_UNKNOWN_ENCODING,T=g.errorOrDestroy;function I(){}function O(e,t,i){a=a||n(69),e=e||{},"boolean"!=typeof i&&(i=t instanceof a),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=v(this,e,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,a=n.sync,i=n.writecb;if("function"!=typeof i)throw new w;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,a,i){--t.pendingcb,n?(r.nextTick(i,a),r.nextTick(L,e,t),e._writableState.errorEmitted=!0,T(e,a)):(i(a),e._writableState.errorEmitted=!0,T(e,a),L(e,t))}(e,n,a,t,i);else{var o=D(n)||e.destroyed;o||n.corked||n.bufferProcessing||!n.bufferedRequest||N(e,n),a?r.nextTick(C,e,n,o,i):C(e,n,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new c(this)}function P(e){var t=this instanceof(a=a||n(69));if(!t&&!h.call(P,this))return new P(e);this._writableState=new O(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function E(e,t,n,r,a,i,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new x("write")):n?e._writev(a,t.onwrite):e._write(a,i,t.onwrite),t.sync=!1}function C(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),L(e,t)}function N(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,a=new Array(r),i=t.corkedRequestsFree;i.entry=n;for(var o=0,s=!0;n;)a[o]=n,n.isBuf||(s=!1),n=n.next,o+=1;a.allBuffers=s,E(e,t,!0,t.length,a,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new c(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,l=n.encoding,d=n.callback;if(E(e,t,!1,t.objectMode?1:u.length,u,l,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function D(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function A(e,t){e._final((function(n){t.pendingcb--,n&&T(e,n),t.prefinished=!0,e.emit("prefinish"),L(e,t)}))}function L(e,t){var n=D(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(A,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var a=e._readableState;(!a||a.autoDestroy&&a.endEmitted)&&e.destroy()}return n}n(67)(P,d),O.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(O.prototype,"buffer",{get:l.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof s.default&&o.default&&"function"==typeof Function.prototype[o.default]?(h=Function.prototype[o.default],(0,i.default)(P,o.default,{value:function(e){return!!h.call(this,e)||this===P&&(e&&e._writableState instanceof O)}})):h=function(e){return e instanceof this},P.prototype.pipe=function(){T(this,new _)},P.prototype.write=function(e,t,n){var a,i=this._writableState,o=!1,s=!i.objectMode&&(a=e,f.isBuffer(a)||a instanceof p);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=I),i.ending?function(e,t){var n=new M;T(e,n),r.nextTick(t,n)}(this,n):(s||function(e,t,n,a){var i;return null===n?i=new k:"string"==typeof n||t.objectMode||(i=new m("chunk",["string","Buffer"],n)),!i||(T(e,i),r.nextTick(a,i),!1)}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,a,i){if(!n){var o=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,n));return t}(t,r,a);r!==o&&(n=!0,a="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:a,isBuf:n,callback:i,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else E(e,t,!1,s,r,a,i);return u}(this,i,s,e,t,n)),o},P.prototype.cork=function(){this._writableState.corked++},P.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||N(this,e))},P.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(P.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(P.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),P.prototype._write=function(e,t,n){n(new b("_write()"))},P.prototype._writev=null,P.prototype.end=function(e,t,n){var a=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),a.corked&&(a.corked=1,this.uncork()),a.ending||function(e,t,n){t.ending=!0,L(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,a,n),this},Object.defineProperty(P.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(P.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),P.prototype.destroy=g.destroy,P.prototype._undestroy=g.undestroy,P.prototype._destroy=function(e,t){t(e)}}).call(this,n(73),n(52))},function(e,t,n){"use strict";var r=n(364).Buffer,a=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===a||!a(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=l,this.end=d,t=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function l(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=i,i.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},i.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var a=o(t[r]);if(a>=0)return a>0&&(e.lastNeed=a-1),a;if(--r<n||-2===a)return 0;if((a=o(t[r]))>=0)return a>0&&(e.lastNeed=a-2),a;if(--r<n||-2===a)return 0;if((a=o(t[r]))>=0)return a>0&&(2===a?a=0:e.lastNeed=a-3),a;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=l;var r=n(68).codes,a=r.ERR_METHOD_NOT_IMPLEMENTED,i=r.ERR_MULTIPLE_CALLBACK,o=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=r.ERR_TRANSFORM_WITH_LENGTH_0,u=n(69);function c(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new i);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);u.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?f(this,null,null):this._flush((function(t,n){f(e,t,n)}))}function f(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new s;if(e._transformState.transforming)throw new o;return e.push(null)}n(67)(l,u),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,u.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,n){n(new a("_transform()"))},l.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var a=this._readableState;(r.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){u.prototype._destroy.call(this,e,(function(e){t(e)}))}},function(e,t,n){"use strict";var r=s(n(2)),a=s(n(0)),i=s(n(3)),o=s(n(4));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EndOfStreamError=t.defaultMessages=void 0,t.defaultMessages="End-Of-Stream";var u=function(e){function n(){return(0,a.default)(this,n),(0,i.default)(this,(n.__proto__||(0,r.default)(n)).call(this,t.defaultMessages))}return(0,o.default)(n,e),n}(Error);t.EndOfStreamError=u},,,,function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},a=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(e).replace(a,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),u=r[n];n<i;u=r[++n])g(u)||!w(u)?o+=" "+u:o+=" "+s(u);return o},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var a=!1;return function(){if(!a){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),a=!0}return n.apply(this,arguments)}};var i,o={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(n)?r.showHidden=n:n&&t._extend(r,n),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),l(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&k(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var a=n.inspect(r,e);return y(a)||(a=l(e,a,r)),a}var i=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(v(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,n);if(i)return i;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),x(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return d(n);if(0===o.length){if(k(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(_(n))return e.stylize(Date.prototype.toString.call(n),"date");if(x(n))return d(n)}var c,w="",M=!1,S=["{","}"];(p(n)&&(M=!0,S=["[","]"]),k(n))&&(w=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(w=" "+RegExp.prototype.toString.call(n)),_(n)&&(w=" "+Date.prototype.toUTCString.call(n)),x(n)&&(w=" "+d(n)),0!==o.length||M&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=M?function(e,t,n,r,a){for(var i=[],o=0,s=t.length;o<s;++o)O(t,String(o))?i.push(f(e,t,n,r,String(o),!0)):i.push("");return a.forEach((function(a){a.match(/^\d+$/)||i.push(f(e,t,n,r,a,!0))})),i}(e,n,r,s,o):o.map((function(t){return f(e,n,r,s,t,M)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,w,S)):S[0]+w+S[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,a,i){var o,s,u;if((u=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),O(r,a)||(o="["+a+"]"),s||(e.seen.indexOf(u.value)<0?(s=g(n)?l(e,u.value,null):l(e,u.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),m(o)){if(i&&a.match(/^\d+$/))return s;(o=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function p(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function g(e){return null===e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function m(e){return void 0===e}function b(e){return w(e)&&"[object RegExp]"===M(e)}function w(e){return"object"==typeof e&&null!==e}function _(e){return w(e)&&"[object Date]"===M(e)}function x(e){return w(e)&&("[object Error]"===M(e)||e instanceof Error)}function k(e){return"function"==typeof e}function M(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(m(i)&&(i=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!o[n])if(new RegExp("\\b"+n+"\\b","i").test(i)){var r=e.pid;o[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else o[n]=function(){};return o[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=h,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=y,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=b,t.isObject=w,t.isDate=_,t.isError=x,t.isFunction=k,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(260);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),T[e.getMonth()],t].join(" ")}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",I(),t.format.apply(t,arguments))},t.inherits=n(67),t._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function E(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(P&&e[P]){var t;if("function"!=typeof(t=e[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),a=[],i=0;i<arguments.length;i++)a.push(arguments[i]);a.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,a)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),P&&Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=P,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var a=n.pop();if("function"!=typeof a)throw new TypeError("The last argument must be of type Function");var i=this,o=function(){return a.apply(i,arguments)};t.apply(this,n).then((function(t){e.nextTick(o,null,t)}),(function(t){e.nextTick(E,t,o)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(52))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,a,i,o;return a=2147483648&e,i=2147483648&t,o=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(r=1073741824&t)?2147483648^o^a^i:n|r?1073741824&o?3221225472^o^a^i:1073741824^o^a^i:o^a^i}function r(e,r,a,i,o,s,u){return e=n(e,n(n(function(e,t,n){return e&t|~e&n}(r,a,i),o),u)),n(t(e,s),r)}function a(e,r,a,i,o,s,u){return e=n(e,n(n(function(e,t,n){return e&n|t&~n}(r,a,i),o),u)),n(t(e,s),r)}function i(e,r,a,i,o,s,u){return e=n(e,n(n(function(e,t,n){return e^t^n}(r,a,i),o),u)),n(t(e,s),r)}function o(e,r,a,i,o,s,u){return e=n(e,n(n(function(e,t,n){return t^(e|~n)}(r,a,i),o),u)),n(t(e,s),r)}function s(e){var t,n="",r="";for(t=0;t<=3;t++)n+=(r="0"+(e>>>8*t&255).toString(16)).substr(r.length-2,2);return n}var u,c,l,d,f,p,h,g,v,y=Array();for(y=function(e){for(var t,n=e.length,r=n+8,a=16*((r-r%64)/64+1),i=Array(a-1),o=0,s=0;s<n;)o=s%4*8,i[t=(s-s%4)/4]=i[t]|e.charCodeAt(s)<<o,s++;return o=s%4*8,i[t=(s-s%4)/4]=i[t]|128<<o,i[a-2]=n<<3,i[a-1]=n>>>29,i}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e)),p=1732584193,h=4023233417,g=2562383102,v=271733878,u=0;u<y.length;u+=16)c=p,l=h,d=g,f=v,p=r(p,h,g,v,y[u+0],7,3614090360),v=r(v,p,h,g,y[u+1],12,3905402710),g=r(g,v,p,h,y[u+2],17,606105819),h=r(h,g,v,p,y[u+3],22,3250441966),p=r(p,h,g,v,y[u+4],7,4118548399),v=r(v,p,h,g,y[u+5],12,1200080426),g=r(g,v,p,h,y[u+6],17,2821735955),h=r(h,g,v,p,y[u+7],22,4249261313),p=r(p,h,g,v,y[u+8],7,1770035416),v=r(v,p,h,g,y[u+9],12,2336552879),g=r(g,v,p,h,y[u+10],17,4294925233),h=r(h,g,v,p,y[u+11],22,2304563134),p=r(p,h,g,v,y[u+12],7,1804603682),v=r(v,p,h,g,y[u+13],12,4254626195),g=r(g,v,p,h,y[u+14],17,2792965006),p=a(p,h=r(h,g,v,p,y[u+15],22,1236535329),g,v,y[u+1],5,4129170786),v=a(v,p,h,g,y[u+6],9,3225465664),g=a(g,v,p,h,y[u+11],14,643717713),h=a(h,g,v,p,y[u+0],20,3921069994),p=a(p,h,g,v,y[u+5],5,3593408605),v=a(v,p,h,g,y[u+10],9,38016083),g=a(g,v,p,h,y[u+15],14,3634488961),h=a(h,g,v,p,y[u+4],20,3889429448),p=a(p,h,g,v,y[u+9],5,568446438),v=a(v,p,h,g,y[u+14],9,3275163606),g=a(g,v,p,h,y[u+3],14,4107603335),h=a(h,g,v,p,y[u+8],20,1163531501),p=a(p,h,g,v,y[u+13],5,2850285829),v=a(v,p,h,g,y[u+2],9,4243563512),g=a(g,v,p,h,y[u+7],14,1735328473),p=i(p,h=a(h,g,v,p,y[u+12],20,2368359562),g,v,y[u+5],4,4294588738),v=i(v,p,h,g,y[u+8],11,2272392833),g=i(g,v,p,h,y[u+11],16,1839030562),h=i(h,g,v,p,y[u+14],23,4259657740),p=i(p,h,g,v,y[u+1],4,2763975236),v=i(v,p,h,g,y[u+4],11,1272893353),g=i(g,v,p,h,y[u+7],16,4139469664),h=i(h,g,v,p,y[u+10],23,3200236656),p=i(p,h,g,v,y[u+13],4,681279174),v=i(v,p,h,g,y[u+0],11,3936430074),g=i(g,v,p,h,y[u+3],16,3572445317),h=i(h,g,v,p,y[u+6],23,76029189),p=i(p,h,g,v,y[u+9],4,3654602809),v=i(v,p,h,g,y[u+12],11,3873151461),g=i(g,v,p,h,y[u+15],16,530742520),p=o(p,h=i(h,g,v,p,y[u+2],23,3299628645),g,v,y[u+0],6,4096336452),v=o(v,p,h,g,y[u+7],10,1126891415),g=o(g,v,p,h,y[u+14],15,2878612391),h=o(h,g,v,p,y[u+5],21,4237533241),p=o(p,h,g,v,y[u+12],6,1700485571),v=o(v,p,h,g,y[u+3],10,2399980690),g=o(g,v,p,h,y[u+10],15,4293915773),h=o(h,g,v,p,y[u+1],21,2240044497),p=o(p,h,g,v,y[u+8],6,1873313359),v=o(v,p,h,g,y[u+15],10,4264355552),g=o(g,v,p,h,y[u+6],15,2734768916),h=o(h,g,v,p,y[u+13],21,1309151649),p=o(p,h,g,v,y[u+4],6,4149444226),v=o(v,p,h,g,y[u+11],10,3174756917),g=o(g,v,p,h,y[u+2],15,718787259),h=o(h,g,v,p,y[u+9],21,3951481745),p=n(p,c),h=n(h,l),g=n(g,d),v=n(v,f);return(s(p)+s(h)+s(g)+s(v)).toLowerCase()}},function(e,t,n){"use strict";(function(e){var r,a,i,o,s=g(n(1)),u=g(n(0)),c=g(n(5)),l=g(n(9)),d=g(n(19)),f=g(n(14)),p=g(n(47)),h=g(n(20));function g(e){return e&&e.__esModule?e:{default:e}}self,o=function(){return function(){var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&(0,p.default)(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return o}});var n=window.localStorage;window.localStorage&&"function"==typeof window.localStorage.getItem&&"function"==typeof window.localStorage.setItem&&"function"==typeof window.localStorage.removeItem||(n={privateObj:{},setItem:function(e,t){n.privateObj[e]=t},getItem:function(e){return n.privateObj[e]},removeItem:function(e){delete n.privateObj[e]},getKeys:function(){return(0,f.default)(n.privateObj)}});var r={getFileKey:function(e){var t=e.size.toString(),n=e.lastModified.toString();return e.name+t.slice(t.length-5)+n.slice(n.length-5)},getFileInfo:function(e){var t=n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}},initFile:function(e,t){r.clearExpiredInfo();var a=this.getFileKey(t),i={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:Date.now(),end:!1};return e.payload&&(i.payload=e.payload),n.setItem(a,(0,d.default)(i)),a},setUploadContext:function(e,t){var r=this.getFileInfo(e);r&&(r.ctx=t,n.setItem(e,(0,d.default)(r)))},setComplete:function(e){var t=this.getFileInfo(e);t&&(t.modifyAt=Date.now(),t.end=!0,n.setItem(e,(0,d.default)(t)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){n.removeItem(e)},clearExpiredInfo:function(){var e="function"==typeof n.getKeys?n.getKeys():(0,f.default)(n),t=Date.now(),a=[],i=!0,s=!1,u=void 0;try{for(var c,d=(0,l.default)(e);!(i=(c=d.next()).done);i=!0){var p=c.value,h=r.getFileInfo(p);null===h||t-h.modifyAt>o.expireTime?n.removeItem(p):a.push({fileInfo:h,key:p})}}catch(e){s=!0,u=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw u}}if(a.length>o.maxFileCache){var g=a.sort((function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt})).slice(o.maxFileCache),v=!0,y=!1,m=void 0;try{for(var b,w=(0,l.default)(g);!(v=(b=w.next()).done);v=!0){var _=b.value;n.removeItem(_.key)}}catch(e){y=!0,m=e}finally{try{!v&&w.return&&w.return()}finally{if(y)throw m}}}}},a=r,i={maxFileCache:100,expireTime:31536e6,getFileUploadInformation:function(e){var t=a.getFileKey(e),n=a.getFileInfo(t);return null===n?null:Date.now()-n.modifyAt>i.expireTime?(a.removeFileInfo(t),null):{uploadInfo:(0,c.default)({bucketName:n.bucket,objectName:n.obj,token:n.token,ctx:n.ctx},n.payload?{payload:n.payload}:{}),complete:n.end}},setMaxFileCache:function(e){i.maxFileCache=e},setExpireTime:function(e){i.expireTime=e},printCaches:function(){var e=(0,f.default)(localStorage),t=!0,n=!1,r=void 0;try{for(var i,o=(0,l.default)(e);!(t=(i=o.next()).done);t=!0){var s=i.value,u=a.getFileInfo(s);u&&console.log(u,"modifiedAt",new Date(u.modifyAt).toTimeString())}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},createConfig:function(e){return new function e(t){for(var n in(0,u.default)(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=2,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.onError=function(e){},this.onProgress=function(e){},this.onComplete=function(e){},t)this[n]=t[n]}(e)},createTask:function(e,t,n){return new(function(){function e(t,n,r){(0,u.default)(this,e),this.uploadState="paused",this.config=r,this.file=t,this.param=n,this.fileKey=a.initFile(n,t),this.resume()}return(0,s.default)(e,[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;!function e(t,n,r){if("uploading"===t.uploadState){var i=t.config,o=t.param,s=a.getUploadContext(t.fileKey);if(!s)return r(0);var u=new XMLHttpRequest;u.onreadystatechange=function(){if("abort"!==t.uploadState&&4===u.readyState){var o=void 0;try{o=JSON.parse(u.responseText)}catch(e){o={errMsg:"返回json无法解析",errCode:500}}200===u.status?o.errCode?t.config.onError({errCode:o.errCode,errMsg:o.errMsg}):r(o.offset):u.status.toString().match(/^5/)?e(t,n-1,r):(i.onError(u.statusText),404===u.status&&a.removeFileInfo(t.fileKey))}};var c=i.directUploadAddr+"/"+o.bucketName+"/"+encodeURIComponent(o.objectName)+"?uploadContext&context="+s+"&version="+i.version;u.open("get",c),u.setRequestHeader("x-nos-token",o.token),u.timeout=i.getOffsetTimeout,u.send()}}(this,t.retryCount,(function(n){!function e(t,n,r,i){if("uploading"===t.uploadState){var o=t.param,s=t.config,u=File.prototype.slice,c=void 0!==o.ctx?o.ctx:"",l=n+s.trunkSize>t.file.size,d=l?t.file.size:n+s.trunkSize,f=new XMLHttpRequest;f.upload.onprogress=function(e){var r=0;e.lengthComputable?(r=(n+e.loaded)/t.file.size,s.onProgress(r)):s.onError({errMsg:"浏览器不支持进度事件"})},f.onreadystatechange=function(){if("abort"!==t.uploadState&&4===f.readyState){var o=void 0;try{o=JSON.parse(f.responseText)}catch(e){console.error("分片上传异常:",e),o={errMsg:"分片上传未知类型错误"}}200===f.status?(t.setContext(o.context),l?(i(),t.setComplete()):e(t,o.offset,s.retryCount,i)):f.status.toString().match(/^5/)?r>0?e(t,n,r-1,i):(a.removeFileInfo(t.fileKey),s.onError({errCode:o.errCode,errMsg:o.errMsg})):f.status?(a.removeFileInfo(t.fileKey),s.onError({errCode:o.errCode,errMsg:o.errMsg})):console.log("上传已暂停",f)}},f.open("post",s.directUploadAddr+"/"+o.bucketName+"/"+encodeURIComponent(o.objectName)+"?offset="+n+"&complete="+l+"&context="+c+"&version="+s.version),f.setRequestHeader("x-nos-token",o.token),f.timeout=s.trunkUploadTimeout,f.send(u.call(t.file,n,d))}}(e,n,t.retryCount,(function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.setUploadState("abort"),a.removeFileInfo(this.fileKey)}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){a.setUploadContext(this.fileKey,e),this.param.ctx=e}},{key:"setComplete",value:function(){a.setComplete(this.fileKey),this.setUploadState("ended")}}]),e}())(e,t,n)}},o=i;return t.default}()},"object"==(0,h.default)(t)&&"object"==(0,h.default)(e)?e.exports=o():(a=[],void 0===(i="function"==typeof(r=o)?r.apply(t,a):r)||(e.exports=i))}).call(this,n(119)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=t.stringToBlob=t.formatLogs=t.SPLITTER=void 0;var r,a=n(13),i=(r=a)&&r.__esModule?r:{default:r};var o=t.SPLITTER="*&(&(*&(&(&*(*&^&^$^%$($^%";t.formatLogs=function(e,t,n){for(var r=[],a="用户账号: "+n+", 房间ID: "+t+"\n\n",i=0;i<e.length;i++)e[i]&&(-1!==e[i].indexOf(o)&&r.length>0?(a+=r.join("\n")+"\n\n\n\n\n\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n\n\n",r=[]):r.push(e[i]));return r.length>0&&(a+=r.join("\n")+"\n\n"),a},t.stringToBlob=function(e,t){var n=new Blob([e],{type:"text/plain"});return n.lastModifiedDate=new Date,n.name=t,n},t.delay=function(e){return new i.default((function(t){setTimeout((function(){t()}),e)}))}},,,,,,function(e,t,n){n(66),n(37),n(43),n(246),n(250),n(251),e.exports=n(6).Promise},function(e,t,n){"use strict";var r,a,i,o,s=n(49),u=n(12),c=n(26),l=n(72),d=n(8),f=n(15),p=n(58),h=n(92),g=n(51),v=n(162),y=n(163).set,m=n(248)(),b=n(123),w=n(164),_=n(249),x=n(165),k=u.TypeError,M=u.process,S=M&&M.versions,T=S&&S.v8||"",I=u.Promise,O="process"==l(M),P=function(){},E=a=b.f,C=!!function(){try{var e=I.resolve(1),t=(e.constructor={})[n(11)("species")]=function(e){e(P,P)};return(O||"function"==typeof PromiseRejectionEvent)&&e.then(P)instanceof t&&0!==T.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),N=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},D=function(e,t){if(!e._n){e._n=!0;var n=e._c;m((function(){for(var r=e._v,a=1==e._s,i=0,o=function(t){var n,i,o,s=a?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(a||(2==e._h&&R(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),o=!0)),n===t.promise?c(k("Promise-chain cycle")):(i=N(n))?i.call(n,u,c):u(n)):c(r)}catch(e){l&&!o&&l.exit(),c(e)}};n.length>i;)o(n[i++]);e._c=[],e._n=!1,t&&!e._h&&A(e)}))}},A=function(e){y.call(u,(function(){var t,n,r,a=e._v,i=L(e);if(i&&(t=w((function(){O?M.emit("unhandledRejection",a,e):(n=u.onunhandledrejection)?n({promise:e,reason:a}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",a)})),e._h=O||L(e)?2:1),e._a=void 0,i&&t.e)throw t.v}))},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},R=function(e){y.call(u,(function(){var t;O?M.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},j=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),D(t,!0))},B=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw k("Promise can't be resolved itself");(t=N(e))?m((function(){var r={_w:n,_d:!1};try{t.call(e,c(B,r,1),c(j,r,1))}catch(e){j.call(r,e)}})):(n._v=e,n._s=1,D(n,!1))}catch(e){j.call({_w:n,_d:!1},e)}}};C||(I=function(e){h(this,I,"Promise","_h"),p(e),r.call(this);try{e(c(B,this,1),c(j,this,1))}catch(e){j.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(93)(I.prototype,{then:function(e,t){var n=E(v(this,I));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=O?M.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&D(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new r;this.promise=e,this.resolve=c(B,e,1),this.reject=c(j,e,1)},b.f=E=function(e){return e===I||e===o?new i(e):a(e)}),d(d.G+d.W+d.F*!C,{Promise:I}),n(50)(I,"Promise"),n(124)("Promise"),o=n(6).Promise,d(d.S+d.F*!C,"Promise",{reject:function(e){var t=E(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!C),"Promise",{resolve:function(e){return x(s&&this===o?I:this,e)}}),d(d.S+d.F*!(C&&n(125)((function(e){I.all(e).catch(P)}))),"Promise",{all:function(e){var t=this,n=E(t),r=n.resolve,a=n.reject,i=w((function(){var n=[],i=0,o=1;g(e,!1,(function(e){var s=i++,u=!1;n.push(void 0),o++,t.resolve(e).then((function(e){u||(u=!0,n[s]=e,--o||r(n))}),a)})),--o||r(n)}));return i.e&&a(i.v),n.promise},race:function(e){var t=this,n=E(t),r=n.reject,a=w((function(){g(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return a.e&&r(a.v),n.promise}})},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(12),a=n(163).set,i=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(53)(o);e.exports=function(){var e,t,n,c=function(){var r,a;for(u&&(r=o.domain)&&r.exit();e;){a=e.fn,e=e.next;try{a()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(c)};else if(!i||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(c)}}else n=function(){a.call(r,c)};else{var d=!0,f=document.createTextNode("");new i(c).observe(f,{characterData:!0}),n=function(){f.data=d=!d}}return function(r){var a={fn:r,next:void 0};t&&(t.next=a),e||(e=a,n()),t=a}}},function(e,t,n){var r=n(12).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(8),a=n(6),i=n(12),o=n(162),s=n(165);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,a.Promise||i.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then((function(){return n}))}:e,n?function(n){return s(t,e()).then((function(){throw n}))}:e)}})},function(e,t,n){"use strict";var r=n(8),a=n(123),i=n(164);r(r.S,"Promise",{try:function(e){var t=a.f(this),n=i(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.App=void 0;var _keys=__webpack_require__(14),_keys2=_interopRequireDefault(_keys),_typeof2=__webpack_require__(20),_typeof3=_interopRequireDefault(_typeof2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_stringify=__webpack_require__(19),_stringify2=_interopRequireDefault(_stringify),_set=__webpack_require__(31),_set2=_interopRequireDefault(_set),_classCallCheck2=__webpack_require__(0),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=__webpack_require__(1),_createClass3=_interopRequireDefault(_createClass2),_container=__webpack_require__(100),_container2=_interopRequireDefault(_container),_OpsManager=__webpack_require__(257),_OpsManager2=_interopRequireDefault(_OpsManager),_dispatcher2=__webpack_require__(132),_dispatcher3=_interopRequireDefault(_dispatcher2),_room=__webpack_require__(327),_room2=_interopRequireDefault(_room),_dataHub=__webpack_require__(333),_dataHub2=_interopRequireDefault(_dataHub),_types=__webpack_require__(128),_previewFactory=__webpack_require__(338),_previewFactory2=_interopRequireDefault(_previewFactory),_config=__webpack_require__(102),_config2=_interopRequireDefault(_config),_camera=__webpack_require__(339),_camera2=_interopRequireDefault(_camera),_validate=__webpack_require__(134),_validate2=_interopRequireDefault(_validate),_player=__webpack_require__(340),_player2=_interopRequireDefault(_player),_drawConfig=__webpack_require__(48),_drawConfig2=_interopRequireDefault(_drawConfig),_simulator=__webpack_require__(341),_simulator2=_interopRequireDefault(_simulator),_vision=__webpack_require__(342),_vision2=_interopRequireDefault(_vision),_toast=__webpack_require__(29),_util=__webpack_require__(221),_isBase=__webpack_require__(381),_isBase2=_interopRequireDefault(_isBase),_textConfig=__webpack_require__(129),_textConfig2=_interopRequireDefault(_textConfig),_OneMotionPlugin=__webpack_require__(382),OneMotionPlugin=_interopRequireWildcard(_OneMotionPlugin),_globalVar=__webpack_require__(96),_constant=__webpack_require__(32),_constant2=_interopRequireDefault(_constant),_mediaValid=__webpack_require__(222),_dataReport=__webpack_require__(98),_dataReport2=_interopRequireDefault(_dataReport),_aliveManager=__webpack_require__(383),_aliveManager2=_interopRequireDefault(_aliveManager);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var App=function(){function App(e){var t,n,r,a,i,o,s,u,c,l;(0,_classCallCheck3.default)(this,App),this.PluginType=_types.PluginType,this.isRecordPlayer=!1,this.editEnabled=!1,this.showCursor=!1,this.isConnected=!1,this.zoomTo1AfterJoin=!0,this.reportedError=new _set2.default,this.account=e.account,this.nickname=e.nickname?e.nickname:e.account,this.platform=e.platform,this.appkey=e.appkey,this.logger=e.logger,this.isG1=e.isG1,this.serviceConf=e.serviceConf,this.ntpTimeDiff=e.ntpTimeDiff?e.ntpTimeDiff:0,this.uid=Number(e.uid),!isNaN(Number(null===(t=e.cameraBound)||void 0===t?void 0:t.centerX))&&!isNaN(Number(null===(n=e.cameraBound)||void 0===n?void 0:n.centerY))&&!isNaN(Number(null===(r=e.cameraBound)||void 0===r?void 0:r.width))&&!isNaN(Number(null===(a=e.cameraBound)||void 0===a?void 0:a.height))&&Number(null===(i=e.cameraBound)||void 0===i?void 0:i.width)>0&&Number(null===(o=e.cameraBound)||void 0===o?void 0:o.height)>0?this.defaultCameraBound={centerX:Number(null===(s=e.cameraBound)||void 0===s?void 0:s.centerX),centerY:Number(null===(u=e.cameraBound)||void 0===u?void 0:u.centerY),width:Number(null===(c=e.cameraBound)||void 0===c?void 0:c.width),height:Number(null===(l=e.cameraBound)||void 0===l?void 0:l.height)}:e.cameraBound&&this.logger.error("[白板] 初始坐标系存在问题",(0,_stringify2.default)(e.cameraBound)),this.zoomTo1AfterJoin=void 0===e.zoomTo1AfterJoin||!0===e.zoomTo1AfterJoin,this.nim=e.nim,this.simulator=new _simulator2.default(this),this.configInstance=new _config2.default(this),this.dispatcher=new _dispatcher3.default,this.opsManager=new _OpsManager2.default(this),this.opsManager.extendDefaultOps(),this.dataHub=new _dataHub2.default(this,e.connector),this.container=new _container2.default(this),this.room=new _room2.default(this,this.dataHub),this.container.addOpsManager(this.opsManager),this.opsManager.addContainer(this.container),this.camera=new _camera2.default(this,this.defaultCameraBound),this.vision=new _vision2.default(this),this.isRecordPlayer=!!e.isRecordPlayer,e.isRecordPlayer||(this.previewFactory=new _previewFactory2.default(this)),this.aliveManager=new _aliveManager2.default(this),e.isRecordPlayer&&(this.player=new _player2.default(this)),e.container&&this.setContainer(e.container)}return(0,_createClass3.default)(App,[{key:"getStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _validate2.default.validate(this.logger,"container.getStream",e,{width:{isRequire:!1,type:"number"},keepDPI:{isRequire:!1,type:"boolean"}}),this.container.getStream(e,!0)}},{key:"updateStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _validate2.default.validate(this.logger,"container.updateStream",e,{width:{isRequire:!1,type:"number"},keepDPI:{isRequire:!1,type:"boolean"}}),this.container.getStream(e,!1)}},{key:"stopStream",value:function(){this.container.stopStream()}},{key:"getStrokeWidth",value:function(){return _drawConfig2.default.strokeWidth}},{key:"getOpacity",value:function(){return _drawConfig2.default.opacity}},{key:"getColor",value:function(){return _drawConfig2.default.strokeColor}},{key:"getRedoCount",value:function(){return this.opsManager.opMap.redo.getCount()}},{key:"getUndoCount",value:function(){return this.opsManager.opMap.undo.getCount()}},{key:"isClearAvailable",value:function(){return this.opsManager.opMap.clear.isAvailable()}},{key:"isTextAreaFocus",value:function(){return this.opsManager.opMap.text.isFocus}},{key:"getSelectedIds",value:function(){return this.opsManager.opMap.select.getSelectedIds()}},{key:"getZoomFactor",value:function(){return this.camera.zoomFactor}},{key:"getCameraBound",value:function(){return this.camera.getContainerWorldRect()}},{key:"getVisionState",value:function(){return{mode:this.vision.mode,broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}},{key:"setAppConfig",value:function(e){this.configInstance.setAppConfig(e)}},{key:"setContainer",value:function(e){var t;e.innerHTML="",this.container.appendTo(e),null===(t=this.previewFactory)||void 0===t||t.resetContainer()}},{key:"updateContainerAfterResize",value:function(){this.container.resize()}},{key:"readyToSyncData",value:function(){document.body.style.cursor="auto",this.dataHub.sendSyncRequest()}},{key:"stopSyncData",value:function(){_globalVar.LOG&&this.logger.log("[白板]","drawPlugin.stopSyncData"),this.dataHub.stopSyncRequest()}},{key:"setIsConnected",value:function(e){this.isConnected=e,this.isConnected||(document.body.style.cursor="auto")}},{key:"resetState",value:function(){this.logger.log("[白板] resetState"),this.room.reset(),this.dataHub.reset(),this.opsManager.destroy()}},{key:"addPlugin",value:function(e,t){switch(e){case _types.PluginType.OneMotion:var n=OneMotionPlugin.wrapPluginToOp(this.logger,t);if(this.opsManager.hasOpType(t.type))throw new Error("插件类型"+t.type+"已存在，请使用其他类型名");this.opsManager.extendDrawOp(n);break;default:this.logger.error("drawPlugin.addPlugin 未知插件类型"+e+", 目前支持的参数类型为"+_types.PluginType.OneMotion)}}},{key:"addImage",value:function(e){this.logger.log("[白板]","drawPlugin.addImage",e),_validate2.default.validate(this.logger,"drawPlugin.addImage",e,{url:{type:"string",isRequire:!0},width:{type:"number"},height:{type:"number"}});var t=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;(0,_isBase2.default)(e.url)||(0,_isBase2.default)(e.url,{allowMime:!0})?(0,_util.uploadAndAddResource)(this,{dataURL:e.url,fileName:"img.png"},{width:e.width,height:e.height},{type:"image",pageName:t,sourceType:"",boardName:e.boardName}):e.url.length>1e4?this.logger.error("[白板]","drawPlugin.addImage opt.url长度不应该大于10000"):this.emit("op:image:upload",e.url,{width:e.width,height:e.height,pageName:t,boardName:e.boardName})}},{key:"addLocalResource",value:function(e){this.logger.log("[白板]","drawPlugin.addLocalResource",e),("audio"!==e.type&&"video"!==e.type||!this.hasMediaOnPage())&&(_validate2.default.validate(this.logger,"drawPlugin.addLocalResource",e,{width:{type:"number"},height:{type:"number"},type:{type:"string",enum:["image","video","audio"]}}),(0,_util.popupFileChooserAndUpload)(this,{width:e.width,height:e.height,type:e.type,pageName:this.room.currBoard.currIndex.toString(),boardName:this.room.currBoard.boardName}))}},{key:"addVideo",value:function(e){this.logger.log("[白板]","drawPlugin.addVideo",e),_validate2.default.validate(this.logger,"drawPlugin.addVideo",e,{url:{type:"string",isRequire:!0},sourceType:{type:"string",isRequire:!0},width:{type:"number"},title:{type:"string"}});var t=(0,_mediaValid.getTransformedMediaType)(e.sourceType,"video");if(null===t)return(0,_toast.showToast)({type:"error",time:3,msg:"不支持类型为"+e.sourceType+"的视频文件",msgType:_constant2.default.VIDEO_TYPE_NOT_ALLOWED});var n=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;this.hasMediaOnPage(e.boardName,n)||this.emit("op:video:insert",e.url,{width:e.width,title:e.title,sourceType:t,pageName:n,boardName:e.boardName})}},{key:"hasMediaOnPage",value:function(e,t){var n=this.room.getPageWithFallback(e,t);return!(!n||!n.hasMedia("audio")&&!n.hasMedia("video"))&&(this.logger.warn("[白板] 同一页白板中仅允许插入一个音视频"),(0,_toast.showToast)({msg:"只允许同时放置一个音视频插件",type:"warn",time:3,msgType:_constant2.default.ONE_MEDIA_LIMIT}),!0)}},{key:"addAudio",value:function(e){this.logger.log("[白板]","drawPlugin.addAudio",e),_validate2.default.validate(this.logger,"drawPlugin.addAudio",e,{url:{type:"string",isRequire:!0},sourceType:{type:"string",isRequire:!0},width:{type:"number"},title:{type:"string"}});var t=(0,_mediaValid.getTransformedMediaType)(e.sourceType,"audio");if(null===t)return(0,_toast.showToast)({type:"error",time:3,msg:"不支持类型为"+e.sourceType+"的音频文件",msgType:_constant2.default.AUDIO_TYPE_NOT_ALLOWED});var n=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;this.hasMediaOnPage(e.boardName,n)||this.emit("op:audio:insert",e.url,{width:e.width,title:e.title,sourceType:t,pageName:n,boardName:e.boardName})}},{key:"setPageBackground",value:function(e){this.logger.log("[白板]","drawPlugin.setPageBackground",e),_validate2.default.validate(this.logger,"drawPlugin.setPageBackground",e,{url:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});var t=this.room.getPageNameFromIndex(e.boardName,e.pageIndex);this.emit("op:background:imageUpload",e.url,{width:e.width,height:e.height,pageName:t,boardName:e.boardName})}},{key:"hasBackground",value:function(e){return(e=e||this.room.currBoard.currPage).backgroundSnapshot||null!==e.getAnimPageIndex()}},{key:"hasTransDoc",value:function(){return void 0!==this.room.currBoard.transDocSnapshot}},{key:"hasDoc",value:function(e){return(e=e||this.room.currBoard).hasDoc}},{key:"addTransDoc",value:function(e){this.logger.log("[白板]","drawPlugin.addTransDoc",e);var t=e.docName+"_"+(new Date).valueOf(),n=(0,_assign2.default)({},e,{displayName:e.docName,boardName:t});return this.emit("op:transDoc:add",n),t}},{key:"addDoc",value:function(e){return Array.isArray(e.params)?this._addDocByUrlArray(e):this._addDocByUrlTemplate(e)}},{key:"_addDocByUrlArray",value:function(e){this.logger.log("[白板]","drawPlugin.addDoc",e),_validate2.default.validate(this.logger,"drawPlugin.addDoc",e,{docName:{type:"string",isRequire:!0},params:{type:"array",isRequire:!0}});for(var t=0;t<e.params.length;t++)_validate2.default.validate(this.logger,"drawPlugin.addDoc opt.params["+t+"]",e.params[t],{url:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});if(0===e.params.length)throw new Error("addDoc参数中params的数组长度必须大于0");for(var n=e.docName,r=e.params,a=this.addBoard(n,r.length),i=0;i<r.length;i++)this.setPageBackground({url:r[i].url,width:r[i].width,height:r[i].height,pageIndex:i,boardName:a});return a}},{key:"_addDocByUrlTemplate",value:function(e){if(this.logger.log("[白板]","drawPlugin.addDoc",e),_validate2.default.validate(this.logger,"drawPlugin.addDoc",e,{docName:{type:"string",isRequire:!0}}),_validate2.default.validate(this.logger,"drawPlugin.addDoc opt.params",e.params,{template:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0},pageCount:{type:"number",isRequire:!0},offset:{type:"number",isRequire:!0}}),e.params.pageCount<=0)throw new Error("addDoc参数中params.pageCount必须大于0");var t=e.docName,n=e.params,r=t+"_"+(new Date).valueOf();return this.emit("op:board:add",t,r,n.pageCount,{width:e.params.width,height:e.params.height,template:e.params.template,offset:e.params.offset}),r}},{key:"setCustomBackground",value:function setCustomBackground(coordinate,customFn,bgName){if("string"==typeof customFn)try{customFn=eval(customFn)}catch(e){return void this.logger.error("setCustomBackground的参数应该为函数，或者函数的字符串表达",e)}"function"==typeof customFn&&"world"===coordinate?(this.bgRenderWorld=customFn,this.bgRenderContainer=void 0,this.bgRenderName=bgName):"function"==typeof customFn&&"container"===coordinate?(this.bgRenderWorld=void 0,this.bgRenderContainer=customFn,this.bgRenderName=bgName):this.logger.error("setCustomBackground第一个参数为函数，第二个参数为world或者container"),this.room.refresh()}},{key:"unsetCustomBackground",value:function(){this.bgRenderContainer=void 0,this.bgRenderWorld=void 0,this.bgRenderName=void 0,this.room.refresh()}},{key:"getBgRendererName",value:function(){return this.bgRenderName}},{key:"setTool",value:function(e){this.emit("op:activate",e)}},{key:"setFontsize",value:function(e){this.emit("op:text:fontsize",e)}},{key:"setFontFamily",value:function(e){return _globalVar.LOG&&this.logger.log("[白板]","drawPlugin.setFontFamily",(0,_stringify2.default)(e)),e.fontFace||e.fontFamily?e.fontFace&&Array.isArray(e.fontFace)&&0===e.fontFace.length?this.logger.error("[白板] setFontFamily。你设置了fontFace为数组, 但是数组长度为0"):(e.fontFamily&&console.log("[白板] 设置字体为: "+e.fontFamily+", 您提供的字体应该在各个设备中均可用。如果某些设备中字体不可用，请同时设置opt.fontFace，作为字体的下载地址"),e.fontFace&&console.log("你设置了fontFace, 请保证该URL能被您用户的设备访问, 可以通过在web端检查浏览器的Network->font检测字体是否被下载"),e.fontFamily&&_textConfig2.default.setFontFamily(e.fontFamily),e.fontFace&&Array.isArray(e.fontFace)?_textConfig2.default.setFontFace(e.fontFace):e.fontFace&&_textConfig2.default.setFontFace([e.fontFace]),void this.opsManager.opMap.text.updateFontFamily()):this.logger.error("[白板] drawPlugin.setFontFamily必须提供fontFamily或者fontFace")}},{key:"setColor",value:function(e){this.logger.log("[白板]","drawPlugin.setColor",e),_drawConfig2.default.setStrokeColor(e),this.emit("event:appState:change","renderColor",e)}},{key:"setShapeFill",value:function(){this.logger.error("[白板] setShapeFill已弃用。如果你需要设置图形填充，可以直接设置tool为rect-fill, 或者ellipse-fill")}},{key:"setStrokeWidth",value:function(e){this.logger.log("[白板]","drawPlugin.setStrokeWidth",e),_drawConfig2.default.setStrokeWidth(e),this.emit("event:appState:change","renderWidth",e)}},{key:"setOpacity",value:function(e){if(this.logger.log("[白板]","drawPlugin.setOpacity",e),e>1||e<0)return this.logger.error("drawPlugin.setOpacity的透明度必须大于0，小于等于1");_drawConfig2.default.setOpacity(e),this.emit("event:appState:change","opacity",e)}},{key:"setShowCursor",value:function(e){this.logger.log("[白板]","drawPlugin.setShowCursor",e),this.showCursor=e}},{key:"enableDraw",value:function(e){this.logger.log("[白板]","drawPlugin.enableDraw",e),_validate2.default.validate(this.logger,"drawPlugin.enableDraw",{editEnabled:e},{editEnabled:{type:"boolean",isRequire:!0}}),this.editEnabled!==e&&(e||(document.body.style.cursor="auto"),this.editEnabled=e,this.opsManager.hooks.enableDrawChange.call(e),this.emit("event:editable:change",this.editable))}},{key:"enableCameraTransform",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.enableCameraTransform",e),this.setAppConfig({cameraTransformEnabled:e})}},{key:"resetCamera",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.resetCamera"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:reset-camera:exec",e)}},{key:"setCameraBound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.logger.log("[白板]","drawPlugin.setCameraBound boundary: ",(0,_stringify2.default)(e),"animate: ",t);var n=_validate2.default.validate(this.logger,"drawPlugin.setCameraBound",e,{centerX:{type:"number",isRequire:!0},centerY:{type:"number",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});n&&this.emit("op:camera-bound:send",e,t)}},{key:"fitToContent",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.fitToContent"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:fit-to-content:exec",e)}},{key:"fitToDoc",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.fitToDoc"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:fit-to-doc:exec",e)}},{key:"zoomIn",value:function(){this.logger.log("[白板]","drawPlugin.zoomIn"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:in")}},{key:"zoomOut",value:function(){this.logger.log("[白板]","drawPlugin.zoomOut"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:out")}},{key:"zoomTo",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.logger.log("[白板]","drawPlugin.zoomTo: ",e," animate: ",t),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:to",e,t)}},{key:"lockCameraWithContent",value:function(e){this.camera.lockCameraWithContent(e)}},{key:"unlockCameraWithContent",value:function(){this.camera.unlockCameraWithContent()}},{key:"undo",value:function(){this.logger.log("[白板]","drawPlugin.undo"),this.emit("op:undo:exec")}},{key:"redo",value:function(){this.logger.log("[白板]","drawPlugin.redo"),this.emit("op:redo:exec")}},{key:"clear",value:function(){this.logger.log("[白板]","drawPlugin.clear"),this.emit("op:clear:exec")}},{key:"duplicate",value:function(){this.logger.log("[白板]","drawPlugin.duplicate"),this.emit("op:duplicate:exec")}},{key:"deleteSelectedElements",value:function(){this.logger.log("[白板]","drawPlugin.deleteSelectedElements"),this.emit("op:delete:exec")}},{key:"deleteElementByOpIds",value:function(e){this.logger.log("[白板]","drawPlugin.deleteElementByOpIds",e),this.emit("op:delete:deleteOps",e)}},{key:"addPage",value:function(e){"object"===(void 0===e?"undefined":(0,_typeof3.default)(e))?this.logger.log("[白板]","drawPlugin.addPage",(0,_stringify2.default)(e)):this.logger.log("[白板]","drawPlugin.addPage, insertAfter",e),"number"==typeof e?e={insertAfter:e}:e||(e={}),this.emit("op:page:add",e)}},{key:"deletePage",value:function(e){var t=this.room.currBoard.getPageBuiltInIndex(e);this.logger.log("[白板]","drawPlugin.deletePage: ",e,"builtInIndex",t),this.emit("op:page:delete",t)}},{key:"gotoPage",value:function(e){var t=this.room.currBoard.getPageBuiltInIndex(e);this.logger.log("[白板]","drawPlugin.gotoPage: ",e,"buildInIndex",t),isNaN(t)?this.logger.error("[白板] 第"+(e+1)+"不存在，当前文档内的页面总数为: "+this.room.currBoard.pageNames.length):this.emit("op:page:goto",t)}},{key:"gotoFirstPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoFirstPage"),this.room.currBoard.getCurrPageIndex()>0&&this.gotoPage(0)}},{key:"gotoPrevPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoPrevPage");var e=this.room.currBoard.getCurrPageIndex();e>0&&this.gotoPage(e-1)}},{key:"gotoNextPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoNextPage");var e=this.room.currBoard,t=e.getCurrPageIndex();t<e.pageNames.length-1&&this.gotoPage(t+1)}},{key:"gotoLastPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoLastPage");var e=this.room.currBoard;e.getCurrPageIndex()<e.pageNames.length-1&&this.gotoPage(e.pageNames.length-1)}},{key:"nextAnim",value:function(){this.logger.log("[白板] drawPlugin.nextAnim"),this.emit("op:transDoc:nextAnim")}},{key:"prevAnim",value:function(){this.logger.log("[白板] drawPlugin.prevAnim"),this.emit("op:transDoc:prevAnim")}},{key:"gotoBoard",value:function(e){_validate2.default.validate(this.logger,"drawPlugin.gotoBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.gotoBoard:",e),this.emit("op:board:goto",e)}},{key:"addBoard",value:function(e,t){_validate2.default.validate(this.logger,"drawPlugin.addBoard",{displayName:e},{displayName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.addBoard, displayName:",e," pageCount:",t);var n=e+"_"+(new Date).valueOf();return this.emit("op:board:add",e,n,t),n}},{key:"deleteBoard",value:function(e){_validate2.default.validate(this.logger,"drawPlugin.deleteBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.deleteBoard: ",e),this.emit("op:board:delete",e)}},{key:"getPageInfos",value:function(e){var t=e?this.room.boards[e]:this.room.currBoard;return{pageNames:(t=t||this.room.currBoard).pageNames.slice(),currPage:t.currIndex,activeIndex:t.getCurrPageIndex(),pagePayloads:t.payloadOfPages}}},{key:"getBoardInfos",value:function(){return{boardNames:(0,_keys2.default)(this.room.boards),currBoard:this.room.currIndex,currBoardDisplayName:this.room.currBoard.displayName,boardDisplayNames:this.room.getBoardDisplayNames()}}},{key:"bindPreviewContainer",value:function(e){var t;null===(t=this.previewFactory)||void 0===t||t.bindPreviewContainer(e)}},{key:"preparePreview",value:function(e){var t;null===(t=this.previewFactory)||void 0===t||t.preparePreview(e)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=this.dispatcher).emit.apply(t,[e].concat(r))}},{key:"on",value:function(e,t){this.dispatcher.on(e,t)}},{key:"off",value:function(e,t){this.dispatcher.off(e,t)}},{key:"once",value:function(e,t){this.dispatcher.once(e,t)}},{key:"getOpDoc",value:function(e){return this.opsManager.getOpDoc(e)}},{key:"getCurrTool",value:function(){var e;return null===(e=this.opsManager.currOp)||void 0===e?void 0:e.type}},{key:"destroy",value:function(){this.logger.log("[白板]","drawPlugin.destroy"),this.dispatcher.destroy(),this.container.destroy(),this.opsManager.destroy(),this.dataHub.destroy(),this.vision.destroy(),this.aliveManager.destroy(),this.stopStream(),this.toolCollection&&"function"==typeof this.toolCollection.destroy&&this.toolCollection.destroy(),document.body.style.cursor="auto",this.setIsConnected(!1)}},{key:"addRecordData",value:function(e){var t;null===(t=this.player)||void 0===t||t.addRecordData(e)}},{key:"seekTo",value:function(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e)}},{key:"play",value:function(){var e;null===(e=this.player)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.player)||void 0===e||e.pause()}},{key:"setPlaySpeed",value:function(e){var t;null===(t=this.player)||void 0===t||t.setPlaySpeed(e)}},{key:"setViewer",value:function(e){var t;null===(t=this.player)||void 0===t||t.setViewer(e)}},{key:"setSelfAsBroadcaster",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsBroadcaster"),this.vision.setSelfAsBroadcaster()}},{key:"unsetSelfAsBroadcaster",value:function(){this.logger.log("[白板]","drawPlugin.unsetSelfAsBroadcaster"),this.vision.unsetSelfAsBroadcaster()}},{key:"setSelfAsFollower",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsFollower"),this.vision.setSelfAsFollower()}},{key:"setSelfAsFreeObserver",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsFreeObserver"),this.vision.setSelfAsFreeObserver()}},{key:"exportAsImage",value:function(e){this.logger.log("[白板]","drawPlugin.exportAsImage",e);var t=null==e?void 0:e.type,n=null==e?void 0:e.quality,r="wholePage"===(null==e?void 0:e.content)?"wholePage":"clip",a=!!(null==e?void 0:e.omitSelection),i=!!(null==e?void 0:e.customBg);t&&!t.startsWith("image")&&(t="image/"+t);var o=this.previewFactory.generatePreviewToDataUrl({pageIndex:this.room.currBoard.currIndex.toString(),boardName:this.room.currIndex,state:"ready",content:r,omitSelection:a,customBg:i},t,n),s=document.createElement("a");s.href=o;var u="whiteboard"===this.room.currBoard.boardName?"白板":this.room.currBoard.boardName,c=this.room.currBoard.currPage.pageIndex,l=this.room.currBoard.pageNames.indexOf(c),d=t&&-1!==t.toLowerCase().indexOf("jpeg")?"jpeg":"png";s.download=u+"-"+(l+1)+"."+d,s.click()}},{key:"exportAsBase64String",value:function(e,t){var n=void 0,r=void 0,a=!1,i=!1;return e&&"object"===(void 0===e?"undefined":(0,_typeof3.default)(e))?(n=e.type,t=e.quality,r=e.content,a=!!e.omitSelection,i=!!e.customBg):n=e,r="wholePage"===r?"wholePage":"clip",this.logger.log("[白板]","drawPlugin.exportAsBase64String("+e+", "+t),n&&!n.startsWith("image")&&(n="image/"+n),this.previewFactory.generatePreviewToDataUrl({pageIndex:this.room.currBoard.currIndex.toString(),boardName:this.room.currIndex,state:"ready",content:r,omitSelection:a,customBg:i},n,t)}},{key:"setMemberList",value:function(e){this.emit("event:member:change",e.slice())}},{key:"dataReportUtil",value:function(e,t){this.dataReportUrl&&this.dataReportParams&&!this.isRecordPlayer&&("v3_run_error"===e?t.error&&!this.reportedError.has(t.error.message)&&((0,_dataReport2.default)(this.dataReportUrl,e,this.dataReportParams.appkey+"-"+this.dataReportParams.cid,(0,_assign2.default)((0,_assign2.default)((0,_assign2.default)({},this.dataReportParams),{time:Date.now()}),t)),this.reportedError.add(t.error.message)):(0,_dataReport2.default)(this.dataReportUrl,e,this.dataReportParams.appkey+"-"+this.dataReportParams.cid,(0,_assign2.default)((0,_assign2.default)((0,_assign2.default)({},this.dataReportParams),{time:Date.now()}),t)))}},{key:"setDataReportParams",value:function(e,t){this.dataReportUrl=e,this.dataReportParams=t}},{key:"setToolCollection",value:function(e){this.toolCollection&&"function"==typeof this.toolCollection.destroy&&this.toolCollection.destroy(),this.toolCollection=e}},{key:"disableInteraction",value:function(){this.container.disableInteraction()}},{key:"enableInteraction",value:function(){this.container.enableInteraction()}},{key:"ifDeviceSupportOrientation",get:function(){return-1!==_types.TouchPlatformArray.indexOf(this.platform.toLowerCase())}},{key:"editable",get:function(){return this.editEnabled&&!this.dataHub.isSynchronizing&&this.isConnected}},{key:"appConfig",get:function(){return this.configInstance.getAppConfig()}}]),App}(),DrawPlugin={getInstance:function(e){return e.logger.log("[白板]","DrawPlugin.getInstance arguments:",e),_validate2.default.validate(e.logger,"DrawPlugin.instance",e,{account:{type:"string",isRequire:!0},nickname:{type:"string",isRequire:!1},container:{type:"dom",isRequire:!1},platform:{type:"string",isRequire:!0,enum:_types.PlatformArray},connector:{type:"object",isRequire:!0},nim:{type:"object",isRequire:!0}}),new App(e)}};exports.App=App,exports.default=DrawPlugin},function(e,t,n){e.exports={default:n(254),__esModule:!0}},function(e,t,n){n(43),n(37),e.exports=n(255)},function(e,t,n){var r=n(72),a=n(11)("iterator"),i=n(40);e.exports=n(6).isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||i.hasOwnProperty(r(t))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evenify=function(e){return 2*Math.ceil(e/2)},t.deltaXY=function(e,t){return[(t[0]-e[0]+t[2]-e[2])/2,(t[1]-e[1]+t[3]-e[3])/2]},t.fingerDiff=function(e,t){return Math.abs(t[0]-e[0]-t[2]+e[2])+Math.abs(t[1]-e[1]-t[3]+e[3])},t.pinchScale=function(e,t){var n=Math.abs(e[0]-e[2])+Math.abs(e[1]-e[3]);return(Math.abs(t[0]-t[2])+Math.abs(t[1]-t[3]))/n},t.ptsCenter=function(e,t){return[(e[0]+e[2]+t[0]+t[2])/4,(e[1]+e[3]+t[1]+t[3])/4]},t.scaleProb=function(e,t,n){var r=0,a=[2.5,6],i=0,o=[.01,.05],s=e/t;if(isNaN(s))return.5;r=s>a[1]?1:s>a[0]?Math.min(1,.5+Math.sqrt((s-a[0])/(a[1]-a[0]))/2):(1-Math.sqrt((a[0]-s)/a[0]))/2;i=n>o[1]?1:n>o[0]?Math.min(1,.5+Math.sqrt((n-o[0])/(o[1]-o[0]))/2):(1-Math.sqrt((o[0]-n)/o[0]))/2;return.7*r+.3*i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Q(n(19)),a=Q(n(0)),i=Q(n(1)),o=Q(n(31)),s=n(54),u=n(258),c=Q(n(198)),l=Q(n(200)),d=Q(n(101)),f=Q(n(274)),p=Q(n(275)),h=Q(n(276)),g=Q(n(277)),v=Q(n(278)),y=Q(n(279)),m=Q(n(280)),b=Q(n(202)),w=Q(n(203)),_=Q(n(281)),x=Q(n(286)),k=Q(n(287)),M=Q(n(289)),S=Q(n(290)),T=Q(n(292)),I=Q(n(293)),O=Q(n(294)),P=Q(n(295)),E=Q(n(296)),C=Q(n(297)),N=Q(n(298)),D=Q(n(299)),A=Q(n(300)),L=Q(n(301)),R=Q(n(303)),j=Q(n(304)),B=Q(n(305)),z=Q(n(56)),F=Q(n(306)),U=Q(n(307)),W=Q(n(308)),Y=n(96),H=Q(n(323)),q=Q(n(324));function Q(e){return e&&e.__esModule?e:{default:e}}var G=new o.default,X=function(){function e(t){var n=this;(0,a.default)(this,e),this.currOp=null,this.opMap={},this.drawOpTypes=[],this.app=t,this.dispatcher=t.dispatcher,this.hooks={scale:new u.SyncBailHook(["event","scale","clientX","clientY"]),pan:new u.SyncBailHook(["event","clientDx","clientDy"]),mousedown:new u.SyncBailHook(["event","mx","my","clientX","clientY"]),mouseup:new u.SyncBailHook(["event","mx","my","clientX","clientY"]),mousemove:new u.SyncBailHook(["event","mx","my","clientX","clientY"]),mouseleave:new u.SyncBailHook(["event","mx","my","clientX","clientY"]),mousewheel:new u.SyncBailHook(["event","mx","my","clientX","clientY"]),resize:new u.SyncBailHook(["event","width","height"]),click:new u.SyncBailHook(["event","mx","my","clientX","clientY"]),keyup:new u.SyncBailHook(["event"]),keydown:new u.SyncBailHook(["event"]),addOpHook:new u.SyncHook(["snapshot","isNew"]),refresh:new u.SyncHook([]),opChange:new u.SyncHook(["type"]),selectChange:new u.SyncHook(["prevSelectedOpIds","selectedOpIds"]),pageChange:new u.SyncHook(["snapshot"]),boardChange:new u.SyncHook([]),pageReady:new u.SyncHook(["boardName, pageIndex"]),enableDrawChange:new u.SyncHook(["enable"]),previewWaiting:new u.SyncHook(["pageIndex"])},this.dispatcher.on("op:activate",(function(e){n.setCurrOp(e)}))}return(0,i.default)(e,[{key:"extendDefaultOps",value:function(){this.extendOp(L.default),this.extendDrawOp(c.default),this.extendDrawOp(T.default),this.extendDrawOp(I.default),this.extendDrawOp(l.default),this.extendDrawOp(b.default),this.extendDrawOp(F.default),this.extendDrawOp(U.default),this.extendDrawOp(w.default),this.extendOp(_.default),this.extendOp(P.default),this.extendOp(d.default),this.extendOp(p.default),this.extendOp(f.default),this.extendOp(h.default),this.extendOp(S.default),this.extendOp(g.default),this.extendOp(v.default),this.extendOp(y.default),this.extendOp(m.default),this.extendOp(O.default),this.extendOp(x.default),this.extendOp(M.default),this.extendOp(q.default),this.extendOp(k.default),this.extendOp(W.default),this.extendOp(H.default),this.extendOp(C.default),this.extendOp(E.default),this.extendOp(N.default),this.extendOp(D.default),this.extendOp(A.default),this.extendOp(R.default),this.extendOp(z.default),this.extendOp(j.default),this.extendOp(B.default),this.setCurrOp("pen")}},{key:"addContainer",value:function(e){this.container=e}},{key:"extendDrawOp",value:function(e){var t=this.extendOp(e);this.drawOpTypes.push(t.type)}},{key:"extendOp",value:function(e){var t,n,r=new e(this.app);this.opMap[r.type]=r;var a=r.eventsToListen();if((null===(t=a.activate)||void 0===t?void 0:t.value)&&(null===(n=a.exec)||void 0===n?void 0:n.value))throw new Error("DEV--\x3e 操作不能同时设置activate和exec为true。操作不同同时为命令类操作，及状态类操作");for(var i in a.activate&&a.activate.value||a.exec&&a.exec.value&&this.dispatcher.on("op:"+r.type+":exec",r.execCommand.bind(r)),a)"activate"!==i&&"exec"!==i&&this.dispatcher.on("op:"+i,a[i].value);return r}},{key:"getOpDoc",value:function(e){var t=[];if(void 0!==e)t=this._getOpDoc(e);else{for(var n in this.opMap)(t=t.concat(this._getOpDoc(n))).push("*************************************");t.push("全局事件\n\n用法：app.on('event:add:snapshot', (data: {local: boolean, snapshot: IOPSnapshot}) => {})\n作用： 接收到新的快照时发送此事件\n"),t.push("*************************************")}return t.join("\n\n")}},{key:"_getOpDoc",value:function(e){var t=[];if(this.opMap.hasOwnProperty(e)){var n=this.opMap[e];n.description&&t.push(n.description);var r=n.eventsToListen();for(var a in r){var i=r[a].information,o="op:"+a;"activate"!==a&&"exec"!==a||(o="op:"+n.type+":"+a),t.push("用法：app.emit('"+o+"'"+(i.args.length>0?", "+i.args:"")+")\n作用："+i.message)}}else this.logger.log("DEV--\x3e","op:"+e+"不存在!!!!!!");return t}},{key:"setCurrOp",value:function(e){var t;return Y.LOG&&this.logger.log("[白板]","设置当前op为："+e),(null===(t=this.currOp)||void 0===t?void 0:t.type)!==e&&(document.body.style.cursor="default",this.hooks.opChange.call(e),this.currOp=this.opMap[e],this.app.emit("event:appState:change","currTool",e),!0)}},{key:"currOpIsCamera",value:function(){var e;return this.currOp&&-1!==s.cameraSnapshotTypes.indexOf(null===(e=this.currOp)||void 0===e?void 0:e.type)}},{key:"resize",value:function(e,t,n){this.hooks.resize.call(e,t,n)||this.currOp&&"handleResize"in this.currOp&&this.currOp.handleResize(e,t,n)}},{key:"pan",value:function(e,t,n){(this.app.editable||this.currOpIsCamera())&&(this.hooks.pan.call(e,t,n)||this.currOp&&"handlePan"in this.currOp&&this.currOp.handlePan(e,t,n))}},{key:"scale",value:function(e,t,n,r){(this.app.editable||this.currOpIsCamera())&&(this.hooks.scale.call(e,t,n,r)||this.currOp&&"handleScale"in this.currOp&&this.currOp.handleScale(e,t,n,r))}},{key:"mousedown",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousedown.call(e,t,n,r,a)||this.currOp&&"handleMouseDown"in this.currOp&&this.currOp.handleMouseDown(e,t,n,r,a))}},{key:"mouseup",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mouseup.call(e,t,n,r,a)||this.currOp&&"handleMouseUp"in this.currOp&&this.currOp.handleMouseUp(e,t,n,r,a))}},{key:"mouseleave",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mouseleave.call(e,t,n,r,a)||this.currOp&&"handleMouseLeave"in this.currOp&&this.currOp.handleMouseLeave(e,t,n,r,a))}},{key:"mousewheel",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousewheel.call(e,t,n,r,a)||this.currOp&&"handleMouseWheel"in this.currOp&&this.currOp.handleMouseWheel(e,t,n,r,a))}},{key:"mousemove",value:function(e,t,n,r,a){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousemove.call(e,t,n,r,a)||this.currOp&&"handleMouseMove"in this.currOp&&this.currOp.handleMouseMove(e,t,n,r,a))}},{key:"click",value:function(e,t,n,r,a){this.app.editable&&(this.hooks.click.call(e,t,n,r,a)||this.currOp&&"handleClick"in this.currOp&&this.currOp.handleClick(e,t,n,r,a))}},{key:"keyup",value:function(e){this.app.editable&&(this.hooks.keyup.call(e)||this.currOp&&"handleKeyUp"in this.currOp&&this.currOp.handleKeyUp(e))}},{key:"keydown",value:function(e){this.app.editable&&(this.hooks.keydown.call(e)||this.currOp&&"handleKeyDown"in this.currOp&&this.currOp.handleKeyDown(e))}},{key:"draw",value:function(e,t,n){try{var r=e.data.type;this.opMap[r]&&this.opMap[r].draw(e,t,n)}catch(e){this.logger.warn("[白板] opsManager.draw error",e)}}},{key:"preview",value:function(e,t,n){try{var r=e.data.type;this.opMap[r].preview(e,t,n)}catch(e){this.logger.warn("[白板] opsManager.preview error",e)}}},{key:"hide",value:function(e,t,n){try{var r=e.data.type;this.opMap[r]&&this.opMap[r].hide(e,t,n)}catch(e){this.logger.warn("[白板] opsManager.hide error",e)}}},{key:"mergePartial",value:function(e,t){var n=e.data.type;return this.opMap[n]?this.opMap[n].mergePartial(e,t):(G.has(n)||(this.logger.error("[白板] 找不到type为"+n+"的教具类型",(0,r.default)(e)),G.add(n)),e)}},{key:"mergeTwoPartial",value:function(e,t){var n={opId:e.opId,data:e.data};for(var r in t.data)Array.isArray(t.data[r])&&Array.isArray(n.data[r])?n.data[r]=n.data[r].concat(t.data[r]):n.data[r]=t.data[r];return n}},{key:"hasOpType",value:function(e){return this.opMap.hasOwnProperty(e)}},{key:"resetUndoRedoCount",value:function(){this.opMap.undo.resetCount(),this.opMap.redo.resetCount()}},{key:"destroy",value:function(){for(var e in this.opMap)this.opMap[e]&&"function"==typeof this.opMap[e].destroy&&this.opMap[e].destroy()}},{key:"logger",get:function(){return this.app.logger}},{key:"currPage",get:function(){return this.currBoard.pages[this.currBoard.currIndex]}},{key:"currBoard",get:function(){return this.app.room.boards[this.app.room.currIndex]}},{key:"drawOpsOfPage",get:function(){return this.currPage.drawOpQueue||{}}},{key:"selectOp",get:function(){return this.opMap.select}},{key:"selectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.selectedOpIds}},{key:"inProgressSelectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.inProgressSelectedOpIds}}]),e}();t.default=X},function(e,t,n){"use strict";t.__esModule=!0,t.Tapable=n(259),t.SyncHook=n(263),t.SyncBailHook=n(185),t.SyncWaterfallHook=n(264),t.SyncLoopHook=n(265),t.AsyncParallelHook=n(266),t.AsyncParallelBailHook=n(267),t.AsyncSeriesHook=n(268),t.AsyncSeriesBailHook=n(269),t.AsyncSeriesWaterfallHook=n(270),t.HookMap=n(271),t.MultiHook=n(272)},function(e,t,n){"use strict";var r=i(n(31)),a=i(n(9));function i(e){return e&&e.__esModule?e:{default:e}}var o=n(236),s=n(185);function u(){var e=this;this._pluginCompat=new s(["options"]),this._pluginCompat.tap({name:"Tapable camelCase",stage:100},(function(e){e.names.add(e.name.replace(/[- ]([a-z])/g,(function(e,t){return t.toUpperCase()})))})),this._pluginCompat.tap({name:"Tapable this.hooks",stage:200},(function(t){var n=void 0,r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(t.names);!(r=(s=u.next()).done);r=!0){var c=s.value;if(void 0!==(n=e.hooks[c]))break}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}if(void 0!==n){var l={name:t.fn.name||"unnamed compat plugin",stage:t.stage||0};return t.async?n.tapAsync(l,t.fn):n.tap(l,t.fn),!0}}))}e.exports=u,u.addCompatLayer=function(e){u.call(e),e.plugin=u.prototype.plugin,e.apply=u.prototype.apply},u.prototype.plugin=o.deprecate((function(e,t){if(Array.isArray(e))e.forEach((function(e){this.plugin(e,t)}),this);else if(!this._pluginCompat.call({name:e,fn:t,names:new r.default([e])}))throw new Error("Plugin could not be registered at '"+e+"'. Hook was not found.\nBREAKING CHANGE: There need to exist a hook at 'this.hooks'. To create a compatibility layer for this hook, hook into 'this._pluginCompat'.")}),"Tapable.plugin is deprecated. Use new API on `.hooks` instead"),u.prototype.apply=o.deprecate((function(){for(var e=0;e<arguments.length;e++)arguments[e].apply(this)}),"Tapable.apply is deprecated. Call apply on the plugin directly instead")},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){n(262);var r=n(6).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},function(e,t,n){var r=n(8);r(r.S+r.F*!n(17),"Object",{defineProperties:n(120)})},function(e,t,n){"use strict";var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(38),l=new(function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,n){return t(n)},onDone:n,rethrowIfPossible:r})}}]),t}(n(42))),d=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(38),l=new(function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=this,n=e.onError,r=e.onResult,a=e.resultReturns,i=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,t){return n(t)},onResult:function(e,n,r){var a="";return a+="if("+n+" !== undefined) {\n",a+=t._args[0]+" = "+n+";\n",a+="}\n",a+=r()},onDone:function(){return r(t._args[0])},doneReturns:a,rethrowIfPossible:i})}}]),t}(n(42))),d=function(e){function t(e){(0,a.default)(this,t);var n=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncWaterfallHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncWaterfallHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=n(38),l=new(function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone,r=e.rethrowIfPossible;return this.callTapsLooping({onError:function(e,n){return t(n)},onDone:n,rethrowIfPossible:r})}}]),t}(n(42))),d=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncLoopHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncLoopHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(c);e.exports=d},function(e,t,n){"use strict";var r=c(n(55)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(38),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone;return this.callTapsParallel({onError:function(e,n,r,a){return t(n)+a(!0)},onDone:n})}}]),t}(n(42))),f=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=c(n(55)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(38),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.onDone,a="";return a+="var _results = new Array("+this.options.taps.length+");\n",a+="var _checkDone = () => {\n",a+="for(var i = 0; i < _results.length; i++) {\n",a+="var item = _results[i];\n",a+="if(item === undefined) return false;\n",a+="if(item.result !== undefined) {\n",a+=n("item.result"),a+="return true;\n",a+="}\n",a+="if(item.error) {\n",a+=t("item.error"),a+="return true;\n",a+="}\n",a+="}\n",a+="return false;\n",a+="}\n",a+=this.callTapsParallel({onError:function(e,t,n,r){var a="";return a+="if("+e+" < _results.length && ((_results.length = "+(e+1)+"), (_results["+e+"] = { error: "+t+" }), _checkDone())) {\n",a+=r(!0),a+="} else {\n",a+=n(),a+="}\n"},onResult:function(e,t,n,r){var a="";return a+="if("+e+" < _results.length && ("+t+" !== undefined && (_results.length = "+(e+1)+"), (_results["+e+"] = { result: "+t+" }), _checkDone())) {\n",a+=r(!0),a+="} else {\n",a+=n(),a+="}\n"},onTap:function(e,t,n,r){var a="";return e>0&&(a+="if("+e+" >= _results.length) {\n",a+=n(),a+="} else {\n"),a+=t(),e>0&&(a+="}\n"),a},onDone:r})}}]),t}(n(42))),f=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=c(n(55)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(38),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onDone;return this.callTapsSeries({onError:function(e,n,r,a){return t(n)+a(!0)},onDone:n})}}]),t}(n(42))),f=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=c(n(55)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(38),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,n=e.onResult,r=e.resultReturns,a=e.onDone;return this.callTapsSeries({onError:function(e,n,r,a){return t(n)+a(!0)},onResult:function(e,t,r){return"if("+t+" !== undefined) {\n"+n(t)+";\n} else {\n"+r()+"}\n"},resultReturns:r,onDone:a})}}]),t}(n(42))),f=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=c(n(55)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(38),d=new(function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=this,n=e.onError,r=e.onResult;e.onDone;return this.callTapsSeries({onError:function(e,t,r,a){return n(t)+a(!0)},onResult:function(e,n,r){var a="";return a+="if("+n+" !== undefined) {\n",a+=t._args[0]+" = "+n+";\n",a+="}\n",a+=r()},onDone:function(){return r(t._args[0])}})}}]),t}(n(42))),f=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,r.default)(f.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=f},function(e,t,n){"use strict";var r=s(n(5)),a=s(n(95)),i=s(n(0)),o=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,i.default)(this,e),this._map=new a.default,this._factory=t,this._interceptors=[]}return(0,o.default)(e,[{key:"get",value:function(e){return this._map.get(e)}},{key:"for",value:function(e){var t=this.get(e);if(void 0!==t)return t;for(var n=this._factory(e),r=this._interceptors,a=0;a<r.length;a++)n=r[a].factory(e,n);return this._map.set(e,n),n}},{key:"intercept",value:function(e){this._interceptors.push((0,r.default)({factory:function(e,t){return t}},e))}},{key:"tap",value:function(e,t,n){return this.for(e).tap(t,n)}},{key:"tapAsync",value:function(e,t,n){return this.for(e).tapAsync(t,n)}},{key:"tapPromise",value:function(e,t,n){return this.for(e).tapPromise(t,n)}}]),e}();e.exports=u},function(e,t,n){"use strict";var r=o(n(9)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}n(38);var s=function(){function e(t){(0,a.default)(this,e),this.hooks=t}return(0,i.default)(e,[{key:"tap",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=(0,r.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tap(e,t)}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}}},{key:"tapAsync",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=(0,r.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tapAsync(e,t)}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}}},{key:"tapPromise",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=(0,r.default)(this.hooks);!(n=(o=s.next()).done);n=!0){o.value.tapPromise(e,t)}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}}},{key:"isUsed",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=(0,r.default)(this.hooks);!(e=(a=i.next()).done);e=!0){if(a.value.isUsed())return!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}return!1}},{key:"intercept",value:function(e){var t=!0,n=!1,a=void 0;try{for(var i,o=(0,r.default)(this.hooks);!(t=(i=o.next()).done);t=!0){i.value.intercept(e)}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}}},{key:"withOptions",value:function(t){return new e(this.hooks.map((function(e){return e.withOptions(t)})))}}]),e}();e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawCurve=void 0;var r,a=n(41),i=(r=a)&&r.__esModule?r:{default:r};t.drawCurve=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;(n>.5||n<=0)&&console.error("k should be between 0 and 0.5"),e.beginPath();for(var r=0;r<t.length;r++)if(void 0!==t[r])for(var a=r+1;a<=t.length;a++)if(a===t.length||void 0===t[a]){o(e,t.slice(r,a),n),r=a;break}};var o=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;if(t.length<=2)2===t.length&&(e.moveTo.apply(e,(0,i.default)(t[0])),e.lineTo.apply(e,(0,i.default)(t[1])));else{e.moveTo.apply(e,(0,i.default)(t[0]));var r=t[0],a=t[1],o=[n*r[0]+(1-n)*a[0],n*r[1]+(1-n)*a[1]];Math.abs(n-.5)>.01&&e.lineTo.apply(e,(0,i.default)(o)),r=a;for(var s=2;s<t.length;s++){a=t[s];var u=[(1-n)*r[0]+n*a[0],(1-n)*r[1]+n*a[1]],c=[n*r[0]+(1-n)*a[0],n*r[1]+(1-n)*a[1]];e.quadraticCurveTo.apply(e,(0,i.default)(r).concat(u)),e.lineTo.apply(e,c),o=c,r=a}e.lineTo.apply(e,(0,i.default)(t[t.length-1]))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(5)),a=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(4)),c=p(n(10)),l=n(18),d=n(36),f=p(n(101));function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="move",e.points=[],e.activate=!1,e.description="移动操作工具。内部使用，不提供对外接口",e.idsBeenMoved=[],e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("MousedownPlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseup.tap("MouseupPlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseMove",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default){if(t=Number(t.toFixed(3)),n=Number(n.toFixed(3)),this.activate)return this.points.push([t,n]),this.dispatch(this.getSnapshot(!0,this.idsBeenMoved)),!0;if(!this.isMouseDown&&"nwse-resize"!==document.body.style.cursor&&"nesw-resize"!==document.body.style.cursor)if(this.mouseInSelectedEleBoundary(t,n,this.opsManager.selectedOpIds)||this.opsManager.inProgressSelectedOpIds.length>0)document.body.style.cursor="move";else{var r=(0,d.findOpsUnderMouse)(this.app.camera.scale,[[t,n]],this.drawOpsOfPage,this.opsManager);(0,d.arrayDeduce)(r,this.opsManager.selectedOpIds.concat(this.opsManager.inProgressSelectedOpIds)).length>0?document.body.style.cursor="move":document.body.style.cursor="default"}}}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof f.default){t=Number(t.toFixed(3)),n=Number(n.toFixed(3));var r=this.opsManager.inProgressSelectedOpIds.concat(this.opsManager.selectOp.lastSelectedOpIds),a=this.mouseInSelectedEleBoundary(t,n,r),i=this.mouseInSelectedEleBoundary(t,n,this.opsManager.selectedOpIds);if(a){var o=r.slice();return this.dispatch(this.opsManager.selectOp.getSnapshot(o)),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=o.slice(),this.points=[[t,n]],this.activate=!0,!0}if(i)return this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=this.opsManager.selectedOpIds,this.points=[[t,n]],this.activate=!0,!0;var s=(0,d.findOpsUnderMouse)(this.app.camera.scale,[[t,n]],this.drawOpsOfPage,this.opsManager);if(s.length>0)return this.dispatch(this.opsManager.selectOp.getSnapshot(s)),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=s.slice(),this.points=[[t,n]],this.activate=!0,!0}this.activate=!1}},{key:"handleMouseUp",value:function(e,t,n){if(this.activate)return this.activate=!1,t=Number(t.toFixed(3)),n=Number(n.toFixed(3)),this.points.push([t,n]),this.dispatch(this.getSnapshot(!1,this.idsBeenMoved)),!0}},{key:"getSnapshot",value:function(e,t){return{type:this.type,sp:this.points[0],ep:this.points[this.points.length-1],dependOn:t.slice(),inProgress:e}}},{key:"mouseInSelectedEleBoundary",value:function(e,t,n){var r=this;if(0===(n=n.filter((function(e){return r.drawOpsOfPage.hasOwnProperty(e)}))).length)return!1;var a=this.opsManager.selectOp.eleContainerPadding,i=n.map((function(e){var t=r.drawOpsOfPage[e];return(0,l.getTransformedBoundary)(r.app.camera.scale,t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)})).reduce((function(e,t){return(0,l.combineBoundary)(e,t)}));return(0,l.pointInRect)({sx:i.sx-a,sy:i.sy-a,w:i.w+2*a,h:i.h+2*a},[e,t])}},{key:"transformOp",value:function(e,t){var n=t.data,a=void 0,i=void 0;Array.isArray(n.points)?(a=n.points[n.points.length-1][0]-n.points[0][0],i=n.points[n.points.length-1][1]-n.points[0][1]):(a=n.ep[0]-n.sp[0],i=n.ep[1]-n.sp[1]);var o=(0,r.default)({},e.data,{dx:a+(e.data.dx||0),dy:i+(e.data.dy||0),inProgress:n.inProgress});return(0,r.default)({},e,{data:o})}}]),t}(c.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(n(5)),a=h(n(35)),i=h(n(2)),o=h(n(0)),s=h(n(1)),u=h(n(3)),c=h(n(4)),l=h(n(10)),d=h(n(101)),f=n(18),p=n(128);function h(e){return e&&e.__esModule?e:{default:e}}var g=["text","video"],v=["audio"],y=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="scale",e.coordinateX=0,e.coordinateY=0,e.boundaryW=1,e.boundaryH=1,e.activate=!1,e.idsBeenScaled=[],e.description="缩放操作工具。内部使用，不提供对外接口",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MouseMovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mousedown.tap("MouseMovePlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mouseup.tap("MouseMovePlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseDown",value:function(e,t,n){if(this.opsManager.currOp instanceof d.default){var r=this.mousePosTest(t,n);if(document.body.style.cursor=r.cursorSuggestion,!0===r.value)return this.beginBatch(),this.activate=!0,this.coordinateX=r.coordinateX,this.coordinateY=r.coordinateY,this.boundaryW=0===r.w?1:r.w,this.boundaryH=0===r.h?1:r.h,this.idsBeenScaled=this.opsManager.selectedOpIds.slice(),!0}this.activate=!1}},{key:"handleMouseMove",value:function(e,t,n){if(this.opsManager.currOp instanceof d.default){if(this.activate)return this.scaleInfo={scaleX:{coordinate:this.coordinateX,factor:(t-this.coordinateX)/this.boundaryW},scaleY:{coordinate:this.coordinateY,factor:(n-this.coordinateY)/this.boundaryH}},this.dispatch(this.getSnapshot(!0,this.idsBeenScaled)),!0;if(this.opsManager.currOp instanceof d.default&&!this.isMouseDown&&this.opsManager.currOp.selectedOpIds.length>0){var r=this.mousePosTest(t,n);document.body.style.cursor=r.cursorSuggestion}else document.body.style.cursor="default"}}},{key:"handleMouseUp",value:function(e,t,n){if(this.activate&&this.scaleInfo)return this.activate=!1,this.dispatch(this.getSnapshot(!1,this.idsBeenScaled)),this.scaleInfo=void 0,!0}},{key:"mousePosTest",value:function(e,t){var n=this,r=this.opsManager.selectedOpIds;if(0===(r=r.filter((function(e){return n.drawOpsOfPage.hasOwnProperty(e)}))).length)return{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,w:1,h:1};var a=this.opsManager.selectedOpIds.map((function(e){var t=n.drawOpsOfPage[e];return(0,f.getTransformedBoundary)(n.app.camera.scale,t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)})).reduce((function(e,t){return(0,f.combineBoundary)(e,t)})),i=15;return-1!==p.TouchPlatformArray.indexOf(this.app.platform)&&(i*=2.2),i*=Math.max(1/this.app.camera.zoomFactor,1),(0,f.pointCollideWithPoint)([e,t],[a.sx,a.sy],i)?{value:!0,cursorSuggestion:"nwse-resize",coordinateX:a.sx+a.w,coordinateY:a.sy+a.h,w:-a.w,h:-a.h}:(0,f.pointCollideWithPoint)([e,t],[a.sx+a.w,a.sy],i)?{value:!0,cursorSuggestion:"nesw-resize",coordinateX:a.sx,coordinateY:a.sy+a.h,w:a.w,h:-a.h}:(0,f.pointCollideWithPoint)([e,t],[a.sx,a.sy+a.h],i)?{value:!0,cursorSuggestion:"nesw-resize",coordinateX:a.sx+a.w,coordinateY:a.sy,w:-a.w,h:a.h}:(0,f.pointCollideWithPoint)([e,t],[a.sx+a.w,a.sy+a.h],i)?{value:!0,cursorSuggestion:"nwse-resize",coordinateX:a.sx,coordinateY:a.sy,w:a.w,h:a.h}:{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,w:a.w,h:a.h}}},{key:"getSnapshot",value:function(e,t){return{type:this.type,inProgress:e,scaleInfo:this._clipScaleInfo(),dependOn:t.slice()}}},{key:"_clipScaleInfo",value:function(){return this.scaleInfo?{scaleX:{coordinate:Number(this.scaleInfo.scaleX.coordinate.toFixed(3)),factor:Number(this.scaleInfo.scaleX.factor.toFixed(3))},scaleY:{coordinate:Number(this.scaleInfo.scaleY.coordinate.toFixed(3)),factor:Number(this.scaleInfo.scaleY.factor.toFixed(3))}}:this.scaleInfo}},{key:"getScaleParameterBySnapshot",value:function(e){var t=e.data,n=1,r=1,a=0,i=0,o=void 0,s=(o=Array.isArray(t.scaleList)?t.scaleList[t.scaleList.length-1]:t.scaleInfo).scaleX.factor,u=o.scaleY.factor;return n*=s,r*=u,{dx:a=s*(a-o.scaleX.coordinate)+o.scaleX.coordinate,dy:i=u*(i-o.scaleY.coordinate)+o.scaleY.coordinate,factorX:n,factorY:r}}},{key:"transformOp",value:function(e,t){var n,i,o=t.data,s=(null===(n=e.data.scaleX)||void 0===n?void 0:n.factor)||1,u=(null===(i=e.data.scaleY)||void 0===i?void 0:i.factor)||1,c=s,l=u,d=e.data.boundary.sx,p=e.data.boundary.sy,h=(0,f.getTransformedPoint)([d,p],e.data.dx,e.data.dy,e.data.scaleX,e.data.scaleY),y=(0,a.default)(h,2),m=y[0],b=y[1],w=void 0;if(!(w=Array.isArray(o.scaleList)?o.scaleList[o.scaleList.length-1]:o.scaleInfo))return e;var _=w.scaleX.factor,x=w.scaleY.factor;if(c*=_,l*=x,-1!==g.indexOf(e.data.type)){var k=Math.abs(c)/2+Math.abs(l)/2;_=(c*=k/Math.abs(c))/s,x=(l*=k/Math.abs(l))/u}else-1!==v.indexOf(e.data.type)&&(l=1,x=1);var M=(m=_*(m-w.scaleX.coordinate)+w.scaleX.coordinate)-c*d,S=(b=x*(b-w.scaleY.coordinate)+w.scaleY.coordinate)-l*p,T=(0,r.default)({},e.data,{scaleX:{factor:c,coordinate:0},scaleY:{factor:l,coordinate:0},dx:M,dy:S});return"text"!==e.data.type||(T.fontSize=Math.abs(e.data.fontSize*c/s)),(0,r.default)({},e,{data:T})}}]),t}(l.default);t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(5)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="delete",e.description="删除元素。",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"删除当前选中的元素"}},"delete:deleteOps":{value:this.deleteOps.bind(this),information:{args:"opIds: string[]",message:"删除ops"}}}}},{key:"handleKeyDown",value:function(e){var t=e.key.toLocaleLowerCase();if(-1!==["backspace","delete"].indexOf(t))return this.execCommand(),!0}},{key:"deleteOps",value:function(e){Array.isArray(e)&&e.length>0&&this.dispatch({type:this.type,dependOn:e.slice()})}},{key:"execCommand",value:function(){this.opsManager.selectedOpIds.length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type,dependOn:this.opsManager.selectedOpIds.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{hidden:!0});return(0,r.default)({},e,{data:n})}}]),t}(c(n(10)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(31)),a=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),c=d(n(10)),l=n(54);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="undo",e.description="撤销操作",e.idsCouldUndo=new r.default,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getCount",value:function(){return this.idsCouldUndo.size}},{key:"registerHooks",value:function(){this.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"z"===e.key.toLocaleLowerCase()&&(this.isKeyDown("control")||this.isKeyDown("command"))&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.idsCouldUndo.clear(),this.emit("event:appState:change","undoCount",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.idsCouldUndo.clear();else{if(e.data.skipUndo||e.data.inProgress||-1!==l.snapshotOutOfNormalFlowTypes.indexOf(e.data.type))return;"undo"===e.data.type?this.idsCouldUndo.delete(e.data.undoOpId):"undo"!==e.data.type&&this.idsCouldUndo.add(e.opId)}this.emit("event:appState:change","undoCount",this.idsCouldUndo.size)}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.idsCouldUndo.size&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",n=new r.default,a=e.length-1;a>=0;a--){var i=e[a],o=i.data.inProgress||i.data.skipUndo||-1!==l.snapshotOutOfNormalFlowTypes.indexOf(i.data.type);if("undo"!==i.data.type&&!o&&!n.has(i.opId)){t=i.opId;break}"undo"===i.data.type&&n.add(i.data.undoOpId)}return{type:this.type,undoOpId:t}}}]),t}(c.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(31)),a=d(n(2)),i=d(n(0)),o=d(n(1)),s=d(n(3)),u=d(n(4)),c=d(n(10)),l=n(54);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="redo",e.description="重做操作",e.idsCouldRedo=new r.default,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"getCount",value:function(){return this.idsCouldRedo.size}},{key:"registerHooks",value:function(){this.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"y"===e.key.toLocaleLowerCase()&&(this.isKeyDown("control")||this.isKeyDown("command"))&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.idsCouldRedo.clear(),this.emit("event:appState:change","redoCount",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.idsCouldRedo.clear();else{if(e.data.inProgress||e.data.skipUndo||-1!==l.snapshotOutOfNormalFlowTypes.indexOf(e.data.type))return;"redo"===e.data.type?this.idsCouldRedo.delete(e.data.redoOpId):"undo"===e.data.type?this.idsCouldRedo.add(e.opId):this.idsCouldRedo.clear()}this.emit("event:appState:change","redoCount",this.idsCouldRedo.size)}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.idsCouldRedo.size&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",n=0,r=e.length-1;r>=0;r--){var a=e[r];if("undo"===a.data.type&&0===n){t=a.opId;break}"undo"===a.data.type?n--:"redo"===a.data.type?n++:a.data.skipUndo||-1!==l.snapshotOutOfNormalFlowTypes.indexOf(a.data.type)||this.logger.warn("DEV--\x3e","redo操作之前有非undo操作。请查看具体细节",e)}return{type:this.type,redoOpId:t}}}]),t}(c.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(14)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="clear",e.description="清空操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"isAvailable",value:function(){return(0,r.default)(this.drawOpsOfPage).length>0}},{key:"registerHooks",value:function(){this.opsManager.hooks.refresh.tap("RefreshPlugin",this.onRefresh.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){(0,r.default)(this.drawOpsOfPage).length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"onRefresh",value:function(){var e=(0,r.default)(this.drawOpsOfPage).length>0;this.emit("event:appState:change","clearAvailable",e)}}]),t}(c(n(10)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="eraser",e.eraserColor="rgba(230, 100, 100, .4)",e.width=20,e.points=[],e.description="橡皮擦。\n首先使用op:eraser:activate设置画布为橡皮擦模式。具体用法如下：",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"eraser:width":{value:this.setWidth.bind(this),information:{args:"width: number",message:"设置橡皮擦宽度"}},"eraser:color":{value:this.setColor.bind(this),information:{args:"color: Color",message:"设置橡皮擦聚光灯颜色"}}}}},{key:"handleMouseMove",value:function(e,t,n){this.isMouseDown&&(this.points.push([t,n]),this.dispatch(this.getSnapshot()))}},{key:"handleMouseDown",value:function(e,t,n){this.beginBatch(),this.points=[],this.points.push([t,n])}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&(this.dispatch(this.getSnapshot()),this.points=[])}},{key:"getSnapshot",value:function(){return{type:this.type,points:this.points.slice(),width:this.width}}},{key:"draw",value:function(e,t){t.save(),t.fillStyle="rgb(0, 0, 0)";var n=e.data.points;t.beginPath(),t.globalCompositeOperation="destination-out";for(var r=1;r<n.length;r++)t.moveTo(n[r][0],n[r][1]),t.arc(n[r][0],n[r][1],this.width,0,2*Math.PI,!0);t.fill(),t.restore(),this.drawEraserSignpost(t)}},{key:"drawEraserSignpost",value:function(e){this.opsManager.currOp instanceof t&&this.isMouseDown&&(e.beginPath(),e.arc(this.points[this.points.length-1][0],this.points[this.points.length-1][1],this.width,0,2*Math.PI,!0),e.fillStyle=this.eraserColor,e.fill())}},{key:"setWidth",value:function(e){this.width=e}},{key:"setColor",value:function(e){this.eraserColor=e}}]),t}(u(n(10)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=_(n(5)),a=_(n(2)),i=_(n(0)),o=_(n(1)),s=_(n(3)),u=_(n(4)),c=_(n(10)),l=n(18),d=_(n(101)),f=n(282),p=_(n(283)),h=n(102),g=_(n(129)),v=n(204),y=n(36),m=n(130),b=n(29),w=_(n(32));function _(e){return e&&e.__esModule?e:{default:e}}var x=function(e){function t(e){(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));n.type="text",n.dependOn=void 0,n.blurAt=0,n.color="black",n.text="",n.textBeforeEdit="",n.fontSize=h.DEFAULT_FONTSIZE,n.isFocus=!1,n.isNewText=!0,n.description="绘制文字\n首先使用op:text:activate设置画布为文字模式。通过op:text:color, op:text:fontSize, 设置文字的颜色和字体大小。然后画布会监听鼠标动作，生成文本框。具体用法如下：",n.handleTextAreaChange=function(e){var t=e.target.value;t.endsWith("\n")&&(t+="\n"),n.text=t,n.pre.innerText=t||" ",(0,f.setElementsSize)(n.textAreaContainer,n.textArea,n.pre,n.fontSize),n.dispatch(n.getSnapshot(!0))},n.handleTextAreaBlur=function(e){setTimeout((function(){n.opsManager.currPage===n.textFocusAtPage&&n._handleTextAreaBlur()}),0)},n._handleTextAreaBlur=function(){var e=n.opIdToDraw;n.dispatch(n.getSnapshot(!1,n.text===n.textBeforeEdit)),n.isFocus=!1,n.text=" ",(0,f.clearTextArea)(n.textAreaContainer,n.textArea),n.blurAt=Date.now(),n.opsManager.setCurrOp("select"),n.opsManager.selectOp.dispatch(n.opsManager.selectOp.getSnapshot([e]))},n.registerToolbar(new p.default);var r=(0,f.createElements)(),o=r.textAreaContainer,u=r.textArea,c=r.pre;return n.textAreaContainer=o,n.textArea=u,n.pre=c,n.app.on("container:set",(function(){n.app.container.textAreaEl.appendChild(o),n.app.container.textAreaEl.appendChild(c)})),n.app.on("camera:transform",(function(){var e;null===(e=n.toolbar)||void 0===e||e.resize(1/n.app.camera.scale)})),n.textArea.oninput=n.handleTextAreaChange,n.textArea.onblur=n.handleTextAreaBlur,(0,f.setElementsSize)(n.textAreaContainer,n.textArea,n.pre,n.fontSize),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.app.on("event:prePageChange",this.handlePrePageChange.bind(this)),this.opsManager.hooks.click.tap("ClickPlugin",this.handleClickExistText.bind(this)),this.opsManager.hooks.selectChange.tap("SelectChangePlugin",this.handleSelectChange.bind(this)),this.opsManager.hooks.enableDrawChange.tap("EnableDrawChange",this.handleEnableDrawChange.bind(this))}},{key:"getIdPrefix",value:function(e,t){return(e+"-"+t).replace(/[\W_]+/g,"-")}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"register:toolbar":{value:this.registerToolbar.bind(this),information:{args:"toolbar: IToolbar",message:"自定义工具栏"}},"text:color":{value:this.setColor.bind(this),information:{args:"color: string",message:"设置文本颜色"}},"text:fontsize":{value:this.setFontSize.bind(this),information:{args:"size: number",message:"设置矩形边框颜色"}}}}},{key:"handlePrePageChange",value:function(){this.isFocus&&this._handleTextAreaBlur()}},{key:"handleEnableDrawChange",value:function(e){var t,n;if(e){var r=this.opsManager.selectedOpIds,a=1===r.length&&"text"===this.getOpTypeByOpId(r[0])?r[0]:void 0;if(a&&this.opsManager.currOp instanceof d.default)return this._handleSelectTextOp(a);null===(n=this.toolbar)||void 0===n||n.hide()}else null===(t=this.toolbar)||void 0===t||t.hide()}},{key:"handleSelectChange",value:function(e,t){var n,r=1===e.length&&"text"===this.getOpTypeByOpId(e[0])?e[0]:void 0,a=1===t.length&&"text"===this.getOpTypeByOpId(t[0])?t[0]:void 0;if(r!==a&&a&&this.opsManager.currOp instanceof d.default)return this._handleSelectTextOp(a);null===(n=this.toolbar)||void 0===n||n.hide()}},{key:"_handleSelectTextOp",value:function(e){var t,n=this.drawOpsOfPage[e].data,r=(0,l.getTransformedBoundary)(this.app.camera.scale,n.boundary,n.dx,n.dy,n.scaleX,n.scaleY);return this.color=n.color,this.fontSize=n.fontSize,this.text=n.text,this.isFocus=!1,(0,f.clearTextArea)(this.textAreaContainer,this.textArea),this.isNewText=!1,this.lastSnapshotData=n,this.dependOn=e,null===(t=this.toolbar)||void 0===t?void 0:t.show({left:r.sx,top:r.sy,container:this.app.container.textAreaEl,fontSize:n.fontSize,scale:1/this.app.camera.scale,color:n.color})}},{key:"handleClickExistText",value:function(e,t,n){var a,i;if((0,m.isIosDevice)())return!1;if(this.opsManager.currOp instanceof d.default){var o=this.detectIfClickOnText(t,n);if(o){this.opsManager.selectedOpIds.length>0&&this.opsManager.currOp.dispatch(this.opsManager.currOp.getSnapshot([])),this.opsManager.setCurrOp("text");var s=document.getElementById(this.getIdPrefix(o.board,o.page.toString())+"-"+o.opId+"-pre");null===(a=null==s?void 0:s.parentNode)||void 0===a||a.removeChild(s);var u=o.data;this.isFocus=!0,this.textFocusAtPage=this.opsManager.currPage,this.isNewText=!1,this.lastSnapshotData=u,this.dependOn=o.opId,this.text=u.text||" ",this.textBeforeEdit=this.text,this.textArea.value=this.text,this.pre.innerText=this.text,this.fontSize=u.fontSize,this.color=u.color;var c=(0,l.getTransformedBoundary)(this.app.camera.scale,u.boundary,u.dx,u.dy,u.scaleX,u.scaleY);return(0,f.setElementsStyle)(this.textAreaContainer,this.textArea,this.pre,(0,r.default)({fontSize:u.fontSize,color:u.color},c)),null===(i=this.toolbar)||void 0===i||i.show({left:c.sx,top:c.sy,container:this.app.container.textAreaEl,fontSize:u.fontSize,scale:1/this.app.camera.scale,color:u.color}),this.textArea.focus(),this.beginBatch(),!0}}}},{key:"handleMouseUp",value:function(e,t,n){this.isMouseDown&&this.handleClick(e,t,n)}},{key:"handleMouseMove",value:function(e){this.isFocus?document.body.style.cursor="auto":this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="text":document.body.style.cursor="auto"}},{key:"handleClick",value:function(e,t,n){var r;if((0,m.isIosDevice)())return(0,b.showToast)({msg:"iOS设备暂不支持添加文本",time:3,type:"warn",msgType:w.default.IOS_NOT_SUPPORT_TEXT});this.isFocus||(this.isNewText=!0,this.isFocus=!0,this.textFocusAtPage=this.opsManager.currPage,this.dependOn=void 0,this.text=" ",this.textBeforeEdit=this.text,this.pre.innerText=this.text,(0,f.setElementsStyle)(this.textAreaContainer,this.textArea,this.pre,{fontSize:this.fontSize,color:this.color,sx:t,sy:n}),this.beginBatch(),null===(r=this.toolbar)||void 0===r||r.show({left:t,top:n,container:this.app.container.textAreaEl,fontSize:this.fontSize,scale:1/this.app.camera.scale,color:this.color}),this.textArea.focus())}},{key:"getSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.isNewText?{boundary:this.getBoundaryRect(this.isNewText),type:this.type,color:this.color,text:this.text,fontSize:this.fontSize,inProgress:e,skipUndo:e||t}:{type:this.type,color:this.color,text:this.text,fontSize:this.fontSize,boundary:this.getBoundaryRect(this.isNewText),dependOn:this.dependOn,inProgress:e,skipUndo:e||t}}},{key:"getBoundaryRect",value:function(e){var t=this.workingPre.getBoundingClientRect(),n=t.width,r=t.height;n/=this.app.camera.scale,r/=this.app.camera.scale;var a=void 0;if(e){var i=t.x-this.app.container.left,o=t.y-this.app.container.top;a=this.app.camera.convertToPointInWorld(i,o)}else{var s=this.lastSnapshotData,u=(0,l.getTransformedBoundary)(this.app.camera.scale,s.boundary,s.dx,s.dy,s.scaleX,s.scaleY);a=[u.sx,u.sy]}return{sx:a[0],sy:a[1],w:n,h:r}}},{key:"draw",value:function(e,t,n){if((0,m.isIosDevice)())return this.preview(e,t);var r=n.div,a=e.opId===this.dependOn||e.opId===this.opIdToDraw;if(!this.isFocus||!a){var i=this.app.room.currIndex,o=this.app.room.currBoard.currIndex,s=this.getIdPrefix(i,o.toString())+"-"+e.opId+"-pre";if(!r.querySelector("[id='"+s+"']")){var u=document.createElement("pre");u.style.lineHeight=""+f.DEFAULT_LINEHEIGHT,u.id=s,r.appendChild(u)}var c=r.querySelector("[id='"+s+"']");c?this.drawSnapshot(e.data,c,e.opId):this.logger.warn("[白板] textOp.draw","找不到id为: "+s+" 的pre")}}},{key:"preview",value:function(e,t){var n=e.data,r=(0,l.getTransformedBoundary)(this.app.camera.scale,n.boundary,n.dx,n.dy,n.scaleX,n.scaleY),a=r.sx,i=r.sy,o=f.PADDING*n.fontSize/h.DEFAULT_FONTSIZE;t.save(),t.fillStyle=n.color,t.font=n.fontSize+"px "+g.default.getFontFamily(),t.textAlign="left",t.textBaseline="top",(0,v.printTextInMultiLine)(t,n.text,a+o,i+2*o,n.fontSize*f.DEFAULT_LINEHEIGHT),t.restore()}},{key:"hide",value:function(e,t,n){var r,a=document.getElementById(this.getIdPrefix(e.board,e.page.toString())+"-"+e.opId+"-pre");null===(r=null==a?void 0:a.parentNode)||void 0===r||r.removeChild(a)}},{key:"drawSnapshot",value:function(e,t,n){var r,a,i,o=(0,l.getTransformedBoundary)(this.app.camera.scale,e.boundary,e.dx,e.dy,e.scaleX,e.scaleY),s=o.sx,u=o.sy;(0,f.drawTextSnapshot)(t,{text:e.text,sx:s,sy:u,fontSize:e.fontSize,color:e.color,pxOverBorder:(0,y.getElementPartOutOfContainer)(o,this.app.camera)}),1===this.opsManager.selectedOpIds.length&&this.opsManager.selectedOpIds[0]===n&&(this.fontSize=e.fontSize,this.color=e.color,null===(r=this.toolbar)||void 0===r||r.setFontsize(e.fontSize),null===(a=this.toolbar)||void 0===a||a.setColor(e.color),null===(i=this.toolbar)||void 0===i||i.updatePosition({left:s,top:u}))}},{key:"detectIfClickOnText",value:function(e,t){for(var n in this.drawOpsOfPage)if("text"===this.drawOpsOfPage[n].data.type){var r=this.drawOpsOfPage[n].data,a=(0,l.getTransformedBoundary)(this.app.camera.scale,r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);if((0,l.pointInRect)(a,[e,t]))return this.drawOpsOfPage[n]}}},{key:"setFontSize",value:function(e){this.fontSize!==e&&(this.fontSize=e,this.isNewText=!1,this.lastSnapshotData=this.drawOpsOfPage[this.dependOn].data,this.text=this.lastSnapshotData.text,(0,f.setElementsSize)(this.textAreaContainer,this.textArea,this.workingPre,this.fontSize),this.dispatch(this.getSnapshot(!1)))}},{key:"setColor",value:function(e){this.color!==e&&(this.color=e,this.isNewText=!1,this.lastSnapshotData=this.drawOpsOfPage[this.dependOn].data,this.text=this.lastSnapshotData.text,this.dispatch(this.getSnapshot(!1)))}},{key:"registerToolbar",value:function(e){this.toolbar=e,this.toolbar.onFontSizeChange(this.setFontSize.bind(this)),this.toolbar.onColorChange(this.setColor.bind(this))}},{key:"transformOp",value:function(e,t){return(0,y.transformPropertyOverwriteOp)(e,t)}},{key:"updateFontFamily",value:function(){for(var e=this.app.container.el.getElementsByTagName("textarea"),t=this.app.container.el.getElementsByTagName("pre"),n=0;n<e.length;n++)e[n].style.fontFamily=g.default.getFontFamily();for(var r=0;r<t.length;r++)t[r].style.fontFamily=g.default.getFontFamily()}},{key:"opIdToDraw",get:function(){return this.isNewText?this.opIdForseen(this.type,this.dependOn):this.dependOn}},{key:"workingPre",get:function(){if(this.isFocus)return this.pre;var e=this.app.room.currIndex,t=this.app.room.currBoard.currIndex.toString();return document.getElementById(this.getIdPrefix(e,t)+"-"+this.dependOn+"-pre")}}]),t}(c.default);t.default=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_LINEHEIGHT=t.PADDING=t.MIN_WIDTH=void 0,t.createElements=function(){var e=document.createElement("textarea"),t=document.createElement("pre"),n=document.createElement("div");return n.style.position="absolute",n.style.display="none",n.style.outline="1px dashed black",e.style.resize="none",e.style.overflow="hidden",e.style["white-space"]="nowrap",e.style.background="transparent",e.style.fontFamily=o.default.getFontFamily(),e.style.fontSize=a.DEFAULT_FONTSIZE+"px",e.style.transformOrigin="left top",e.style.padding=u+"px",e.style.border="none",e.style.outline="none",e.style.boxSizing="content-box",e.style.lineHeight=""+c,t.style.width="fit-content",t.style.position="absolute",t.style.userSelect="none",t.style.pointerEvents="none",t.style.visibility="hidden",t.style.fontFamily=o.default.getFontFamily(),t.style.fontSize=a.DEFAULT_FONTSIZE+"px",t.style.transformOrigin="left top",t.style.padding=u+"px",t.style.margin="0",t.style.lineHeight=""+c,t.style.boxSizing="border-box",n.appendChild(e),{textAreaContainer:n,textArea:e,pre:t}},t.setElementsStyle=function(e,t,n,r){e.style.display="block",e.style.left=r.sx+"px",e.style.top=r.sy+"px",n.style.left=r.sx+"px",n.style.top=r.sy+"px",t.style.color=r.color,t.style.width=(r.w||s)*a.DEFAULT_FONTSIZE/r.fontSize-2*u+"px",t.style.height=(r.h||r.fontSize+12)*a.DEFAULT_FONTSIZE/r.fontSize-2*u+"px",l(e,t,n,r.fontSize)},t.setElementsSize=l,t.drawTextSnapshot=function(e,t){var n=t.fontSize/a.DEFAULT_FONTSIZE;e.innerText=t.text,e.style.color=t.color,e.style.left=t.sx+"px",e.style.top=t.sy+"px",e.style.position="absolute",e.style.fontFamily=o.default.getFontFamily(),e.style.fontSize=a.DEFAULT_FONTSIZE+"px",e.style.margin="0",e.style.transform="scale("+n+")",e.style.userSelect="none",e.style.transformOrigin="left top",e.style.padding=u+"px",e.style.pointerEvents="none",t.pxOverBorder?e.style.clipPath="inset("+t.pxOverBorder.top/n+"px "+t.pxOverBorder.right/n+"px "+t.pxOverBorder.bottom/n+"px "+t.pxOverBorder.left/n+"px)":e.style.clipPath="none"},t.clearTextArea=function(e,t){t.value="",e.style.display="none"};var r,a=n(102),i=n(129),o=(r=i)&&r.__esModule?r:{default:r};var s=t.MIN_WIDTH=20,u=t.PADDING=4,c=t.DEFAULT_LINEHEIGHT=1.2;function l(e,t,n,r){n.style.transform="scale("+r/a.DEFAULT_FONTSIZE+")",t.style.transform="scale("+r/a.DEFAULT_FONTSIZE+")",t.style.width=n.clientWidth-2*u+"px",t.style.height=n.clientHeight-2*u+"px",e.style.width=n.clientWidth*r/a.DEFAULT_FONTSIZE+"px",e.style.height=n.clientHeight*r/a.DEFAULT_FONTSIZE+"px"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(0)),a=s(n(1)),i=n(102),o=n(204);function s(e){return e&&e.__esModule?e:{default:e}}n(284);var u="iower-23nsdf090sd",c=function(){function e(){(0,r.default)(this,e),this.fontSize=i.DEFAULT_FONTSIZE,this.color="black",this.fonts=[8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88],this.colors=["rgb(224,32,32)","rgb(250,100,0)","rgb(247,181,0)","rgb(109,212,0)","rgb(68,215,182)","rgb(50,197,255)","rgb(0,145,255)","rgb(98,54,255)","rgb(182,32,224)","rgb(109,114,120)","rgb(0,0,0)","rgb(255,255,255)"],this.fontInputPrevValue="",this.colorCells=[],this.colorPlatteOpen=!1,this.toolbarContainer=document.createElement("div"),this.toolbarContainer.style.pointerEvents="auto",this.toolbarContainer.className="text-toolbar",this.toolbarContainer.id=u,this.colorBtn=document.createElement("div"),this.colorBtn.innerText="",this.colorBtn.className="color flex-cell";var t=document.createElement("span");this.colorBtn.appendChild(t),this.colorPlatteContainer=document.createElement("div"),this.colorPlatteContainer.className="platte-container",this.colorPlatteContainer.onmousemove=function(e){e.stopPropagation()};for(var n=0;n<this.colors.length;n++){var a=document.createElement("div");a.className="color-cell",a.style.backgroundColor=this.colors[n],"rgb(255,255,255)"===this.colors[n]&&(a.style.border="1px solid #D9D9DB"),this.colorPlatteContainer.appendChild(a),this.colorCells.push(a)}this.fontInput=document.createElement("input"),this.fontInput.className="fontsize input",this.fontIncBtn=document.createElement("div"),this.fontIncBtn.className="fontsize inc flex-cell";var o=document.createElement("span");o.innerText="+",this.fontIncBtn.appendChild(o),this.fontDecBtn=document.createElement("div"),this.fontDecBtn.className="fontsize dec flex-cell";var s=document.createElement("span");s.innerText="-",this.fontDecBtn.appendChild(s),this.toolbarContainer.appendChild(this.fontInput),this.toolbarContainer.appendChild(this.fontIncBtn),this.toolbarContainer.appendChild(this.fontDecBtn),this.toolbarContainer.appendChild(this.colorBtn),this.toolbarContainer.appendChild(this.colorPlatteContainer),this._registerEvents(),this._stopPropagation()}return(0,a.default)(e,[{key:"show",value:function(e){var t=e.left,n=e.top,r=e.container,a=e.fontSize,i=e.color,o=e.scale;this.setFontsize(a),this.setColor(i),document.getElementById(u)||r.appendChild(this.toolbarContainer),this.toolbarContainer.style.display="flex",this.toolbarContainer.style.transformOrigin="left bottom",this.toolbarContainer.style.transform="scale("+o+")",this.colorPlatteContainer.style.display="none",this.updatePosition({left:t,top:n})}},{key:"resize",value:function(e){this.toolbarContainer.style.transform="scale("+e+")"}},{key:"updatePosition",value:function(e){var t=e.left,n=e.top;this.toolbarContainer.style.left=t-23+"px",this.toolbarContainer.style.top=n-78+"px"}},{key:"hide",value:function(){this.toolbarContainer.style.display="none"}},{key:"setFontsize",value:function(e){this.fontSize=e,this.fontInputPrevValue=Math.round(e).toString(),this.fontInput.value=this.fontInputPrevValue}},{key:"setColor",value:function(e){this.color=e,this.colorBtn.firstChild.style.backgroundColor=this.color,this.setColorPlatteState(!1)}},{key:"setColorPlatteState",value:function(e){this.colorPlatteOpen=e,this.colorPlatteContainer.style.display=e?"flex":"none"}},{key:"onFontSizeChange",value:function(e){this.fontSizeCb=e}},{key:"onColorChange",value:function(e){this.colorCb=e}},{key:"_registerEvents",value:function(){for(var e=this,t=function(t){e.colorCells[t].onclick=function(n){e.setColor(e.colors[t]),e.colorCb&&e.colorCb(e.color)}},n=0;n<this.colorCells.length;n++)t(n);this.colorBtn.onclick=function(t){e.setColorPlatteState(!e.colorPlatteOpen)},this.fontIncBtn.onclick=function(t){e.fontSize<o.MAX_FONT_SIZE&&e._sendFontChangeCommand(Math.min(e.fontSize+8,o.MAX_FONT_SIZE))},this.fontDecBtn.onclick=function(t){e.fontSize>o.MIN_FONT_SIZE&&e._sendFontChangeCommand(Math.max(e.fontSize-8,o.MIN_FONT_SIZE))};var r=function(t){var n=e.fontInput.value;if(""!==n){var r=(0,o.testFontSizeText)(n),a=void 0;a="exceed_max"===r?o.MAX_FONT_SIZE:"exceed_min"===r?o.MIN_FONT_SIZE:Number(n),e.fontInput.value=a,e.fontInputPrevValue=a.toString(),e._sendFontChangeCommand(e.fontInput.value),t&&e.fontInput.blur()}};this.fontInput.onkeydown=function(e){e.stopPropagation(),"Enter"===e.key&&r(!0)},this.fontInput.onblur=function(){r(!1)},this.fontInput.oninput=function(t){var n=t.target.value;n=n.replace(/\D/g,""),e.fontInput.value=n}}},{key:"_sendFontChangeCommand",value:function(e){var t="string"==typeof e?Number(e):e;this.setFontsize(t),this.fontSizeCb&&this.fontSizeCb(this.fontSize)}},{key:"_stopPropagation",value:function(){this.toolbarContainer.onmousedown=function(e){e.stopPropagation()},this.toolbarContainer.ontouchstart=function(e){e.stopPropagation()}}}]),e}();t.default=c},function(e,t,n){var r=n(285);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(25)(r,a);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(24)(!1)).push([e.i,".text-toolbar {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-around;\n\n    position: absolute;\n\n    box-sizing: border-box;\n    height: 48px;\n    margin: 12px 12px 24px;\n\n    -webkit-user-select: none;\n\n       -moz-user-select: none;\n\n        -ms-user-select: none;\n\n            user-select: none;\n    background-color: white;\n    border-radius: 4px;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n    z-index: 7;\n}\n\n    .text-toolbar .flex-cell {\n        display: flex;\n        flex: 1;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        border: none;\n        width: 40px;\n        height: 40px;\n    }\n\n    .text-toolbar .color {\n        border-radius: 12px;\n    }\n\n    .text-toolbar .color span {\n            width: 18px;\n            height: 18px;\n            border-radius: 9px;\n        }\n\n    .text-toolbar .fontsize.input {\n        height: 24px;\n        vertical-align: top;\n        box-sizing: border-box;\n        width: 40px;\n        outline: none;\n        border: 1px solid rgba(0, 0, 0, 0.3);\n        margin: 0 6px 0 8px;\n        text-align: center;\n    }\n\n    .text-toolbar .fontsize.inc, .text-toolbar .fontsize.dec {\n        border-radius: 12px;\n        font-size: 32px;\n        line-height: 24px;\n        text-align: center;\n        vertical-align: top;\n        position: relative;\n        top: -3px;\n    }\n\n    .text-toolbar .platte-container {\n        position: absolute;\n        display: none;\n        flex-direction: row;\n        flex-wrap: wrap;\n\n        align-items: center;\n        justify-content: space-around;\n        box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n        bottom: 56px;\n        right: 0;\n        background-color: white;\n        width: 100%;\n    }\n\n    .text-toolbar .platte-container .color-cell {\n            width: 20px;\n            height: 20px;\n            border-radius: 10px;\n            margin: 10px;\n            display: inline-block;\n            box-sizing: border-box\n        }\n\n    .text-toolbar .platte-container .color-cell:hover {\n                cursor: pointer;\n            }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(14)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="page",e.description="页面相关操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pageChange.tap("pageChangePlugin",this.onPageChange.bind(this))}},{key:"onPageChange",value:function(){return this.emit("event:appState:change","page",{activeIndex:this.opsManager.currBoard.getCurrPageIndex(),pageNames:this.opsManager.currBoard.pageNames.slice(),currPage:this.opsManager.currBoard.currIndex,pagePayloads:this.opsManager.currBoard.payloadOfPages})}},{key:"eventsToListen",value:function(){return{"page:goto":{value:this.goto.bind(this),information:{args:"page: number",message:"跳转至页面"}},"page:add":{value:this.add.bind(this),information:{args:"opt: {insertAfter?: number, payload?: any}",message:"添加页面。默认添加至当前board最后"}},"page:delete":{value:this.delete.bind(this),information:{args:"page: number",message:"删除页面。只有当页面数量大于1时可以删除页面"}}}}},{key:"add",value:function(e){this.dispatch({type:this.type,action:"add",insertAfter:e.insertAfter,payload:e.payload})}},{key:"goto",value:function(e){e!==this.opsManager.currBoard.currIndex&&-1!==this.opsManager.currBoard.pageNames.indexOf(e.toString())&&this.dispatch({type:this.type,action:"goto",page:e})}},{key:"delete",value:function(e){var t=this.opsManager.currBoard.pages;e in t&&(0,r.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",page:e})}}]),t}(c(n(10)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(10)),c=n(131),l=n(18);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="image",e.description="图片操作",e.dispatchImage=function(t,n,r,a){var i=(0,c.getImageProperPosition)(e,n,r),o=i.sx,s=i.sy,u=i.width,l=i.height;a?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}},a):e.dispatch({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}})},e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"image:upload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        width?: number,\n                        height?: number,\n                        pageName?: string,\n                        boardName?: string\n                    }",message:"上传图片"}}}}},{key:"addImage",value:function(e,t){return(0,c.addImage)(this,e,t)}},{key:"preview",value:function(e,t,n){var r=e.data,a=(0,l.getTransformedBoundary)(this.app.camera.scale,r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);return(0,c.draw)(t,r.url,a,{page:n.page,supportToDataUrl:n.supportToDataUrl,preview:!0})}},{key:"draw",value:function(e,t,n){var r=e.data,a=(0,l.getTransformedBoundary)(this.app.camera.scale,r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);return(0,c.draw)(t,r.url,a,{page:n.page,div:n.div,id:e.opId,type:"image"})}},{key:"hide",value:function(e,t,n){var r,a=n.querySelector("[id='"+e.opId+"']");null===(r=null==a?void 0:a.parentNode)||void 0===r||r.removeChild(a)}}]),t}(u.default);t.default=f},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgwIiBoZWlnaHQ9IjM2MCIgdmlld0JveD0iMCAwIDQ4MCAzNjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0wIDBINDgwVjM2MEgwVjBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQ3OCAySDJWMzU4SDQ3OFYyWk0wIDBWMzYwSDQ4MFYwSDBaIiBmaWxsPSIjRDlEOURCIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTY2LjI5NCAxMjZIMzE1TDMxNSAxODkuMzg2TDI5NS4wNDkgMTY3LjY0QzI5MS4xNDQgMTYzLjM4NCAyODQuNDU2IDE2My4zMTEgMjgwLjQ2IDE2Ny40ODNMMjM4Ljc5MiAyMTAuOTc3TDIxOS45MTcgMTkxLjU3MkMyMTYuNzg0IDE4OC4zNTEgMjExLjYxMyAxODguMzQxIDIwOC40NjggMTkxLjU1MUwxNjcuMzM4IDIzMy41MjlIMTY2LjI5NEwxNjYuMjk0IDEyNlpNMTY2LjI5NCAyNDEuNTI5QzE2NC40NzggMjQxLjUyOSAxNjIuODAzIDI0MC45MjQgMTYxLjQ2IDIzOS45MDRIMTYxLjA5MkwxNjEuMjUyIDIzOS43NDFDMTU5LjQ0NyAyMzguMjc0IDE1OC4yOTQgMjM2LjAzNiAxNTguMjk0IDIzMy41MjlWMTI2QzE1OC4yOTQgMTIxLjU4MiAxNjEuODc2IDExOCAxNjYuMjk0IDExOEgzMTVDMzE5LjQxOCAxMTggMzIzIDEyMS41ODIgMzIzIDEyNlYyMzMuNTI5QzMyMyAyMzcuOTQ4IDMxOS40MTggMjQxLjUyOSAzMTUgMjQxLjUyOUgxNjYuMjk0Wk0yMDEgMTcxLjgwNEMyMDkuMjg0IDE3MS44MDQgMjE2IDE2NS4wODggMjE2IDE1Ni44MDRDMjE2IDE0OC41MiAyMDkuMjg0IDE0MS44MDQgMjAxIDE0MS44MDRDMTkyLjcxNiAxNDEuODA0IDE4NiAxNDguNTIgMTg2IDE1Ni44MDRDMTg2IDE2NS4wODggMTkyLjcxNiAxNzEuODA0IDIwMSAxNzEuODA0WiIgZmlsbD0iI0U2RTdFQiIvPgo8L3N2Zz4K"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(14)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="board",e.description="board相关操作",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.boardChange.tap("boardChangePlugin",this.onBoardChange.bind(this))}},{key:"onBoardChange",value:function(){var e=this;setTimeout((function(){return e.emit("event:appState:change","board",{boardNames:(0,r.default)(e.app.room.boards),boardDisplayNames:e.app.room.getBoardDisplayNames(),currBoard:e.app.room.currIndex,currBoardDisplayName:e.app.room.currBoard.displayName})}),0)}},{key:"eventsToListen",value:function(){return{"board:goto":{value:this.goto.bind(this),information:{args:"boardName: string",message:"跳转至board。若board不存在，则创建board"}},"board:add":{value:this.add.bind(this),information:{args:"displayName: string, boardName: string, pageCount: number, opt?: {\n                        width: number,\n                        height: number,\n                        template: string,\n                        offset?: number\n                    }",message:"创建[pageCount]页数的board"}},"board:delete":{value:this.delete.bind(this),information:{args:"boardName: string",message:"删除board。只有当board数量大于1时可以删除board"}}}}},{key:"goto",value:function(e){e!==this.app.room.currIndex&&this.dispatch({type:this.type,action:"goto",boardName:e})}},{key:"add",value:function(e,t,n,r){r?this.dispatch({type:this.type,action:"add",boardName:t,displayName:e,pageCount:n,w:r.width,h:r.height,tmpl:r.template,offset:r.offset?r.offset:0}):this.dispatch({type:this.type,action:"add",boardName:t,displayName:e,pageCount:n})}},{key:"delete",value:function(e){var t=this.app.room.boards;e in t&&(0,r.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",boardName:e})}}]),t}(c(n(10)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COPY_PASTE_SHIFT=void 0;var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(10)),c=d(n(291)),l=n(36);function d(e){return e&&e.__esModule?e:{default:e}}var f=t.COPY_PASTE_SHIFT=50,p=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="duplicate",e.description="拷贝drawable快照",e.copiedSnapshotArray=[],e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"复制当前选中的元素"}}}}},{key:"handleKeyDown",value:function(e){var t=this,n=e.key.toLocaleLowerCase();if("c"===n&&(this.isKeyDown("control")||this.isKeyDown("command"))&&this.opsManager.selectedOpIds.length>0){e.preventDefault();var r=(0,l.filterNonMediaOpIds)(this,this.opsManager.selectedOpIds);return this.copiedSnapshotArray=(0,c.default)(r.map((function(e){return t.drawOpsOfPage[e]}))),!0}if("v"===n&&(this.isKeyDown("control")||this.isKeyDown("command"))&&this.copiedSnapshotArray.length>0)return e.preventDefault(),this.execCommand(this.copiedSnapshotArray.slice()),!0}},{key:"execCommand",value:function(e){var t=(0,l.filterNonMediaOpIds)(this,this.opsManager.selectedOpIds);if(t.length>0||e&&e.length>0){var n=this.getSnapshot(t,e);this.dispatch(n);var r=n.duplicates.map((function(e){return e.opId}));this.opsManager.selectOp.dispatch(this.opsManager.selectOp.getSnapshot(r))}}},{key:"getSnapshot",value:function(e,t){var n=this,r=!!t;if(!t){var a=e;t=[];for(var i=0;i<a.length;i++){var o=a[i];if(this.drawOpsOfPage.hasOwnProperty(o)){var s=this.drawOpsOfPage[o];t.push(s)}}}return t=t.map((function(e){return(e=(0,c.default)(e)).data.dx=(e.data.dx?e.data.dx:0)+f,e.data.dy=(e.data.dy?e.data.dy:0)+f,e.opId=n.opsManager.currPage.getNextOpId(!0),e})),r&&(this.copiedSnapshotArray=t.slice()),{type:this.type,duplicates:t}}}]),t}(u.default);t.default=p},function(e,t,n){(function(e,n){var r="[object Arguments]",a="[object Function]",i="[object GeneratorFunction]",o="[object Map]",s="[object Set]",u=/\w*$/,c=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,d={};d[r]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object DataView]"]=d["[object Boolean]"]=d["[object Date]"]=d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d[o]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d[s]=d["[object String]"]=d["[object Symbol]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Error]"]=d[a]=d["[object WeakMap]"]=!1;var f="object"==typeof e&&e&&e.Object===Object&&e,p="object"==typeof self&&self&&self.Object===Object&&self,h=f||p||Function("return this")(),g=t&&!t.nodeType&&t,v=g&&"object"==typeof n&&n&&!n.nodeType&&n,y=v&&v.exports===g;function m(e,t){return e.set(t[0],t[1]),e}function b(e,t){return e.add(t),e}function w(e,t,n,r){var a=-1,i=e?e.length:0;for(r&&i&&(n=e[++a]);++a<i;)n=t(n,e[a],a,e);return n}function _(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function x(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function k(e,t){return function(n){return e(t(n))}}function M(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var S,T=Array.prototype,I=Function.prototype,O=Object.prototype,P=h["__core-js_shared__"],E=(S=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+S:"",C=I.toString,N=O.hasOwnProperty,D=O.toString,A=RegExp("^"+C.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),L=y?h.Buffer:void 0,R=h.Symbol,j=h.Uint8Array,B=k(Object.getPrototypeOf,Object),z=Object.create,F=O.propertyIsEnumerable,U=T.splice,W=Object.getOwnPropertySymbols,Y=L?L.isBuffer:void 0,H=k(Object.keys,Object),q=ve(h,"DataView"),Q=ve(h,"Map"),G=ve(h,"Promise"),X=ve(h,"Set"),V=ve(h,"WeakMap"),Z=ve(Object,"create"),K=_e(q),J=_e(Q),$=_e(G),ee=_e(X),te=_e(V),ne=R?R.prototype:void 0,re=ne?ne.valueOf:void 0;function ae(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function oe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function se(e){this.__data__=new ie(e)}function ue(e,t){var n=ke(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Me(e)}(e)&&N.call(e,"callee")&&(!F.call(e,"callee")||D.call(e)==r)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],a=n.length,i=!!a;for(var o in e)!t&&!N.call(e,o)||i&&("length"==o||be(o,a))||n.push(o);return n}function ce(e,t,n){var r=e[t];N.call(e,t)&&xe(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function le(e,t){for(var n=e.length;n--;)if(xe(e[n][0],t))return n;return-1}function de(e,t,n,c,l,f,p){var h;if(c&&(h=f?c(e,l,f,p):c(e)),void 0!==h)return h;if(!Ie(e))return e;var g=ke(e);if(g){if(h=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&N.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(e,h)}else{var v=me(e),y=v==a||v==i;if(Se(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if("[object Object]"==v||v==r||y&&!f){if(_(e))return f?e:{};if(h=function(e){return"function"!=typeof e.constructor||we(e)?{}:(t=B(e),Ie(t)?z(t):{});var t}(y?{}:e),!t)return function(e,t){return he(e,ye(e),t)}(e,function(e,t){return e&&he(t,Oe(t),e)}(h,e))}else{if(!d[v])return f?e:{};h=function(e,t,n,r){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return pe(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return function(e,t){var n=t?pe(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var n=t?pe(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case o:return function(e,t,n){return w(t?n(x(e),!0):x(e),m,new e.constructor)}(e,r,n);case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,u.exec(e));return t.lastIndex=e.lastIndex,t}(e);case s:return function(e,t,n){return w(t?n(M(e),!0):M(e),b,new e.constructor)}(e,r,n);case"[object Symbol]":return i=e,re?Object(re.call(i)):{}}var i}(e,v,de,t)}}p||(p=new se);var k=p.get(e);if(k)return k;if(p.set(e,h),!g)var S=n?function(e){return function(e,t,n){var r=t(e);return ke(e)?r:function(e,t){for(var n=-1,r=t.length,a=e.length;++n<r;)e[a+n]=t[n];return e}(r,n(e))}(e,Oe,ye)}(e):Oe(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(S||e,(function(r,a){S&&(r=e[a=r]),ce(h,a,de(r,t,n,c,a,e,p))})),h}function fe(e){return!(!Ie(e)||(t=e,E&&E in t))&&(Te(e)||_(e)?A:c).test(_e(e));var t}function pe(e){var t=new e.constructor(e.byteLength);return new j(t).set(new j(e)),t}function he(e,t,n,r){n||(n={});for(var a=-1,i=t.length;++a<i;){var o=t[a],s=r?r(n[o],e[o],o,n,e):void 0;ce(n,o,void 0===s?e[o]:s)}return n}function ge(e,t){var n,r,a=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?a["string"==typeof t?"string":"hash"]:a.map}function ve(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return fe(n)?n:void 0}ae.prototype.clear=function(){this.__data__=Z?Z(null):{}},ae.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ae.prototype.get=function(e){var t=this.__data__;if(Z){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return N.call(t,e)?t[e]:void 0},ae.prototype.has=function(e){var t=this.__data__;return Z?void 0!==t[e]:N.call(t,e)},ae.prototype.set=function(e,t){return this.__data__[e]=Z&&void 0===t?"__lodash_hash_undefined__":t,this},ie.prototype.clear=function(){this.__data__=[]},ie.prototype.delete=function(e){var t=this.__data__,n=le(t,e);return!(n<0)&&(n==t.length-1?t.pop():U.call(t,n,1),!0)},ie.prototype.get=function(e){var t=this.__data__,n=le(t,e);return n<0?void 0:t[n][1]},ie.prototype.has=function(e){return le(this.__data__,e)>-1},ie.prototype.set=function(e,t){var n=this.__data__,r=le(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},oe.prototype.clear=function(){this.__data__={hash:new ae,map:new(Q||ie),string:new ae}},oe.prototype.delete=function(e){return ge(this,e).delete(e)},oe.prototype.get=function(e){return ge(this,e).get(e)},oe.prototype.has=function(e){return ge(this,e).has(e)},oe.prototype.set=function(e,t){return ge(this,e).set(e,t),this},se.prototype.clear=function(){this.__data__=new ie},se.prototype.delete=function(e){return this.__data__.delete(e)},se.prototype.get=function(e){return this.__data__.get(e)},se.prototype.has=function(e){return this.__data__.has(e)},se.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ie){var r=n.__data__;if(!Q||r.length<199)return r.push([e,t]),this;n=this.__data__=new oe(r)}return n.set(e,t),this};var ye=W?k(W,Object):function(){return[]},me=function(e){return D.call(e)};function be(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||l.test(e))&&e>-1&&e%1==0&&e<t}function we(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||O)}function _e(e){if(null!=e){try{return C.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function xe(e,t){return e===t||e!=e&&t!=t}(q&&"[object DataView]"!=me(new q(new ArrayBuffer(1)))||Q&&me(new Q)!=o||G&&"[object Promise]"!=me(G.resolve())||X&&me(new X)!=s||V&&"[object WeakMap]"!=me(new V))&&(me=function(e){var t=D.call(e),n="[object Object]"==t?e.constructor:void 0,r=n?_e(n):void 0;if(r)switch(r){case K:return"[object DataView]";case J:return o;case $:return"[object Promise]";case ee:return s;case te:return"[object WeakMap]"}return t});var ke=Array.isArray;function Me(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!Te(e)}var Se=Y||function(){return!1};function Te(e){var t=Ie(e)?D.call(e):"";return t==a||t==i}function Ie(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Oe(e){return Me(e)?ue(e):function(e){if(!we(e))return H(e);var t=[];for(var n in Object(e))N.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}n.exports=function(e){return de(e,!0,!0)}}).call(this,n(73),n(119)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(41)),a=p(n(5)),i=p(n(2)),o=p(n(0)),s=p(n(1)),u=p(n(3)),c=p(n(4)),l=n(18),d=p(n(198)),f=p(n(48));function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="pen-arrow",e.description="带箭头的涂鸦操作工具。\n首先使用op:pen-arrow:activate设置画布为涂鸦模式。通过op:pen-arrow:lineWidth, op:pen-arrow:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getArrowPoints",value:function(e,t,n){var r=[];if(e.length<3||!e[0]||!e[1]||!e[2])return r;if(e.length>1&&n){var a=e.length>2?[e[e.length-3],e[e.length-1]]:e.slice(e.length-2),i=(0,l.getLineCoef)(a);if((0,l.dist)(a[0],a[1])>1){var o=a[1][0]-a[0][0]>0?(0,l.getXFromCoefAndOffset)(a[1],i,1):2*a[1][0]-(0,l.getXFromCoefAndOffset)(a[1],i,1),s=a[1][0]-a[0][0]==0?a[1][1]+(a[1][1]-a[0][1]>0?1:-1):(0,l.getLineFromPointsY)(a,o);a.push([o,s])}r=(0,l.getArrowPoints)(t+1,a)}return r}},{key:"getSnapshot",value:function(e){var t=this.points,n=!e&&t.length>2,r=this.getArrowPoints(t,this.lineWidth,n),i=this.opsManager.currPage.getOpId(),o=this.app.room.opIdSnapshotMap[i];if(!o||!o.snapshot.hasOwnProperty("category"))return(0,a.default)({points:t.slice(),arrowPoints:r,total:t.length},this.getFreeDrawCommonProperty({inProgress:e}));var s={boundary:this.getBoundaryRectOfFreeDraw()};return this.sampleSeq>0&&e?(0,a.default)((0,a.default)({},s),{points:t.slice(t.length-f.default.pointsPerBatch),total:t.length}):this.sampleSeq>0?(0,a.default)((0,a.default)({},s),{points:t.slice(t.length-f.default.pointsPerBatch),arrowPoints:r,inProgress:e,total:t.length}):(0,a.default)({points:t.slice(),arrowPoints:r,total:t.length},this.getFreeDrawCommonProperty({inProgress:e}))}},{key:"draw",value:function(e,t){t.save();var n=e.data,a=this._draw(e,t);if(t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.globalAlpha=n.opacity,t.stroke(),3===n.arrowPoints.length){var i=this.getArrowPoints(a,n.lineWidth,!0);3===i.length&&(t.beginPath(),t.moveTo.apply(t,(0,r.default)(i[0])),t.lineTo.apply(t,(0,r.default)(i[1])),t.lineTo.apply(t,(0,r.default)(i[2])),t.fillStyle=n.color,t.fill())}t.restore()}}]),t}(d.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(41)),a=d(n(5)),i=d(n(2)),o=d(n(0)),s=d(n(1)),u=d(n(3)),c=d(n(4)),l=n(18);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="line-arrow",e.description="绘制带箭头线段。\n首先使用op:line-arrow:activate设置画布为线段模式。通过op:line-arrow:lineWidth, op:line-arrow:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,c.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){var t=!e&&this.points.length>2,n=[];if(this.points.length>1&&t){var r=[this.sp,this.ep];n=(0,l.getArrowPoints)(this.lineWidth+1,r)}return(0,a.default)({arrowPoints:n},this.getTwoPointShapeCommonProperty({inProgress:e}))}},{key:"draw",value:function(e,t){t.save();var n=e.data,a=this.getStartEndPointFromSnapshot(n),i=a.sp,o=a.ep,s=(0,l.getTransformedPoint)(i,n.dx,n.dy,n.scaleX,n.scaleY),u=(0,l.getTransformedPoint)(o,n.dx,n.dy,n.scaleX,n.scaleY);if(t.beginPath(),t.moveTo.apply(t,(0,r.default)(s)),t.lineTo.apply(t,(0,r.default)(u)),t.strokeStyle=n.color,t.lineWidth=n.lineWidth,t.globalAlpha=n.opacity,t.stroke(),3===n.arrowPoints.length){var c=(0,l.getArrowPoints)(n.lineWidth+1,[s,u]);t.beginPath(),t.moveTo.apply(t,(0,r.default)(c[0])),t.lineTo.apply(t,(0,r.default)(c[1])),t.lineTo.apply(t,(0,r.default)(c[2])),t.fillStyle=n.color,t.fill()}t.restore()}}]),t}(d(n(200)).default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(5)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="element-eraser",e.description="删除元素。",e.lastSelectedOpIds=[],e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"postMouseMove",value:function(e){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+n(210)+") 2 13, auto":document.body.style.cursor="auto"}},{key:"postMouseUp",value:function(e){this.postClick(e)}},{key:"postClick",value:function(e){this.dispatch(this.getSelectionSnapshot(!1,[]));var t=this.filterMediaIds(e);t.length>0&&this.dispatch(this.getSnapshot(t)),this.lastSelectedOpIds=[]}},{key:"filterMediaIds",value:function(e){var t=this;return e.filter((function(e){var n=t.opsManager.drawOpsOfPage[e];return!n||!n.data||"audio"!==n.data.type&&"video"!==n.data.type}))}},{key:"getSnapshot",value:function(e){return{type:"element-eraser",dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{hidden:!0});return(0,r.default)({},e,{data:n})}}]),t}(c(n(201)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(10)),c=d(n(48)),l=n(36);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="laser",e.description="镭射灯",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this))}},{key:"handleOpChange",value:function(e){var t;"laser"!==e&&"laser"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&(document.body.style.cursor="default",this.dispatch(this.getSnapshot(!1)))}},{key:"handleMouseLeave",value:function(e,t,n){this.dispatch(this.getSnapshot(!1))}},{key:"handleMouseMove",value:function(e,t,n){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="none":document.body.style.cursor="auto",this.dispatch(this.getSnapshot(!0,[t,n]))}},{key:"getSnapshot",value:function(e,t){return{type:"laser",point:t,inProgress:e,skipUndo:!0,reuseOpType:"laser",color:c.default.strokeColor,nickname:this.app.nickname}}},{key:"draw",value:function(e,t){var n=e.data;if(!(Date.now()+this.app.ntpTimeDiff-e.time>9e4)){var r=6/this.app.camera.scale;e.data.inProgress&&n.point&&(t.save(),t.beginPath(),t.arc(n.point[0],n.point[1],r,0,2*Math.PI,!0),t.shadowColor="rgba(255, 0, 0, 0.5)",t.shadowBlur=8,t.fillStyle="#ff0000",t.fill(),t.restore(),e.uid!==this.app.account&&this.app.appConfig.showLaserNickname&&(0,l.drawUserName)({ctx:t,account:n.nickname||e.uid,scale:this.app.camera.scale,px:n.point[0],py:n.point[1],bgColor:n.color}))}}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(5)),a=c(n(2)),i=c(n(0)),o=c(n(1)),s=c(n(3)),u=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="lock",e.description="锁定元素。",e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{lock:{value:this.lockOps.bind(this),information:{args:"opIds",message:"锁定元素"}},unlock:{value:this.unlockOps.bind(this),information:{args:"opIds",message:"解锁元素"}}}}},{key:"lockOps",value:function(e){this.dispatch(this.getSnapshot(e,"lock"))}},{key:"unlockOps",value:function(e){this.dispatch(this.getSnapshot(e,"unlock"))}},{key:"getSnapshot",value:function(e,t){return{type:this.type,action:t,dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var n=(0,r.default)({},e.data,{locked:"lock"===t.data.action});return(0,r.default)({},e,{data:n})}}]),t}(c(n(10)).default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(2)),a=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(10)),c=n(131);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="background",e.description="设置背景操作",e.getBoundaryFromSnapshot=function(t){var n=void 0;if(t.data.hasOwnProperty("imgWidth")){var r=(0,c.getImageProperPosition)(e,t.data.imgWidth,t.data.imgHeight);n={sx:r.sx,sy:r.sy,w:r.width,h:r.height}}else n=t.data.boundary;return n},e.dispatchImage=function(t,n,r,a){var i=(0,c.getBackgroundImagePorperPosition)(e,n,r),o=i.sx,s=i.sy,u=i.width,l=i.height;a?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}},a):e.dispatch({type:e.type,url:t,boundary:{sx:o,sy:s,w:u,h:l}})},e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"background:imageUpload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        width?: number,\n                        height?: number,\n                        pageName?: string,\n                        boardName?: string\n                    }",message:"上传背景图片"}}}}},{key:"addImage",value:function(e,t){return(0,c.addImage)(this,e,t)}},{key:"preview",value:function(e,t,n){var r=e.data;return(0,c.draw)(t,r.url,this.getBoundaryFromSnapshot(e),{page:n.page,supportToDataUrl:n.supportToDataUrl,preview:!0})}},{key:"draw",value:function(e,t,n){var r=e.data;return(0,c.draw)(t,r.url,this.getBoundaryFromSnapshot(e),{page:n.page,div:n.div,id:e.opId,type:"background"})}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(2)),a=p(n(0)),i=p(n(1)),o=p(n(3)),s=p(n(4)),u=p(n(10)),c=n(56),l=n(88),d=n(29),f=p(n(32));function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="pan",e.activate=!1,e.description="平移操作",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pan.tap("pan",this.handlePan.bind(this))}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handleMouseMove",value:function(e,t,n,r,a){this.app.enableCameraTransform&&(0,l.shouldDispatch)(this.app)&&(this.activate?document.body.style.cursor="grabbing":this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="grab":document.body.style.cursor="auto",this.activate&&this.lastPoint&&(this.dispatch(this.getSnapshot(r-this.lastPoint[0],a-this.lastPoint[1])),this.lastPoint=[r,a]))}},{key:"handlePan",value:function(e,t,n){if(this.app.enableCameraTransform){if((0,l.shouldDispatch)(this.app)||(0,l.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(t,n)),!0;(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:f.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}})}}},{key:"handleMouseDown",value:function(e,t,n,r,a){this.app.appConfig.cameraTransformEnabled&&((0,l.shouldDispatch)(this.app)?(this.activate=!0,this.beginBatch(),this.lastPoint=[r,a]):(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:f.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}}))}},{key:"handleMouseUp",value:function(e,t,n,r,a){this.app.appConfig.cameraTransformEnabled&&(0,l.shouldDispatch)(this.app)&&(this.activate&&this.lastPoint&&(this.dispatch(this.getSnapshot(r-this.lastPoint[0],a-this.lastPoint[1])),this.lastPoint=void 0),this.activate=!1)}},{key:"getSnapshot",value:function(e,t){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"pan",dx:-e,dy:-t,animate:!1})}}]),t}(u.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(2)),a=p(n(0)),i=p(n(1)),o=p(n(3)),s=p(n(4)),u=p(n(10)),c=n(56),l=n(88),d=n(29),f=p(n(32));function p(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="zoom",e.sp=[0,0],e.description="缩放操作",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousewheel.tap("MousewheelPlugin",this.handleMouseWheel.bind(this)),this.opsManager.hooks.scale.tap("Scale",this.handleScale.bind(this))}},{key:"eventsToListen",value:function(){return{"zoom:in":{value:this.zoomIn.bind(this),information:{args:"",message:"缩放"}},"zoom:out":{value:this.zoomOut.bind(this),information:{args:"",message:"缩放"}},"zoom:to":{value:this.zoomTo.bind(this),information:{args:"scale: number, animate: boolean",message:"缩放"}}}}},{key:"handleScale",value:function(e,t,n,r){this.app.appConfig.cameraTransformEnabled&&((0,l.shouldDispatch)(this.app)?this.app.camera.zoomFactor*t>=10&&t>1||this.app.camera.zoomFactor*t<=.1&&t<1||(this.beginBatch(),this.dispatch(this.getSnapshot(t,!1,[n,r]))):(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:f.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}}))}},{key:"handleMouseWheel",value:function(e,t,n,r,a){if(this.app.appConfig.cameraTransformEnabled)if((0,l.shouldDispatch)(this.app)){var i=void 0,o=this.app.appConfig.zoomSensitivity;if("gesturestart"!==e.type)if("gestureend"!==e.type){if("gesturechange"===e.type){if(void 0===this.gestureLastScale)return void(this.gestureLastScale=e.scale);i=e.scale/this.gestureLastScale,this.gestureLastScale=e.scale}else o=(1-("DOMMouseScroll"===e.type?1.1:Math.abs(e.deltaY)<20?Math.max(Math.min(Math.pow(Math.abs(e.deltaY)/4,2),.8),.1):Math.max(Math.min(Math.pow(Math.abs(e.deltaY)/150,2),1),.5)))*(1-o)+o,i="DOMMouseScroll"===e.type?e.detail>0?o:1/o:e.deltaY>0?o:1/o;this.app.camera.zoomFactor*i>=10&&i>1||this.app.camera.zoomFactor*i<=.1&&i<1||this.isMouseDown||this.app.container.isTargetOnContainer(e.target)&&(this.beginBatch(),this.dispatch(this.getSnapshot(i,!1,[r,a])))}else this.gestureLastScale=void 0;else this.gestureLastScale=e.scale}else(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:f.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}})}},{key:"zoomIn",value:function(){if((0,l.shouldDispatch)(this.app)&&!(this.app.camera.zoomFactor/this.app.appConfig.zoomSensitivity>=10))return this.beginBatch(),this.dispatch(this.getSnapshot(1/this.app.appConfig.zoomSensitivity,!1))}},{key:"zoomOut",value:function(){if((0,l.shouldDispatch)(this.app)&&!(this.app.camera.zoomFactor*this.app.appConfig.zoomSensitivity<=.1))return this.beginBatch(),this.dispatch(this.getSnapshot(this.app.appConfig.zoomSensitivity,!1))}},{key:"zoomTo",value:function(e,t){if((0,l.shouldDispatch)(this.app))return this.beginBatch(),this.dispatch(this.getSnapshot(e/this.app.camera.zoomFactor,t))}},{key:"getSnapshot",value:function(e,t,n){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"zoom",animate:t,center:n,scale:e})}}]),t}(u.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(10)),c=n(56),l=n(88);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="reset-camera",e.description="重置视角",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"reset-camera",animate:e})}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(n(35)),a=g(n(2)),i=g(n(0)),o=g(n(1)),s=g(n(3)),u=g(n(4)),c=g(n(10)),l=g(n(199)),d=g(n(210)),f=g(n(302)),p=g(n(48)),h=n(36);function g(e){return e&&e.__esModule?e:{default:e}}var v=new Image,y=new Image,m=new Image;v.src=l.default,y.src=d.default,m.src=f.default;var b=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="mouse-pointer",e.description="展示鼠标位置",e.sampleSeq=0,e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseleave.tap("MousemovePlugin",this.handleMouseLeave.bind(this))}},{key:"handleMouseMove",value:function(e,t,n){var r;if(this.app.showCursor&&"laser"!==(null===(r=this.opsManager.currOp)||void 0===r?void 0:r.type)){var a=this.app.container.isTargetOnContainer(e.target);this.sampleSeq%6==0&&this.dispatch(this.getSnapshot([t,n],a)),this.sampleSeq+=1}}},{key:"handleMouseLeave",value:function(e,t,n){var r;this.app.showCursor&&"laser"!==(null===(r=this.opsManager.currOp)||void 0===r?void 0:r.type)&&(this.dispatch(this.getSnapshot([t,n],!1)),this.sampleSeq=0)}},{key:"getSnapshot",value:function(e,t){return{type:"mouse-pointer",point:[Number(e[0].toFixed(1)),Number(e[1].toFixed(1))],c:p.default.strokeColor,show:t?1:0,op:this.opsManager.currOp?this.opsManager.currOp.type:"",reuseOpType:"mouse-pointer",nickname:this.app.nickname}}},{key:"preview",value:function(){}},{key:"draw",value:function(e,t){if(!((new Date).valueOf()-e.time>5e3)){var n=e.data;if(e.uid!==this.app.account&&n.show&&n.point){var a=this.getImageByOpType(n.op),i=this.mapPointInsideContainer(n.point[0],n.point[1]),o=(0,r.default)(i,2),s=o[0],u=o[1];-1!==this.opsManager.drawOpTypes.indexOf(n.op)&&(s-=1/this.app.camera.scale,u-=27/this.app.camera.scale);var c=32/this.app.camera.scale;t.drawImage(a,s,u,c,c),this.app.appConfig.showCursorNickname&&(0,h.drawUserName)({ctx:t,account:n.nickname||e.uid,scale:this.app.camera.scale,px:s,py:u,bgColor:n.c})}}}},{key:"mapPointInsideContainer",value:function(e,t){var n=this.app.camera.convertToPointInWorld(0,0),a=(0,r.default)(n,2),i=a[0],o=a[1],s=this.app.camera.convertToPointInWorld(this.app.container.width,this.app.container.height),u=(0,r.default)(s,2),c=u[0],l=u[1];return e<i+30?e=i+30:e>c-25&&(e=c-25),t<o+30?t=o+30:t>l-15&&(t=l-15),[e,t]}},{key:"getImageByOpType",value:function(e){return"element-eraser"===e?y:-1!==this.opsManager.drawOpTypes.indexOf(e)?v:m}}]),t}(c.default);t.default=b},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MzA2MTkyNDQ5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwOTYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU2IDBsNjEyLjY1MDY2NyA1NzMuODI0LTI1MC4yODI2NjcgMjIuNzQxMzMzLTQ1LjQ0IDQuMDk2IDE4LjkwMTMzMyA0MS41NTczMzMgMTUxLjg1MDY2NyAzMzIuNTQ0TDYzMS42OCAxMDI0bC0xNDQuODk2LTMzNi4xMjgtMTguMTc2LTQyLjM2OC0zMy41Nzg2NjcgMzEuNTMwNjY3LTE3Ny43OTIgMTY2Ljc0MTMzM0wyNTYgMCIgcC1pZD0iMjA5NyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(2)),a=l(n(0)),i=l(n(1)),o=l(n(3)),s=l(n(4)),u=l(n(10)),c=n(56);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="resize-camera",e.description="重置视角",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.resize.tap("ResizePlugin",this.handleResize.bind(this))}},{key:"handleResize",value:function(e,t,n){if(t&&n)if("follower"===this.app.vision.mode)this.app.camera.updateTransParamAndRefresh();else{var r=this.app.camera,a=this.app.camera.getNextCameraBound({type:"resize-camera",width:t,height:n,animate:!1});if(Math.abs(a.centerX-r.centerX)+Math.abs(a.centerY-r.centerY)+Math.abs(a.width-r.width)+Math.abs(a.height-r.height)<1)return;this.dispatch(this.getSnapshot(t,n))}else this.logger.warn("[白板] resize 宽高无效",t,n)}},{key:"getSnapshot",value:function(e,t){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"resize-camera",width:e,height:t,animate:!1})}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(10)),c=n(56),l=n(88);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="fit-to-content",e.description="缩放至完全包含内容",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"fit-to-content",animate:e})}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(10)),c=n(56),l=n(88);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="fit-to-doc",e.description="缩放至完全包含文档",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app)&&(this.app.room.currBoard.currPage.backgroundSnapshot||this.app.room.currBoard.transDocSnapshot))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,c.convertToCameraBoundSnapshot)(this.app.camera,{type:"fit-to-doc",animate:e})}}]),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="rect-fill",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({strokeOrFill:"fill",inProgress:e})}}]),t}(u(n(202)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="ellipse-fill",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({strokeOrFill:"fill",inProgress:e})}}]),t}(u(n(203)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="video",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"video:insert":{value:this.addMedia.bind(this),information:{args:"url: string, opts: {\n                        width: number,\n                        sourceType: string,\n                        title?: string\n                        pageName?: string\n                        boardName?: string\n                    }",message:"上传视频"}}}}}]),t}(u(n(211)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(2)),a=c(n(0)),i=c(n(1)),o=c(n(3)),s=c(n(4)),u=c(n(212));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){return(0,a.default)(this,t),(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"onSizeChange",value:function(e){this.headerWidget&&this.controlWidget&&(this.headerWidget.style.visibility=e.height>130&&e.width>180?"visible":"hidden",this.controlWidget.style.visibility=e.height>130&&e.width>180?"visible":"hidden")}},{key:"getTitle",value:function(){return this.title?this.title:"视频文件"}},{key:"createControllor",value:function(){var e=document.createElement("div");this.progressController=new u.default(0,{emitEvent:this.isCreator()});var t=this.createControlContainer(),n=this.createPlayWidget(),r=this.createTimeIndicator(),a=this.createVolumeWidget();return e.appendChild(this.progressController.widget),e.appendChild(t),t.appendChild(n),t.appendChild(r),t.appendChild(a),e.style.userSelect="none",e.className="media-control",this.controlWidget=e,e}}],[{key:"getElementWidth",value:function(e,t){return e||t.videoWidth}},{key:"getElementHeight",value:function(e,t){return e/t.videoWidth*t.videoHeight}}]),t}(c(n(213)).default);t.default=l},function(e,t,n){var r=function(){return this}()||Function("return this")(),a=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=a&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(311),a)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=g;var l={},d={};d[i]=function(){return this};var f=Object.getPrototypeOf,p=f&&f(f(T([])));p&&p!==n&&r.call(p,i)&&(d=p);var h=b.prototype=y.prototype=Object.create(d);m.prototype=h.constructor=b,b.constructor=m,b[s]=m.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(h),e},c.awrap=function(e){return{__await:e}},w(_.prototype),_.prototype[o]=function(){return this},c.AsyncIterator=_,c.async=function(e,t,n,r){var a=new _(g(e,t,n,r));return c.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(h),h[s]="Generator",h[i]=function(){return this},h.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;M(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function g(e,t,n,r){var a=t&&t.prototype instanceof y?t:y,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return I()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=x(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=v(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function v(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function y(){}function m(){}function b(){}function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(n,a){function i(){return new Promise((function(t,i){!function t(n,a,i,o){var s=v(e[n],e,a);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,i,o)}),(function(e){t("throw",e,i,o)})):Promise.resolve(c).then((function(e){u.value=e,i(u)}),o)}o(s.arg)}(n,a,t,i)}))}return t=t?t.then(i,i):i()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=v(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(21)),a=u(n(5)),i=u(n(0)),o=u(n(1)),s=u(n(13));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t,n,r){return new(n||(n=s.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},l=function(){function e(t,n,r){var a=this;(0,i.default)(this,e),this.recordTime=0,this.handlePrePageChange=function(e){a.app.room.getPage(a.boardName,a.pageName)&&a.boardName===a.app.room.currIndex&&a.pageName===a.app.room.currBoard.currIndex.toString()&&"delete"!==e.data.action&&a.onPrePageChange(e.uid)},this.handlePlayerPlay=function(){a.boardName===a.app.room.currIndex&&a.pageName===a.app.room.currBoard.currIndex.toString()&&a.onAttributeUpdated(a.data)},this.handlePlayerPause=function(){a.boardName===a.app.room.currIndex&&a.pageName===a.app.room.currBoard.currIndex.toString()&&a.onAttributeUpdated(a.data)},this.handlePlayerSeekTo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;clearTimeout(a.seekToTimer),e>30||a.boardName===a.app.room.currIndex&&a.pageName===a.app.room.currBoard.currIndex.toString()&&(a.media?a.onAttributeUpdated(a.data):a.seekToTimer=setTimeout((function(){a.handlePlayerSeekTo(e+1)}),100))},this.handlePlayerPlaySpeed=function(e){a.onPlaySpeedChange(e)},this.opId=t.opId,this.boardName=t.board,this.pageName=t.page.toString(),this.mediaOwner=t.uid,this.app=n,this.operation=r,this.type=r.type,this.title=t.data.title,this.data=t.data.mediaData||{play:!1,seek:0,ended:!1},this.app.player&&(this.app.on("event:player:play",this.handlePlayerPlay),this.app.on("event:player:pause",this.handlePlayerPause),this.app.on("event:player:seekTo",this.handlePlayerSeekTo),this.app.on("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.app.on("event:prePageChange",this.handlePrePageChange)}return(0,o.default)(e,[{key:"isCreator",value:function(){return this.mediaOwner===this.app.account}},{key:"isInReplay",value:function(){return this.app.isRecordPlayer}},{key:"replayMode",value:function(){return this.app.player?this.app.player.state:"pause"}},{key:"replaySeekDiff",value:function(){return this.app.player?(this.app.player.lastTime-this.recordTime)/1e3:0}},{key:"destroy",value:function(){var e;this.app.off("event:prePageChange",this.handlePrePageChange),this.app.player&&(this.app.off("event:player:play",this.handlePlayerPlay),this.app.off("event:player:pause",this.handlePlayerPause),this.app.off("event:player:seekTo",this.handlePlayerSeekTo),this.app.off("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.onPluginWillDestroy();var t=this.app.container.el.querySelector("[id='"+this.opId+"']");null===(e=null==t?void 0:t.parentNode)||void 0===e||e.removeChild(t)}},{key:"putAttributes",value:function(e){var t=this.app.room.getPage(this.boardName,this.pageName);t&&this.operation.dispatchFromPage({dependOn:this.opId,skipUndo:!0,type:this.type,reuseOpType:this.opId+"-"+this.type+"-action",mediaData:(0,a.default)((0,a.default)({},this.data),e)},t)}},{key:"onReceiveAttributes",value:function(e){return c(this,void 0,void 0,r.default.mark((function t(){var n,a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n={play:!1,seek:0,ended:!1},e.data.hasOwnProperty("mediaData"))for(a in n=e.data.mediaData||{},this.data)n.hasOwnProperty(a)||(n[a]=this.data[a]);return this.recordTime=e.data.recordTime||0,t.next=5,this.onAttributeUpdated(n);case 5:this.data=n;case 6:case"end":return t.stop()}}),t,this)})))}}],[{key:"getElementWidth",value:function(e,t){return e}},{key:"getElementHeight",value:function(e,t){return e}}]),e}();t.default=l},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTUxOTYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTYwMCAtNjAwIDIyMjQgMjIyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MDgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU5Ljk0NzkyOTA5IDEzMy45MjE4OTNoMTI2LjAyNjAzNDgxYzIzLjMzODE1NDczIDAgNDIuMDA4Njc4MjcgMTguNjcwNTIzNTMgNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZ2NjcyLjEzODg1NzQ4YzAgMjMuMzM4MTU0NzMtMTguNjcwNTIzNTMgNDIuMDA4Njc4MjctNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZIMjU5Ljk0NzkyOTA5Yy0yMy4zMzgxNTQ3MyAwLTQyLjAwODY3ODI3LTE4LjY3MDUyMzUzLTQyLjAwODY3OTU2LTQyLjAwODY3ODI2VjE3NS45MzA1NzEyNmMwLTIzLjMzODE1NDczIDE4LjY3MDUyMzUzLTQyLjAwODY3ODI3IDQyLjAwODY3OTU2LTQyLjAwODY3ODI2ek02MzguMDI2MDM2MSAxMzMuOTIxODkzaDEyNi4wMjYwMzQ4MWMyMy4zMzgxNTQ3MyAwIDQyLjAwODY3ODI3IDE4LjY3MDUyMzUzIDQyLjAwODY3OTU2IDQyLjAwODY3ODI2djY3Mi4xMzg4NTc0OGMwIDIzLjMzODE1NDczLTE4LjY3MDUyMzUzIDQyLjAwODY3ODI3LTQyLjAwODY3OTU2IDQyLjAwODY3ODI2aC0xMjYuMDI2MDM0ODFjLTIzLjMzODE1NDczIDAtNDIuMDA4Njc4MjctMTguNjcwNTIzNTMtNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZWMTc1LjkzMDU3MTI2YzAtMjMuMzM4MTU0NzMgMTguNjcwNTIzNTMtNDIuMDA4Njc4MjcgNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZ6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyOTA5Ij48L3BhdGg+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBmaWxsPScjZmZmZmZmJyB0PSIxNjIwODcxNDY4NTkwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTU2OS44OTg2NjcgMjc1LjJjLTIuMTMzMzMzLTIwLjczNi00LjM5NDY2Ny00Mi4yNC05Ljg5ODY2Ny02My43NDRDNTQ1LjA2NjY2NyAxNjAuMDg1MzMzIDUwMy41MDkzMzMgMTI4IDQ1OS4wMDggMTI4Yy0yNC44MzItMC4wODUzMzMtNTYuMjM0NjY3IDE1LjE4OTMzMy03NC4wNjkzMzMgMzAuNzJsLTE0Ny42MjY2NjcgMTIzLjYwNTMzM2gtNzcuMjI2NjY3Yy01Ni44NzQ2NjcgMC0xMDIuNTcwNjY3IDQzLjgxODY2Ny0xMTEuMjMyIDEwNy4wOTMzMzQtNy4zMzg2NjcgNjAuNzU3MzMzLTkuMTMwNjY3IDE3NS4zNiAwIDI0Mi4yMTg2NjYgNy45MzYgNjYuODU4NjY3IDUxLjYyNjY2NyAxMTAuMDM3MzMzIDExMS4yMzIgMTEwLjAzNzMzNGg3Ny4yMjY2NjdsMTUwLjQ4NTMzMyAxMjUuNDRjMTUuNDQ1MzMzIDEzLjQ0IDQyLjY2NjY2NyAyOC44NDI2NjcgNjcuNzU0NjY3IDI4Ljg0MjY2Nmw0LjQ4IDAuMDQyNjY3YzQ1LjM1NDY2NyAwIDg1LjMzMzMzMy0zMy4yOCAxMDAuMjY2NjY3LTg0LjQ4IDUuNjc0NjY3LTIxLjcxNzMzMyA3LjY4LTQyLjAyNjY2NyA5LjU1NzMzMy02MS42NTMzMzNsMC4wNDI2NjctMC4zNDEzMzQgMi4wMDUzMzMtMTkuNTg0YzcuNjgtNjMuNDQ1MzMzIDcuNjgtMzcyLjg2NCAwLTQzNS44NGwtMi4wMDUzMzMtMTguODU4NjY2eiBtMTcyLjggMS45MmEzOC42OTg2NjcgMzguNjk4NjY3IDAgMCAwLTU0LjU3MDY2Ny0xMC4xMTIgNDAuODMyIDQwLjgzMiAwIDAgMC05LjcyOCA1NS44MDhjMzQuMjE4NjY3IDUwLjQzMiA1My4wMzQ2NjcgMTE3LjU4OTMzMyA1My4wMzQ2NjcgMTg5LjE4NCAwIDcxLjU1Mi0xOC44MTYgMTM4Ljc1Mi01My4wMzQ2NjcgMTg5LjE4NGE0MC43ODkzMzMgNDAuNzg5MzMzIDAgMCAwIDkuODEzMzMzIDU1LjgwOCAzOC42MTMzMzMgMzguNjEzMzMzIDAgMCAwIDU0LjQ4NTMzNC0xMC4xMTJjNDMuMTc4NjY3LTYzLjY1ODY2NyA2Ny4wMjkzMzMtMTQ3LjA3MiA2Ny4wMjkzMzMtMjM0Ljg4cy0yMy44NTA2NjctMTcxLjIyMTMzMy02Ny4wMjkzMzMtMjM0Ljg4ek04MjMuMDQgMTM3LjM4NjY2N2EzOC42MTMzMzMgMzguNjEzMzMzIDAgMCAxIDU0LjQ4NTMzMyAxMC4wNjkzMzNDOTQ0LjQ2OTMzMyAyNDYuMDU4NjY3IDk4MS4zMzMzMzMgMzc1LjU1MiA5ODEuMzMzMzMzIDUxMmMwIDEzNi41MzMzMzMtMzYuODY0IDI2NS45ODQtMTAzLjgwOCAzNjQuNTQ0YTM4LjQ4NTMzMyAzOC40ODUzMzMgMCAwIDEtNTQuNDQyNjY2IDEwLjA2OTMzMyA0MC44MzIgNDAuODMyIDAgMCAxLTkuODEzMzM0LTU1LjgwOGM1Ny44NTYtODUuMjkwNjY3IDg5Ljc3MDY2Ny0xOTguNTI4IDg5Ljc3MDY2Ny0zMTguODA1MzMzIDAtMTIwLjIzNDY2Ny0zMS45MTQ2NjctMjMzLjQ3Mi04OS44MTMzMzMtMzE4Ljc2MjY2N2E0MC44NzQ2NjcgNDAuODc0NjY3IDAgMCAxIDkuODEzMzMzLTU1LjgwOHoiIGZpbGw9IiNmZmZmZmYiIHAtaWQ9IjIwMzIiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjIwODkxOTY3ODE0IiBmaWxsPScjZmZmZmZmJyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE4NzQiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTg5OS42NDggNTMzLjk1MmwxMDIuNC0xMDIuNGMxNC42MjQtMTQuNjI0IDE0LjYyNC0zNi41NzYgMC01MS4ycy0zNi41NzYtMTQuNjI0LTUxLjIgMGwtMTAyLjQgMTAyLjQtMTA5LjcyOC0xMDkuNzI4Yy03LjMyOC03LjMyOC0yOS4yNDgtMjEuOTUyLTUxLjIgMGEzNS4zNiAzNS4zNiAwIDAgMCAwIDUxLjJsMTAyLjQgMTAyLjQtMTAyLjQgMTA5LjcyOGMtMTQuNjI0IDE0LjYyNC0xNC42MjQgMzYuNTc2IDAgNTEuMnMzNi41NzYgMTQuNjI0IDUxLjIgMGwxMDkuNzI4LTEwMi40IDEwMi40IDEwMi40YzE0LjYyNCAxNC42MjQgMzYuNTc2IDE0LjYyNCA1MS4yIDBzMTQuNjI0LTM2LjU3NiAwLTUxLjJsLTEwMi40LTEwMi40eiBtLTQwMi4yNzItNDYwLjhjLTcuMzI4IDAtMTQuNjI0IDAtMjEuOTUyIDcuMzI4TDE1My42IDM1MS4xMDRINzMuMTUyYy0yOS4yNDgtNy4zMjgtNTEuMiAyMS45NTItNTEuMiA1MS4ydjIxOS40MjRjMCAyOS4yNDggMjEuOTUyIDU4LjUyOCA1MS4yIDU4LjUyOCAwIDAgODcuNzc2IDAgOTUuMDcyIDcuMzI4bDMwNy4yIDI2My4zMjhoMjEuOTUyYzIxLjk1MiAwIDM2LjU3Ni0yMS45NTIgMzYuNTc2LTUxLjJWMTI0LjM4NGMwLTI5LjI0OC0xNC42MjQtNTEuMi0zNi41NzYtNTEuMnoiIHAtaWQ9IjE4NzUiPjwvcGF0aD48L3N2Zz4="},function(e,t,n){var r=n(317);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(25)(r,a);r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(24)(!1);var r=n(97),a=r(n(318)),i=r(n(214));t.push([e.i,".neteaseyunxin-wb-media-container {\n    position: fixed;\n}\n    .neteaseyunxin-wb-media-container .header {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 32px;\n        background-color: rgba(0,0,0,.7);\n        align-items: center;\n        display: none;\n    }\n    .neteaseyunxin-wb-media-container .header .title {\n            flex: 1;\n            color: white;\n            margin-left: 8px;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            font-size: 18px;\n        }\n    .neteaseyunxin-wb-media-container .header .close.icon {\n            width: 20px;\n            height: 20px;\n            background-image: url("+a+");\n            background-size: contain;\n            margin-right: 8px\n        }\n    .neteaseyunxin-wb-media-container .header .close.icon:hover {\n                cursor: pointer;\n            }\n    .neteaseyunxin-wb-media-container .media-control {\n        width: 100%;\n        position: absolute;\n        bottom: 0;\n        background: rgba(0,0,0,.7);\n        padding-top: 3px;\n        display: none;\n    }\n    .neteaseyunxin-wb-media-container .media-control .control-container {\n            display: flex;\n            height: 40px;\n            width: 100%;\n        }\n    .neteaseyunxin-wb-media-container .media-control .play-icon {\n            display: inline-block;\n            height: 100%;\n            width: 40px;\n            background-image: url("+i+");\n            background-size: contain;\n        }\n    .neteaseyunxin-wb-media-container .media-control .time-container {\n            display: inline-block;\n            height: 40px;\n            color: white;\n            vertical-align: top;\n            margin: 0 16px 0 0;\n        }\n    .neteaseyunxin-wb-media-container .media-control .time-text {\n            line-height: 40px;\n            height: 40px;\n            vertical-align: middle;\n            font-size: 14px;\n        }\n.neteaseyunxin-wb-media-container.visible .header, .neteaseyunxin-wb-media-container.audio .header {\n            display: flex;\n        }\n.neteaseyunxin-wb-media-container.visible .media-control, .neteaseyunxin-wb-media-container.audio .media-control {\n            display: block;\n        }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHQ9IjE2MjA4OTY3NjEwNjEiIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNSAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMTg2MyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIzMi4wMzEyNSIgaGVpZ2h0PSIzMiI+CjxkZWZzPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPgo8cGF0aCBkPSJNNTEzLjM0NCAwYTUxMiA1MTIgMCAxIDAgMCAxMDI0IDUxMiA1MTIgMCAwIDAgMC0xMDI0eiBtMjI2LjA0OCA2NzQuNjI0bC01NC41MjggNTYuODk2LTE3MS41Mi0xNjQuOTI4LTE3MS4zOTIgMTY0LjkyOC01NC41OTItNTYuODk2TDQ1Ni41NzYgNTEyIDI4Ny4zNiAzNDkuMzEybDU0LjU5Mi01Ni43NjggMTcxLjM5MiAxNjQuOCAxNzEuNTItMTY0LjggNTQuNTI4IDU2Ljc2OEw1NzAuMTc2IDUxMmwxNjkuMjE2IDE2Mi42MjR6IiBmaWxsPSIjZDgzZjIzIiBwLWlkPSIxODY0Ij48L3BhdGg+Cjwvc3ZnPg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendTooltip=void 0;var r=i(n(0)),a=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}n(320);var o=function(){function e(t,n){var a=this;(0,r.default)(this,e),this.onMouseOver=function(){a.widget.classList.add("visible")},this.onTouchStart=function(){a.widget.classList.add("visible"),clearTimeout(a.hideTimer),a.hideTimer=setTimeout((function(){a.onMouseLeave()}),1e3)},this.onMouseLeave=function(){a.widget.classList.remove("visible")},t.classList.add("neteaseyunxin-wb-tooltip");var i=document.createElement("span");i.className="tooltiptext",i.innerText=n,t.appendChild(i),this.widget=t,this.bindEvents()}return(0,a.default)(e,[{key:"bindEvents",value:function(){this.widget.addEventListener("mouseover",this.onMouseOver),this.widget.addEventListener("mouseleave",this.onMouseLeave),this.widget.addEventListener("touchstart",this.onTouchStart),window.document.addEventListener("touchend",this.onMouseLeave)}}]),e}();t.appendTooltip=function(e,t){return new o(e,t)}},function(e,t,n){var r=n(321);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(25)(r,a);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(24)(!1)).push([e.i,".neteaseyunxin-wb-tooltip {\n    position: relative;\n    display: inline-block;\n}\n\n    \n    .neteaseyunxin-wb-tooltip .tooltiptext {\n        visibility: hidden;\n        width: 120px;\n        background-color: black;\n        color: #fff;\n        text-align: center;\n        border-radius: 6px;\n        padding: 5px 0;\n      \n        /* Position the tooltip */\n        position: absolute;\n        z-index: 1;\n        bottom: 30px;\n        left: 50%;\n        transform: translateX(-50%);\n    }\n\n    \n.neteaseyunxin-wb-tooltip.visible .tooltiptext {\n        visibility: visible;\n    }",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(5)),a=l(n(2)),i=l(n(0)),o=l(n(1)),s=l(n(3)),u=l(n(4)),c=l(n(212));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return(0,i.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,o.default)(t,[{key:"onSizeChange",value:function(e){this.playWidget&&this.timeWidget&&this.selfMuteIcon&&this.progressController&&(this.playWidget.style.display=e.width>140?"inline-block":"none",this.progressController.widget.style.display=e.width>140?"inline-block":"none",this.timeWidget.style.display=e.width>260?"inline-block":"none",this.selfMuteIcon.style.display=e.width>140?"inline-block":"none")}},{key:"getTitle",value:function(){return this.title?this.title:"音频文件"}},{key:"createControllor",value:function(){var e=document.createElement("div");this.progressController=new c.default(0,{emitEvent:this.isCreator()});var t=this.createControlContainer(),n=this.createPlayWidget(),a=this.createTimeIndicator(),i=this.createVolumeWidget();e.appendChild(t),t.appendChild(n),t.appendChild(a);var o=document.createElement("div");return(0,r.default)(o.style,{height:"40px",lineHeight:"40px",display:"inline-flex",alignItems:"center",flex:1,marginRight:"16px"}),o.appendChild(this.progressController.widget),t.appendChild(o),t.appendChild(i),e.style.userSelect="none",e.className="media-control",this.controlWidget=e,e}}],[{key:"getElementWidth",value:function(e){return e||500}},{key:"getElementHeight",value:function(){return 75}}]),t}(l(n(213)).default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(2)),a=u(n(0)),i=u(n(1)),o=u(n(3)),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){(0,a.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments));return e.type="audio",e}return(0,s.default)(t,e),(0,i.default)(t,[{key:"eventsToListen",value:function(){return{"audio:insert":{value:this.addMedia.bind(this),information:{args:"url: string, opts: {\n                         width: number,\n                         sourceType: string,\n                         title?: string\n                         pageName?: string\n                         boardName?: string\n                     }",message:"上传视频"}}}}}]),t}(u(n(211)).default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(14)),a=p(n(2)),i=p(n(0)),o=p(n(1)),s=p(n(3)),u=p(n(4)),c=n(18),l=p(n(10)),d=n(36),f=p(n(325));function p(e){return e&&e.__esModule?e:{default:e}}var h=void 0,g=function(e){function t(){(0,i.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments));return e.type="transDoc",e.description="转码相关的操作汇聚地",e.transDocPlugin={},e.boardLastSnapshot={},e}return(0,u.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.boardChange.tap("boardChangePlugin",this.onBoardChange.bind(this))}},{key:"getPluginOfCurrBoard",value:function(){var e=this.app.room.currBoard.transDocSnapshot,t=e&&e.opId||"";return this.transDocPlugin[t]}},{key:"eventsToListen",value:function(){return{"transDoc:add":{value:this.addTransDoc.bind(this),information:{args:"opt",message:"添加ppt转码文档页面"}},"transDoc:nextAnim":{value:this.nextAnim.bind(this),information:{args:"",message:"播放下一个动画"}},"transDoc:prevAnim":{value:this.prevAnim.bind(this),information:{args:"",message:"跳到上一个动画"}}}}},{key:"addTransDoc",value:function(e){this.dispatch({type:this.type,action:"addTransDoc",boardName:e.boardName,displayName:e.displayName,pageCount:e.pageCount,transDocUrl:e.url,boundary:{sx:-e.width/2,sy:-e.height/2,w:e.width,h:e.height},transDocData:{animIndex:0,animState:"start",animPageIndex:0}})}},{key:"nextAnim",value:function(){var e=this.getPluginOfCurrBoard();if(e)return e.nextAnim()}},{key:"prevAnim",value:function(){var e=this.getPluginOfCurrBoard();if(e)return e.prevAnim()}},{key:"onBoardChange",value:function(){var e=(0,r.default)(this.app.room.boards);for(var t in this.transDocPlugin){var n=this.transDocPlugin[t];-1===e.indexOf(n.boardName)?this.destroyPlugin(n):n.boardName!==this.app.room.currIndex&&n.hide()}var a=this.app.room.currIndex;this.boardLastSnapshot.hasOwnProperty(a)&&this.apply(this.boardLastSnapshot[a],{fromBatch:!0})}},{key:"destroy",value:function(){for(var e in this.transDocPlugin)this.destroyPlugin(this.transDocPlugin[e])}},{key:"destroyPlugin",value:function(e){e.destroy(),delete this.transDocPlugin[e.opId]}},{key:"previewDoc",value:function(e,t){var n=this.transDocPlugin[e.opId];n&&n.previewDoc(t)}},{key:"updateDocClipPath",value:function(e){var t=this.transDocPlugin[e.opId];t&&t.updateDocClipPath()}},{key:"apply",value:function(e,t){var n=this;this.boardLastSnapshot[e.data.boardName]=e,clearTimeout(h),t.fromBatch&&!this.app.isRecordPlayer?h=setTimeout((function(){n._apply(e,t)}),0):this._apply(e,t)}},{key:"_apply",value:function(e,t){if(!this.transDocPlugin[e.opId]){if(!this.app.room.boards.hasOwnProperty(e.data.boardName))return;this.transDocPlugin[e.opId]=new f.default(e,this.app,this)}var n=this.transDocPlugin[e.opId],r=e.data,a=r.boundary,i=(0,c.getTransformedBoundary)(this.app.camera.scale,a),o=this.app.container.h5El,s=o.querySelector("[id='"+e.opId+"']"),u=null==s;u&&((s=document.createElement("div")).style.position="fixed",s.id=""+e.opId,s.className="transDoc-plugin-container",o.appendChild(s)),s.style.width=i.w+"px",s.style.height=i.h+"px",s.style.left=i.sx+"px",s.style.top=i.sy+"px",u&&n.mountElement(e,t.fromBatch,s,r.transDocUrl),n.onReceiveAttributes(e.data.transDocData,{jump:t.fromBatch})}},{key:"transformOp",value:function(e,t){return(0,d.transformPropertyOverwriteOp)(e,t)}}]),t}(l.default);t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(21)),a=f(n(5)),i=f(n(9)),o=f(n(0)),s=f(n(1)),u=f(n(13)),c=n(18),l=n(36),d=f(n(326));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t,n,r){return new(n||(n=u.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},h=function(){function e(t,n,r){var a,s=this;(0,o.default)(this,e),this.summaryReady=!1,this.handlePlayerPause=function(){s.pgReader&&s.data.animPageIndex===s.app.room.currBoard.currPage.getAnimPageIndex()&&s.pgReader.gotoAnimation({animIndex:s.data.animIndex,animState:s.data.animState},!0)},this.handlePlayerPlaySpeed=function(e){s.pgReader&&s.pgReader.setAnimSpeed(e)},this.opId=t.opId,this.type=r.type,this.boardName=t.data.boardName,this.app=n,this.operation=r,this.boundary=t.data.boundary;var u=this.app.room.boards[this.boardName];window.PgReader?(this.pgReader=new window.PgReader({fontDownloadPrefix:null===(a=this.app.serviceConf)||void 0===a?void 0:a.fontDownloadUrl,pageCount:t.data.pageCount}),this.pgReader.on("event:pptState:change",(function(e,t){"pageImgLoaded"===e?s.removeBlockH5Img(t):"indexLoaded"===e&&(s.summaryReady=!0,s.onAttributeUpdated(s.data,!0))}))):n.logger.error("房间加载了动态ppt，但是应用没有加载pptRenderer脚本。"),this.data=t.data.transDocData||{animIndex:0,animState:"start",animPageIndex:0},this.operation.opsManager.hooks.pageChange.tap("PageChange",this.handlePageChange.bind(this)),this.operation.opsManager.hooks.previewWaiting.tap("PreviewWaitingPlugin",this.handlePreviewWaiting.bind(this));var c=u.payloadOfPages,l=!0,d=!1,f=void 0;try{for(var p,h=(0,i.default)(c);!(l=(p=h.next()).done);l=!0){var g=p.value;if(g&&g.hasOwnProperty("animPageIndex")){var v=u.getPageNameByAnimPageIndex(g.animPageIndex);null!==v&&u.pages[v].addWaitingResource("h5Image")}}}catch(e){d=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw f}}this.app.isRecordPlayer&&(this.app.on("event:player:pause",this.handlePlayerPause),this.app.on("event:player:playSpeed",this.handlePlayerPlaySpeed))}return(0,s.default)(e,[{key:"removeBlockH5Img",value:function(e){if(this.pgReader){var t=this.app.room.boards[this.boardName],n=t.getPageNameByAnimPageIndex(e);n&&t.pages[n].removeWaitingResource("h5Image")}}},{key:"mountElement",value:function(e,t,n,r){var i,o,s=this;if(this.container=n,this.pgReader){!function(){if(g)return;g=!0;var e=document.createElement("style");e.type="text/css";e.innerHTML="\n@keyframes __newb__rotate {\nfrom {transform: rotate(0);}\nto {transform: rotate(360deg);}\n}\n    ",document.getElementsByTagName("head")[0].appendChild(e)}();var u=document.createElement("img");u.src=d.default,u.className="__newb__ppt_icon_loading",this.container.appendChild(u),(0,a.default)(u.style,{display:"none",position:"absolute",top:"50%",left:"50%",bottom:"0",right:"0",width:"55px",height:"55px",animation:"2s ease-in-out infinite __newb__rotate",transform:"translate(-50%, -50%)",zIndex:"1000"}),this.pgReader.open(r,{mode:"lazy"}).then((function(){s.pgReader.updateContainer(n);var r=Date.now()+s.app.ntpTimeDiff-e.time;e.uid===s.app.account.toString()&&r<1e3&&!t&&0===s.data.animPageIndex&&"start"===s.data.animState&&0===s.data.animIndex&&s.pgReader.waitTilPageReady(0).then((function(){var e=s.pgReader.getFirstAnimationPosition(0);0===e.animIndex&&"start"===e.animState||s.putAttributes((0,a.default)((0,a.default)({},e),{animPageIndex:0,jump:!1}))}))})),this.app.isRecordPlayer&&(null===(i=this.app.player)||void 0===i?void 0:i.playSpeed)&&this.pgReader.setAnimSpeed(null===(o=this.app.player)||void 0===o?void 0:o.playSpeed)}}},{key:"destroy",value:function(){var e;this.container&&(null===(e=this.container.parentNode)||void 0===e||e.removeChild(this.container)),this.app.isRecordPlayer&&(this.app.off("event:player:pause",this.handlePlayerPause),this.app.off("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.pgReader&&this.pgReader.destroy()}},{key:"hide",value:function(){this.container&&(this.container.style.visibility="hidden")}},{key:"show",value:function(){this.container&&(this.container.style.visibility="visible")}},{key:"hideLoading",value:function(){for(var e,t=(null===(e=this.container)||void 0===e?void 0:e.getElementsByClassName("__newb__ppt_icon_loading"))||[],n=0;n<t.length;n++)t[n].style.display="none"}},{key:"showLoading",value:function(){for(var e,t=(null===(e=this.container)||void 0===e?void 0:e.getElementsByClassName("__newb__ppt_icon_loading"))||[],n=0;n<t.length;n++)t[n].style.display="block"}},{key:"updateDocClipPath",value:function(){var e=this.boundary,t=(0,c.getTransformedBoundary)(this.app.camera.scale,e),n=(0,l.getElementPartOutOfContainer)(t,this.app.camera);n&&this.container?this.container.style.clipPath="inset("+n.top+"px "+n.right+"px "+n.bottom+"px "+n.left+"px)":this.container&&(this.container.style.clipPath="none")}},{key:"gotoNextPage",value:function(){var e=this,t=this.app.getPageInfos(),n=t.activeIndex;if(n<t.pageNames.length-1){var r=this.app.room.currBoard.getPageByIndex(n+1).getAnimPageIndex();null===r?this.app.gotoPage(n+1):this.pgReader&&(this.showLoading(),this.pgReader.waitTilPageReady(r).then((function(){var t=e.pgReader.getFirstAnimationPosition(r);e.putAttributes((0,a.default)({jump:!1,animPageIndex:r},t)),e.hideLoading()})).catch((function(){e.putAttributes({jump:!1,animPageIndex:r,animIndex:0,animState:"start"}),e.hideLoading()})))}}},{key:"gotoPrevPage",value:function(){var e=this,t=this.app.getPageInfos().activeIndex;if(t>0){var n=this.app.room.currBoard.getPageByIndex(t-1).getAnimPageIndex();null===n?this.app.gotoPage(t-1):this.pgReader&&(this.showLoading(),this.pgReader.waitTilPageReady(n).then((function(){e.putAttributes({jump:!0,animPageIndex:n,animState:"end",animIndex:e.pgReader.getAnimationLengthOfPage(n)}),e.hideLoading()})).catch((function(){e.putAttributes({jump:!0,animPageIndex:n,animState:"end",animIndex:e.pgReader.getAnimationLengthOfPage(n)}),e.hideLoading()})))}}},{key:"nextAnim",value:function(){if(this.pgReader){var e=void 0!==this.data.animPageIndex&&null!==this.data.animPageIndex,t=this.pgReader.getNextAnimationPosition(),n=this.app.room.currBoard;e&&this.data.animPageIndex===n.currPage.getAnimPageIndex()&&t?this.putAttributes((0,a.default)((0,a.default)({},t),{animPageIndex:this.app.room.currBoard.currPage.getAnimPageIndex(),jump:!1})):this.gotoNextPage()}}},{key:"prevAnim",value:function(){if(this.pgReader){var e=void 0!==this.data.animPageIndex&&null!==this.data.animPageIndex,t=this.pgReader.getPrevAnimationPosition();e&&t&&this.data.animPageIndex===this.app.room.currBoard.currPage.getAnimPageIndex()?this.putAttributes((0,a.default)((0,a.default)({},t),{animPageIndex:this.app.room.currBoard.currPage.getAnimPageIndex(),jump:!0})):this.gotoPrevPage()}}},{key:"handlePreviewWaiting",value:function(e){var t=this.app.room.currBoard.getPageByIndex(e);if(t){var n=t.getAnimPageIndex();n&&this.pgReader&&this.boardName===this.app.room.currBoard.boardName&&this.pgReader.waitTilPageReady(n)}}},{key:"handlePageChange",value:function(e){var t=this;if(this.app.isRecordPlayer||e.uid!==this.app.account||"transDoc"===e.data.type){if(this.app.isRecordPlayer||"transDoc"===e.data.type){if(this.app.isRecordPlayer&&this.boardName===this.app.room.currBoard.boardName){var n=this.app.room.currBoard.currPage.getAnimPageIndex();this.onReceiveAttributes({animIndex:0,animState:"start",animPageIndex:n,jump:!0},{jump:!0})}}else if(this.boardName===this.app.room.currBoard.boardName){var r=this.app.room.currBoard.currPage.getAnimPageIndex();this.onReceiveAttributes({animIndex:0,animState:"start",animPageIndex:r,jump:!0},{jump:!0})}}else{var a=Date.now()+this.app.ntpTimeDiff-e.time;if(this.pgReader&&this.boardName===this.app.room.currBoard.boardName&&a<1e3){var i=this.app.room.currBoard.currPage.getAnimPageIndex();i||0===i?(this.showLoading(),this.pgReader.waitTilPageReady(i).then((function(){var e=t.pgReader.getFirstAnimationPosition(i);t.putAttributes({jump:!1,animIndex:e.animIndex,animState:e.animState,animPageIndex:i}),t.hideLoading()})).catch((function(){t.hideLoading()}))):this.putAttributes({animIndex:0,animState:"start",animPageIndex:i,jump:!0})}}}},{key:"putAttributes",value:function(e){this.operation.dispatch({boardName:this.boardName,dependOn:this.opId,skipUndo:!0,type:this.type,transDocData:(0,a.default)((0,a.default)({},this.data),e)})}},{key:"onReceiveAttributes",value:function(e,t){return p(this,void 0,void 0,r.default.mark((function n(){var i;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=(0,a.default)({},this.data,e||{animState:"start",animIndex:0,animPageIndex:0}),e.jump?this.onAttributeUpdated(i,!0):this.app.isRecordPlayer?this.onAttributeUpdated(i,!1):this.onAttributeUpdated(i,t.jump),this.data=i;case 3:case"end":return n.stop()}}),n,this)})))}},{key:"onAttributeUpdated",value:function(e,t){var n=this;clearTimeout(this.animTimer),this.summaryReady&&(this.animTimer=setTimeout((function(){var r=n.app.room.currBoard.currPage.getAnimPageIndex();null!==r&&r===e.animPageIndex?(n.show(),n.pgReader&&n.pgReader.currPageIndex!==e.animPageIndex&&(n.showLoading(),n.pgReader.waitTilPageReady(e.animPageIndex).then((function(){n.pgReader.gotoPage(e.animPageIndex),n.hideLoading()})).catch((function(){n.pgReader.gotoPage(e.animPageIndex),n.hideLoading()}))),n.pgReader&&(n.showLoading(),n.pgReader.waitTilPageReady(e.animPageIndex).then((function(){n.pgReader.gotoAnimation({animIndex:e.animIndex,animState:e.animState},t),n.hideLoading()})).catch((function(){n.pgReader.gotoAnimation({animIndex:e.animIndex,animState:e.animState},t),n.hideLoading()})))):n.hide()}),20))}},{key:"previewDoc",value:function(e){if(this.pgReader){var t=e.boundary?e.boundary:this.app.camera.getContainerWorldRect(),n=e.ctx.canvas.width,r=e.ctx.canvas.height,a=this.boundary.w;if("fitDoc"===this.app.appConfig.previewMode&&!e.stream&&!e.toDataUrl)return this.pgReader.paintOnCanvas({ctx:e.ctx,pageIndex:e.animPageIndex,keepAnimState:e.keepAnimState});var i,o=[1,0,0,1,0,0];if(n/r>t.width/t.height){var s=r/n*a,u=t.width/t.height*s,c=u/a;o=[c,0,0,c,(a-u)/2,0]}else{o=[1,0,0,1,0,(r/n*a-t.height/t.width*a)/2]}var l=a/t.width;i=[l,0,0,l,(this.boundary.sx-t.centerX+t.width/2)*l,(this.boundary.sy-t.centerY+t.height/2)*l],this.pgReader.paintOnCanvas({ctx:e.ctx,pageIndex:e.animPageIndex,keepAnimState:e.keepAnimState,transforms:[o[0]*i[0],0,0,o[3]*i[3],o[4]+o[0]*i[4],o[5]+o[3]*i[5]]})}}}]),e}(),g=!1;t.default=h},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM1ODM4Mzk1MTM1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MTAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNDgwIDk2YTMyIDMyIDAgMCAxIDY0IDB2MTkyYTMyIDMyIDAgMCAxLTY0IDBWOTZ6IG0yNTAuNjI0IDYwLjY0YTMyIDMyIDAgMSAxIDUxLjc3NiAzNy42MzJsLTExMi44MzIgMTU1LjMyOGEzMiAzMiAwIDAgMS01MS44MDgtMzcuNjMybDExMi44NjQtMTU1LjMyOHogbTE2Ny4xMzYgMTk2LjM4NGEzMiAzMiAwIDEgMSAxOS43NzYgNjAuODY0bC0xODIuNjI0IDU5LjMyOGEzMiAzMiAwIDAgMS0xOS43NzYtNjAuODY0bDE4Mi42MjQtNTkuMzI4eiBtMTkuNzc2IDI1Ny4wODhhMzIgMzIgMCAxIDEtMTkuNzc2IDYwLjg2NGwtMTgyLjYyNC01OS4zMjhhMzIgMzIgMCAwIDEgMTkuNzc2LTYwLjg2NGwxODIuNjI0IDU5LjMyOHpNNzgyLjQgODI5Ljc2YTMyIDMyIDAgMCAxLTUxLjc3NiAzNy42MzJsLTExMi44NjQtMTU1LjMyOGEzMiAzMiAwIDEgMSA1MS44MDgtMzcuNjMybDExMi44MzIgMTU1LjMyOHpNNTQ0IDkyOGEzMiAzMiAwIDAgMS02NCAwdi0xOTJhMzIgMzIgMCAwIDEgNjQgMHYxOTJ6IG0tMjUwLjYyNC02MC42NGEzMiAzMiAwIDAgMS01MS43NzYtMzcuNjMybDExMi44MzItMTU1LjMyOGEzMiAzMiAwIDAgMSA1MS44MDggMzcuNjMybC0xMTIuODY0IDE1NS4zMjh6IG0tMTY3LjEzNi0xOTYuMzg0YTMyIDMyIDAgMSAxLTE5Ljc3Ni02MC44NjRsMTgyLjYyNC01OS4zMjhhMzIgMzIgMCAwIDEgMTkuNzc2IDYwLjg2NGwtMTgyLjYyNCA1OS4zMjh6IG0tMTkuNzc2LTI1Ny4wODhhMzIgMzIgMCAwIDEgMTkuNzc2LTYwLjg2NGwxODIuNjI0IDU5LjMyOGEzMiAzMiAwIDEgMS0xOS43NzYgNjAuODY0bC0xODIuNjI0LTU5LjMyOHpNMjQxLjYgMTk0LjI0YTMyIDMyIDAgMSAxIDUxLjc3Ni0zNy42MzJsMTEyLjg2NCAxNTUuMzI4YTMyIDMyIDAgMSAxLTUxLjgwOCAzNy42MzJMMjQxLjYgMTk0LjI0eiIgcC1pZD0iMjkxMSIgZmlsbD0iIzJjMmMyYyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=w(n(5)),a=w(n(9)),i=w(n(19)),o=w(n(14)),s=w(n(31)),u=w(n(0)),c=w(n(1)),l=w(n(216)),d=n(54),f=n(133),p=n(331),h=n(219),g=n(332),v=n(96),y=n(98),m=n(29),b=w(n(32));function w(e){return e&&e.__esModule?e:{default:e}}var _=0,x=function(){function e(t,n){var r=this;(0,u.default)(this,e),this.executedClientIdSet=new s.default,this.currIndex="whiteboard",this.isReceivingBatchSnapshots=!1,this.boards={},this.pkgIdOpIdMap={},this.pageToRefresh=void 0,this.pageToIncRefresh=void 0,this.opIdSnapshotMap={},this.boardsSnapshotIds=[],this.globalSnapshotIds=[],this.boardOps={},this.delayedSnaps=[],this.mergeFailCache={},this._startRefreshLoop2=function(){cancelAnimationFrame(r.refreshAnimationTimer);try{r.refreshAnimationTimer=requestAnimationFrame((function(){return r._startRefreshLoop2()}))}catch(e){_<10&&(_+=1,r.logger.error("[白板] requestAnimationFrame error")),(0,g.polyfillRaf)(),r._startRefreshLoop()}r.pageToRefresh&&r.pageToRefresh===r.currBoard.currPage&&(r.currBoard.currPage.refresh(),r.pageToRefresh=void 0),r.pageToIncRefresh&&r.pageToIncRefresh===r.currBoard.currPage&&(r.currBoard.currPage.incRefresh(),r.pageToIncRefresh=void 0),r.currBoard.currPage.refreshOnStreamCanvas()},this.app=t,this.dataHub=n,this._init()}return(0,c.default)(e,[{key:"getBoardSnapshots",value:function(){var e=this;return this.boardsSnapshotIds.map((function(t){return e.opIdSnapshotMap[t]})).filter((function(e){return"goto"!==e.snapshot.data.action}))}},{key:"getBoardDisplayNames",value:function(){var e=this;return(0,o.default)(this.boards).map((function(t){return e.boards[t].displayName}))}},{key:"getPageWithFallback",value:function(e,t){e=void 0===e?this.currBoard.boardName:e;var n=this.boards[e],r=void 0;if(n){if(r=void 0===t?n.pages[n.currIndex]:n.pages[t])return r;this.logger.warn("[白板] getPageWithFallback 找不到boardName为"+e+"，pageName为"+t+"的白板页")}else this.logger.warn("[白板] getPageWithFallback 找不到boardName为"+e+"的文档")}},{key:"getPage",value:function(e,t){var n=this.boards[e];if(!n)return this.app.dataReportUtil("v3_run_error",{error:{code:y.DataReportRunError.Board_Lost,message:(0,i.default)({snaps:this.getBoardSnapshots(),board:e,page:t})}}),void this.logger.warn("[白板] getPage: 找不到名字为"+e+"的白板，当前房间白板列表为: "+(0,o.default)(this.app.room.boards).join(","));var r=n.pages[t];return r||(this.app.dataReportUtil("v3_run_error",{error:{code:y.DataReportRunError.Page_Lost,message:(0,i.default)({snaps:n.getPageSnapshots(),board:e,page:t})}}),void this.logger.warn("[白板] getPage: 找不到boardName: "+e+", pageName: "+t+"的白板页，当前房间白板页码为: "+n.pageNames.join(",")))}},{key:"getPageByBoardNameAndIndex",value:function(e,t){var n=this.boards[e];if(n){var r=n.pageNames[t];if(r){if(n.pages[r])return n.pages[r];this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到找不到boardName: "+e+", pageName: "+r+"的的白板页，当前房间白板页码为: "+n.pageNames.join(","))}else this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到找不到boardName: "+e+", pageIndex: "+t+"的的白板页，当前房间白板页码为: "+n.pageNames.join(","))}else this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到名字为"+e+"的白板，当前房间白板列表为: "+(0,o.default)(this.app.room.boards).join(","))}},{key:"getPageNameFromIndex",value:function(e,t){if(void 0!==t){e=e||this.currBoard.boardName;var n=this.getPageByBoardNameAndIndex(e,t);return null==n?void 0:n.pageIndex}}},{key:"recoverFullSnapshot",value:function(e){var t=this.opIdSnapshotMap[e.opId]&&this.opIdSnapshotMap[e.opId].snapshot.data.type,n=e.data.type;if(t&&n)return this.app.opsManager.mergePartial(this.opIdSnapshotMap[e.opId].snapshot,e);if(n){var r=this.mergeFailCache[e.opId],i=e;if(r){var o=!0,s=!1,u=void 0;try{for(var c,l=(0,a.default)(r);!(o=(c=l.next()).done);o=!0){var d=c.value;i=this.app.opsManager.mergePartial(i,d)}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}delete this.mergeFailCache[e.opId]}return i}return t?(delete this.mergeFailCache[e.opId],this.app.opsManager.mergePartial(this.opIdSnapshotMap[e.opId].snapshot,e)):(this.mergeFailCache[e.opId]=this.mergeFailCache[e.opId]||[],this.mergeFailCache[e.opId].push(e),e)}},{key:"reset",value:function(){var e,t,n;v.LOG&&this.logger.log("[白板]","room.reset"),this._init(),null===(t=null===(e=this.currBoard)||void 0===e?void 0:e.currPage)||void 0===t||t.cleanNonCanvasElements(),this.pageToRefresh=null===(n=this.currBoard)||void 0===n?void 0:n.currPage}},{key:"beginReceiveBatchSnapshots",value:function(e){this.batchSource=e,this.isReceivingBatchSnapshots=!0}},{key:"endReceiveBatchSnapshots",value:function(e,t,n){var r,a,i,o=this;if(this.batchSource=void 0,this.isReceivingBatchSnapshots=!1,this.currBoard.currPage.calcDrawOpQueue(),e.length>0){var s=e[e.length-1];s.boundary.width>0&&s.boundary.height>0?s.animate?(0,f.transitionToCameraBound)(this.app.camera,s.boundary,(function(){var e;null===(e=o.app.previewFactory)||void 0===e||e.refreshPreviewsOfCurrBoard(),"function"==typeof n&&n(!0)})):((0,f.stopTransitionToCameraBound)(),this.app.camera.setCameraBound(s.boundary),null===(r=this.app.previewFactory)||void 0===r||r.refreshPreviewsOfCurrBoard(),"function"==typeof n&&n(!0)):"function"==typeof n&&n(!1)}else this.pageToRefresh=this.currBoard.currPage,t?null===(a=this.app.previewFactory)||void 0===a||a.refreshPreviewsOfCurrBoard():null===(i=this.app.previewFactory)||void 0===i||i.refreshPreviewsOfCurrPage(),"function"==typeof n&&n(!1)}},{key:"dispatch",value:function(e){var t=-1!==d.cameraSnapshotTypes.indexOf(e.data.type);if("camera-bound"!==e.data.type||e.data.boundary.width&&e.data.boundary.height){if(!this.app.editable&&!t){if(this.app.isRecordPlayer)return;if(!this.app.editEnabled)return this.logger.error("[白板] 请设置enableDraw(true)后，再修改白板");if((0,h.shouldCacheSnapshot)(e)){this.logger.log("[白板] 白板恢复后会上传数据: "+e.data.type);var n=e.data.type,r="文档";return"video"===n?r="视频":"audio"===n?r="音频":"image"===n&&(r="图片"),(0,m.showToast)({time:30,type:"warn",msg:"目前网络不稳定，若30s内恢复网络，将自动添加"+r,msgType:b.default.SYNCHRONIZING,args:{name:r}}),void this.delayedSnaps.push({snap:e,time:Date.now()})}if(!this.app.isConnected)return this.logger.error("[白板] 请在joinRoom时监听onconnected, 等待网络恢复后再修改白板");if(this.dataHub.isSynchronizing)return this.logger.error("[白板] 请在joinRoom时监听onSyncFinish，等待同步结束后再修改白板")}if(this.dataHub.isSynchronizing)this.logger.error("请等待同步结束后再修改白板");else{var a=this.dataHub.sendSnapshot(e);this.execSnapshot({snapshot:e,pkgId:a})}}else this.logger.warn("[白板] error, dispatch camera-bound的宽高无效",(0,i.default)(e.data))}},{key:"execCachedSnapshots",value:function(e){var t=(0,o.default)(e.pkgIdOpIdMap).map((function(e){return Number(e)})).sort((function(e,t){return e-t})),n=[],r=!0,i=!1,s=void 0;try{for(var u,c=(0,a.default)(t);!(r=(u=c.next()).done);r=!0){var l=u.value;if(Number(l)<=e.lastConfirmId){var d=e.pkgIdOpIdMap[l],f=!0,p=!1,h=void 0;try{for(var g,v=(0,a.default)(d);!(f=(g=v.next()).done);f=!0){var y=g.value;n.push(e.opIdSnapshotMap[y])}}catch(e){p=!0,h=e}finally{try{!f&&v.return&&v.return()}finally{if(p)throw h}}}}}catch(e){i=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw s}}this.execBatchSnapshots(n,"sync")}},{key:"getCachedTil",value:function(e){for(var t=(0,o.default)(this.pkgIdOpIdMap).map((function(e){return Number(e)})).sort((function(e,t){return e-t})),n=t.length-1;n>=0;n--)if(t[n]<=e)return t[n];return-1}},{key:"executeDelayedSnaps",value:function(){if(this.app.editEnabled)for(;this.delayedSnaps.length>0;){var e=this.delayedSnaps.shift(),t=Date.now();t-e.time<3e4&&(e.snap.time=t,this.dispatch(e.snap))}else this.delayedSnaps=[]}},{key:"execSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromBatch:!1,batchSource:"data"},n=(0,r.default)((0,r.default)({},e),{snapshot:this.recoverFullSnapshot(e.snapshot)});t.fromBatch||(this.cacheSnapshot(n,!0),this.pushSnapshotToQueue(n));var a=n.snapshot;if("inPageOp"===a.category){var i=this.getPage(a.board,a.page.toString());i&&i.addOpInPage(a)}else if("pageOp"===a.category){var o=this.boards[a.board];o&&o.addOpInBoard(a)}else"globalOp"===a.category?(0,p.addGlobalOp)(this,a):(0,p.addOpInRoom)(this,a,{fromBatch:t.fromBatch&&"data"!==t.batchSource})}},{key:"execBatchSnapshots",value:function(e,t,n){var i=this,o=e.map((function(e){var t=(0,r.default)((0,r.default)({},e),{snapshot:i.recoverFullSnapshot(e.snapshot)});return i.pushSnapshotToQueue(t),i.cacheSnapshot(t,!0),t})),s=0===o.filter((function(e){return"inPageOp"!==e.snapshot.category})).length,u=o.filter((function(e){return"boardOp"===e.snapshot.category})).length>0,c=o.filter((function(e){return"globalOp"===e.snapshot.category&&"camera-bound"===e.snapshot.data.type})).map((function(e){return{animate:e.snapshot.data.animate,boundary:(0,h.getCameraBoundFromGlobalOp)(i,e.snapshot)}})).filter((function(e){return e.boundary})),l=o.filter((function(e){return"globalOp"!==e.snapshot.category||"camera-bound"!==e.snapshot.data.type}));if(s){var d=!1;l.forEach((function(e){var t=e.snapshot,n=i.getPage(t.board,t.page.toString());n&&(d=n.addOpInPage(t,!1)||d)})),d?this.endReceiveBatchSnapshots([],!1,n):"function"==typeof n&&n(!1)}else{this.beginReceiveBatchSnapshots(t);try{var f=!0,p=!1,g=void 0;try{for(var v,y=(0,a.default)(l);!(f=(v=y.next()).done);f=!0){var m=v.value;this.execSnapshot(m,{fromBatch:!0,batchSource:t})}}catch(e){p=!0,g=e}finally{try{!f&&y.return&&y.return()}finally{if(p)throw g}}this.endReceiveBatchSnapshots(c,u,n)}catch(e){this.logger.error("[白板] error",e),this.endReceiveBatchSnapshots(c,u,n)}}}},{key:"cacheOrExecAckPkg",value:function(e,t){var n=this.pkgIdOpIdMap[e.pkgId],r=this.pkgIdOpIdMap[t];n&&-1!==n.indexOf(e.snapshot.opId)||r&&-1!==r.indexOf(e.snapshot.opId)?this.cacheSnapshot(e):this.execSnapshot(e)}},{key:"cacheSnapshot",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.snapshot.opId,a=e.pkgId;if(this.opIdSnapshotMap[r]){n||(e.snapshot=this.recoverFullSnapshot(e.snapshot));var i=this.opIdSnapshotMap[r].pkgId,o=this.pkgIdOpIdMap[i].indexOf(r);this.pkgIdOpIdMap[i].splice(o,1),0===this.pkgIdOpIdMap[i].length&&delete this.pkgIdOpIdMap[i]}this.opIdSnapshotMap[r]=e,(t=this.pkgIdOpIdMap)[a]||(t[a]=[]),this.pkgIdOpIdMap[a].push(r)}},{key:"pushSnapshotToQueue",value:function(e){var t,n,r=e.snapshot.category,a=e.snapshot.opId,i=e.pkgId;if("globalOp"===r)this._pushSnapshotInArray(a,i,this.globalSnapshotIds);else if("boardOp"===r)this._pushSnapshotInArray(a,i,this.boardsSnapshotIds);else if("pageOp"===e.snapshot.category){var o=e.snapshot.board;this.boardOps.hasOwnProperty(o)||(this.boardOps[o]={pageSnapshotIds:[],pages:{}}),(t=this.boardOps[o]).pageSnapshotIds||(t.pageSnapshotIds=[]),this._pushSnapshotInArray(a,i,this.boardOps[o].pageSnapshotIds)}else if("inPageOp"===e.snapshot.category){var s=e.snapshot.board,u=e.snapshot.page;this.boardOps.hasOwnProperty(s)||(this.boardOps[s]={pageSnapshotIds:[],pages:{}}),this.boardOps[s].pages.hasOwnProperty(u)||(this.boardOps[s].pages[u]={inPageSnapshotIds:[]}),(n=this.boardOps[s].pages[u]).inPageSnapshotIds||(n.inPageSnapshotIds=[]),this._pushSnapshotInArray(a,i,this.boardOps[s].pages[u].inPageSnapshotIds)}}},{key:"_pushSnapshotInArray",value:function(e,t,n){var r=n.indexOf(e);-1!==r&&n.splice(r,1);for(var a=n.length;a>=0;a--){if(0===a){n.splice(a,0,e);break}if(this.opIdSnapshotMap[n[a-1]].pkgId<=t){n.splice(a,0,e);break}}}},{key:"mergeDebouncedData",value:function(e,t){if("snapshot"!==t&&e.length>0)return e[e.length-1];if("snapshot"!==t)throw new Error("[白板] mergeDebounceData, dataArr is empty!!");var n={},r=!0,i=!1,s=void 0;try{for(var u,c=(0,a.default)(e);!(r=(u=c.next()).done);r=!0){var l=u.value;"vision"===l.type?n.vision=l:n.hasOwnProperty(l.value.opId)?l.value.hasOwnProperty("category")?n[l.value.opId]=l.value:n[l.value.opId].hasOwnProperty("category")?n[l.value.opId]=this.app.opsManager.mergePartial(n[l.value.opId],l.value):n[l.value.opId]=this.app.opsManager.mergeTwoPartial(n[l.value.opId],l.value):n[l.value.opId]=l.value}}catch(e){i=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw s}}return 1===(0,o.default)(n).length?{type:"snapshot",value:(0,o.default)(n).map((function(e){return n[e]}))[0]}:{type:"snapshotArr",value:(0,o.default)(n).map((function(e){return n[e]}))}}},{key:"_init",value:function(){var e=new l.default(this.app,"whiteboard","whiteboard");this.boards={whiteboard:e},this.currIndex="whiteboard",this.pkgIdOpIdMap={},this.opIdSnapshotMap={},this.boardsSnapshotIds=[],this.globalSnapshotIds=[],this.boardOps={},this.mergeFailCache={},this.executedClientIdSet.clear(),this._startRefreshLoop()}},{key:"_startRefreshLoop",value:function(){cancelAnimationFrame(this.refreshAnimationTimer),this._startRefreshLoop2()}},{key:"refresh",value:function(){this.pageToRefresh=this.currBoard.currPage}},{key:"currBoard",get:function(){return this.boards[this.currIndex]}},{key:"logger",get:function(){return this.app.logger}}]),e}();t.default=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawInProgressSnapshots=t.refresh=t.refreshOnStreamCanvas=t.cleanNonCanvasElements=void 0;var r=s(n(9)),a=s(n(14)),i=n(100),o=n(104);function s(e){return e&&e.__esModule?e:{default:e}}t.cleanNonCanvasElements=function(e){var t,n,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=(0,a.default)(e.drawOpQueue);if(e.app.container&&e.app.container.imageEl)for(var o=e.app.container.imageEl.children,s=Array.prototype.slice.apply(o),u=0;u<s.length;u++){var c=s[u],l=c.id;-1===i.indexOf(l)&&(null===(t=null==c?void 0:c.parentNode)||void 0===t||t.removeChild(c))}e.app.container&&e.app.container.domEl&&(e.app.container.domEl.innerHTML=""),r&&e.app.container&&e.app.container.backgroundEl&&(e.app.container.backgroundEl.innerHTML="");for(var d=Array.prototype.slice.apply(e.app.container.el.getElementsByClassName("neteaseyunxin-wb-media-container")),f=0;f<d.length;f++){var p=d[f],h=p.id;-1===i.indexOf(h)&&(null===(n=null==p?void 0:p.parentNode)||void 0===n||n.removeChild(p))}},t.refreshOnStreamCanvas=function(e){var t=e.app.container.streamCtx;if(t){if(t.save(),(0,o.clearCtx)(t),t.fillStyle=e.app.appConfig.canvasBgColor,(0,o.fillCtx)(t),e.app.bgRenderContainer&&e.app.bgRenderContainer({width:e.app.container.width,height:e.app.container.height,DPI:i.DPI,zoom:e.app.camera.zoomFactor,ctx:t}),e.app.camera.convertPreviewCanvas(t),e.app.bgRenderWorld){var n=e.app.camera.getContainerWorldRect();e.app.bgRenderWorld({width:e.app.container.width,height:e.app.container.height,DPI:i.DPI,rect:n,zoom:e.app.camera.zoomFactor,ctx:t})}if(e.backgroundSnapshot)e.opsManager.preview(e.backgroundSnapshot,t,{page:e,supportToDataUrl:!0});else{var s=e.getBoard(),c=e.getAnimPageIndex();null!==c&&s.previewDoc({ctx:t,animPageIndex:c,keepAnimState:!0,stream:!0})}var l=(0,a.default)(e.drawOpQueue);l=l.sort((function(t,n){return"image"===e.drawOpQueue[t].data.type&&"image"!==e.drawOpQueue[n].data.type?-1:"image"!==e.drawOpQueue[t].data.type&&"image"===e.drawOpQueue[n].data.type||"text"===e.drawOpQueue[t].data.type&&"text"!==e.drawOpQueue[n].data.type?1:"text"!==e.drawOpQueue[t].data.type&&"text"===e.drawOpQueue[n].data.type?-1:0}));var d=!0,f=!1,p=void 0;try{for(var h,g=(0,r.default)(l);!(d=(h=g.next()).done);d=!0){var v=h.value;e.opsManager.preview(e.drawOpQueue[v],t,{page:e,supportToDataUrl:!0})}}catch(e){f=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(f)throw p}}for(var y in u(e,t),e.lastLaserOfUser){var m=e.lastLaserOfUser[y];e.opsManager.preview(m,t,{page:e,supportToDataUrl:!0})}t.restore()}},t.refresh=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.ctx,s=t.preview;n||(n=e.ctx);var l=s?n:e.frontCtx,d=s?n:e.bgCtx,f=!s||!t.supportToDataUrl&&e.app.appConfig.previewCustomBg||t.supportToDataUrl&&t.exportCustomBg;if(e.opsManager.hooks.refresh.call(),n.save(),e.bgCtx.save(),(0,o.clearCtx)(n),(0,o.clearCtx)(d),s&&(d.fillStyle=e.app.appConfig.canvasBgColor,(0,o.fillCtx)(d)),e.app.bgRenderContainer&&f){var p=e.app.container.width,h=e.app.container.height;t.supportToDataUrl&&t.boundary&&(p=d.canvas.width,h=d.canvas.height),e.app.bgRenderContainer({width:p,height:h,DPI:i.DPI,zoom:e.app.camera.zoomFactor,ctx:d})}if(s?t.boundary?e.app.camera.convertPreviewCanvas(n,t.boundary):e.app.camera.convertPreviewCanvas(n):(e.app.camera.convertCanvas(n),e.app.camera.convertCanvas(e.bgCtx)),e.app.bgRenderWorld&&f){var g=e.app.camera.getContainerWorldRect(),v=e.app.camera.zoomFactor,y=t.supportToDataUrl&&t.boundary?t.boundary:g;v*=t.supportToDataUrl&&t.boundary?g.width/t.boundary.width:1,e.app.bgRenderWorld({width:e.app.container.width,height:e.app.container.height,DPI:i.DPI,rect:y,zoom:v,ctx:d})}if(!s&&e.getBoard()&&e.getBoard().updateDocClipPath(),s||(l.save(),e.laserCtx.save(),(0,o.clearCtx)(l),(0,o.clearCtx)(e.laserCtx),e.app.camera.convertCanvas(l),e.app.camera.convertCanvas(e.laserCtx)),e.backgroundSnapshot&&!s?e.opsManager.draw(e.backgroundSnapshot,n,{div:e.app.container.backgroundEl,page:e}):e.backgroundSnapshot&&e.opsManager.preview(e.backgroundSnapshot,n,{page:e,supportToDataUrl:t.supportToDataUrl}),s){var m=e.getBoard(),b=e.getAnimPageIndex();null!==b&&(n.save(),m.previewDoc({ctx:n,animPageIndex:b,keepAnimState:t.supportToDataUrl,toDataUrl:t.supportToDataUrl,boundary:t.boundary}),n.restore())}if(s&&t.omitSelection||u(e,l),s){var w=(0,a.default)(e.drawOpQueue);w=w.sort((function(t,n){return"image"===e.drawOpQueue[t].data.type&&"image"!==e.drawOpQueue[n].data.type?-1:"image"!==e.drawOpQueue[t].data.type&&"image"===e.drawOpQueue[n].data.type||"text"===e.drawOpQueue[t].data.type&&"text"!==e.drawOpQueue[n].data.type?1:"text"!==e.drawOpQueue[t].data.type&&"text"===e.drawOpQueue[n].data.type?-1:0}));var _=!0,x=!1,k=void 0;try{for(var M,S=(0,r.default)(w);!(_=(M=S.next()).done);_=!0){var T=M.value;e.opsManager.preview(e.drawOpQueue[T],n,{page:e,supportToDataUrl:t.supportToDataUrl})}}catch(e){x=!0,k=e}finally{try{!_&&S.return&&S.return()}finally{if(x)throw k}}}else{for(var I in e.drawOpQueue){var O="image"===e.drawOpQueue[I].data.type?e.app.container.imageEl:e.app.container.domEl;e.opsManager.draw(e.drawOpQueue[I],n,{div:O,page:e})}for(var P in e.hiddenOpQueue){var E="image"===e.hiddenOpQueue[P].data.type?e.app.container.imageEl:e.app.container.domEl;e.opsManager.hide(e.hiddenOpQueue[P],n,E)}}if(!s)for(var C in c(e,e.laserCtx),e.lastLaserOfUser){var N=e.lastLaserOfUser[C];e.opsManager.draw(N,e.laserCtx)}n.restore(),e.frontCtx.restore(),e.bgCtx.restore(),s||e.laserCtx.restore()},t.drawInProgressSnapshots=function(e){e.laserCtx.save(),e.frontCtx.save(),(0,o.clearCtx)(e.laserCtx),(0,o.clearCtx)(e.frontCtx),e.app.camera.convertCanvas(e.laserCtx),e.app.camera.convertCanvas(e.frontCtx),(0,a.default)(e.lastInProgressSnapshotOfUser).map((function(t){return e.lastInProgressSnapshotOfUser[t]})).sort((function(e,t){return e.beginAt-t.beginAt})).forEach((function(t){var n="laser"===t.snapshot.data.type?e.laserCtx:e.frontCtx;e.opsManager.draw(t.snapshot,n,{div:e.app.container.domEl,page:e})})),u(e,e.frontCtx),c(e,e.laserCtx),e.laserCtx.restore(),e.frontCtx.restore()};var u=function(e,t){for(var n in e.lastSelectOfUser)e.opsManager.draw(e.lastSelectOfUser[n],t);for(var r in e.lastInProgressSelectOfUser)e.opsManager.draw(e.lastInProgressSelectOfUser[r],t)},c=function(e,t){for(var n in e.lastMousePointerOfUser){var r=e.lastMousePointerOfUser[n];e.opsManager.draw(r,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calcDrawOpQueue=void 0;var r=s(n(9)),a=s(n(31)),i=n(54),o=n(104);function s(e){return e&&e.__esModule?e:{default:e}}var u=new a.default,c=(t.calcDrawOpQueue=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.drawOpQueue={},e.hiddenOpQueue={};var n=p(e,e.opQueue),r=n.normalQueue,a=n.abNormalQueue,i=h(e,r),o=g(e,i),s=v(e,o);c(e,a),l(e,s),t||d(e)},function(e,t){for(var n=0;n<t.length;n++){var r=t[n];"select"===r.data.type?r.data.inProgress?e.lastInProgressSelectOfUser[r.uid]=r:(delete e.lastInProgressSelectOfUser[r.uid],e.lastSelectOfUser[r.uid]=r):"mouse-pointer"===r.data.type?e.lastMousePointerOfUser[r.uid]=r:"laser"===r.data.type&&(e.lastLaserOfUser[r.uid]=r)}}),l=function(e,t){var n={},a=[],i=!0,o=!1,s=void 0;try{for(var c,l=(0,r.default)(t);!(i=(c=l.next()).done);i=!0){var d=c.value;if(e.lastInProgressSelectOfUser={},Array.isArray(d.data.dependOn)){var p=!0,h=!1,g=void 0;try{for(var v,m=(0,r.default)(d.data.dependOn);!(p=(v=m.next()).done);p=!0){var b=v.value;n.hasOwnProperty(b)?(a.push(b),n[b].push(d)):u.has(b)||(u.add(b),e.logger.warn("[白板]","miss op",n,d,b,t))}}catch(e){h=!0,g=e}finally{try{!p&&m.return&&m.return()}finally{if(h)throw g}}}else"string"==typeof d.data.dependOn?n.hasOwnProperty(d.data.dependOn)?(a.push(d.data.dependOn),n[d.data.dependOn].push(d)):u.has(d.data.dependOn)||(u.add(d.data.dependOn),e.logger.warn("[白板]","miss op",n,d,d.data.dependOn,t)):n[d.opId]=[d]}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}for(var w in y(e,a),n){var _=f(e,w,n);_.data.hidden?e.hiddenOpQueue[w]=_:e.drawOpQueue[w]=_}},d=function(e){if(e.app.room.currBoard.currPage===e){var t=(0,o.getSelectedOpIds)(e);e.opsManager.selectOp.setSelectedOpIds(t);var n=e.lastInProgressSelectOfUser[e.app.account];n?e.opsManager.selectOp.setInProgressSelectedOpIds(n.data.selectedOpIds):e.opsManager.selectOp.setInProgressSelectedOpIds([])}},f=function(e,t,n){for(var r=n[t][0],a=1;a<n[t].length;a++)r=(0,o.transformOp)(e,r,n[t][a]);return r},p=function(e,t){var n=[],a=[],o=!0,s=!1,u=void 0;try{for(var c,l=(0,r.default)(t);!(o=(c=l.next()).done);o=!0){var d=c.value;-1!==i.snapshotOutOfNormalFlowTypes.indexOf(d.data.type)?a.push(d):n.push(d)}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}return{normalQueue:n,abNormalQueue:a}},h=function(e,t){for(var n=t.slice(),r=n.length-1;r>=0;r--){var a=n[r];if("undo"===a.data.type||"redo"===a.data.type)for(var i=a.data.undoOpId||a.data.redoOpId,o=r-1;o>=0;o--)n[o].opId===i&&(n.splice(r,1),n.splice(o,1),r--)}return n},g=function(e,t){for(var n=t.slice(),r=n.length-1;r>=0;r--){if("clear"===n[r].data.type)return y(e,n.slice(0,r+1).map((function(e){return e.opId}))),n=n.slice(r+1)}return n},v=function(e,t){for(var n=[],r=0;r<t.length;r++){var a=t[r];"duplicate"===a.data.type?n=n.concat(a.data.duplicates):n.push(t[r])}return n},y=function(e,t){for(var n in e.lastInProgressSnapshotOfUser){var r=e.lastInProgressSnapshotOfUser[n];-1!==t.indexOf(r.snapshot.opId)&&delete e.lastInProgressSnapshotOfUser[n]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addIncrementSnapshot=void 0;var r=n(54),a=n(104),i=(t.addIncrementSnapshot=function(e,t){"text"===t.data.type?i(e,t):o(e,t)},function(e,t){if(e.boardName===e.app.room.currIndex&&e.pageIndex===e.app.room.currBoard.currIndex.toString()){if(t.data.dependOn){var n=t.data.dependOn,r=e.drawOpQueue[n];r&&(r=(0,a.transformOp)(e,r,t),e.drawOpQueue[n]=r,s(e,r))}else e.drawOpQueue[t.opId]=t,s(e,t);e.app.room.pageToIncRefresh=e}}),o=function(e,t){s(e,t),e.boardName===e.app.room.currIndex&&e.pageIndex===e.app.room.currBoard.currIndex.toString()&&(-1===r.snapshotOutOfNormalFlowTypes.indexOf(t.data.type)?e.drawOpQueue[t.opId]=t:"laser"===t.data.type&&(e.lastLaserOfUser[t.uid]=t),e.app.room.pageToIncRefresh=e)},s=function(e,t){"select"===t.data.type?t.data.inProgress&&(e.lastInProgressSelectOfUser[t.uid]=t):"mouse-pointer"===t.data.type?e.lastMousePointerOfUser[t.uid]=t:e.lastInProgressSnapshotOfUser.hasOwnProperty(t.uid)&&e.lastInProgressSnapshotOfUser[t.uid].snapshot.opId===t.opId?e.lastInProgressSnapshotOfUser[t.uid]={snapshot:t,beginAt:e.lastInProgressSnapshotOfUser[t.uid].beginAt}:e.lastInProgressSnapshotOfUser[t.uid]={snapshot:t,beginAt:Date.now()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gotoBoard=t.addTransDocBoard=t.addBoard=t.deleteBoard=t.addOpInRoom=t.addGlobalOp=void 0;var r=u(n(14)),a=n(133),i=u(n(216)),o=n(218),s=n(219);function u(e){return e&&e.__esModule?e:{default:e}}t.addGlobalOp=function(e,t){var n,r=e.app.camera,i=(0,s.getCameraBoundFromGlobalOp)(e,t);i&&(t.data.animate?(0,a.transitionToCameraBound)(r,i,(function(){var t;null===(t=e.app.previewFactory)||void 0===t||t.refreshPreviewsOfCurrBoard()})):((0,a.stopTransitionToCameraBound)(),e.app.camera.setCameraBound(i),null===(n=e.app.previewFactory)||void 0===n||n.refreshPreviewsOfCurrBoard()))},t.addOpInRoom=function(e,t,n){var r,a=t.data,i=a.action,o=a.boardName,s=a.type;"goto"===i&&f(e,o,t),"delete"===i&&c(e,o,t),"add"===i&&l(e,o,t),"transDoc"===s&&("addTransDoc"===i&&d(e,o,t),e.boards[o].addTransDocOp(t,n)),e.app.opsManager.hooks.addOpHook.call(t,!0),"transDoc"===s&&"addTransDoc"!==i||null===(r=e.app.previewFactory)||void 0===r||r.refreshPreviewsOfCurrBoard()};var c=t.deleteBoard=function(e,t,n){if(e.boards.hasOwnProperty(t))if(1===(0,r.default)(e.boards).length)e.logger.error("[白板]","不能删除最后一个board");else{var a=(0,r.default)(e.boards),i=a.indexOf(t);delete e.boards[t];var u=i;i===a.length-1&&(u=i-1),e.currIndex=(0,r.default)(e.boards)[u];var c=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call(),(0,o.gotoPage)(c,c.currIndex,n),(0,s.fitToContentAfterBoardChange)(e)}else e.logger.error("[白板]","删除board:"+t+", 但是board不存在")},l=t.addBoard=function(e,t,n){var r=n.data.displayName?n.data.displayName:t;e.boards[t]=new i.default(e.app,t,r),e.currIndex=t;var a=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call();for(var u=1;u<n.data.pageCount;u++)(0,o.addPage)(a,void 0,n);if(n.data.tmpl)for(var c=0;c<n.data.pageCount;c++){a.pages[c].setBackgroundSnapshot({board:t,page:c,category:"inPageOp",opId:n.opId+"_"+c,time:n.time,uid:n.uid,data:{boundary:{sx:-n.data.w/2,sy:-n.data.h/2,w:n.data.w,h:n.data.h},url:n.data.tmpl.replace("{index}",n.data.offset+c),type:"background"}})}(0,o.gotoPage)(a,0,n),(0,s.fitToContentAfterBoardChange)(e)},d=t.addTransDocBoard=function(e,t,n){var r=n.data.displayName?n.data.displayName:t;e.boards[t]=new i.default(e.app,t,r),e.currIndex=t;var a=e.boards[e.currIndex];a.hasDoc=!0,e.app.opsManager.hooks.boardChange.call(),a.pages[0].setPayload({animPageIndex:0});for(var u=1;u<n.data.pageCount;u++)(0,o.addPage)(a,void 0,n,{animPageIndex:u});(0,o.gotoPage)(a,0,n),(0,s.fitToContentAfterBoardChange)(e)},f=t.gotoBoard=function(e,t,n){e.boards.hasOwnProperty(t)||(e.boards[t]=new i.default(e.app,t,t)),e.currIndex=t;var r=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call(),(0,o.gotoPage)(r,r.currIndex,n),(0,s.fitToContentAfterBoardChange)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.polyfillRaf=function(){var e=0;window.requestAnimationFrame=function(t,n){var r=window.performance.now(),a=Math.max(e+16,r);return setTimeout((function(){t(e=a)}),a-r)},window.cancelAnimationFrame=clearTimeout}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(n(9)),a=g(n(20)),i=g(n(5)),o=g(n(14)),s=g(n(19)),u=g(n(0)),c=g(n(1)),l=n(29),d=g(n(32)),f=n(334),p=n(98),h=n(215);function g(e){return e&&e.__esModule?e:{default:e}}var v=["select","select-hover","camera-bound","mouse-pointer","laser"],y=function(){function e(t,n){var r=this;(0,u.default)(this,e),this.incId=0,this.debounceData={},this.noAckData={},this.dataInResendQueue={},this.lastContinueServerPkgId=-1,this.serverPkgSinceLast=[],this.lastPkgIdToSync=-2,this.dataOfSync={},this.syncStartToLog=-1,this.syncEndToLog=-1,this.pkgInside=0,this.appliedPkgs={},this.isSynchronizing=!1,this.isFirstSync=!0,this.timerTrigger=requestAnimationFrame.bind(window),this._scheduleNextBroadcast=function(e,t){return r.timerTrigger((function(){(new Date).valueOf()-e.time<70?e.timer=r._scheduleNextBroadcast(e,t):r._doBroadcastData(e,t)}))},this._doBroadcastData=function(e,t){var n=r.app.room.mergeDebouncedData(e.dataQueue,t),a={strategy:"snapshot"===t?1:2,data:(0,s.default)(n),client_pkg_id:e.client_pkg_id};"snapshot"!==t&&(a.dataType=t),r.app.isConnected&&r.handler.broadcastData(a),r._shouldDataBeResendIfLost(n)&&r._pushDataToResendQueue(a),r.noAckData[a.client_pkg_id]={data:n,fakePkgId:e.fakePkgId},r.debounceData[t]={timer:null,client_pkg_id:-1,time:0,dataQueue:[],fakePkgId:-1}},this._checkResendQueue=function(){if(0===(0,o.default)(r.dataInResendQueue).length)r.resendTimer=null;else{var e=Date.now();for(var t in r.dataInResendQueue){if(r.dataInResendQueue[t].resendCount>=3)return r.logger.error("重发数据超过3次，停止重发该数据",(0,s.default)(r.dataInResendQueue[t].data)),r.app.dataReportUtil("v3_conn_error",{error:{code:p.DataReportConnError.Resend_Count_Exceed_Max,message:(0,s.default)(r.dataInResendQueue[t].data)}}),r._handleResendFail();e-r.dataInResendQueue[t].sendAt>2e3&&r.app.isConnected&&(r.handler.broadcastData(r.dataInResendQueue[t].data),r.dataInResendQueue[t]=(0,i.default)((0,i.default)({},r.dataInResendQueue[t]),{sendAt:Date.now(),resendCount:r.dataInResendQueue[t].resendCount+1}))}r.resendTimer=setTimeout(r._checkResendQueue,2e3)}},this._handleResendFail=function(){r.dataInResendQueue={};var e=r.room.getCachedTil(r.lastContinueServerPkgId),t=r.room.pkgIdOpIdMap,n=r.room.opIdSnapshotMap;r.app.resetState(),r.app.room.execCachedSnapshots({lastConfirmId:e,pkgIdOpIdMap:t,opIdSnapshotMap:n}),r.lastContinueServerPkgId=e,(0,l.showToast)({msg:"同步数据中...",time:1e3,type:"info",msgType:d.default.SYNCHRONIZING}),r.app.readyToSyncData()},this._setupResendSyncRequestTimer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;clearTimeout(r.resendSyncRequestTimer),r.resendSyncRequestTimer=setTimeout((function(){e<=8?(r.logger.error("[白板] 同步数据超时，第"+(e+1)+"次请求同步数据, "+r.lastContinueServerPkgId),r.handler.sendSyncRequest(r.lastContinueServerPkgId),r._setupResendSyncRequestTimer(e+1)):((0,l.showToast)({type:"error",msg:"无法同步数据，请检查你的网络",time:1e3,msgType:d.default.SYNC_FAIL}),r.app.dataReportUtil("v3_conn_error",{error:{code:p.DataReportConnError.Sync_Timeout,message:(0,s.default)({lastContinueServerPkgId:r.lastContinueServerPkgId,lastPkgIdToSync:r.lastPkgIdToSync})}}),r.logger.error("[白板] 多次同步数据失败"))}),1e4)},this.app=t,this.handler=n,this.randomSeed=(0,f.getRandomIntByStr)(9),this.incId=0,this.bindEvents()}return(0,c.default)(e,[{key:"destroy",value:function(){clearTimeout(this.resendSyncRequestTimer),clearTimeout(this.resendTimer),this.isSynchronizing=!1,void 0===(0,a.default)(this.visHandlerUnregist)&&(this.visHandlerUnregist(),this.visHandlerUnregist=void 0)}},{key:"reset",value:function(){for(var e in this.debounceData)this.debounceData[e].timer&&cancelAnimationFrame(this.debounceData[e].timer);this.debounceData={},this.lastContinueServerPkgId=-1,this.serverPkgSinceLast=[],this.lastPkgIdToSync=-2,this.dataOfSync={},this.appliedPkgs={},this.isSynchronizing=!1,this.randomSeed=(0,f.getRandomIntByStr)(9),this.incId=0,clearTimeout(this.resendSyncRequestTimer)}},{key:"bindEvents",value:function(){var e=this;this.handler.on("data",this.onData.bind(this)),this.handler.on("broadcastAck",this.onBroadcastAck.bind(this)),this.handler.on("syncRequestAck",this.onSendRequestAck.bind(this)),this.handler.on("syncRequestResponse",this.onSendRequestResponse.bind(this)),this.visHandlerUnregist=(0,h.registerVisibleChangeHandler)((function(){e.timerTrigger=requestAnimationFrame.bind(window)}),(function(){e.timerTrigger=setTimeout.bind(window)}))}},{key:"hasPkgBeenApplied",value:function(e,t){if(!t||!e)return!1;var n=this.getAppliedPkgKey(e,t);return this.appliedPkgs.hasOwnProperty(n)}},{key:"setPkgBeenApplied",value:function(e,t,n){if(t&&e){var r=this.getAppliedPkgKey(e,t);(!this.appliedPkgs.hasOwnProperty(r)||this.appliedPkgs[r]>n)&&(this.appliedPkgs[r]=n)}}},{key:"getAppliedPkgKey",value:function(e,t){return t.toString()+"_"+e.toString()}},{key:"onData",value:function(e){var t,n=e.data,r=e.server_pkg_id,a=e.client_pkg_id,i=e.source_uid;if(this._updateServerPkgInfo(r,r),this.isSynchronizing)this.dataOfSync[r]={data:n,client_pkg_id:a,source_uid:i};else{if(this.hasPkgBeenApplied(a,i))return;this.setPkgBeenApplied(a,i,r);var o=n.type,s=n.value;"snapshot"===o?this.room.execSnapshot({snapshot:s,pkgId:r}):"broadcaster"===o?this.app.vision.receiveBroadcaster(s):"alive"===o?null===(t=this.app.aliveManager)||void 0===t||t.receiveAlive(s):"snapshotArr"===o&&this.room.execBatchSnapshots(s.map((function(e){return{snapshot:e,pkgId:r}})),"data")}}},{key:"sendSyncRequest",value:function(){this.logger.log("[白板] 请求同步数据, 是否正在同步数据",this.isSynchronizing,"当前最后一个数据id",this.lastContinueServerPkgId),this.isSynchronizing||(this.isSynchronizing=!0,this.handler.sendSyncRequest(this.lastContinueServerPkgId),this.lastPkgIdToSync=-2,this.dataOfSync={},this._setupResendSyncRequestTimer())}},{key:"stopSyncRequest",value:function(){this.logger.log("白板--\x3e 终止同步数据, 是否正在同步数据",this.isSynchronizing),this.isSynchronizing=!1,clearTimeout(this.resendSyncRequestTimer)}},{key:"onSendRequestAck",value:function(e){this.lastPkgIdToSync=e.last_server_pkg_id,this.logger.log("[白板] 收到同步响应，需求同步到序列号: "+this.lastPkgIdToSync),this._updateAppAfterSync()}},{key:"onSendRequestResponse",value:function(e){var t=this;if(this.isSynchronizing){var n=e.start_server_pkg_id,a=e.end_server_pkg_id,i=e.packages;Array.isArray(i)||(i=[]),clearTimeout(this.syncLogTimer),-1!==this.syncEndToLog&&n!==this.syncEndToLog+1?(this.logger.warn("[白板] 收到同步数据不重叠。\n            \n之前同步数据为: "+this.syncStartToLog+"-"+this.syncEndToLog+", 共有"+this.pkgInside+"数据包\n            \n当前同步数据为: "+n+"-"+a+", 共有"+i.length+"数据包"),this.syncStartToLog=-1,this.syncEndToLog=-1,this.pkgInside=0):(this.syncStartToLog=-1===this.syncStartToLog?n:this.syncStartToLog,this.syncEndToLog=a,this.pkgInside=this.pkgInside+i.length,this.syncLogTimer=setTimeout((function(){t.logger.log("[白板] 收到同步数据: "+t.syncStartToLog+"-"+t.syncEndToLog+"。实际包括"+t.pkgInside+"个数据包"),t.syncStartToLog=-1,t.syncEndToLog=-1,t.pkgInside=0}),2e3));var o=!0,s=!1,u=void 0;try{for(var c,l=(0,r.default)(i);!(o=(c=l.next()).done);o=!0){var d=c.value;this.dataOfSync[d.server_pkg_id]={data:d.data,client_pkg_id:d.client_pkg_id,source_uid:d.source_uid}}}catch(e){s=!0,u=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}this._updateServerPkgInfo(n,a),this._updateAppAfterSync()}}},{key:"onBroadcastAck",value:function(e){var t=this,n=e.server_pkg_id,r=e.client_pkg_id;delete this.dataInResendQueue[r],this._updateServerPkgInfo(n,n);var a=this.noAckData[r].data,i=this.noAckData[r].fakePkgId;delete this.noAckData[r],a||this.logger.warn("[白板] broadcastAck, clientSeqId:"+r+"的数据不存在"),a&&"snapshot"===a.type?this.app.room.cacheOrExecAckPkg({pkgId:n,snapshot:a.value},i):a&&"snapshotArr"===a.type&&a.value.forEach((function(e){t.app.room.cacheOrExecAckPkg({pkgId:n,snapshot:e},i)}))}},{key:"sendSnapshot",value:function(e){return-1!==v.indexOf(e.data.type)?this.broadcastData({data:{type:"snapshot",value:e}},e.opId):this.broadcastData({data:{type:"snapshot",value:e}},"snapshot")}},{key:"broadcastRoomState",value:function(e,t){return this.broadcastData({data:{type:t,value:e}},t,!0)}},{key:"broadcastData",value:function(e,t,n){if(!this.debounceData.hasOwnProperty(t)||!this.debounceData[t].timer){var r=this.nextLocalFakeId,a=this.getNextClientPkgId();this.debounceData[t]={timer:null,time:(new Date).valueOf(),client_pkg_id:a,dataQueue:[],fakePkgId:r},this.noAckData[a]={data:void 0,fakePkgId:r}}var i=this.debounceData[t];return i.dataQueue.push(e.data),n?this._doBroadcastData(i,t):i.timer||(i.timer=this._scheduleNextBroadcast(i,t)),i.fakePkgId}},{key:"getNextClientPkgId",value:function(){return this.incId+=1,Number(this.randomSeed.toString()+this.incId.toString())}},{key:"_shouldDataBeResendIfLost",value:function(e){if("snapshot"===e.type){var t=e.value&&e.value.data&&e.value.data.type;return!t||-1===["select","select-hover","camera-bound"].indexOf(t)}return!0}},{key:"_pushDataToResendQueue",value:function(e){this.dataInResendQueue[e.client_pkg_id]={data:e,sendAt:Date.now(),resendCount:0},this.resendTimer||(clearTimeout(this.resendTimer),this.resendTimer=setTimeout(this._checkResendQueue,2e3))}},{key:"_updateAppAfterSync",value:function(){var e=this;if(-2!==this.lastPkgIdToSync&&(this.lastContinueServerPkgId>=this.lastPkgIdToSync&&clearTimeout(this.resendSyncRequestTimer),this.lastContinueServerPkgId>=this.lastPkgIdToSync&&this.isSynchronizing)){this.logger.log("[白板] 同步数据接收完毕: "+this.lastContinueServerPkgId+"--"+this.lastPkgIdToSync),this.isSynchronizing=!1,this.app.emit("event:editable:change",this.app.editable);var t=this._getDataToSync();this.dataOfSync={};for(var n=void 0,a=[],i=t.length-1;i>=0;i--)if("broadcaster"===t[i].data.type){n=t[i].data.value;break}for(var o=0;o<t.length;o++)"broadcaster"===t[o].data.type?n=t[o].data.value:"alive"===t[o].data.type&&a.push(t[o].data.value);var s=[],u=!0,c=!1,l=void 0;try{for(var d,f=(0,r.default)(t);!(u=(d=f.next()).done);u=!0){var p=d.value;if(this.dataInResendQueue.hasOwnProperty(p.client_pkg_id)&&delete this.dataInResendQueue[p.client_pkg_id],!this.hasPkgBeenApplied(p.client_pkg_id,p.source_uid))if(this.setPkgBeenApplied(p.client_pkg_id,p.source_uid,p.pkgId),"snapshot"===p.data.type)s.push({pkgId:p.pkgId,snapshot:p.data.value});else if("snapshotArr"===p.data.type){var h=!0,g=!1,v=void 0;try{for(var y,m=(0,r.default)(p.data.value);!(h=(y=m.next()).done);h=!0){var b=y.value;s.push({pkgId:p.pkgId,snapshot:b})}}catch(e){g=!0,v=e}finally{try{!h&&m.return&&m.return()}finally{if(g)throw v}}}}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}this.app.aliveManager.receiveSyncData(a),n&&this.app.vision.receiveBroadcasterAfterSync(n),setTimeout((function(){e.app.dispatcher.emit("event:sync_finished")}),0),this.app.room.execBatchSnapshots(s,"sync",(function(){if(e.isFirstSync){e.isFirstSync=!1;var t=e.app.vision.mode;if("follower"===t||"broadcaster"===t)return;e.app.defaultCameraBound?e.app.setCameraBound(e.app.defaultCameraBound,!1):e.app.hasBackground()||e.app.hasTransDoc()?e.app.fitToDoc(!1):e.app.zoomTo1AfterJoin?(e.app.fitToContent(!1),e.app.zoomTo(1,!1)):e.app.setCameraBound({centerX:0,centerY:0,width:1920,height:1080},!1)}else e.app.room.executeDelayedSnaps()}))}}},{key:"_getDataToSync",value:function(){var e=this;return(0,o.default)(this.dataOfSync).sort((function(e,t){return Number(e)-Number(t)})).map((function(t){try{var n=e.dataOfSync[t].data;return{data:n="object"===(void 0===n?"undefined":(0,a.default)(n))?n:JSON.parse(n),client_pkg_id:e.dataOfSync[t].client_pkg_id,source_uid:e.dataOfSync[t].source_uid,pkgId:Number(t)}}catch(e){return}})).filter((function(e){return e}))}},{key:"_updateServerPkgInfo",value:function(e,t){for(var n=0,r=e;n<=this.serverPkgSinceLast.length&&!(r>t);)if(r<=this.lastContinueServerPkgId)r++;else if(n===this.serverPkgSinceLast.length){for(var a,i=[];r<=t;)i.push(r),r+=1;(a=this.serverPkgSinceLast).splice.apply(a,[n,0].concat(i))}else this.serverPkgSinceLast[n]<r?n++:this.serverPkgSinceLast[n]===r?(r++,n++):(this.serverPkgSinceLast.splice(n,0,r),r++,n++);for(n=0;n<this.serverPkgSinceLast.length&&this.serverPkgSinceLast[n]===this.lastContinueServerPkgId+n+1;n++);this.lastContinueServerPkgId+=n,this.serverPkgSinceLast.splice(0,n)}},{key:"room",get:function(){return this.app.room}},{key:"logger",get:function(){return this.app.logger}},{key:"lastServerPkgId",get:function(){return this.serverPkgSinceLast.length>0?this.serverPkgSinceLast[this.serverPkgSinceLast.length-1]:this.lastContinueServerPkgId}},{key:"nextLocalFakeId",get:function(){var e=this,t=this.lastServerPkgId,n=(0,o.default)(this.noAckData).map((function(t){return Number(e.noAckData[t].fakePkgId)})).sort((function(e,t){return e-t}));return 0===n.length||t>=n[n.length-1]?t+1:n[n.length-1]+1}}]),e}();t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(335),i=(r=a)&&r.__esModule?r:{default:r};function o(e){var t="0123456789abcdefghijklmnopqrstuvwxyz!@#$%^&*()_+[]{}|/<>,./";return e?"0123456789"[Math.floor(Math.random()*"0123456789".length)]:t[Math.floor(Math.random()*t.length)]}t.getRandomIntByStr=function(e){var t=(n=function(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=(0,i.default)(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return function(){return n=(0,i.default)(n^n>>>16,2246822507),n=(0,i.default)(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}(function(e){for(var t="",n=0;n<e;n++)t+=o(!1);return t}(18))(),function(){var e=n+=1831565813;return e=(0,i.default)(e^e>>>15,1|e),((e^=e+(0,i.default)(e^e>>>7,61|e))^e>>>14)>>>0})().toString().slice(0,e);var n;if(t.length<e)for(var r=t.length;r<e;r++)t+=o(!0);return t}},function(e,t,n){e.exports={default:n(336),__esModule:!0}},function(e,t,n){n(337),e.exports=n(6).Math.imul},function(e,t,n){var r=n(8),a=Math.imul;r(r.S+r.F*n(28)((function(){return-5!=a(4294967295,5)||2!=a.length})),"Math",{imul:function(e,t){var n=+e,r=+t,a=65535&n,i=65535&r;return 0|a*i+((65535&n>>>16)*i+a*(65535&r>>>16)<<16>>>0)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(21)),a=d(n(9)),i=d(n(118)),o=d(n(95)),s=d(n(0)),u=d(n(1)),c=d(n(13)),l=n(100);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,r){return new(n||(n=c.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},p=function(){function e(t){(0,s.default)(this,e),this.previewContainerMap=new o.default,this.task=[],this.isLoopBusy=!1,this.visiblePages=[],this.app=t,this.app.opsManager.hooks.pageReady.tap("PageReadyPlugin",this.onPageReady.bind(this)),this.app.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this))}return(0,u.default)(e,[{key:"getPagePreviewCtx",value:function(e){return this.pagePreviewCtx&&this.pagePreviewCanvas||(this.pagePreviewCanvas=document.createElement("canvas"),this.pagePreviewCtx=this.pagePreviewCanvas.getContext("2d"),this.pagePreviewCanvas.style.visibility="hidden",this.pagePreviewCanvas.style.position="absolute",this.app.container.el.appendChild(this.pagePreviewCanvas)),e.width<8192&&e.height<8192?(this.pagePreviewCanvas.width=e.width,this.pagePreviewCanvas.height=e.height):e.width>e.height?(this.pagePreviewCanvas.width=8192,this.pagePreviewCanvas.height=Math.floor(8192*e.height/e.width)):(this.pagePreviewCanvas.height=8192,this.pagePreviewCanvas.width=Math.floor(8192*e.width/e.height)),this.pagePreviewCtx}},{key:"resetContainer",value:function(){this.previewContainerMap.clear()}},{key:"bindPreviewContainer",value:function(e){var t=this,n=!e.hasOwnProperty("reset")||e.reset,r=!e.hasOwnProperty("keepPrevContainer")||e.keepPrevContainer,o=e.previewContainerSettings.map((function(e){return t.getContainerKey(e)})),s=(0,i.default)(this.previewContainerMap.keys());if(n){var u=!0,c=!1,l=void 0;try{for(var d,f=(0,a.default)(s);!(u=(d=f.next()).done);u=!0){var p=d.value;-1!==o.indexOf(p)&&r||this.previewContainerMap.delete(p)}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}this.task=[]}var h=[];e.previewContainerSettings.forEach((function(e){var n=t.getContainerKey(e);if(!r||!t.previewContainerMap.has(n)||t.previewContainerMap.get(n).id!==e.id){var a=t.setupPreviewElements(e.container),i=a.ctx,o=a.canvasContainer,s=e.container.getBoundingClientRect();h.push({pageIndex:e.pageIndex,boardName:e.boardName}),t.previewContainerMap.set(n,{id:e.id,container:o,ctx:i,width:s.width,height:s.height})}})),this.addPreviewTask(h),this.setBackgroundColor()}},{key:"preparePreview",value:function(e){for(var t=this.app.room.currIndex,n=[],r=0;r<e.length;r++){var a=this.app.room.currBoard.pageNames[e[r]];void 0!==a&&(this.app.opsManager.hooks.previewWaiting.call(e[r]),n.push({pageIndex:a,boardName:t}))}this.visiblePages=n.slice(),this.setPreviewTask(n)}},{key:"generatePreviewToDataUrl",value:function(e,t,n){var r=this.app.room.getPage(e.boardName,e.pageIndex);if(!r)return"";var a=this.app.camera.getCameraBoundFitToContent({padding:100}),i="clip"===e.content?this.ctx:this.getPagePreviewCtx(a);if(!i)return"";r.calcDrawOpQueue(),"clip"===e.content?r.refresh({ctx:i,preview:!0,supportToDataUrl:!0,omitSelection:e.omitSelection,exportCustomBg:e.customBg}):r.refresh({ctx:i,preview:!0,supportToDataUrl:!0,boundary:a,omitSelection:e.omitSelection,exportCustomBg:e.customBg});var o=i.canvas.toDataURL(t,n);return this.app.room.refresh(),o}},{key:"setBackgroundColor",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this.previewContainerMap.values());!(e=(r=i.next()).done);e=!0){r.value.container.style.backgroundColor=this.app.appConfig.canvasBgColor}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"refreshPreviewsOfCurrBoard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.app.room.isReceivingBatchSnapshots){this.task=[];var t=this.app.room.currBoard,n=t.pages,r=[];for(var a in n)!e&&"fitContainer"!==this.app.appConfig.previewMode&&this.app.hasBackground(n[a])||r.push({boardName:t.boardName,pageIndex:n[a].pageIndex});this.addPreviewTask(r)}}},{key:"refreshPreviewsOfCurrPage",value:function(){if(!this.app.room.isReceivingBatchSnapshots){var e=this.app.room.currBoard;this.invalidatePreview(e.currPage.pageIndex,e.boardName);var t=[{boardName:e.boardName,pageIndex:e.currIndex.toString()}];this.addPreviewTask(t)}}},{key:"generatePreview",value:function(e){var t=this.getContainerKey(e);if(this.previewContainerMap.has(t)){var n=this.previewContainerMap.get(t),r=this.app.room.getPage(e.boardName,e.pageIndex);if(!r)return;var a=void 0;"fitDoc"===this.app.appConfig.previewMode&&this.app.hasBackground(r)&&(a=this.app.camera.getDocCameraBound(r)),r.calcDrawOpQueue(),r.refresh({ctx:null==n?void 0:n.ctx,preview:!0,boundary:a})}}},{key:"invalidatePreview",value:function(e,t){}},{key:"setPreviewTask",value:function(e){this.task=[],this.addPreviewTask(e)}},{key:"addPreviewTask",value:function(e){var t=this;e=e.filter((function(e){return t.isPageVisible(e)})),setTimeout((function(){e.reverse().forEach((function(e){var n=t.getTaskIndexOfPage(e.pageIndex,e.boardName);-1!==n&&t.task.splice(n,1);var r=t.app.room.boards[e.boardName];if(r){var a=r.pages[e.pageIndex];if(a){var i=t.getContainerKey(e);t.previewContainerMap.has(i)&&t.task.unshift({pageIndex:e.pageIndex,boardName:e.boardName,state:a.blocked?"waiting":"ready"})}}})),t.startLoop()}),0)}},{key:"getTaskIndexOfPage",value:function(e,t){for(var n=0;n<this.task.length;n++)if(this.task[n].pageIndex===e&&this.task[n].boardName===t)return n;return-1}},{key:"getContainerKey",value:function(e){return e.boardName+"129*&^ljdfh893"+e.pageIndex.toString()}},{key:"setupPreviewElements",value:function(e){var t=e.getElementsByClassName("preview-canvas-container"),n=void 0,r=void 0,a=void 0;0===t.length?((a=document.createElement("div")).className="preview-canvas-container",a.style.backgroundColor=this.app.appConfig.canvasBgColor,a.style.position="absolute",a.style.left="0",a.style.right="0",a.style.top="0",a.style.bottom="0",e.appendChild(a),(n=document.createElement("canvas")).style.imageRendering="optimize-contrast",a.appendChild(n),(r=n.getContext("2d")).lineCap="round",r.lineJoin="round"):(a=t[0],r=(n=t[0].getElementsByTagName("canvas")[0]).getContext("2d"));var i=a.getBoundingClientRect();return n.width=i.width*l.DPI,n.height=i.height*l.DPI,n.style.width=i.width+"px",n.style.height=i.height+"px",{ctx:r,canvasContainer:a}}},{key:"onOpAdded",value:function(e){if("inPageOp"===e.category&&!e.data.inProgress&&"laser"!==e.data.type&&"mouse-pointer"!==e.data.type&&!this.app.room.isReceivingBatchSnapshots){var t=e.board,n=e.page;this.invalidatePreview(n.toString(),t),this.addPreviewTask([{pageIndex:n.toString(),boardName:t}])}}},{key:"onPageReady",value:function(e,t){this.invalidatePreview(t.toString(),e),this.addPreviewTask([{pageIndex:t.toString(),boardName:e}])}},{key:"isPageVisible",value:function(e){for(var t=0;t<this.visiblePages.length;t++)if(this.visiblePages[t].boardName===e.boardName&&this.visiblePages[t].pageIndex===e.pageIndex)return!0;return!1}},{key:"startLoop",value:function(){return f(this,void 0,void 0,r.default.mark((function e(){var t,n=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoopBusy){e.next=2;break}return e.abrupt("return");case 2:return this.isLoopBusy=!0,e.next=5,new c.default((function(e){setTimeout(e,0)}));case 5:t=r.default.mark((function e(){var t,a;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.shiftNextTastk();case 2:t=e.sent;case 3:if(null!==t){e.next=11;break}return e.next=6,n.delay(30);case 6:return e.next=8,n.shiftNextTastk();case 8:t=e.sent,e.next=3;break;case 11:if(a=n.getContainerKey(t),n.previewContainerMap.has(a)){e.next=14;break}return e.abrupt("return","continue");case 14:return e.next=16,new c.default((function(e){try{t&&n.isPageVisible(t)&&n.generatePreview(t),e()}catch(t){n.app.logger.error("[白板]",t),e()}}));case 16:return e.next=18,n.delay(100);case 18:case"end":return e.stop()}}),e,n)}));case 6:if(!(this.task.length>0)){e.next=13;break}return e.delegateYield(t(),"t0",8);case 8:if("continue"!==e.t0){e.next=11;break}return e.abrupt("continue",6);case 11:e.next=6;break;case 13:this.isLoopBusy=!1;case 14:case"end":return e.stop()}}),e,this)})))}},{key:"shiftNextTastk",value:function(){return f(this,void 0,void 0,r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<this.task.length)){e.next=21;break}if(n=this.task[t],this.task.splice(t,1),e.prev=4,!this.app.room.getPage(n.boardName,n.pageIndex)){e.next=10;break}return e.abrupt("return",n);case 10:return t--,e.abrupt("continue",18);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(4),t--,e.abrupt("continue",18);case 18:t++,e.next=1;break;case 21:return e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,this,[[4,14]])})))}},{key:"delay",value:function(e){return f(this,void 0,void 0,r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new c.default((function(t){setTimeout((function(){t()}),e)})));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"ctx",get:function(){return this.app.container.ctx}}]),e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(14)),a=l(n(19)),i=l(n(35)),o=l(n(0)),s=l(n(1)),u=n(100),c=n(18);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,n){var r=this;(0,o.default)(this,e),this.scale=1,this.cameraBoundByUser={},this.app=t,this.translateX=0,this.translateY=0,this.scale=1,n?(this.width=n.width,this.height=n.height,this.centerX=n.centerX,this.centerY=n.centerY):(this.width=1920,this.height=1080,this.centerX=0,this.centerY=0),this.app.on("container:set",(function(){r.updateTransParamAndRefresh()}))}return(0,s.default)(e,[{key:"getContainerWorldRect",value:function(){var e=this.container.el.getBoundingClientRect(),t=e.width,n=e.height,r=this.convertToPointInWorld(0,0),a=(0,i.default)(r,2),o=a[0],s=a[1],u=this.convertToPointInWorld(t,n),c=(0,i.default)(u,2),l=c[0],d=c[1];return{centerX:o/2+l/2,centerY:s/2+d/2,width:l-o,height:d-s}}},{key:"getContainerWorldRectByCameraBound",value:function(e,t){if(e.width<=0||e.height<=0)return this.app.logger.warn("[白板] camera.getContainerWorldRectByCameraBound opts width or height less or equal to 0. \n            from: "+t+", width: "+e.width+", height: "+e.height),{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height};var n=this.container.width,r=this.container.height;return n/r>e.width/e.height?e.width=e.height/r*n:e.height=e.width/n*r,e}},{key:"convertToPointInWorld",value:function(e,t){return[e=(e-this.translateX)/this.scale,t=(t-this.translateY)/this.scale]}},{key:"convertWorldPointInContainer",value:function(e,t){return[e=e*this.scale+this.translateX,t=t*this.scale+this.translateY]}},{key:"convertDom",value:function(e){e.style.transform="translate("+this.translateX+"px, "+this.translateY+"px) scale("+this.scale+")",this.app.emit("camera:transform",this.scale)}},{key:"convertDomAndRefresh",value:function(){var e,t;this.convertDom(this.container.backgroundEl),this.convertDom(this.container.imageEl),this.convertDom(this.container.domEl),this.convertDom(this.container.textAreaEl),this.convertDom(this.container.h5El),this.app.room.pageToRefresh=null===(t=null===(e=this.app.room)||void 0===e?void 0:e.currBoard)||void 0===t?void 0:t.currPage}},{key:"convertCanvas",value:function(e){e.translate(this.translateX*u.DPI,this.translateY*u.DPI),e.scale(this.scale*u.DPI,this.scale*u.DPI)}},{key:"convertPreviewCanvas",value:function(e,t){var n=e.canvas.width,r=e.canvas.height,a=this.getTransParam(n,r,t),i=a.scale,o=a.translateX,s=a.translateY;e.translate(o,s),e.scale(i,i)}},{key:"setCameraBound",value:function(e){e.width&&e.height?(this.centerX=e.centerX,this.centerY=e.centerY,this.width=e.width,this.height=e.height,this.updateTransParamAndRefresh()):this.app.logger.warn("[白板] camera.setCameraBound 宽高无效",(0,a.default)(e))}},{key:"getNextCameraBound",value:function(e){return this.cameraLockParam?this.getCameraBoundLockWithContent(this.cameraLockParam):"pan"===e.type?this._roundBoundary(this.getCameraBoundPan(e)):"zoom"===e.type?this._roundBoundary(this.getCameraBoundZoom(e)):"reset-camera"===e.type?this._roundBoundary(this.getCameraBoundReset()):"fit-to-content"===e.type?this._roundBoundary(this.getCameraBoundFitToContent()):"fit-to-doc"===e.type?this._roundBoundary(this.getCameraBoundFitToDoc()):"resize-camera"===e.type?this._roundBoundary(this.getCameraBoundResize(e)):(console.error("不应该进入此分支(getCameraBound), data类型为："+e),{width:this.width,height:this.height,centerX:this.centerX,centerY:this.centerY})}},{key:"_roundBoundary",value:function(e){return{centerX:Number(e.centerX.toFixed(1)),centerY:Number(e.centerY.toFixed(1)),width:Number(e.width.toFixed(1)),height:Number(e.height.toFixed(1))}}},{key:"getCameraBoundPan",value:function(e){var t=this.centerX,n=this.centerY,r=this.width,a=this.height;return t+=e.dx/this.scale,n+=e.dy/this.scale,this.getContainerWorldRectByCameraBound({centerX:t,centerY:n,width:r,height:a},"pan")}},{key:"getCameraBoundZoom",value:function(e){var t=this.centerX,n=this.centerY,r=this.width,a=this.height,i=void 0;i=e.center?this.convertToPointInWorld(e.center[0],e.center[1]):[t,n];var o=e.scale;return t=i[0]-(i[0]-t)/o,n=i[1]-(i[1]-n)/o,r/=o,a/=o,this.getContainerWorldRectByCameraBound({centerX:t,centerY:n,width:r,height:a},"zoom")}},{key:"getCameraBoundReset",value:function(){return{centerX:0,centerY:0,width:this.container.width,height:this.container.height}}},{key:"getCameraBoundFitToDoc",value:function(){var e=this.app.room.currBoard.currPage.backgroundSnapshot,t=this.app.room.currBoard.transDocSnapshot;if(t&&t.data.boundary){var n=t.data.boundary,r=n.sx,a=n.sy,i=n.w,o=n.h;return this.getContainerWorldRectByCameraBound({centerX:r+i/2,centerY:a+o/2,width:i,height:o},"fitToDoc")}if(e){var s=e.data.boundary,u=s.sx,c=s.sy,l=s.w,d=s.h;return this.getContainerWorldRectByCameraBound({centerX:u+l/2,centerY:c+d/2,width:l,height:d},"fitToDoc")}return{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height}}},{key:"getDocCameraBound",value:function(e){var t=e.getBoard(),n=e.backgroundSnapshot,r=t.transDocSnapshot;if(r&&r.data.boundary){var a=r.data.boundary,i=a.sx,o=a.sy,s=a.w,u=a.h;return{centerX:i+s/2,centerY:o+u/2,width:s,height:u}}if(n){var c=n.data.boundary,l=c.sx,d=c.sy,f=c.w,p=c.h;return{centerX:l+f/2,centerY:d+p/2,width:f,height:p}}return{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height}}},{key:"getCameraBoundFitToContent",value:function(e){var t=this.app.room.currBoard.currPage,n=t.drawOpQueue,a=t.backgroundSnapshot,i=this.app.room.currBoard.transDocSnapshot;if(0===(0,r.default)(n).length&&!a&&!i)return this.getCameraBoundReset();var o={sx:1e7,sy:1e7,ex:-1e7,ey:-1e7};if(a){var s=a.data.boundary,u=s.sx,l=s.sy,d=s.w,f=s.h;o.sx=Math.min(o.sx,u),o.sy=Math.min(o.sy,l),o.ex=Math.max(o.ex,u+d),o.ey=Math.max(o.ey,l+f)}if(i&&i.data.boundary){var p=i.data.boundary,h=p.sx,g=p.sy,v=p.w,y=p.h;o.sx=Math.min(o.sx,h),o.sy=Math.min(o.sy,g),o.ex=Math.max(o.ex,h+v),o.ey=Math.max(o.ey,g+y)}for(var m in n){var b=n[m].data;if(b.boundary&&null!==b.boundary.sx&&void 0!==b.boundary.sx&&null!==b.boundary.sy&&void 0!==b.boundary.sy&&null!==b.boundary.w&&void 0!==b.boundary.w&&null!==b.boundary.h&&void 0!==b.boundary.h){var w=(0,c.getTransformedBoundary)(this.scale,b.boundary,b.dx,b.dy,b.scaleX,b.scaleY),_=w.sx,x=w.sy,k=w.w,M=w.h;o.sx=Math.min(o.sx,_),o.sy=Math.min(o.sy,x),o.ex=Math.max(o.ex,_+k),o.ey=Math.max(o.ey,x+M)}}if(o.ex-o.sx<100&&o.ey-o.sy<100){var S=100-(o.ex-o.sx),T=100-(o.ey-o.sy);o.sx=o.sx-S/2,o.ex=o.ex+S/2,o.sy=o.sy-T/2,o.ey=o.ey+T/2}var I=e?e.padding:0;return this.getContainerWorldRectByCameraBound({centerX:o.sx/2+o.ex/2,centerY:o.sy/2+o.ey/2,width:o.ex-o.sx+2*I,height:o.ey-o.sy+2*I},"fitToContent")}},{key:"getCameraBoundResize",value:function(e){return this.app.appConfig.disableAutoResize?{centerX:this.centerX,centerY:this.centerY,width:e.width/this.zoomFactor,height:e.height/this.zoomFactor}:{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.width/e.width*e.height}}},{key:"getTransParam",value:function(e,t,n){var r=n?n.width:this.width,a=n?n.height:this.height,i=n?n.centerX:this.centerX,o=n?n.centerY:this.centerY,s=void 0,u=void 0,c=void 0;return u=e/2-i*(s=e/t>r/a?t/a:e/r),c=t/2-o*s,s&&isFinite(s)||(this.app.logger.warn("[白板] scale无效:",s,"参数为width: "+e+", height: "+t+", cameraW: "+r+", cameraH: "+a+", centerX: "+i+", centerY: "+o,"重置scale为1"),u=e/2-i*(s=1),c=t/2-o*s),{scale:s,translateX:u,translateY:c}}},{key:"updateTransParamAndRefresh",value:function(){var e=this.getTransParam(this.container.width,this.container.height),t=e.scale,n=e.translateX,r=e.translateY;this.scale=t,this.translateX=n,this.translateY=r,this.convertDomAndRefresh(),this.app.emit("event:appState:change","zoomFactor",this.zoomFactor)}},{key:"getCameraBoundLockWithContent",value:function(e){var t=e.width,n=e.height,r=e.height/e.width*1920,a=void 0,i=void 0;return this.container.width/this.container.height>t/n?(i=r,a=this.container.width/this.container.height*r):(a=1920,i=this.container.height/this.container.width*1920),{centerX:0,centerY:0,width:a/2,height:i/2}}},{key:"lockCameraWithContent",value:function(e){this.cameraLockParam=e,this.setCameraBound(this.getCameraBoundLockWithContent(e))}},{key:"unlockCameraWithContent",value:function(){this.cameraLockParam=void 0}},{key:"zoomFactor",get:function(){return this.scale}},{key:"container",get:function(){return this.app.container}}]),e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(9)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),this.state="pause",this.playSpeed=1,this.records=[],this.nextRecordIndex=0,this.lastTime=0,this.lastRealTime=0,this.offsetBegin=0,this.pkgId=0,this.app=t}return(0,i.default)(e,[{key:"addRecordData",value:function(e){this.records=e.slice(),this.app.resetState(),this.nextRecordIndex=0}},{key:"setViewer",value:function(e){this.app.account=e;var t=this.lastTime;this.lastTime=1/0,this.seekTo(t)}},{key:"play",value:function(){"pause"===this.state&&(this.state="play",this.app.emit("event:player:play"))}},{key:"pause",value:function(){"play"===this.state&&(this.state="pause",this.app.emit("event:player:pause"))}},{key:"setPlaySpeed",value:function(e){this.playSpeed!==e&&(this.playSpeed=e,this.app.emit("event:player:playSpeed",this.playSpeed))}},{key:"seekTo",value:function(e){var t=Date.now(),n=Math.abs(t-this.lastRealTime-(e-this.lastTime));this.lastRealTime=t;var a=e>=this.lastTime;this.lastTime=e;for(var i=a?this.nextRecordIndex:0,o=i;o<this.records.length;o++){if(this.records[o].time+this.offsetBegin>e)break}var s=this.records.slice(i,o);this.nextRecordIndex=o,a||(this.app.resetState(),this.pkgId=0);for(var u=[],c=void 0,l=void 0,d=[],f=0;f<s.length;f++)if("snapshot"===s[f].record.type)u.push({snapshot:s[f].record.value,pkgId:this.pkgId}),this.pkgId+=1;else if("snapshotArr"===s[f].record.type){var p=!0,h=!1,g=void 0;try{for(var v,y=(0,r.default)(s[f].record.value);!(p=(v=y.next()).done);p=!0){var m=v.value;u.push({snapshot:m,pkgId:this.pkgId}),this.pkgId+=1}}catch(e){h=!0,g=e}finally{try{!p&&y.return&&y.return()}finally{if(h)throw g}}}else"broadcaster"===s[f].record.type?c=s[f].record.value:"observeMode"===s[f].record.type?s[f].record.value.account===this.app.account&&(l=s[f].record.value):"alive"===s[f].record.type&&d.push(s[f]);this.app.aliveManager.receiveSyncData(d),c&&this.app.vision.receiveBroadcasterAfterSync(c),l&&this.app.vision.receiveObserveModeAfterSync(l),this.app.room.execBatchSnapshots(u,"player"),n>100&&this.app.emit("event:player:seekTo")}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(35)),a=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,a.default)(this,e),this._lastDirection=0,this._interruptFreeDraw=!1,this.task=[],this.lNo=0,this.dNo=0,this.rNo=0,this.repeat=100,this.dInterval=15,this.lInterval=1e3,this.taskGenerator=function(){},this.app=t}return(0,i.default)(e,[{key:"reconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("DEV--\x3e 模拟重连， 是否清空数据: "+t+", 是否重新创建socket连接: "+e),t&&this.app.resetState(),e?this.app.dataHub.handler._simulateReconnect():this.app.readyToSyncData()}},{key:"generateRandomLines",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this._interruptFreeDraw=!1,this.app.disableInteraction(),this._generateRandomLines(e,t,n,r)}},{key:"generateZheng",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this._interruptFreeDraw=!1,this.app.disableInteraction(),this.app.setTool("pen"),this._generateZheng(e,t,n,r)}},{key:"interruptRandomLines",value:function(){clearTimeout(this.timer),this.finish(),this._interruptFreeDraw=!0,this.app.enableInteraction()}},{key:"next",value:function(){var e=this;clearTimeout(this.timer);var t=this.task[this.lNo];if(t)if(t.length>2){var n=t[this.dNo],r=void 0,a=void 0;0===this.dNo?(r="mousedown",a=this.dInterval,this.dNo+=1):this.dNo===t.length-1?(r="mouseup",a=this.lInterval,this.dNo=0,this.lNo+=1):(r="mousemove",a=this.dInterval,this.dNo+=1);var i=new MouseEvent(r,{clientX:n.x,clientY:n.y});this.app.container[r](i,!0),this.timer=setTimeout((function(){e.next()}),a)}else this.lNo+=1,this.next();else this.timer=setTimeout((function(){e.nextTask()}),this.lInterval)}},{key:"nextTask",value:function(){this.lNo=0,this.dNo=0,this.isFinish()?(this.task=[],this._interruptFreeDraw=!0,this.app.enableInteraction()):(this.task=this.taskGenerator(),this.rNo+=1,this.next())}},{key:"isFinish",value:function(){return this._interruptFreeDraw||this.rNo>=this.repeat}},{key:"finish",value:function(){var e=new MouseEvent("mousedown",{clientX:0,clientY:0});this.app.container.mousedown(e,!0),e=new MouseEvent("mouseup",{clientX:0,clientY:0}),this.app.container.mouseup(e,!0)}},{key:"_generateZheng",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this.dInterval=Number(r)||15,this.lInterval=Number(a)||1e3,this.repeat=t||100;var i=Math.ceil(Math.sqrt(t)),o=Math.ceil(Math.sqrt(t));this.taskParam={x:0,y:0,row:o,col:i},this.rNo=0,this.taskGenerator=function(){var t=n.app.container.el.getBoundingClientRect(),r=t.width,a=t.height,s=.9*r/Math.max(i,15),u=.9*a/Math.max(o,15),c=t.left+.05*r+n.taskParam.x*s,l=t.top+.05*a+n.taskParam.y*u,d=t.left+.05*r+(n.taskParam.x+.8)*s,f=t.top+.05*a+(n.taskParam.y+.8)*u,p=[];return p.push(n._generateLine(e,c,l,d,l)),p.push(n._generateLine(e,c/2+d/2,l,c/2+d/2,f)),p.push(n._generateLine(e,c/2+d/2,l/2+f/2,d,l/2+f/2)),p.push(n._generateLine(e,.75*c+.25*d,l/2+f/2,.75*c+.25*d,f)),p.push(n._generateLine(e,c,f,d,f)),n.taskParam.x<o-1?n.taskParam.x+=1:(n.taskParam.y+=1,n.taskParam.x=0),p},this.nextTask()}},{key:"_generateLine",value:function(e,t,n,r,a){for(var i=[],o=0;o<e;o++)i.push({x:t+o/e*(r-t)+Math.random(),y:n+o/e*(a-n)+Math.random()});return i}},{key:"_generateRandomLines",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this.dInterval=Number(a)||15,this.lInterval=Number(i)||1e3,this.repeat=Number(t)||100,this.taskParam=e||100,this.rNo=0,this.taskGenerator=function(){var e=n.app.container.el.getBoundingClientRect(),t=e.width,a=e.height,i=Math.random()*t+e.left,o=Math.random()*a+e.top,s=[];s.push({x:i,y:o});for(var u=0;u<n.taskParam;u++){var c=n._getDxDy(u),l=(0,r.default)(c,2);i+=l[0],o+=l[1],s.push({x:i,y:o})}return[s]},this.nextTask()}},{key:"_getDxDy",value:function(e){return e%30==0&&(this._lastDirection=Math.floor(4*Math.random())),0===this._lastDirection?[10*Math.random(),10*Math.random()]:1===this._lastDirection?[10*Math.random(),-10*Math.random()]:2===this._lastDirection?[-10*Math.random(),10*Math.random()]:[-10*Math.random(),-10*Math.random()]}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(9)),a=c(n(0)),i=c(n(1)),o=n(29),s=c(n(32)),u=n(133);function c(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){var n=this;(0,a.default)(this,e),this.mode="freeObserver",this.unsetWhenDisconnecting=function(){n.broadcaster===n.app.account.toString()&&n.unsetSelfAsBroadcaster()},this.unsetWhenPageHide=function(e){e.persisted&&n.unsetWhenDisconnecting()},this.handleBroadcasterOffline=function(e){n.app.logger.log("[白板] vision broadcaster offline",e,"broadcaster",n.broadcaster);var t=!0,a=!1,i=void 0;try{for(var u,c=(0,r.default)(e);!(t=(u=c.next()).done);t=!0){var l=u.value;if(l.toString()===n.broadcaster){var d=n.broadcasterName,f=n.broadcaster;n.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}});var p=l===n.app.account?"其他用户将停止与您保持视角同步":d+"取消了视角同步",h=l===n.app.account?s.default.STOP_BROADCAST:s.default.RECEIVE_STOP_BROADCAST;(0,o.showToast)({msg:p,type:"success",time:3,msgType:h,args:{broadcasterName:n.broadcasterName,broadcaster:n.broadcaster,prevBroadcasterName:d,prevBroadcaster:f}})}}}catch(e){a=!0,i=e}finally{try{!t&&c.return&&c.return()}finally{if(a)throw i}}},this.app=t,this.camera=this.app.camera,window.addEventListener("beforeunload",this.unsetWhenDisconnecting),window.addEventListener("pagehide",this.unsetWhenPageHide,!1),this.app.on("aliveManager:offline",this.handleBroadcasterOffline)}return(0,i.default)(e,[{key:"destroy",value:function(){this.unsetWhenDisconnecting(),window.removeEventListener("beforeunload",this.unsetWhenDisconnecting),window.removeEventListener("pagehide",this.unsetWhenPageHide,!1),this.app.off("aliveManager:offline",this.handleBroadcasterOffline)}},{key:"setVisionData",value:function(e){e.mode&&(this.mode=e.mode),e.broadcaster&&(this.broadcaster=e.broadcaster.value,this.broadcasterNickname=e.broadcaster.nickname),this.app.emit("event:appState:change","vision",{mode:this.mode,broadcasterName:this.broadcasterName,broadcaster:this.broadcaster})}},{key:"setSelfAsBroadcaster",value:function(){if(this.app.appConfig.allowReplaceActiveBroadcaster||!this.broadcaster||this.broadcaster===this.app.account.toString()){if(this.broadcaster!==this.app.account.toString())if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else{var e=this.app.account,t=this.app.nickname;this.setVisionData({mode:"broadcaster",broadcaster:{value:e,nickname:t}}),(0,o.showToast)({type:"success",msg:"其他用户将与您保持视角同步",time:3,msgType:s.default.START_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({broadcaster:e,nickname:t},"broadcaster"),this.app.emit("op:camera-bound:send",this.camera.getContainerWorldRect(),!0)}}else(0,o.showToast)({type:"error",msg:"其他参会人已开启视角同步",time:3,msgType:s.default.NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}},{key:"unsetSelfAsBroadcaster",value:function(){if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else if("broadcaster"===this.mode){this.broadcaster!==this.app.account&&this.app.logger.error("[白板] unsetSelfAsBroadcaster: 取消广播。但事实上目前用户并不是房间的广播者",this.broadcaster,this.app.account);var e=this.broadcasterName,t=this.broadcaster;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),(0,o.showToast)({type:"success",msg:"其他用户将停止与您保持视角同步",msgType:s.default.STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:e,prevBroadcaster:t}}),this.app.dataHub.broadcastRoomState({broadcaster:void 0},"broadcaster")}}},{key:"setSelfAsFollower",value:function(){if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else if("broadcaster"===this.mode)this.app.logger.error("[白板] setSelfAsFollower: 请先停止广播");else if("freeObserver"===this.mode){this.setVisionData({mode:"follower"});var e=this.camera.cameraBoundByUser[this.broadcaster];(0,u.transitionToCameraBound)(this.camera,e),(0,o.showToast)({type:"success",msg:"与"+this.broadcasterName+"保持视角同步",msgType:s.default.SWITCH_TO_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({account:this.app.account,mode:"follower"},"observeMode")}}},{key:"setSelfAsFreeObserver",value:function(){this.app.dataHub.isSynchronizing?this.app.logger.warn("正在同步数据，请同步后再设置"):"broadcaster"===this.mode?this.app.logger.error("[白板] setSelfAsFreeObserver: 请先停止广播"):"follower"===this.mode&&(this.setVisionData({mode:"freeObserver"}),(0,o.showToast)({type:"success",msg:"与"+this.broadcasterName+"解除视角同步",msgType:s.default.SWITCH_TO_FREE_OBSERVER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({account:this.app.account,mode:"freeObserver"},"observeMode"),this.app.emit("op:camera-bound:send",this.camera.getContainerWorldRect(),!1))}},{key:"receiveBroadcaster",value:function(e){var t=e.broadcaster,n=e.nickname;if(t)this.setVisionData({mode:"follower",broadcaster:{value:t,nickname:n}}),(0,o.showToast)({msg:"正在与"+this.broadcasterName+"保持视角同步",type:"success",time:3,msgType:s.default.RECEIVE_START_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}});else{var r=this.broadcasterName,a=this.broadcaster;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),(0,o.showToast)({msg:r+"取消了视角同步",type:"success",time:3,msgType:s.default.RECEIVE_STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:r,prevBroadcaster:a}})}}},{key:"receiveBroadcasterAfterSync",value:function(e){var t=this.app.aliveManager.isAlive(e.broadcaster);if(t&&e.broadcaster===this.app.account)"broadcaster"!==this.mode&&(this.setVisionData({mode:"broadcaster",broadcaster:{value:this.app.account,nickname:this.app.nickname}}),(0,o.showToast)({type:"success",msg:"其他用户正与您保持视角同步",time:3,msgType:s.default.CURRENT_USER_IS_BROADCASTER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}));else if(t&&e.broadcaster)"follower"===this.mode&&this.broadcaster===e.broadcaster||(this.setVisionData({mode:"follower",broadcaster:{value:e.broadcaster,nickname:e.nickname}}),(0,o.showToast)({msg:"正在与"+this.broadcasterName+"保持视角同步",type:"success",time:3,msgType:s.default.CURRENT_USER_IS_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}));else if("freeObserver"!==this.mode||this.broadcaster){var n=this.broadcaster,r=this.broadcasterName;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),this.app.account===n?(0,o.showToast)({type:"success",msg:"其他用户将停止与您保持视角同步",msgType:s.default.STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:r,prevBroadcaster:n}}):n&&(0,o.showToast)({msg:r+"取消了视角同步",type:"success",time:3,msgType:s.default.RECEIVE_STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:r,prevBroadcaster:n}})}}},{key:"receiveObserveModeAfterSync",value:function(e){if(e.account===this.app.account)if("follower"===e.mode){this.setVisionData({mode:"follower"});var t=this.camera.cameraBoundByUser[this.broadcaster];(0,u.transitionToCameraBound)(this.camera,t),(0,o.showToast)({type:"success",msg:"正在与"+this.broadcasterName+"保持视角同步",msgType:s.default.CURRENT_USER_IS_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}else{this.setVisionData({mode:"freeObserver"});var n=this.camera.cameraBoundByUser[this.app.account];(0,u.transitionToCameraBound)(this.camera,n),(0,o.showToast)({type:"success",msg:"与"+this.broadcasterName+"解除视角同步",msgType:s.default.CURRENT_USER_IS_FREE_OBSERVER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}}},{key:"broadcasterName",get:function(){return this.broadcasterNickname?this.broadcasterNickname:this.broadcaster}}]),e}();t.default=l},function(e,t,n){"use strict";(function(t){var r,a,i=d(n(5)),o=d(n(13)),s=d(n(21)),u=d(n(57)),c=(r=(0,u.default)(s.default.mark((function e(t){var n,r;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f(t),e.next=3,p.fromStream(n);case 3:return r=e.sent,e.next=6,n.close();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)}),l=(a=(0,u.default)(s.default.mark((function e(n){var r;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(n);case 2:return r=e.sent,e.abrupt("return",p.fromBuffer(t.from(r)));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)});function d(e){return e&&e.__esModule?e:{default:e}}var f=n(346).ReadableWebToNodeStream,p=n(369);function h(e){return e.arrayBuffer?e.arrayBuffer():new o.default((function(t,n){var r=new FileReader;r.addEventListener("loadend",(function(e){t(e.target.result)})),r.addEventListener("error",(function(e){n(new Error(e.message))})),r.addEventListener("abort",(function(e){n(new Error(e.type))})),r.readAsArrayBuffer(e)}))}(0,i.default)(e.exports,p,{fromStream:c,fromBlob:l})}).call(this,n(44).Buffer)},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),o=r[0],s=r[1],u=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,d=s>0?o-4:o;for(n=0;n<d;n+=4)t=a[e.charCodeAt(n)]<<18|a[e.charCodeAt(n+1)]<<12|a[e.charCodeAt(n+2)]<<6|a[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===s&&(t=a[e.charCodeAt(n)]<<2|a[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===s&&(t=a[e.charCodeAt(n)]<<10|a[e.charCodeAt(n+1)]<<4|a[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,a=n%3,i=[],o=0,s=n-a;o<s;o+=16383)i.push(l(e,o,o+16383>s?s:o+16383));1===a?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===a&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],a=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],a[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var a,i,o=[],s=t;s<n;s+=3)a=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(i=a)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r=l(n(21)),a=l(n(57)),i=l(n(2)),o=l(n(0)),s=l(n(1)),u=l(n(3)),c=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ReadableWebToNodeStream=void 0;var d=function(e){function t(e){(0,o.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.bytesRead=0,n.released=!1,n.reader=e.getReader(),n}var n,l,d,f;return(0,c.default)(t,e),(0,s.default)(t,[{key:"_read",value:(f=(0,a.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.released){e.next=3;break}return this.push(null),e.abrupt("return");case 3:return this.pendingRead=this.reader.read(),e.next=6,this.pendingRead;case 6:t=e.sent,delete this.pendingRead,t.done||this.released?this.push(null):(this.bytesRead+=t.value.length,this.push(t.value));case 9:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"waitForReadToComplete",value:(d=(0,a.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead){e.next=3;break}return e.next=3,this.pendingRead;case 3:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"close",value:(l=(0,a.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncAndRelease();case 2:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"syncAndRelease",value:(n=(0,a.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.released=!0,e.next=3,this.waitForReadToComplete();case 3:return e.next=5,this.reader.releaseLock();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),t}(n(347).Readable);t.ReadableWebToNodeStream=d},function(e,t,n){"use strict";(t=e.exports=n(224)).Stream=t,t.Readable=t,t.Writable=n(229),t.Duplex=n(69),t.Transform=n(231),t.PassThrough=n(367),t.finished=n(135),t.pipeline=n(368)},function(e,t){},function(e,t,n){"use strict";var r=c(n(47)),a=c(n(55)),i=c(n(350)),o=c(n(354)),s=c(n(357)),u=c(n(14));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var n=(0,u.default)(e);if(s.default){var r=(0,s.default)(e);t&&(r=r.filter((function(t){return(0,o.default)(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e,t,n){return t in e?(0,r.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,r.default)(e,a.key,a)}}var p=n(44).Buffer,h=n(359).inspect,g=h&&h.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,s;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return p.alloc(0);for(var t,n,r,a=p.allocUnsafe(e>>>0),i=this.head,o=0;i;)t=i.data,n=a,r=o,p.prototype.copy.call(t,n,r),o+=i.data.length,i=i.next;return a}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var a=t.data,i=e>a.length?a.length:e;if(i===a.length?r+=a:r+=a.slice(0,e),0==(e-=i)){i===a.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=a.slice(i));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=p.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var a=n.data,i=e>a.length?a.length:e;if(a.copy(t,t.length-e,0,i),0==(e-=i)){i===a.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(i));break}++r}return this.length-=r,t}},{key:g,value:function(e,t){return h(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){d(e,t,n[t])})):i.default?(0,a.default)(e,(0,i.default)(n)):l(Object(n)).forEach((function(t){(0,r.default)(e,t,(0,o.default)(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}])&&f(t.prototype,n),s&&f(t,s),e}()},function(e,t,n){e.exports={default:n(351),__esModule:!0}},function(e,t,n){n(352),e.exports=n(6).Object.getOwnPropertyDescriptors},function(e,t,n){var r=n(8),a=n(353),i=n(30),o=n(71),s=n(126);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=i(e),u=o.f,c=a(r),l={},d=0;c.length>d;)void 0!==(n=u(r,t=c[d++]))&&s(l,t,n);return l}})},function(e,t,n){var r=n(91),a=n(63),i=n(23),o=n(12).Reflect;e.exports=o&&o.ownKeys||function(e){var t=r.f(i(e)),n=a.f;return n?t.concat(n(e)):t}},function(e,t,n){e.exports={default:n(355),__esModule:!0}},function(e,t,n){n(356);var r=n(6).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},function(e,t,n){var r=n(30),a=n(71).f;n(94)("getOwnPropertyDescriptor",(function(){return function(e,t){return a(r(e),t)}}))},function(e,t,n){e.exports={default:n(358),__esModule:!0}},function(e,t,n){n(122),e.exports=n(6).Object.getOwnPropertySymbols},function(e,t){},function(e,t,n){e.exports={default:n(361),__esModule:!0}},function(e,t,n){n(362),e.exports=n(64).f("hasInstance")},function(e,t,n){"use strict";var r=n(15),a=n(90),i=n(11)("hasInstance"),o=Function.prototype;i in o||n(16).f(o,i,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=a(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(73))},function(e,t,n){var r=n(44),a=r.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return a(e,t,n)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=o),i(a,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return a(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=a(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";(function(t){var r,a=l(n(86)),i=l(n(13)),o=l(n(127)),s=l(n(2)),u=l(n(65)),c=l(n(47));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n){return t in e?(0,c.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=n(135),p=(0,u.default)("lastResolve"),h=(0,u.default)("lastReject"),g=(0,u.default)("error"),v=(0,u.default)("ended"),y=(0,u.default)("lastPromise"),m=(0,u.default)("handlePromise"),b=(0,u.default)("stream");function w(e,t){return{value:e,done:t}}function _(e){var t=e[p];if(null!==t){var n=e[b].read();null!==n&&(e[y]=null,e[p]=null,e[h]=null,t(w(n,!1)))}}function x(e){t.nextTick(_,e)}var k=(0,s.default)((function(){})),M=(0,o.default)((d(r={get stream(){return this[b]},next:function(){var e=this,n=this[g];if(null!==n)return i.default.reject(n);if(this[v])return i.default.resolve(w(void 0,!0));if(this[b].destroyed)return new i.default((function(n,r){t.nextTick((function(){e[g]?r(e[g]):n(w(void 0,!0))}))}));var r,a=this[y];if(a)r=new i.default(function(e,t){return function(n,r){e.then((function(){t[v]?n(w(void 0,!0)):t[m](n,r)}),r)}}(a,this));else{var o=this[b].read();if(null!==o)return i.default.resolve(w(o,!1));r=new i.default(this[m])}return this[y]=r,r}},u.default.asyncIterator,(function(){return this})),d(r,"return",(function(){var e=this;return new i.default((function(t,n){e[b].destroy(null,(function(e){e?n(e):t(w(void 0,!0))}))}))})),r),k);e.exports=function(e){var t,n=(0,a.default)(M,(d(t={},b,{value:e,writable:!0}),d(t,p,{value:null,writable:!0}),d(t,h,{value:null,writable:!0}),d(t,g,{value:null,writable:!0}),d(t,v,{value:e._readableState.endEmitted,writable:!0}),d(t,m,{value:function(e,t){var r=n[b].read();r?(n[y]=null,n[p]=null,n[h]=null,e(w(r,!1))):(n[p]=e,n[h]=t)},writable:!0}),t));return n[y]=null,f(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[h];return null!==t&&(n[y]=null,n[p]=null,n[h]=null,t(e)),void(n[g]=e)}var r=n[p];null!==r&&(n[y]=null,n[p]=null,n[h]=null,r(w(void 0,!0))),n[v]=!0})),e.on("readable",x.bind(null,n)),n}}).call(this,n(52))},function(e,t,n){"use strict";e.exports=function(){throw new Error("Readable.from is not available in the browser")}},function(e,t,n){"use strict";e.exports=a;var r=n(231);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e)}n(67)(a,r),a.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";var r;var a=n(68).codes,i=a.ERR_MISSING_ARGS,o=a.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function u(e,t,a,i){i=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(i);var s=!1;e.on("close",(function(){s=!0})),void 0===r&&(r=n(135)),r(e,{readable:t,writable:a},(function(e){if(e)return i(e);s=!0,i()}));var u=!1;return function(t){if(!s&&!u)return u=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void i(t||new o("pipe"))}}function c(e){e()}function l(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?s:e.pop():s}e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,a=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new i("streams");var o=t.map((function(e,n){var i=n<t.length-1;return u(e,i,n>0,(function(e){r||(r=e),e&&o.forEach(c),i||(o.forEach(c),a(r))}))}));return t.reduce(l)}},function(module,exports,__webpack_require__){"use strict";(function(Buffer){var _set=__webpack_require__(31),_set2=_interopRequireDefault(_set),_promise=__webpack_require__(13),_promise2=_interopRequireDefault(_promise),_maxSafeInteger=__webpack_require__(370),_maxSafeInteger2=_interopRequireDefault(_maxSafeInteger),_getIterator2=__webpack_require__(9),_getIterator3=_interopRequireDefault(_getIterator2),_slicedToArray2=__webpack_require__(35),_slicedToArray3=_interopRequireDefault(_slicedToArray2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_typeof2=__webpack_require__(20),_typeof3=_interopRequireDefault(_typeof2),_regenerator=__webpack_require__(21),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(57),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),fromStream=(_ref=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(t){var n;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,strtok3.fromStream(t);case 2:return n=e.sent,e.prev=3,e.next=6,fromTokenizer(n);case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.next=10,n.close();case 10:return e.finish(7);case 11:case"end":return e.stop()}}),e,this,[[3,,7,11]])}))),function(e){return _ref.apply(this,arguments)}),_ref,fromBuffer=(_ref2=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(t){var n,r;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)){e.next=2;break}throw new TypeError("Expected the `input` argument to be of type `Uint8Array` or `Buffer` or `ArrayBuffer`, got `"+(void 0===t?"undefined":(0,_typeof3.default)(t))+"`");case 2:if((n=t instanceof Buffer?t:Buffer.from(t))&&n.length>1){e.next=5;break}return e.abrupt("return");case 5:return r=strtok3.fromBuffer(n),e.abrupt("return",fromTokenizer(r));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return _ref2.apply(this,arguments)}),_ref2,fromTokenizer=(_ref5=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(t){return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",_fromTokenizer(t));case 4:if(e.prev=4,e.t0=e.catch(0),e.t0 instanceof strtok3.EndOfStreamError){e.next=8;break}throw e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])}))),function(e){return _ref5.apply(this,arguments)}),_ref5,_fromTokenizer=(_ref6=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(t){var n,r,a,i,o,s,u,c,l,d,f,p,h,g,v,y,m,b,w,_,x,k,M,S,T;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Buffer.alloc(minimumBytes),r=function(e,t){return _check(n,e,t)},a=function(e,t){return r(stringToBytes(e),t)},t.fileInfo.size||(t.fileInfo.size=_maxSafeInteger2.default),e.next=7,t.peekBuffer(n,{length:12,mayBeLess:!0});case 7:if(!r([66,77])){e.next=9;break}return e.abrupt("return",{ext:"bmp",mime:"image/bmp"});case 9:if(!r([11,119])){e.next=11;break}return e.abrupt("return",{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"});case 11:if(!r([120,1])){e.next=13;break}return e.abrupt("return",{ext:"dmg",mime:"application/x-apple-diskimage"});case 13:if(!r([77,90])){e.next=15;break}return e.abrupt("return",{ext:"exe",mime:"application/x-msdownload"});case 15:if(!r([37,33])){e.next=21;break}return e.next=18,t.peekBuffer(n,{length:24,mayBeLess:!0});case 18:if(!a("PS-Adobe-",{offset:2})||!a(" EPSF-",{offset:14})){e.next=20;break}return e.abrupt("return",{ext:"eps",mime:"application/eps"});case 20:return e.abrupt("return",{ext:"ps",mime:"application/postscript"});case 21:if(!r([31,160])&&!r([31,157])){e.next=23;break}return e.abrupt("return",{ext:"Z",mime:"application/x-compress"});case 23:if(!r([255,216,255])){e.next=25;break}return e.abrupt("return",{ext:"jpg",mime:"image/jpeg"});case 25:if(!r([73,73,188])){e.next=27;break}return e.abrupt("return",{ext:"jxr",mime:"image/vnd.ms-photo"});case 27:if(!r([31,139,8])){e.next=29;break}return e.abrupt("return",{ext:"gz",mime:"application/gzip"});case 29:if(!r([66,90,104])){e.next=31;break}return e.abrupt("return",{ext:"bz2",mime:"application/x-bzip2"});case 31:if(!a("ID3")){e.next=42;break}return e.next=34,t.ignore(6);case 34:return e.next=36,t.readToken(uint32SyncSafeToken);case 36:if(i=e.sent,!(t.position+i>t.fileInfo.size)){e.next=39;break}return e.abrupt("return",{ext:"mp3",mime:"audio/mpeg"});case 39:return e.next=41,t.ignore(i);case 41:return e.abrupt("return",fromTokenizer(t));case 42:if(!a("MP+")){e.next=44;break}return e.abrupt("return",{ext:"mpc",mime:"audio/x-musepack"});case 44:if(67!==n[0]&&70!==n[0]||!r([87,83],{offset:1})){e.next=46;break}return e.abrupt("return",{ext:"swf",mime:"application/x-shockwave-flash"});case 46:if(!r([71,73,70])){e.next=48;break}return e.abrupt("return",{ext:"gif",mime:"image/gif"});case 48:if(!a("FLIF")){e.next=50;break}return e.abrupt("return",{ext:"flif",mime:"image/flif"});case 50:if(!a("8BPS")){e.next=52;break}return e.abrupt("return",{ext:"psd",mime:"image/vnd.adobe.photoshop"});case 52:if(!a("WEBP",{offset:8})){e.next=54;break}return e.abrupt("return",{ext:"webp",mime:"image/webp"});case 54:if(!a("MPCK")){e.next=56;break}return e.abrupt("return",{ext:"mpc",mime:"audio/x-musepack"});case 56:if(!a("FORM")){e.next=58;break}return e.abrupt("return",{ext:"aif",mime:"audio/aiff"});case 58:if(!a("icns",{offset:0})){e.next=60;break}return e.abrupt("return",{ext:"icns",mime:"image/icns"});case 60:if(!r([80,75,3,4])){e.next=121;break}e.prev=61;case 62:if(!(t.position+30<t.fileInfo.size)){e.next=114;break}return e.next=65,t.readBuffer(n,{length:30});case 65:return o={compressedSize:n.readUInt32LE(18),uncompressedSize:n.readUInt32LE(22),filenameLength:n.readUInt16LE(26),extraFieldLength:n.readUInt16LE(28)},e.next=68,t.readToken(new Token.StringType(o.filenameLength,"utf-8"));case 68:return o.filename=e.sent,e.next=71,t.ignore(o.extraFieldLength);case 71:if("META-INF/mozilla.rsa"!==o.filename){e.next=73;break}return e.abrupt("return",{ext:"xpi",mime:"application/x-xpinstall"});case 73:if(!o.filename.endsWith(".rels")&&!o.filename.endsWith(".xml")){e.next=83;break}s=o.filename.split("/")[0],e.t0=s,e.next="_rels"===e.t0?78:"word"===e.t0?79:"ppt"===e.t0?80:"xl"===e.t0?81:82;break;case 78:return e.abrupt("break",83);case 79:return e.abrupt("return",{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});case 80:return e.abrupt("return",{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"});case 81:return e.abrupt("return",{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});case 82:return e.abrupt("break",83);case 83:if(!o.filename.startsWith("xl/")){e.next=85;break}return e.abrupt("return",{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});case 85:if(!o.filename.startsWith("3D/")||!o.filename.endsWith(".model")){e.next=87;break}return e.abrupt("return",{ext:"3mf",mime:"model/3mf"});case 87:if("mimetype"!==o.filename||o.compressedSize!==o.uncompressedSize){e.next=98;break}return e.next=90,t.readToken(new Token.StringType(o.compressedSize,"utf-8"));case 90:u=e.sent,e.t1=u,e.next="application/epub+zip"===e.t1?94:"application/vnd.oasis.opendocument.text"===e.t1?95:"application/vnd.oasis.opendocument.spreadsheet"===e.t1?96:"application/vnd.oasis.opendocument.presentation"===e.t1?97:98;break;case 94:return e.abrupt("return",{ext:"epub",mime:"application/epub+zip"});case 95:return e.abrupt("return",{ext:"odt",mime:"application/vnd.oasis.opendocument.text"});case 96:return e.abrupt("return",{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"});case 97:return e.abrupt("return",{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"});case 98:if(0!==o.compressedSize){e.next=110;break}c=-1;case 100:if(!(c<0&&t.position<t.fileInfo.size)){e.next=108;break}return e.next=103,t.peekBuffer(n,{mayBeLess:!0});case 103:return c=n.indexOf("504B0304",0,"hex"),e.next=106,t.ignore(c>=0?c:n.length);case 106:e.next=100;break;case 108:e.next=112;break;case 110:return e.next=112,t.ignore(o.compressedSize);case 112:e.next=62;break;case 114:e.next=120;break;case 116:if(e.prev=116,e.t2=e.catch(61),e.t2 instanceof strtok3.EndOfStreamError){e.next=120;break}throw e.t2;case 120:return e.abrupt("return",{ext:"zip",mime:"application/zip"});case 121:if(!a("OggS")){e.next=140;break}return e.next=124,t.ignore(28);case 124:return l=Buffer.alloc(8),e.next=127,t.readBuffer(l);case 127:if(!_check(l,[79,112,117,115,72,101,97,100])){e.next=129;break}return e.abrupt("return",{ext:"opus",mime:"audio/opus"});case 129:if(!_check(l,[128,116,104,101,111,114,97])){e.next=131;break}return e.abrupt("return",{ext:"ogv",mime:"video/ogg"});case 131:if(!_check(l,[1,118,105,100,101,111,0])){e.next=133;break}return e.abrupt("return",{ext:"ogm",mime:"video/ogg"});case 133:if(!_check(l,[127,70,76,65,67])){e.next=135;break}return e.abrupt("return",{ext:"oga",mime:"audio/ogg"});case 135:if(!_check(l,[83,112,101,101,120,32,32])){e.next=137;break}return e.abrupt("return",{ext:"spx",mime:"audio/ogg"});case 137:if(!_check(l,[1,118,111,114,98,105,115])){e.next=139;break}return e.abrupt("return",{ext:"ogg",mime:"audio/ogg"});case 139:return e.abrupt("return",{ext:"ogx",mime:"application/ogg"});case 140:if(!r([80,75])||3!==n[2]&&5!==n[2]&&7!==n[2]||4!==n[3]&&6!==n[3]&&8!==n[3]){e.next=142;break}return e.abrupt("return",{ext:"zip",mime:"application/zip"});case 142:if(!a("ftyp",{offset:4})||0==(96&n[8])){e.next=167;break}d=n.toString("binary",8,12).replace("\0"," ").trim(),e.t3=d,e.next="avif"===e.t3?147:"mif1"===e.t3?148:"msf1"===e.t3?149:"heic"===e.t3||"heix"===e.t3?150:"hevc"===e.t3||"hevx"===e.t3?151:"qt"===e.t3?152:"M4V"===e.t3||"M4VH"===e.t3||"M4VP"===e.t3?153:"M4P"===e.t3?154:"M4B"===e.t3?155:"M4A"===e.t3?156:"F4V"===e.t3?157:"F4P"===e.t3?158:"F4A"===e.t3?159:"F4B"===e.t3?160:"crx"===e.t3?161:162;break;case 147:return e.abrupt("return",{ext:"avif",mime:"image/avif"});case 148:return e.abrupt("return",{ext:"heic",mime:"image/heif"});case 149:return e.abrupt("return",{ext:"heic",mime:"image/heif-sequence"});case 150:return e.abrupt("return",{ext:"heic",mime:"image/heic"});case 151:return e.abrupt("return",{ext:"heic",mime:"image/heic-sequence"});case 152:return e.abrupt("return",{ext:"mov",mime:"video/quicktime"});case 153:return e.abrupt("return",{ext:"m4v",mime:"video/x-m4v"});case 154:return e.abrupt("return",{ext:"m4p",mime:"video/mp4"});case 155:return e.abrupt("return",{ext:"m4b",mime:"audio/mp4"});case 156:return e.abrupt("return",{ext:"m4a",mime:"audio/x-m4a"});case 157:return e.abrupt("return",{ext:"f4v",mime:"video/mp4"});case 158:return e.abrupt("return",{ext:"f4p",mime:"video/mp4"});case 159:return e.abrupt("return",{ext:"f4a",mime:"audio/mp4"});case 160:return e.abrupt("return",{ext:"f4b",mime:"audio/mp4"});case 161:return e.abrupt("return",{ext:"cr3",mime:"image/x-canon-cr3"});case 162:if(!d.startsWith("3g")){e.next=166;break}if(!d.startsWith("3g2")){e.next=165;break}return e.abrupt("return",{ext:"3g2",mime:"video/3gpp2"});case 165:return e.abrupt("return",{ext:"3gp",mime:"video/3gpp"});case 166:return e.abrupt("return",{ext:"mp4",mime:"video/mp4"});case 167:if(!a("MThd")){e.next=169;break}return e.abrupt("return",{ext:"mid",mime:"audio/midi"});case 169:if(!a("wOFF")||!r([0,1,0,0],{offset:4})&&!a("OTTO",{offset:4})){e.next=171;break}return e.abrupt("return",{ext:"woff",mime:"font/woff"});case 171:if(!a("wOF2")||!r([0,1,0,0],{offset:4})&&!a("OTTO",{offset:4})){e.next=173;break}return e.abrupt("return",{ext:"woff2",mime:"font/woff2"});case 173:if(!r([212,195,178,161])&&!r([161,178,195,212])){e.next=175;break}return e.abrupt("return",{ext:"pcap",mime:"application/vnd.tcpdump.pcap"});case 175:if(!a("DSD ")){e.next=177;break}return e.abrupt("return",{ext:"dsf",mime:"audio/x-dsf"});case 177:if(!a("LZIP")){e.next=179;break}return e.abrupt("return",{ext:"lz",mime:"application/x-lzip"});case 179:if(!a("fLaC")){e.next=181;break}return e.abrupt("return",{ext:"flac",mime:"audio/x-flac"});case 181:if(!r([66,80,71,251])){e.next=183;break}return e.abrupt("return",{ext:"bpg",mime:"image/bpg"});case 183:if(!a("wvpk")){e.next=185;break}return e.abrupt("return",{ext:"wv",mime:"audio/wavpack"});case 185:if(!a("%PDF")){e.next=195;break}return e.next=188,t.ignore(1350);case 188:return f=Buffer.alloc(Math.min(10485760,t.fileInfo.size)),e.next=192,t.readBuffer(f,{mayBeLess:!0});case 192:if(-1===f.indexOf(Buffer.from("AIPrivateData"))){e.next=194;break}return e.abrupt("return",{ext:"ai",mime:"application/postscript"});case 194:return e.abrupt("return",{ext:"pdf",mime:"application/pdf"});case 195:if(!r([0,97,115,109])){e.next=197;break}return e.abrupt("return",{ext:"wasm",mime:"application/wasm"});case 197:if(!r([73,73,42,0])){e.next=210;break}if(!a("CR",{offset:8})){e.next=200;break}return e.abrupt("return",{ext:"cr2",mime:"image/x-canon-cr2"});case 200:if(!r([28,0,254,0],{offset:8})&&!r([31,0,11,0],{offset:8})){e.next=202;break}return e.abrupt("return",{ext:"nef",mime:"image/x-nikon-nef"});case 202:if(!r([8,0,0,0],{offset:4})||!r([45,0,254,0],{offset:8})&&!r([39,0,254,0],{offset:8})){e.next=204;break}return e.abrupt("return",{ext:"dng",mime:"image/x-adobe-dng"});case 204:return n=Buffer.alloc(24),e.next=207,t.peekBuffer(n);case 207:if(!r([16,251,134,1],{offset:4})&&!r([8,0,0,0],{offset:4})||!r([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})){e.next=209;break}return e.abrupt("return",{ext:"arw",mime:"image/x-sony-arw"});case 209:return e.abrupt("return",{ext:"tif",mime:"image/tiff"});case 210:if(!r([77,77,0,42])){e.next=212;break}return e.abrupt("return",{ext:"tif",mime:"image/tiff"});case 212:if(!a("MAC ")){e.next=214;break}return e.abrupt("return",{ext:"ape",mime:"audio/ape"});case 214:if(!r([26,69,223,163])){e.next=230;break}return p=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){var n,r,a,i;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.peekNumber(Token.UINT8);case 2:for(n=e.sent,r=128,a=0;0==(n&r);)++a,r>>=1;return i=Buffer.alloc(a+1),e.next=9,t.readBuffer(i);case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){var t,n,r;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:return t=e.sent,e.next=5,p();case 5:return(n=e.sent)[0]^=128>>n.length-1,r=Math.min(6,n.length),e.abrupt("return",{id:t.readUIntBE(0,t.length),len:n.readUIntBE(n.length-r,r)});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(n,r){var a;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r>0)){e.next=11;break}return e.next=3,h();case 3:if(17026!==(a=e.sent).id){e.next=6;break}return e.abrupt("return",t.readToken(new Token.StringType(a.len,"utf-8")));case 6:return e.next=8,t.ignore(a.len);case 8:--r,e.next=0;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),e.next=220,h();case 220:return v=e.sent,e.next=223,g(1,v.len);case 223:y=e.sent,e.t4=y,e.next="webm"===e.t4?227:"matroska"===e.t4?228:229;break;case 227:return e.abrupt("return",{ext:"webm",mime:"video/webm"});case 228:return e.abrupt("return",{ext:"mkv",mime:"video/x-matroska"});case 229:return e.abrupt("return");case 230:if(!r([82,73,70,70])){e.next=237;break}if(!r([65,86,73],{offset:8})){e.next=233;break}return e.abrupt("return",{ext:"avi",mime:"video/vnd.avi"});case 233:if(!r([87,65,86,69],{offset:8})){e.next=235;break}return e.abrupt("return",{ext:"wav",mime:"audio/vnd.wave"});case 235:if(!r([81,76,67,77],{offset:8})){e.next=237;break}return e.abrupt("return",{ext:"qcp",mime:"audio/qcelp"});case 237:if(!a("SQLi")){e.next=239;break}return e.abrupt("return",{ext:"sqlite",mime:"application/x-sqlite3"});case 239:if(!r([78,69,83,26])){e.next=241;break}return e.abrupt("return",{ext:"nes",mime:"application/x-nintendo-nes-rom"});case 241:if(!a("Cr24")){e.next=243;break}return e.abrupt("return",{ext:"crx",mime:"application/x-google-chrome-extension"});case 243:if(!a("MSCF")&&!a("ISc(")){e.next=245;break}return e.abrupt("return",{ext:"cab",mime:"application/vnd.ms-cab-compressed"});case 245:if(!r([237,171,238,219])){e.next=247;break}return e.abrupt("return",{ext:"rpm",mime:"application/x-rpm"});case 247:if(!r([197,208,211,198])){e.next=249;break}return e.abrupt("return",{ext:"eps",mime:"application/eps"});case 249:if(!r([40,181,47,253])){e.next=251;break}return e.abrupt("return",{ext:"zst",mime:"application/zstd"});case 251:if(!r([79,84,84,79,0])){e.next=253;break}return e.abrupt("return",{ext:"otf",mime:"font/otf"});case 253:if(!a("#!AMR")){e.next=255;break}return e.abrupt("return",{ext:"amr",mime:"audio/amr"});case 255:if(!a("{\\rtf")){e.next=257;break}return e.abrupt("return",{ext:"rtf",mime:"application/rtf"});case 257:if(!r([70,76,86,1])){e.next=259;break}return e.abrupt("return",{ext:"flv",mime:"video/x-flv"});case 259:if(!a("IMPM")){e.next=261;break}return e.abrupt("return",{ext:"it",mime:"audio/x-it"});case 261:if(!(a("-lh0-",{offset:2})||a("-lh1-",{offset:2})||a("-lh2-",{offset:2})||a("-lh3-",{offset:2})||a("-lh4-",{offset:2})||a("-lh5-",{offset:2})||a("-lh6-",{offset:2})||a("-lh7-",{offset:2})||a("-lzs-",{offset:2})||a("-lz4-",{offset:2})||a("-lz5-",{offset:2})||a("-lhd-",{offset:2}))){e.next=263;break}return e.abrupt("return",{ext:"lzh",mime:"application/x-lzh-compressed"});case 263:if(!r([0,0,1,186])){e.next=268;break}if(!r([33],{offset:4,mask:[241]})){e.next=266;break}return e.abrupt("return",{ext:"mpg",mime:"video/MP1S"});case 266:if(!r([68],{offset:4,mask:[196]})){e.next=268;break}return e.abrupt("return",{ext:"mpg",mime:"video/MP2P"});case 268:if(!a("ITSF")){e.next=270;break}return e.abrupt("return",{ext:"chm",mime:"application/vnd.ms-htmlhelp"});case 270:if(!r([253,55,122,88,90,0])){e.next=272;break}return e.abrupt("return",{ext:"xz",mime:"application/x-xz"});case 272:if(!a("<?xml ")){e.next=274;break}return e.abrupt("return",{ext:"xml",mime:"application/xml"});case 274:if(!r([55,122,188,175,39,28])){e.next=276;break}return e.abrupt("return",{ext:"7z",mime:"application/x-7z-compressed"});case 276:if(!r([82,97,114,33,26,7])||0!==n[6]&&1!==n[6]){e.next=278;break}return e.abrupt("return",{ext:"rar",mime:"application/x-rar-compressed"});case 278:if(!a("solid ")){e.next=280;break}return e.abrupt("return",{ext:"stl",mime:"model/stl"});case 280:if(!a("BLENDER")){e.next=282;break}return e.abrupt("return",{ext:"blend",mime:"application/x-blender"});case 282:if(!a("!<arch>")){e.next=291;break}return e.next=285,t.ignore(8);case 285:return e.next=287,t.readToken(new Token.StringType(13,"ascii"));case 287:if("debian-binary"!==e.sent){e.next=290;break}return e.abrupt("return",{ext:"deb",mime:"application/x-deb"});case 290:return e.abrupt("return",{ext:"ar",mime:"application/x-unix-archive"});case 291:if(!r([137,80,78,71,13,10,26,10])){e.next=309;break}return m=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readToken(Token.INT32_BE);case 2:return e.t0=e.sent,e.next=5,t.readToken(new Token.StringType(4,"binary"));case 5:return e.t1=e.sent,e.abrupt("return",{length:e.t0,type:e.t1});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.next=295,t.ignore(8);case 295:return e.next=297,m();case 297:if(!((b=e.sent).length<0)){e.next=300;break}return e.abrupt("return");case 300:e.t5=b.type,e.next="IDAT"===e.t5?303:"acTL"===e.t5?304:305;break;case 303:return e.abrupt("return",{ext:"png",mime:"image/png"});case 304:return e.abrupt("return",{ext:"apng",mime:"image/apng"});case 305:return e.next=307,t.ignore(b.length+4);case 307:if(t.position+8<t.fileInfo.size){e.next=295;break}case 308:return e.abrupt("return",{ext:"png",mime:"image/png"});case 309:if(!r([65,82,82,79,87,49,0,0])){e.next=311;break}return e.abrupt("return",{ext:"arrow",mime:"application/x-apache-arrow"});case 311:if(!r([103,108,84,70,2,0,0,0])){e.next=313;break}return e.abrupt("return",{ext:"glb",mime:"model/gltf-binary"});case 313:if(!(r([102,114,101,101],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))){e.next=315;break}return e.abrupt("return",{ext:"mov",mime:"video/quicktime"});case 315:if(!r([73,73,82,79,8,0,0,0,24])){e.next=317;break}return e.abrupt("return",{ext:"orf",mime:"image/x-olympus-orf"});case 317:if(!a("gimp xcf ")){e.next=319;break}return e.abrupt("return",{ext:"xcf",mime:"image/x-xcf"});case 319:if(!r([73,73,85,0,24,0,0,0,136,231,116,216])){e.next=321;break}return e.abrupt("return",{ext:"rw2",mime:"image/x-panasonic-rw2"});case 321:if(!r([48,38,178,117,142,102,207,17,166,217])){e.next=345;break}return w=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){var n;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Buffer.alloc(16),e.next=3,t.readBuffer(n);case 3:return e.t0=n,e.next=6,t.readToken(Token.UINT64_LE);case 6:return e.t1=e.sent,e.abrupt("return",{id:e.t0,size:e.t1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.next=325,t.ignore(30);case 325:if(!(t.position+24<t.fileInfo.size)){e.next=344;break}return e.next=328,w();case 328:if(_=e.sent,x=_.size-24,!_check(_.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){e.next=340;break}return k=Buffer.alloc(16),e.next=334,t.readBuffer(k);case 334:if(x-=e.sent,!_check(k,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43])){e.next=337;break}return e.abrupt("return",{ext:"asf",mime:"audio/x-ms-asf"});case 337:if(!_check(k,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43])){e.next=339;break}return e.abrupt("return",{ext:"asf",mime:"video/x-ms-asf"});case 339:return e.abrupt("break",344);case 340:return e.next=342,t.ignore(x);case 342:e.next=325;break;case 344:return e.abrupt("return",{ext:"asf",mime:"application/vnd.ms-asf"});case 345:if(!r([171,75,84,88,32,49,49,187,13,10,26,10])){e.next=347;break}return e.abrupt("return",{ext:"ktx",mime:"image/ktx"});case 347:if(!r([126,16,4])&&!r([126,24,4])||!r([48,77,73,69],{offset:4})){e.next=349;break}return e.abrupt("return",{ext:"mie",mime:"application/x-mie"});case 349:if(!r([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2})){e.next=351;break}return e.abrupt("return",{ext:"shp",mime:"application/x-esri-shape"});case 351:if(!r([0,0,0,12,106,80,32,32,13,10,135,10])){e.next=365;break}return e.next=354,t.ignore(20);case 354:return e.next=356,t.readToken(new Token.StringType(4,"ascii"));case 356:M=e.sent,e.t6=M,e.next="jp2 "===e.t6?360:"jpx "===e.t6?361:"jpm "===e.t6?362:"mjp2"===e.t6?363:364;break;case 360:return e.abrupt("return",{ext:"jp2",mime:"image/jp2"});case 361:return e.abrupt("return",{ext:"jpx",mime:"image/jpx"});case 362:return e.abrupt("return",{ext:"jpm",mime:"image/jpm"});case 363:return e.abrupt("return",{ext:"mj2",mime:"image/mj2"});case 364:return e.abrupt("return");case 365:if(!r([255,10])&&!r([0,0,0,12,74,88,76,32,13,10,135,10])){e.next=367;break}return e.abrupt("return",{ext:"jxl",mime:"image/jxl"});case 367:if(!r([0,0,1,186])&&!r([0,0,1,179])){e.next=369;break}return e.abrupt("return",{ext:"mpg",mime:"video/mpeg"});case 369:if(!r([0,1,0,0,0])){e.next=371;break}return e.abrupt("return",{ext:"ttf",mime:"font/ttf"});case 371:if(!r([0,0,1,0])){e.next=373;break}return e.abrupt("return",{ext:"ico",mime:"image/x-icon"});case 373:if(!r([0,0,2,0])){e.next=375;break}return e.abrupt("return",{ext:"cur",mime:"image/x-icon"});case 375:if(!r([208,207,17,224,161,177,26,225])){e.next=377;break}return e.abrupt("return",{ext:"cfb",mime:"application/x-cfb"});case 377:return e.next=379,t.peekBuffer(n,{length:Math.min(256,t.fileInfo.size),mayBeLess:!0});case 379:if(!a("BEGIN:")){e.next=384;break}if(!a("VCARD",{offset:6})){e.next=382;break}return e.abrupt("return",{ext:"vcf",mime:"text/vcard"});case 382:if(!a("VCALENDAR",{offset:6})){e.next=384;break}return e.abrupt("return",{ext:"ics",mime:"text/calendar"});case 384:if(!a("FUJIFILMCCD-RAW")){e.next=386;break}return e.abrupt("return",{ext:"raf",mime:"image/x-fujifilm-raf"});case 386:if(!a("Extended Module:")){e.next=388;break}return e.abrupt("return",{ext:"xm",mime:"audio/x-xm"});case 388:if(!a("Creative Voice File")){e.next=390;break}return e.abrupt("return",{ext:"voc",mime:"audio/x-voc"});case 390:if(!(r([4,0,0,0])&&n.length>=16)){e.next=402;break}if(!((S=n.readUInt32LE(12))>12&&n.length>=S+16)){e.next=402;break}if(e.prev=393,T=n.slice(16,S+16).toString(),!JSON.parse(T).files){e.next=398;break}return e.abrupt("return",{ext:"asar",mime:"application/x-asar"});case 398:e.next=402;break;case 400:e.prev=400,e.t7=e.catch(393);case 402:if(!r([6,14,43,52,2,5,1,1,13,1,2,1,1,2])){e.next=404;break}return e.abrupt("return",{ext:"mxf",mime:"application/mxf"});case 404:if(!a("SCRM",{offset:44})){e.next=406;break}return e.abrupt("return",{ext:"s3m",mime:"audio/x-s3m"});case 406:if(!r([71],{offset:4})||!r([71],{offset:192})&&!r([71],{offset:196})){e.next=408;break}return e.abrupt("return",{ext:"mts",mime:"video/mp2t"});case 408:if(!r([66,79,79,75,77,79,66,73],{offset:60})){e.next=410;break}return e.abrupt("return",{ext:"mobi",mime:"application/x-mobipocket-ebook"});case 410:if(!r([68,73,67,77],{offset:128})){e.next=412;break}return e.abrupt("return",{ext:"dcm",mime:"application/dicom"});case 412:if(!r([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70])){e.next=414;break}return e.abrupt("return",{ext:"lnk",mime:"application/x.ms.shortcut"});case 414:if(!r([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0])){e.next=416;break}return e.abrupt("return",{ext:"alias",mime:"application/x.apple.alias"});case 416:if(!r([76,80],{offset:34})||!(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8}))){e.next=418;break}return e.abrupt("return",{ext:"eot",mime:"application/vnd.ms-fontobject"});case 418:if(!r([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29])){e.next=420;break}return e.abrupt("return",{ext:"indd",mime:"application/x-indesign"});case 420:return e.next=422,t.peekBuffer(n,{length:Math.min(512,t.fileInfo.size),mayBeLess:!0});case 422:if(!tarHeaderChecksumMatches(n)){e.next=424;break}return e.abrupt("return",{ext:"tar",mime:"application/x-tar"});case 424:if(!r([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0])){e.next=426;break}return e.abrupt("return",{ext:"skp",mime:"application/vnd.sketchup.skp"});case 426:if(!a("-----BEGIN PGP MESSAGE-----")){e.next=428;break}return e.abrupt("return",{ext:"pgp",mime:"application/pgp-encrypted"});case 428:if(!(n.length>=2&&r([255,224],{offset:0,mask:[255,224]}))){e.next=439;break}if(!r([16],{offset:1,mask:[22]})){e.next=433;break}if(!r([8],{offset:1,mask:[8]})){e.next=432;break}return e.abrupt("return",{ext:"aac",mime:"audio/aac"});case 432:return e.abrupt("return",{ext:"aac",mime:"audio/aac"});case 433:if(!r([2],{offset:1,mask:[6]})){e.next=435;break}return e.abrupt("return",{ext:"mp3",mime:"audio/mpeg"});case 435:if(!r([4],{offset:1,mask:[6]})){e.next=437;break}return e.abrupt("return",{ext:"mp2",mime:"audio/mpeg"});case 437:if(!r([6],{offset:1,mask:[6]})){e.next=439;break}return e.abrupt("return",{ext:"mp1",mime:"audio/mpeg"});case 439:case"end":return e.stop()}}),e,this,[[61,116],[393,400]])}))),function(e){return _ref6.apply(this,arguments)}),_ref6;function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var Token=__webpack_require__(373),strtok3=__webpack_require__(374),_require=__webpack_require__(378),stringToBytes=_require.stringToBytes,tarHeaderChecksumMatches=_require.tarHeaderChecksumMatches,uint32SyncSafeToken=_require.uint32SyncSafeToken,supported=__webpack_require__(379),minimumBytes=4100;function _check(e,t,n){n=(0,_assign2.default)({offset:0},n);var r=!0,a=!1,i=void 0;try{for(var o,s=(0,_getIterator3.default)(t.entries());!(r=(o=s.next()).done);r=!0){var u=o.value,c=(0,_slicedToArray3.default)(u,2),l=c[0],d=c[1];if(n.mask){if(d!==(n.mask[l]&e[l+n.offset]))return!1}else if(d!==e[l+n.offset])return!1}}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return!0}var stream=function stream(readableStream){return new _promise2.default((function(resolve,reject){var stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){var t,n,r,a;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new stream.PassThrough,n=void 0,n=stream.pipeline?stream.pipeline(readableStream,t,(function(){})):readableStream.pipe(t),r=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0),e.prev=4,e.next=7,fromBuffer(r);case 7:a=e.sent,t.fileType=a,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),reject(e.t0);case 14:resolve(n);case 15:case"end":return e.stop()}}),e,void 0,[[4,11]])}))))}))},fileType={fromStream:fromStream,fromTokenizer:fromTokenizer,fromBuffer:fromBuffer,stream:stream};Object.defineProperty(fileType,"extensions",{get:function(){return new _set2.default(supported.extensions)}}),Object.defineProperty(fileType,"mimeTypes",{get:function(){return new _set2.default(supported.mimeTypes)}}),module.exports=fileType}).call(this,__webpack_require__(44).Buffer)},function(e,t,n){e.exports={default:n(371),__esModule:!0}},function(e,t,n){n(372),e.exports=9007199254740991},function(e,t,n){var r=n(8);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){"use strict";var r=i(n(0)),a=i(n(1));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.writeIntBE=t.readIntBE=t.writeUIntBE=t.readUIntBE=t.writeIntLE=t.AnsiStringType=t.StringType=t.BufferType=t.IgnoreType=t.Float80_LE=t.Float80_BE=t.Float64_LE=t.Float64_BE=t.Float32_LE=t.Float32_BE=t.Float16_LE=t.Float16_BE=t.INT64_BE=t.UINT64_BE=t.INT64_LE=t.UINT64_LE=t.INT32_LE=t.INT32_BE=t.INT24_BE=t.INT24_LE=t.INT16_LE=t.INT16_BE=t.INT8=t.UINT32_BE=t.UINT32_LE=t.UINT24_BE=t.UINT24_LE=t.UINT16_BE=t.UINT16_LE=t.UINT8=void 0;var o=n(223);t.UINT8={len:1,get:function(e,t){return e.readUInt8(t)},put:function(e,t,n){return e.writeUInt8(n,t)}},t.UINT16_LE={len:2,get:function(e,t){return e.readUInt16LE(t)},put:function(e,t,n){return e.writeUInt16LE(n,t)}},t.UINT16_BE={len:2,get:function(e,t){return e.readUInt16BE(t)},put:function(e,t,n){return e.writeUInt16BE(n,t)}},t.UINT24_LE={len:3,get:function(e,t){return e.readUIntLE(t,3)},put:function(e,t,n){return e.writeUIntLE(n,t,3)}},t.UINT24_BE={len:3,get:function(e,t){return e.readUIntBE(t,3)},put:function(e,t,n){return e.writeUIntBE(n,t,3)}},t.UINT32_LE={len:4,get:function(e,t){return e.readUInt32LE(t)},put:function(e,t,n){return e.writeUInt32LE(n,t)}},t.UINT32_BE={len:4,get:function(e,t){return e.readUInt32BE(t)},put:function(e,t,n){return e.writeUInt32BE(n,t)}},t.INT8={len:1,get:function(e,t){return e.readInt8(t)},put:function(e,t,n){return e.writeInt8(n,t)}},t.INT16_BE={len:2,get:function(e,t){return e.readInt16BE(t)},put:function(e,t,n){return e.writeInt16BE(n,t)}},t.INT16_LE={len:2,get:function(e,t){return e.readInt16LE(t)},put:function(e,t,n){return e.writeInt16LE(n,t)}},t.INT24_LE={len:3,get:function(e,t){return e.readIntLE(t,3)},put:function(e,t,n){return e.writeIntLE(n,t,3)}},t.INT24_BE={len:3,get:function(e,t){return e.readIntBE(t,3)},put:function(e,t,n){return e.writeIntBE(n,t,3)}},t.INT32_BE={len:4,get:function(e,t){return e.readInt32BE(t)},put:function(e,t,n){return e.writeInt32BE(n,t)}},t.INT32_LE={len:4,get:function(e,t){return e.readInt32LE(t)},put:function(e,t,n){return e.writeInt32LE(n,t)}},t.UINT64_LE={len:8,get:function(e,t){return function(e,t,n){n>>>=0;var r=e[t>>>=0],a=1,i=0;for(;++i<n&&(a*=256);)r+=e[t+i]*a;return r}(e,t,this.len)},put:function(e,t,n){return function(e,t,n,r){t=+t,r>>>=0;var a=1,i=0;e[n>>>=0]=255&t;for(;++i<r&&(a*=256);)e[n+i]=t/a&255;return n+r}(e,n,t,this.len)}},t.INT64_LE={len:8,get:function(e,t){return function(e,t,n){n>>>=0;var r=e[t>>>=0],a=1,i=0;for(;++i<n&&(a*=256);)r+=e[t+i]*a;r>=(a*=128)&&(r-=Math.pow(2,8*n));return r}(e,t,this.len)},put:function(e,t,n){return d(e,n,t,this.len)}},t.UINT64_BE={len:8,get:function(e,t){return f(e,t,this.len)},put:function(e,t,n){return p(e,n,t,this.len)}},t.INT64_BE={len:8,get:function(e,t){return h(e,t,this.len)},put:function(e,t,n){return g(e,n,t,this.len)}},t.Float16_BE={len:2,get:function(e,t){return o.read(e,t,!1,10,this.len)},put:function(e,t,n){return o.write(e,n,t,!1,10,this.len),t+this.len}},t.Float16_LE={len:2,get:function(e,t){return o.read(e,t,!0,10,this.len)},put:function(e,t,n){return o.write(e,n,t,!0,10,this.len),t+this.len}},t.Float32_BE={len:4,get:function(e,t){return e.readFloatBE(t)},put:function(e,t,n){return e.writeFloatBE(n,t)}},t.Float32_LE={len:4,get:function(e,t){return e.readFloatLE(t)},put:function(e,t,n){return e.writeFloatLE(n,t)}},t.Float64_BE={len:8,get:function(e,t){return e.readDoubleBE(t)},put:function(e,t,n){return e.writeDoubleBE(n,t)}},t.Float64_LE={len:8,get:function(e,t){return e.readDoubleLE(t)},put:function(e,t,n){return e.writeDoubleLE(n,t)}},t.Float80_BE={len:10,get:function(e,t){return o.read(e,t,!1,63,this.len)},put:function(e,t,n){return o.write(e,n,t,!1,63,this.len),t+this.len}},t.Float80_LE={len:10,get:function(e,t){return o.read(e,t,!0,63,this.len)},put:function(e,t,n){return o.write(e,n,t,!0,63,this.len),t+this.len}};var s=function(){function e(t){(0,r.default)(this,e),this.len=t}return(0,a.default)(e,[{key:"get",value:function(e,t){}}]),e}();t.IgnoreType=s;var u=function(){function e(t){(0,r.default)(this,e),this.len=t}return(0,a.default)(e,[{key:"get",value:function(e,t){return e.slice(t,t+this.len)}}]),e}();t.BufferType=u;var c=function(){function e(t,n){(0,r.default)(this,e),this.len=t,this.encoding=n}return(0,a.default)(e,[{key:"get",value:function(e,t){return e.toString(this.encoding,t,t+this.len)}}]),e}();t.StringType=c;var l=function(){function e(t){(0,r.default)(this,e),this.len=t}return(0,a.default)(e,[{key:"get",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.decode(t,n,n+this.len)}}],[{key:"decode",value:function(t,n,r){for(var a="",i=n;i<r;++i)a+=e.codePointToString(e.singleByteDecoder(t[i]));return a}},{key:"inRange",value:function(e,t,n){return t<=e&&e<=n}},{key:"codePointToString",value:function(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}},{key:"singleByteDecoder",value:function(t){if(e.inRange(t,0,127))return t;var n=e.windows1252[t-128];if(null===n)throw Error("invaliding encoding");return n}}]),e}();function d(e,t,n,r){t=+t;var a=0,i=1,o=0;for(e[n>>>=0]=255&t;++a<r&&(i*=256);)t<0&&0===o&&0!==e[n+a-1]&&(o=1),e[n+a]=(t/i>>0)-o&255;return n+r}function f(e,t,n){n>>>=0;for(var r=e[(t>>>=0)+--n],a=1;n>0&&(a*=256);)r+=e[t+--n]*a;return r}function p(e,t,n,r){t=+t;var a=(r>>>=0)-1,i=1;for(e[(n>>>=0)+a]=255&t;--a>=0&&(i*=256);)e[n+a]=t/i&255;return n+r}function h(e,t,n){for(var r=n>>>=0,a=1,i=e[(t>>>=0)+--r];r>0&&(a*=256);)i+=e[t+--r]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*n)),i}function g(e,t,n,r){t=+t;var a=r-1,i=1,o=0;for(e[(n>>>=0)+a]=255&t;--a>=0&&(i*=256);)t<0&&0===o&&0!==e[n+a+1]&&(o=1),e[n+a]=(t/i>>0)-o&255;return n+r}t.AnsiStringType=l,l.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255],t.writeIntLE=d,t.readUIntBE=f,t.writeUIntBE=p,t.readIntBE=h,t.writeIntBE=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromBuffer=t.fromStream=t.EndOfStreamError=void 0;var r=n(375),a=n(377),i=n(105);Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return i.EndOfStreamError}}),t.fromStream=function(e,t){return t=t||{},new r.ReadStreamTokenizer(e,t)},t.fromBuffer=function(e,t){return new a.BufferTokenizer(e,t)}},function(e,t,n){"use strict";(function(e){var r=d(n(70)),a=d(n(21)),i=d(n(57)),o=d(n(2)),s=d(n(0)),u=d(n(1)),c=d(n(3)),l=d(n(4));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ReadStreamTokenizer=void 0;var f=n(376),p=n(105),h=function(t){function n(e,t){(0,s.default)(this,n);var r=(0,c.default)(this,(n.__proto__||(0,o.default)(n)).call(this,t));return r.streamReader=new p.StreamReader(e),r}var d,f,h,g;return(0,l.default)(n,t),(0,u.default)(n,[{key:"getFileInfo",value:(g=(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fileInfo);case 1:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"readBuffer",value:(h=(0,i.default)(a.default.mark((function e(t,n){var i,o,s,u;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=0,o=t.length,!n){e.next=15;break}if((0,r.default)(n.length)?o=n.length:o-=n.offset||0,!n.position){e.next=14;break}if(!((s=n.position-this.position)>0)){e.next=12;break}return e.next=9,this.ignore(s);case 9:return e.abrupt("return",this.readBuffer(t,n));case 12:if(!(s<0)){e.next=14;break}throw new Error("`options.position` must be equal or greater than `tokenizer.position`");case 14:n.offset&&(i=n.offset);case 15:if(0!==o){e.next=17;break}return e.abrupt("return",0);case 17:return e.next=19,this.streamReader.read(t,i,o);case 19:if(u=e.sent,this.position+=u,n&&n.mayBeLess||!(u<o)){e.next=23;break}throw new p.EndOfStreamError;case 23:return e.abrupt("return",u);case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"peekBuffer",value:(f=(0,i.default)(a.default.mark((function t(n,i){var o,s,u,c,l;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=0,s=void 0,u=n.length,!i){t.next=19;break}if(i.offset&&(o=i.offset),(0,r.default)(i.length)?u=i.length:u-=i.offset||0,!i.position){t.next=19;break}if(!((c=i.position-this.position)>0)){t.next=17;break}return l=e.alloc(u+c),t.next=12,this.peekBuffer(l,{mayBeLess:i.mayBeLess});case 12:return s=t.sent,l.copy(n,o,c),t.abrupt("return",s-c);case 17:if(!(c<0)){t.next=19;break}throw new Error("Cannot peek from a negative offset in a stream");case 19:return t.prev=19,t.next=22,this.streamReader.peek(n,o,u);case 22:s=t.sent,t.next=30;break;case 25:if(t.prev=25,t.t0=t.catch(19),!(i&&i.mayBeLess&&t.t0 instanceof p.EndOfStreamError)){t.next=29;break}return t.abrupt("return",0);case 29:throw t.t0;case 30:if(i&&i.mayBeLess||!(s<u)){t.next=32;break}throw new p.EndOfStreamError;case 32:return t.abrupt("return",s);case 33:case"end":return t.stop()}}),t,this,[[19,25]])}))),function(e,t){return f.apply(this,arguments)})},{key:"ignore",value:(d=(0,i.default)(a.default.mark((function t(n){var r,i,o,s,u;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=Math.min(256e3,n),i=e.alloc(r),o=0;case 3:if(!(o<n)){t.next=13;break}return s=n-o,t.next=7,this.readBuffer(i,{length:Math.min(r,s)});case 7:if(!((u=t.sent)<0)){t.next=10;break}return t.abrupt("return",u);case 10:o+=u,t.next=3;break;case 13:return t.abrupt("return",o);case 14:case"end":return t.stop()}}),t,this)}))),function(e){return d.apply(this,arguments)})}]),n}(f.AbstractTokenizer);t.ReadStreamTokenizer=h}).call(this,n(44).Buffer)},function(e,t,n){"use strict";(function(e){var r=s(n(21)),a=s(n(57)),i=s(n(0)),o=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractTokenizer=void 0;var u=n(105),c=function(){function t(n){(0,i.default)(this,t),this.position=0,this.numBuffer=e.alloc(10),this.fileInfo=n||{}}var n,s,c,l,d;return(0,o.default)(t,[{key:"readToken",value:(d=(0,a.default)(r.default.mark((function t(n,a){var i;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.alloc(n.len),t.next=3,this.readBuffer(i,{position:a});case 3:if(!(t.sent<n.len)){t.next=6;break}throw new u.EndOfStreamError;case 6:return t.abrupt("return",n.get(i,0));case 7:case"end":return t.stop()}}),t,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"peekToken",value:(l=(0,a.default)(r.default.mark((function t(n){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.alloc(n.len),t.next=3,this.peekBuffer(a,{position:i});case 3:if(!(t.sent<n.len)){t.next=6;break}throw new u.EndOfStreamError;case 6:return t.abrupt("return",n.get(a,0));case 7:case"end":return t.stop()}}),t,this)}))),function(e){return l.apply(this,arguments)})},{key:"readNumber",value:(c=(0,a.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readBuffer(this.numBuffer,{length:t.len});case 2:if(!(e.sent<t.len)){e.next=5;break}throw new u.EndOfStreamError;case 5:return e.abrupt("return",t.get(this.numBuffer,0));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"peekNumber",value:(s=(0,a.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.peekBuffer(this.numBuffer,{length:t.len});case 2:if(!(e.sent<t.len)){e.next=5;break}throw new u.EndOfStreamError;case 5:return e.abrupt("return",t.get(this.numBuffer,0));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"close",value:(n=(0,a.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),t}();t.AbstractTokenizer=c}).call(this,n(44).Buffer)},function(e,t,n){"use strict";var r=c(n(13)),a=c(n(70)),i=c(n(21)),o=c(n(57)),s=c(n(0)),u=c(n(1));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BufferTokenizer=void 0;var l=n(105),d=function(){function e(t,n){(0,s.default)(this,e),this.buffer=t,this.position=0,this.fileInfo=n||{},this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:t.length}var t,n,c,d,f,p,h,g;return(0,u.default)(e,[{key:"readBuffer",value:(g=(0,o.default)(i.default.mark((function e(t,n){var r=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!n.position){e.next=4;break}if(!(n.position<this.position)){e.next=3;break}throw new Error("`options.position` must be equal or greater than `tokenizer.position`");case 3:this.position=n.position;case 4:return e.abrupt("return",this.peekBuffer(t,n).then((function(e){return r.position+=e,e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"peekBuffer",value:(h=(0,o.default)(i.default.mark((function e(t,n){var o,s,u,c;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=0,s=t.length,u=this.position,!n){e.next=10;break}if(!n.position){e.next=8;break}if(!(n.position<this.position)){e.next=7;break}throw new Error("`options.position` can be less than `tokenizer.position`");case 7:u=n.position;case 8:(0,a.default)(n.length)?s=n.length:s-=n.offset||0,n.offset&&(o=n.offset);case 10:if(0!==s){e.next=12;break}return e.abrupt("return",r.default.resolve(0));case 12:if(u=u||this.position,s||(s=t.length),c=Math.min(this.buffer.length-u,s),n&&n.mayBeLess||!(c<s)){e.next=19;break}throw new l.EndOfStreamError;case 19:return this.buffer.copy(t,o,u,u+c),e.abrupt("return",c);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"readToken",value:(p=(0,o.default)(i.default.mark((function e(t,n){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.position=n||this.position,e.prev=1,r=this.peekToken(t,this.position),this.position+=t.len,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(1),this.position+=this.buffer.length-n,e.t0;case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return p.apply(this,arguments)})},{key:"peekToken",value:(f=(0,o.default)(i.default.mark((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length-n<t.len)){e.next=2;break}throw new l.EndOfStreamError;case 2:return e.abrupt("return",t.get(this.buffer,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"readNumber",value:(d=(0,o.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readToken(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"peekNumber",value:(c=(0,o.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.peekToken(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"ignore",value:(n=(0,o.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Math.min(this.buffer.length-this.position,t),this.position+=n,e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();t.BufferTokenizer=d},function(e,t,n){"use strict";var r,a=n(41),i=(r=a)&&r.__esModule?r:{default:r};t.stringToBytes=function(e){return[].concat((0,i.default)(e)).map((function(e){return e.charCodeAt(0)}))},t.tarHeaderChecksumMatches=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(n))return!1;for(var r=256,a=t;a<t+148;a++)r+=e[a];for(var i=t+156;i<t+512;i++)r+=e[i];return n===r},t.uint32SyncSafeToken={get:function(e,t){return 127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21},len:4}},function(e,t,n){"use strict";e.exports={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadMedia=void 0;var r=s(n(19)),a=s(n(13)),i=s(n(5)),o=s(n(238));function s(e){return e&&e.__esModule?e:{default:e}}o.default.setExpireTime(864e5);t.uploadMedia=function(e,t){if("function"==typeof e.getAuthInfo)u(e,t);else{if(e.nim&&"function"==typeof e.nim.previewFile)return e.nim.previewFile(t);e.logger.error("无法上传文件！！")}};var u=function(e,t){var n,r,a,s=(null===(n=e.serviceConf)||void 0===n?void 0:n.mediaUploadAddr)?e.serviceConf.mediaUploadAddr:"https://vcloud.163.com",u=(null===(r=e.serviceConf)||void 0===r?void 0:r.directNosAddr)?null===(a=e.serviceConf)||void 0===a?void 0:a.directNosAddr:"https://wanproxy-web.127.net";e.getAuthInfo().then((function(n){var r=o.default.createConfig({directUploadAddr:u,onError:function(e){t.done(e)},onProgress:function(e){t.uploadprogress({percentageText:(100*e).toFixed(2)+"%"})},onComplete:function(r){c(e,n,r).then((function(e){t.done(void 0,e)})).catch((function(e){t.done(e)}))}}),a=l(t),d=o.default.getFileUploadInformation(a);if(!d)return f((0,i.default)((0,i.default)({},n),{appkey:e.appkey,url:s+"/app/vod/upload/init"}),{originFileName:a.name}).then((function(e){o.default.createTask(a,{bucketName:e.ret.bucket,objectName:e.ret.object,token:e.ret.xNosToken,payload:{mediaType:t.mediaType}},r)})).catch((function(e){t.done(e)}));d.complete?r.onComplete(d.uploadInfo):o.default.createTask(a,d.uploadInfo,r)}))},c=function(e,t,n){var o,s=n&&n.payload&&n.payload.mediaType;if(!s)return a.default.reject("mediaType无法解析: "+s);var u=(null===(o=e.serviceConf)||void 0===o?void 0:o.mediaUploadAddr)?e.serviceConf.mediaUploadAddr:"https://vcloud.163.com";return f((0,i.default)((0,i.default)({url:u+"/app/vod/video/query"},t),{appkey:e.appkey}),{objectNames:[n.objectName]}).then((function(e){if(e.ret&&Array.isArray(e.ret.list)&&e.ret.list.length>0)return"image"===s&&e.ret.list[0].imgId?e.ret.list[0].imgId:e.ret.list[0].vid?e.ret.list[0].vid:a.default.reject("无法获取"+s+" id: "+(0,r.default)(e))})).then((function(n){var r="image"===s?{imageId:n}:{vid:n};return f((0,i.default)((0,i.default)({url:"image"===s?u+"/app/vod/image/get":u+"/app/vod/video/get"},t),{appkey:e.appkey}),r)})).then((function(e){var t=void 0;return"image"===s&&e.ret&&e.ret.url?t=e.ret.url:e.ret&&e.ret.origUrl&&(t=e.ret.origUrl),"string"==typeof t&&t.startsWith("http://")&&(t="https://"+t.slice(7)),"string"==typeof t?{url:t}:a.default.reject("找不到"+s+"的url地址: "+(0,r.default)(e))}))},l=function(e){var t=e.dataURL,n=e.fileInput,r=e.blob,a=e.fileName?e.fileName:Date.now().toString();if(n&&n.files&&n.files.length>0)return n.files[0];if(r)return new File([r],a,{type:"text/plain"});if(t)return d(t,a);throw new Error("previewFile参数中缺少数据")},d=function(e,t){for(var n=e.split(","),r=n[0].match(/:(.*?);/)[1],a=atob(n[1]),i=a.length,o=new Uint8Array(i);i--;)o[i]=a.charCodeAt(i);return new File([o],t,{type:r})},f=function(e,t){return fetch(e.url,{method:"post",headers:{"content-type":"application/json",AppKey:e.appkey,Nonce:e.nonce,CurTime:e.curTime.toString(),CheckSum:e.checksum},body:(0,r.default)(t)}).then((function(e){return e.ok?e.json():a.default.reject(e)})).then((function(e){return 200!==e.code?a.default.reject(e):e}))}},function(e,t,n){!function(n){"use strict";function r(e,t){if(e instanceof Boolean||"boolean"==typeof e)return!1;if(t instanceof Object||(t={}),!1===t.allowEmpty&&""===e)return!1;var n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?",r="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)";return!0===t.mimeRequired?n=r+n:!0===t.allowMime&&(n=r+"?"+n),!1===t.paddingRequired&&(n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+n+"$","gi").test(e)}e.exports&&(t=e.exports=r),t.isBase64=r}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapPluginToOp=void 0;var r=d(n(2)),a=d(n(0)),i=d(n(1)),o=d(n(3)),s=d(n(4)),u=d(n(134)),c=n(18),l=d(n(87));function d(e){return e&&e.__esModule?e:{default:e}}t.wrapPluginToOp=function(e,t){if(!u.default.validate(e,"OneMotionPlugin.wrapPluginToOp",t,{type:{type:"string",isRequire:!0},draw:{type:"function",isRequire:!0},ifMouseOnOp:{type:"function",isRequire:!0},getBoundary:{type:"function"}}))throw new Error("OneMotion插件参数错误，请仔细检查你的参数");return function(e){function n(){(0,a.default)(this,n);var e=(0,o.default)(this,(n.__proto__||(0,r.default)(n)).apply(this,arguments));return e.type=t.type,e.shouldSaniteEp=!0,e}return(0,s.default)(n,e),(0,i.default)(n,[{key:"getSnapshot",value:function(e){var n="function"==typeof t.getBoundary?t.getBoundary({sp:this.sp,ep:this.ep}):this.getBoundaryRectOfLine();return{type:t.type,boundary:n,inProgress:e,sp:this.sp,ep:this.ep,lineWidth:this.lineWidth,opacity:this.opacity,color:this.color}}},{key:"draw",value:function(e,n){var r=e.data,a=(0,c.getTransformedPoint)(r.sp,r.dx,r.dy,r.scaleX,r.scaleY),i=(0,c.getTransformedPoint)(r.ep,r.dx,r.dy,r.scaleX,r.scaleY);n.save(),t.draw({ctx:n,sp:a,ep:i,lineWidth:r.lineWidth,opacity:r.opacity,color:r.color}),n.restore()}},{key:"ifMouseOnOp",value:function(e,n,r){var a=this.app.container.ctx,i=e.data,o=(0,c.getTransformedPoint)(i.sp,i.dx,i.dy,i.scaleX,i.scaleY),s=(0,c.getTransformedPoint)(i.ep,i.dx,i.dy,i.scaleX,i.scaleY);a.save(),a.beginPath(),a.fillStyle="rgba(0,0,0,0)",a.strokeStyle="rgba(0,0,0,0)";var u=t.ifMouseOnOp(n,r,{ctx:a,sp:o,ep:s,lineWidth:i.lineWidth,opacity:i.opacity,color:i.color});return a.restore(),u}}]),n}(l.default)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(9)),a=u(n(31)),i=u(n(95)),o=u(n(0)),s=u(n(1));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){var n=this;(0,o.default)(this,e),this.isBroadcaster=!1,this.aliveMap=new i.default,this.aliveSet=new a.default,this.visionChangeCb=function(e,t){if("vision"===e){var r=n.shouldKeepAlive;t&&"broadcaster"===t.mode?n.isBroadcaster=!0:n.isBroadcaster=!1,n.update(r)}},this.sendAlive=function(){clearTimeout(n.aliveTimer);var e=Date.now()+n.app.ntpTimeDiff;n.app.dataHub.broadcastData({data:{type:"alive",value:{uid:n.app.account,t:e}}},"alive",!0),n.aliveMap.set(n.app.account,e),n.aliveSet.add(n.app.account),n.aliveTimer=setTimeout(n.sendAlive,7e3)},this.checkAlive=function(){var e=[],t=n.aliveMap.keys(),a=!0,i=!1,o=void 0;try{for(var s,u=(0,r.default)(t);!(a=(s=u.next()).done);a=!0){var c=s.value;n.isAlive(c)||(e.push(c),n.aliveMap.delete(c))}}catch(e){i=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw o}}e.length>0&&n.app.emit("aliveManager:offline",e),clearTimeout(n.checkTimer),n.checkTimer=setTimeout(n.checkAlive,7e3)},this.app=t,this.app.isRecordPlayer||this.app.on("event:appState:change",this.visionChangeCb),this.checkAlive()}return(0,s.default)(e,[{key:"destroy",value:function(){this.app.isRecordPlayer||this.app.off("event:appState:change",this.visionChangeCb),clearTimeout(this.aliveTimer),clearTimeout(this.checkTimer)}},{key:"update",value:function(e){e!==this.shouldKeepAlive&&(this.shouldKeepAlive?(clearTimeout(this.aliveTimer),this.sendAlive()):clearTimeout(this.aliveTimer))}},{key:"receiveAlive",value:function(e){this.aliveMap.set(e.uid,e.t),this.aliveSet.add(e.uid.toString())}},{key:"receiveSyncData",value:function(e){var t;if(this.app.isRecordPlayer){var n=null===(t=this.app.player)||void 0===t?void 0:t.lastTime;if(n){var a=!0,i=!1,o=void 0;try{for(var s,u=(0,r.default)(e);!(a=(s=u.next()).done);a=!0){var c=s.value;n-c.time<2e4&&(this.aliveMap.set(c.record.value.uid.toString(),c.time),this.aliveSet.add(c.record.value.uid.toString()))}}catch(e){i=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw o}}}}else{var l=Date.now()+this.app.ntpTimeDiff,d=!0,f=!1,p=void 0;try{for(var h,g=(0,r.default)(e);!(d=(h=g.next()).done);d=!0){var v=h.value;l-v.t<2e4&&(this.aliveMap.set(v.uid.toString(),v.t),this.aliveSet.add(v.uid.toString()))}}catch(e){f=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(f)throw p}}}}},{key:"isAlive",value:function(e){var t;if(e&&!this.aliveSet.has(e))return!0;if(e&&this.aliveMap.has(e)){var n=this.aliveMap.get(e);if(this.app.isRecordPlayer){var r=null===(t=this.app.player)||void 0===t?void 0:t.lastTime;if(r&&r>n&&r-n<2e4)return!0}else{var a=Date.now()+this.app.ntpTimeDiff;if(Math.abs(a-n)<2e4)return!0}}return!1}},{key:"shouldKeepAlive",get:function(){return this.isBroadcaster}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(0)),a=c(n(1)),i=c(n(385)),o=c(n(132)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(386)),u=n(239);function c(e){return e&&e.__esModule?e:{default:e}}var l=(new Date).valueOf(),d=function(){function e(t){(0,r.default)(this,e),this.dispatcher=new o.default,this.logger=new i.default("whiteboard-"+t,864e5),this.wrapLog(),this.log(u.SPLITTER)}return(0,a.default)(e,[{key:"getLogTilNow",value:function(){var e=(new Date).valueOf();return this.logger.get({start:0,end:e}).then((function(e){return e}))}},{key:"deleteLogTilNow",value:function(){var e=(new Date).valueOf();this.logger.delete({start:0,end:e})}},{key:"wrapLog",value:function(){this.log=this.wrapLogByType("log"),this.info=this.wrapLogByType("info"),this.error=this.wrapLogByType("error"),this.warn=this.wrapLogByType("warn"),this.debug=this.wrapLogByType("debug")}},{key:"wrapLogByType",value:function(e){var t=this;return function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=Array.prototype.slice.apply(r);i=[t.getLogPrefix()].concat(i);var o=t.argsToString.call(t,i,e);try{t.dispatcher.emit("log",{type:e,msg:o}),"error"===e&&console[e].apply(console,i),t.logger.log(e,o)}catch(e){}}}},{key:"argsToString",value:function(e,t){var n="";try{for(var r=[],a=0;a<e.length;a++)s.isFunction(e[a])?r.push(e[a].toString()):s.isObject(e[a])||s.isArray(e[a])?r.push(s.JSONStringify(e[a])):r.push(e[a]);n=r.join(" ")}catch(e){}return this.padEnd(t,5)+" "+n}},{key:"getLogPrefix",value:function(){var e=new Date,t=e.valueOf()-l,n=e.toLocaleString();return"+"+this.pad(t/1e3,1,6)+"s "+n}},{key:"pad",value:function(e,t,n){for(var r=e.toFixed(t).toString();r.length<n;)r=" "+r;return r}},{key:"padEnd",value:function(e,t){for(;e.length<t;)e+=" ";return e}}]),e}();t.default=d},function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=106)}([function(e,t,n){"use strict";var r=n(3),a=n(27).f,i=n(74),o=n(9),s=n(12),u=n(14),c=n(13),l=function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var n,d,f,p,h,g,v,y,m=e.target,b=e.global,w=e.stat,_=e.proto,x=b?r:w?r[m]:(r[m]||{}).prototype,k=b?o:o[m]||(o[m]={}),M=k.prototype;for(f in t)n=!i(b?f:m+(w?".":"#")+f,e.forced)&&x&&c(x,f),h=k[f],n&&(g=e.noTargetGet?(y=a(x,f))&&y.value:x[f]),p=n&&g?g:t[f],n&&typeof h==typeof p||(v=e.bind&&n?s(p,r):e.wrap&&n?l(p):_&&"function"==typeof p?s(Function.call,p):p,(e.sham||p&&p.sham||h&&h.sham)&&u(v,"sham",!0),k[f]=v,_&&(c(o,d=m+"Prototype")||u(o,d,{}),o[d][f]=p,e.real&&M&&!M[f]&&u(M,f,p)))}},function(e,t,n){var r=n(10);e.exports=function(e){if(!r(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){e.exports=!0},function(e,t,n){(function(t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,n(110))},function(e,t,n){var r=n(1),a=n(116),i=n(29),o=n(12),s=n(82),u=n(117),c=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,n){var l,d,f,p,h,g,v,y=n&&n.that,m=!(!n||!n.AS_ENTRIES),b=!(!n||!n.IS_ITERATOR),w=!(!n||!n.INTERRUPTED),_=o(t,y,1+m+w),x=function(e){return l&&u(l),new c(!0,e)},k=function(e){return m?(r(e),w?_(e[0],e[1],x):_(e[0],e[1])):w?_(e,x):_(e)};if(b)l=e;else{if("function"!=typeof(d=s(e)))throw TypeError("Target is not iterable");if(a(d)){for(f=0,p=i(e.length);p>f;f++)if((h=k(e[f]))&&h instanceof c)return h;return new c(!1)}l=d.call(e)}for(g=l.next;!(v=g.call(l)).done;){try{h=k(v.value)}catch(e){throw u(l),e}if("object"==typeof h&&h&&h instanceof c)return h}return new c(!1)}},function(e,t,n){var r=n(9),a=n(13),i=n(68),o=n(15).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});a(t,e)||o(t,e,{value:i.f(e)})}},function(e,t,n){var r=n(3),a=n(53),i=n(13),o=n(40),s=n(58),u=n(81),c=a("wks"),l=r.Symbol,d=u?l:l&&l.withoutSetter||o;e.exports=function(e){return i(c,e)&&(s||"string"==typeof c[e])||(s&&i(l,e)?c[e]=l[e]:c[e]=d("Symbol."+e)),c[e]}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t){e.exports={}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(7);e.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,n){var r=n(8);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(19),a={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return a.call(r(e),t)}},function(e,t,n){var r=n(11),a=n(15),i=n(22);e.exports=r?function(e,t,n){return a.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(11),a=n(73),i=n(1),o=n(37),s=Object.defineProperty;t.f=r?s:function(e,t,n){if(i(e),t=o(t,!0),i(n),a)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(9),a=n(3),i=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?i(r[e])||i(a[e]):r[e]&&r[e][t]||a[e]&&a[e][t]}},function(e,t,n){var r=n(2),a=n(224);e.exports=r?a:function(e){return Map.prototype.entries.call(e)}},function(e,t,n){var r=n(72),a=n(36);e.exports=function(e){return r(a(e))}},function(e,t,n){var r=n(36);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r,a,i,o=n(89),s=n(3),u=n(10),c=n(14),l=n(13),d=n(54),f=n(39),p=n(30),h=s.WeakMap;if(o||d.state){var g=d.state||(d.state=new h),v=g.get,y=g.has,m=g.set;r=function(e,t){if(y.call(g,e))throw new TypeError("Object already initialized");return t.facade=e,m.call(g,e,t),t},a=function(e){return v.call(g,e)||{}},i=function(e){return y.call(g,e)}}else{var b=f("state");p[b]=!0,r=function(e,t){if(l(e,b))throw new TypeError("Object already initialized");return t.facade=e,c(e,b,t),t},a=function(e){return l(e,b)?e[b]:{}},i=function(e){return l(e,b)}}e.exports={set:r,get:a,has:i,enforce:function(e){return i(e)?a(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!u(t)||(n=a(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},function(e,t,n){var r=n(9);e.exports=function(e){return r[e+"Prototype"]}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports={}},function(e,t,n){var r=n(59),a=n(15).f,i=n(14),o=n(13),s=n(119),u=n(6)("toStringTag");e.exports=function(e,t,n,c){if(e){var l=n?e:e.prototype;o(l,u)||a(l,u,{configurable:!0,value:t}),c&&!r&&i(l,"toString",s)}}},function(e,t,n){var r=n(12),a=n(72),i=n(19),o=n(29),s=n(63),u=[].push,c=function(e){var t=1==e,n=2==e,c=3==e,l=4==e,d=6==e,f=7==e,p=5==e||d;return function(h,g,v,y){for(var m,b,w=i(h),_=a(w),x=r(g,v,3),k=o(_.length),M=0,S=y||s,T=t?S(h,k):n||f?S(h,0):void 0;k>M;M++)if((p||M in _)&&(b=x(m=_[M],M,w),e))if(t)T[M]=b;else if(b)switch(e){case 3:return!0;case 5:return m;case 6:return M;case 2:u.call(T,m)}else switch(e){case 4:return!1;case 7:u.call(T,m)}return d?-1:c||l?l:T}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6),filterOut:c(7)}},function(e,t,n){e.exports=n(107)},function(e,t,n){var r=n(11),a=n(71),i=n(22),o=n(18),s=n(37),u=n(13),c=n(73),l=Object.getOwnPropertyDescriptor;t.f=r?l:function(e,t){if(e=o(e),t=s(t,!0),c)try{return l(e,t)}catch(e){}if(u(e,t))return i(!a.f.call(e,t),e[t])}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(42),a=Math.min;e.exports=function(e){return e>0?a(r(e),9007199254740991):0}},function(e,t){e.exports={}},function(e,t,n){var r=n(14);e.exports=function(e,t,n,a){a&&a.enumerable?e[t]=n:r(e,t,n)}},function(e,t,n){var r=n(1),a=n(8),i=n(6)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||null==(n=r(o)[i])?t:a(n)}},function(e,t,n){"use strict";var r=n(8),a=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new a(e)}},function(e,t,n){n(128);var r=n(129),a=n(3),i=n(45),o=n(14),s=n(23),u=n(6)("toStringTag");for(var c in r){var l=a[c],d=l&&l.prototype;d&&i(d)!==u&&o(d,u,c),s[c]=s.Array}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var r=n(10);e.exports=function(e,t){if(!r(e))return e;var n,a;if(t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;if("function"==typeof(n=e.valueOf)&&!r(a=n.call(e)))return a;if(!t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){e.exports=n(111)},function(e,t,n){var r=n(53),a=n(40),i=r("keys");e.exports=function(e){return i[e]||(i[e]=a(e))}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+r).toString(36)}},function(e,t,n){var r,a=n(1),i=n(76),o=n(57),s=n(30),u=n(80),c=n(51),l=n(39)("IE_PROTO"),d=function(){},f=function(e){return"<script>"+e+"<\/script>"},p=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;p=r?function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t}(r):((t=c("iframe")).style.display="none",u.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F);for(var n=o.length;n--;)delete p.prototype[o[n]];return p()};s[l]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(d.prototype=a(e),n=new d,d.prototype=null,n[l]=e):n=p(),void 0===t?n:i(n,t)}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r,a,i=n(3),o=n(44),s=i.process,u=s&&s.versions,c=u&&u.v8;c?a=(r=c.split("."))[0]<4?1:r[0]+r[1]:o&&(!(r=o.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=o.match(/Chrome\/(\d+)/))&&(a=r[1]),e.exports=a&&+a},function(e,t,n){var r=n(16);e.exports=r("navigator","userAgent")||""},function(e,t,n){var r=n(59),a=n(28),i=n(6)("toStringTag"),o="Arguments"==a(function(){return arguments}());e.exports=r?a:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?a(t):"Object"==(r=a(t))&&"function"==typeof t.callee?"Arguments":r}},function(e,t){},function(e,t,n){var r=n(31);e.exports=function(e,t,n){for(var a in t)n&&n.unsafe&&e[a]?e[a]=t[a]:r(e,a,t[a],n);return e}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,n){var r=n(30),a=n(10),i=n(13),o=n(15).f,s=n(40),u=n(217),c=s("meta"),l=0,d=Object.isExtensible||function(){return!0},f=function(e){o(e,c,{value:{objectID:"O"+ ++l,weakData:{}}})},p=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,c)){if(!d(e))return"F";if(!t)return"E";f(e)}return e[c].objectID},getWeakData:function(e,t){if(!i(e,c)){if(!d(e))return!0;if(!t)return!1;f(e)}return e[c].weakData},onFreeze:function(e){return u&&p.REQUIRED&&d(e)&&!i(e,c)&&f(e),e}};r[c]=!0},function(e,t,n){var r=n(3),a=n(10),i=r.document,o=a(i)&&a(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var r=n(13),a=n(19),i=n(39),o=n(114),s=i("IE_PROTO"),u=Object.prototype;e.exports=o?Object.getPrototypeOf:function(e){return e=a(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?u:null}},function(e,t,n){var r=n(2),a=n(54);(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.13.1",mode:r?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var r=n(3),a=n(113),i=r["__core-js_shared__"]||a("__core-js_shared__",{});e.exports=i},function(e,t,n){var r=n(1),a=n(115);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,i){return r(n),a(i),t?e.call(n,i):n.__proto__=i,n}}():void 0)},function(e,t,n){var r=n(77),a=n(57);e.exports=Object.keys||function(e){return r(e,a)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){var r=n(43),a=n(7);e.exports=!!Object.getOwnPropertySymbols&&!a((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},function(e,t,n){var r={};r[n(6)("toStringTag")]="z",e.exports="[object z]"===String(r)},function(e,t,n){var r=n(28),a=n(3);e.exports="process"==r(a.process)},function(e,t,n){"use strict";var r=n(126).charAt,a=n(20),i=n(62),o=a.set,s=a.getterFor("String Iterator");i(String,"String",(function(e){o(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=s(this),n=t.string,a=t.index;return a>=n.length?{value:void 0,done:!0}:(e=r(n,a),t.index+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";var r=n(0),a=n(127),i=n(52),o=n(55),s=n(24),u=n(14),c=n(31),l=n(6),d=n(2),f=n(23),p=n(92),h=p.IteratorPrototype,g=p.BUGGY_SAFARI_ITERATORS,v=l("iterator"),y=function(){return this};e.exports=function(e,t,n,l,p,m,b){a(n,t,l);var w,_,x,k=function(e){if(e===p&&O)return O;if(!g&&e in T)return T[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},M=t+" Iterator",S=!1,T=e.prototype,I=T[v]||T["@@iterator"]||p&&T[p],O=!g&&I||k(p),P="Array"==t&&T.entries||I;if(P&&(w=i(P.call(new e)),h!==Object.prototype&&w.next&&(d||i(w)===h||(o?o(w,h):"function"!=typeof w[v]&&u(w,v,y)),s(w,M,!0,!0),d&&(f[M]=y))),"values"==p&&I&&"values"!==I.name&&(S=!0,O=function(){return I.call(this)}),d&&!b||T[v]===O||u(T,v,O),f[t]=O,p)if(_={values:k("values"),keys:m?O:k("keys"),entries:k("entries")},b)for(x in _)(g||S||!(x in T))&&c(T,x,_[x]);else r({target:t,proto:!0,forced:g||S},_);return _}},function(e,t,n){var r=n(10),a=n(64),i=n(6)("species");e.exports=function(e,t){var n;return a(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!a(n.prototype)?r(n)&&null===(n=n[i])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},function(e,t,n){var r=n(28);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){"use strict";var r=n(37),a=n(15),i=n(22);e.exports=function(e,t,n){var o=r(t);o in e?a.f(e,o,i(0,n)):e[o]=n}},function(e,t,n){var r=n(7),a=n(6),i=n(43),o=a("species");e.exports=function(e){return i>=51||!r((function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,n){var r=n(77),a=n(57).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,a)}},function(e,t,n){var r=n(6);t.f=r},function(e,t,n){"use strict";var r=n(7);e.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){throw 1},1)}))}},function(e,t,n){"use strict";var r=n(1);e.exports=function(e,t){var n,a=r(this),i=arguments.length>2?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof i)throw TypeError("At least one callback required");return a.has(e)?(n=a.get(e),"function"==typeof t&&(n=t(n),a.set(e,n))):"function"==typeof i&&(n=i(),a.set(e,n)),n}},function(e,t,n){"use strict";var r={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,i=a&&!r.call({1:2},1);t.f=i?function(e){var t=a(this,e);return!!t&&t.enumerable}:r},function(e,t,n){var r=n(7),a=n(28),i="".split;e.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==a(e)?i.call(e,""):Object(e)}:Object},function(e,t,n){var r=n(11),a=n(7),i=n(51);e.exports=!r&&!a((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(7),a=/#|\.prototype\./,i=function(e,t){var n=s[o(e)];return n==c||n!=u&&("function"==typeof t?r(t):!!t)},o=i.normalize=function(e){return String(e).replace(a,".").toLowerCase()},s=i.data={},u=i.NATIVE="N",c=i.POLYFILL="P";e.exports=i},function(e,t,n){"use strict";var r=n(0),a=n(52),i=n(55),o=n(41),s=n(14),u=n(22),c=n(4),l=function(e,t){var n=this;if(!(n instanceof l))return new l(e,t);i&&(n=i(new Error(void 0),a(n))),void 0!==t&&s(n,"message",String(t));var r=[];return c(e,r.push,{that:r}),s(n,"errors",r),n};l.prototype=o(Error.prototype,{constructor:u(5,l),message:u(5,""),name:u(5,"AggregateError")}),r({global:!0},{AggregateError:l})},function(e,t,n){var r=n(11),a=n(15),i=n(1),o=n(56);e.exports=r?Object.defineProperties:function(e,t){i(e);for(var n,r=o(t),s=r.length,u=0;s>u;)a.f(e,n=r[u++],t[n]);return e}},function(e,t,n){var r=n(13),a=n(18),i=n(78).indexOf,o=n(30);e.exports=function(e,t){var n,s=a(e),u=0,c=[];for(n in s)!r(o,n)&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~i(c,n)||c.push(n));return c}},function(e,t,n){var r=n(18),a=n(29),i=n(79),o=function(e){return function(t,n,o){var s,u=r(t),c=a(u.length),l=i(o,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},function(e,t,n){var r=n(42),a=Math.max,i=Math.min;e.exports=function(e,t){var n=r(e);return n<0?a(n+t,0):i(n,t)}},function(e,t,n){var r=n(16);e.exports=r("document","documentElement")},function(e,t,n){var r=n(58);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var r=n(45),a=n(23),i=n(6)("iterator");e.exports=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){var r=n(3);e.exports=r.Promise},function(e,t,n){"use strict";var r=n(16),a=n(15),i=n(6),o=n(11),s=i("species");e.exports=function(e){var t=r(e),n=a.f;o&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(54),a=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(e){return a.call(e)}),e.exports=r.inspectSource},function(e,t,n){var r,a,i,o=n(3),s=n(7),u=n(12),c=n(80),l=n(51),d=n(87),f=n(60),p=o.location,h=o.setImmediate,g=o.clearImmediate,v=o.process,y=o.MessageChannel,m=o.Dispatch,b=0,w={},_=function(e){if(w.hasOwnProperty(e)){var t=w[e];delete w[e],t()}},x=function(e){return function(){_(e)}},k=function(e){_(e.data)},M=function(e){o.postMessage(e+"",p.protocol+"//"+p.host)};h&&g||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return w[++b]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},r(b),b},g=function(e){delete w[e]},f?r=function(e){v.nextTick(x(e))}:m&&m.now?r=function(e){m.now(x(e))}:y&&!d?(i=(a=new y).port2,a.port1.onmessage=k,r=u(i.postMessage,i,1)):o.addEventListener&&"function"==typeof postMessage&&!o.importScripts&&p&&"file:"!==p.protocol&&!s(M)?(r=M,o.addEventListener("message",k,!1)):r="onreadystatechange"in l("script")?function(e){c.appendChild(l("script")).onreadystatechange=function(){c.removeChild(this),_(e)}}:function(e){setTimeout(x(e),0)}),e.exports={set:h,clear:g}},function(e,t,n){var r=n(44);e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(r)},function(e,t,n){var r=n(1),a=n(10),i=n(33);e.exports=function(e,t){if(r(e),a(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){var r=n(3),a=n(85),i=r.WeakMap;e.exports="function"==typeof i&&/native code/.test(a(i))},function(e,t,n){"use strict";var r=n(0),a=n(8),i=n(33),o=n(49),s=n(4);r({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=i.f(t),r=n.resolve,u=n.reject,c=o((function(){var n=a(t.resolve),i=[],o=0,u=1;s(e,(function(e){var a=o++,s=!1;i.push(void 0),u++,n.call(t,e).then((function(e){s||(s=!0,i[a]={status:"fulfilled",value:e},--u||r(i))}),(function(e){s||(s=!0,i[a]={status:"rejected",reason:e},--u||r(i))}))})),--u||r(i)}));return c.error&&u(c.value),n.promise}})},function(e,t,n){"use strict";var r=n(0),a=n(8),i=n(16),o=n(33),s=n(49),u=n(4);r({target:"Promise",stat:!0},{any:function(e){var t=this,n=o.f(t),r=n.resolve,c=n.reject,l=s((function(){var n=a(t.resolve),o=[],s=0,l=1,d=!1;u(e,(function(e){var a=s++,u=!1;o.push(void 0),l++,n.call(t,e).then((function(e){u||d||(d=!0,r(e))}),(function(e){u||d||(u=!0,o[a]=e,--l||c(new(i("AggregateError"))(o,"No one promise resolved")))}))})),--l||c(new(i("AggregateError"))(o,"No one promise resolved"))}));return l.error&&c(l.value),n.promise}})},function(e,t,n){"use strict";var r,a,i,o=n(7),s=n(52),u=n(14),c=n(13),l=n(6),d=n(2),f=l("iterator"),p=!1;[].keys&&("next"in(i=[].keys())?(a=s(s(i)))!==Object.prototype&&(r=a):p=!0);var h=null==r||o((function(){var e={};return r[f].call(e)!==e}));h&&(r={}),d&&!h||c(r,f)||u(r,f,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:p}},function(e,t){e.exports=function(){}},function(e,t,n){"use strict";var r=n(0),a=n(7),i=n(64),o=n(10),s=n(19),u=n(29),c=n(65),l=n(63),d=n(66),f=n(6),p=n(43),h=f("isConcatSpreadable"),g=p>=51||!a((function(){var e=[];return e[h]=!1,e.concat()[0]!==e})),v=d("concat"),y=function(e){if(!o(e))return!1;var t=e[h];return void 0!==t?!!t:i(e)};r({target:"Array",proto:!0,forced:!g||!v},{concat:function(e){var t,n,r,a,i,o=s(this),d=l(o,0),f=0;for(t=-1,r=arguments.length;t<r;t++)if(y(i=-1===t?o:arguments[t])){if(f+(a=u(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<a;n++,f++)n in i&&c(d,f,i[n])}else{if(f>=9007199254740991)throw TypeError("Maximum allowed index exceeded");c(d,f++,i)}return d.length=f,d}})},function(e,t,n){"use strict";var r=n(0),a=n(3),i=n(16),o=n(2),s=n(11),u=n(58),c=n(81),l=n(7),d=n(13),f=n(64),p=n(10),h=n(1),g=n(19),v=n(18),y=n(37),m=n(22),b=n(41),w=n(56),_=n(67),x=n(147),k=n(96),M=n(27),S=n(15),T=n(71),I=n(14),O=n(31),P=n(53),E=n(39),C=n(30),N=n(40),D=n(6),A=n(68),L=n(5),R=n(24),j=n(20),B=n(25).forEach,z=E("hidden"),F=D("toPrimitive"),U=j.set,W=j.getterFor("Symbol"),Y=Object.prototype,H=a.Symbol,q=i("JSON","stringify"),Q=M.f,G=S.f,X=x.f,V=T.f,Z=P("symbols"),K=P("op-symbols"),J=P("string-to-symbol-registry"),$=P("symbol-to-string-registry"),ee=P("wks"),te=a.QObject,ne=!te||!te.prototype||!te.prototype.findChild,re=s&&l((function(){return 7!=b(G({},"a",{get:function(){return G(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Q(Y,t);r&&delete Y[t],G(e,t,n),r&&e!==Y&&G(Y,t,r)}:G,ae=function(e,t){var n=Z[e]=b(H.prototype);return U(n,{type:"Symbol",tag:e,description:t}),s||(n.description=t),n},ie=c?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof H},oe=function(e,t,n){e===Y&&oe(K,t,n),h(e);var r=y(t,!0);return h(n),d(Z,r)?(n.enumerable?(d(e,z)&&e[z][r]&&(e[z][r]=!1),n=b(n,{enumerable:m(0,!1)})):(d(e,z)||G(e,z,m(1,{})),e[z][r]=!0),re(e,r,n)):G(e,r,n)},se=function(e,t){h(e);var n=v(t),r=w(n).concat(de(n));return B(r,(function(t){s&&!ue.call(n,t)||oe(e,t,n[t])})),e},ue=function(e){var t=y(e,!0),n=V.call(this,t);return!(this===Y&&d(Z,t)&&!d(K,t))&&(!(n||!d(this,t)||!d(Z,t)||d(this,z)&&this[z][t])||n)},ce=function(e,t){var n=v(e),r=y(t,!0);if(n!==Y||!d(Z,r)||d(K,r)){var a=Q(n,r);return!a||!d(Z,r)||d(n,z)&&n[z][r]||(a.enumerable=!0),a}},le=function(e){var t=X(v(e)),n=[];return B(t,(function(e){d(Z,e)||d(C,e)||n.push(e)})),n},de=function(e){var t=e===Y,n=X(t?K:v(e)),r=[];return B(n,(function(e){!d(Z,e)||t&&!d(Y,e)||r.push(Z[e])})),r};u||(O((H=function(){if(this instanceof H)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=N(e),n=function(e){this===Y&&n.call(K,e),d(this,z)&&d(this[z],t)&&(this[z][t]=!1),re(this,t,m(1,e))};return s&&ne&&re(Y,t,{configurable:!0,set:n}),ae(t,e)}).prototype,"toString",(function(){return W(this).tag})),O(H,"withoutSetter",(function(e){return ae(N(e),e)})),T.f=ue,S.f=oe,M.f=ce,_.f=x.f=le,k.f=de,A.f=function(e){return ae(D(e),e)},s&&(G(H.prototype,"description",{configurable:!0,get:function(){return W(this).description}}),o||O(Y,"propertyIsEnumerable",ue,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!u,sham:!u},{Symbol:H}),B(w(ee),(function(e){L(e)})),r({target:"Symbol",stat:!0,forced:!u},{for:function(e){var t=String(e);if(d(J,t))return J[t];var n=H(t);return J[t]=n,$[n]=t,n},keyFor:function(e){if(!ie(e))throw TypeError(e+" is not a symbol");if(d($,e))return $[e]},useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),r({target:"Object",stat:!0,forced:!u,sham:!s},{create:function(e,t){return void 0===t?b(e):se(b(e),t)},defineProperty:oe,defineProperties:se,getOwnPropertyDescriptor:ce}),r({target:"Object",stat:!0,forced:!u},{getOwnPropertyNames:le,getOwnPropertySymbols:de}),r({target:"Object",stat:!0,forced:l((function(){k.f(1)}))},{getOwnPropertySymbols:function(e){return k.f(g(e))}}),q&&r({target:"JSON",stat:!0,forced:!u||l((function(){var e=H();return"[null]"!=q([e])||"{}"!=q({a:e})||"{}"!=q(Object(e))}))},{stringify:function(e,t,n){for(var r,a=[e],i=1;arguments.length>i;)a.push(arguments[i++]);if(r=t,(p(t)||void 0!==e)&&!ie(e))return f(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!ie(t))return t}),a[1]=t,q.apply(null,a)}}),H.prototype[F]||I(H.prototype,F,H.prototype.valueOf),R(H,"Symbol"),C[z]=!0},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){n(5)("iterator")},function(e,t,n){e.exports=n(174)},function(e,t,n){e.exports=n(182)},function(e,t,n){"use strict";var r=n(0),a=n(3),i=n(50),o=n(7),s=n(14),u=n(4),c=n(48),l=n(10),d=n(24),f=n(15).f,p=n(25).forEach,h=n(11),g=n(20),v=g.set,y=g.getterFor;e.exports=function(e,t,n){var g,m=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),w=m?"set":"add",_=a[e],x=_&&_.prototype,k={};if(h&&"function"==typeof _&&(b||x.forEach&&!o((function(){(new _).entries().next()})))){g=t((function(t,n){v(c(t,g,e),{type:e,collection:new _}),null!=n&&u(n,t[w],{that:t,AS_ENTRIES:m})}));var M=y(e);p(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in x)||b&&"clear"==e||s(g.prototype,e,(function(n,r){var a=M(this).collection;if(!t&&b&&!l(n))return"get"==e&&void 0;var i=a[e](0===n?0:n,r);return t?this:i}))})),b||f(g.prototype,"size",{configurable:!0,get:function(){return M(this).collection.size}})}else g=n.getConstructor(t,e,m,w),i.REQUIRED=!0;return d(g,e,!1,!0),k[e]=g,r({global:!0,forced:!0},k),b||n.setStrong(g,e,m),g}},function(e,t,n){"use strict";var r=n(8),a=n(12),i=n(4);e.exports=function(e){var t,n,o,s,u=arguments.length,c=u>1?arguments[1]:void 0;return r(this),(t=void 0!==c)&&r(c),null==e?new this:(n=[],t?(o=0,s=a(c,u>2?arguments[2]:void 0,2),i(e,(function(e){n.push(s(e,o++))}))):i(e,n.push,{that:n}),new this(n))}},function(e,t,n){"use strict";e.exports=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}},function(e,t,n){"use strict";var r=n(1),a=n(8);e.exports=function(){for(var e,t=r(this),n=a(t.delete),i=!0,o=0,s=arguments.length;o<s;o++)e=n.call(t,arguments[o]),i=i&&e;return!!i}},function(e,t,n){"use strict";var r=n(1);e.exports=function(e,t){var n=r(this),a=n.has(e)&&"update"in t?t.update(n.get(e),e,n):t.insert(e,n);return n.set(e,a),a}},function(e,t,n){e.exports=n(241)},function(e,t,n){"use strict";var r=n(35),a=r(n(26)),i=r(n(38)),o=r(n(134)),s=r(n(139));(0,a.default)(t,"__esModule",{value:!0});var u=function(e){return e&&e.__esModule?e:{default:e}}(n(143)),c=function(){function e(e,t,n){if(void 0===t&&(t=864e5),this.name=e,this.expire=t,this.onError=n,this.logQueue=[],this.addTimer=-1,this.onError=n||function(){},"undefined"==typeof indexedDB||"undefined"==typeof IDBKeyRange||"undefined"==typeof Proxy)return this.onError("not support indexeddb or Proxy"),this.get=function(){return i.default.resolve([])},this.delete=function(){return i.default.resolve()},void(this.log=function(){});this.db=new u.default(e,t)}return e.prototype.get=function(e){return this.db.getLogs(e)},e.prototype.delete=function(e){return this.db.deleteLogs(e)},e.prototype.log=function(e,t,n){var r,a=this,i={time:+new Date,level:e,type:n,logStr:t};this.logQueue.push(i),clearTimeout(this.addTimer),this.logQueue.length>3e3?this.db.save((0,o.default)(r=this.logQueue).call(r,0)):this.addTimer=(0,s.default)((function(){var e;a.db.save((0,o.default)(e=a.logQueue).call(e,0))}),2e3)},e}();t.default=c},function(e,t,n){var r=n(108);e.exports=r},function(e,t,n){n(109);var r=n(9).Object,a=e.exports=function(e,t,n){return r.defineProperty(e,t,n)};r.defineProperty.sham&&(a.sham=!0)},function(e,t,n){var r=n(0),a=n(11);r({target:"Object",stat:!0,forced:!a,sham:!a},{defineProperty:n(15).f})},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(112);n(130),n(131),n(132),n(133),e.exports=r},function(e,t,n){n(75),n(46),n(118),n(90),n(91),n(125),n(61),n(34);var r=n(9);e.exports=r.Promise},function(e,t,n){var r=n(3),a=n(14);e.exports=function(e,t){try{a(r,e,t)}catch(n){r[e]=t}return t}},function(e,t,n){var r=n(7);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,n){var r=n(10);e.exports=function(e){if(!r(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,n){var r=n(6),a=n(23),i=r("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(a.Array===e||o[i]===e)}},function(e,t,n){var r=n(1);e.exports=function(e){var t=e.return;if(void 0!==t)return r(t.call(e)).value}},function(e,t,n){"use strict";var r,a,i,o,s=n(0),u=n(2),c=n(3),l=n(16),d=n(83),f=n(31),p=n(47),h=n(55),g=n(24),v=n(84),y=n(10),m=n(8),b=n(48),w=n(85),_=n(4),x=n(120),k=n(32),M=n(86).set,S=n(121),T=n(88),I=n(123),O=n(33),P=n(49),E=n(20),C=n(74),N=n(6),D=n(124),A=n(60),L=n(43),R=N("species"),j="Promise",B=E.get,z=E.set,F=E.getterFor(j),U=d&&d.prototype,W=d,Y=U,H=c.TypeError,q=c.document,Q=c.process,G=O.f,X=G,V=!!(q&&q.createEvent&&c.dispatchEvent),Z="function"==typeof PromiseRejectionEvent,K=!1,J=C(j,(function(){var e=w(W)!==String(W);if(!e&&66===L)return!0;if(u&&!Y.finally)return!0;if(L>=51&&/native code/.test(W))return!1;var t=new W((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[R]=n,!(K=t.then((function(){}))instanceof n)||!e&&D&&!Z})),$=J||!x((function(e){W.all(e).catch((function(){}))})),ee=function(e){var t;return!(!y(e)||"function"!=typeof(t=e.then))&&t},te=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;S((function(){for(var r=e.value,a=1==e.state,i=0;n.length>i;){var o,s,u,c=n[i++],l=a?c.ok:c.fail,d=c.resolve,f=c.reject,p=c.domain;try{l?(a||(2===e.rejection&&ie(e),e.rejection=1),!0===l?o=r:(p&&p.enter(),o=l(r),p&&(p.exit(),u=!0)),o===c.promise?f(H("Promise-chain cycle")):(s=ee(o))?s.call(o,d,f):d(o)):f(r)}catch(e){p&&!u&&p.exit(),f(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&re(e)}))}},ne=function(e,t,n){var r,a;V?((r=q.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),c.dispatchEvent(r)):r={promise:t,reason:n},!Z&&(a=c["on"+e])?a(r):"unhandledrejection"===e&&I("Unhandled promise rejection",n)},re=function(e){M.call(c,(function(){var t,n=e.facade,r=e.value;if(ae(e)&&(t=P((function(){A?Q.emit("unhandledRejection",r,n):ne("unhandledrejection",n,r)})),e.rejection=A||ae(e)?2:1,t.error))throw t.value}))},ae=function(e){return 1!==e.rejection&&!e.parent},ie=function(e){M.call(c,(function(){var t=e.facade;A?Q.emit("rejectionHandled",t):ne("rejectionhandled",t,e.value)}))},oe=function(e,t,n){return function(r){e(t,r,n)}},se=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,te(e,!0))},ue=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw H("Promise can't be resolved itself");var r=ee(t);r?S((function(){var n={done:!1};try{r.call(t,oe(ue,n,e),oe(se,n,e))}catch(t){se(n,t,e)}})):(e.value=t,e.state=1,te(e,!1))}catch(t){se({done:!1},t,e)}}};if(J&&(Y=(W=function(e){b(this,W,j),m(e),r.call(this);var t=B(this);try{e(oe(ue,t),oe(se,t))}catch(e){se(t,e)}}).prototype,(r=function(e){z(this,{type:j,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=p(Y,{then:function(e,t){var n=F(this),r=G(k(this,W));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=A?Q.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&te(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r,t=B(e);this.promise=e,this.resolve=oe(ue,t),this.reject=oe(se,t)},O.f=G=function(e){return e===W||e===i?new a(e):X(e)},!u&&"function"==typeof d&&U!==Object.prototype)){o=U.then,K||(f(U,"then",(function(e,t){var n=this;return new W((function(e,t){o.call(n,e,t)})).then(e,t)}),{unsafe:!0}),f(U,"catch",Y.catch,{unsafe:!0}));try{delete U.constructor}catch(e){}h&&h(U,Y)}s({global:!0,wrap:!0,forced:J},{Promise:W}),g(W,j,!1,!0),v(j),i=l(j),s({target:j,stat:!0,forced:J},{reject:function(e){var t=G(this);return t.reject.call(void 0,e),t.promise}}),s({target:j,stat:!0,forced:u||J},{resolve:function(e){return T(u&&this===i?W:this,e)}}),s({target:j,stat:!0,forced:$},{all:function(e){var t=this,n=G(t),r=n.resolve,a=n.reject,i=P((function(){var n=m(t.resolve),i=[],o=0,s=1;_(e,(function(e){var u=o++,c=!1;i.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,i[u]=e,--s||r(i))}),a)})),--s||r(i)}));return i.error&&a(i.value),n.promise},race:function(e){var t=this,n=G(t),r=n.reject,a=P((function(){var a=m(t.resolve);_(e,(function(e){a.call(t,e).then(n.resolve,r)}))}));return a.error&&r(a.value),n.promise}})},function(e,t,n){"use strict";var r=n(59),a=n(45);e.exports=r?{}.toString:function(){return"[object "+a(this)+"]"}},function(e,t,n){var r=n(6)("iterator"),a=!1;try{var i=0,o={next:function(){return{done:!!i++}},return:function(){a=!0}};o[r]=function(){return this},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var i={};i[r]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(e){}return n}},function(e,t,n){var r,a,i,o,s,u,c,l,d=n(3),f=n(27).f,p=n(86).set,h=n(87),g=n(122),v=n(60),y=d.MutationObserver||d.WebKitMutationObserver,m=d.document,b=d.process,w=d.Promise,_=f(d,"queueMicrotask"),x=_&&_.value;x||(r=function(){var e,t;for(v&&(e=b.domain)&&e.exit();a;){t=a.fn,a=a.next;try{t()}catch(e){throw a?o():i=void 0,e}}i=void 0,e&&e.enter()},h||v||g||!y||!m?w&&w.resolve?((c=w.resolve(void 0)).constructor=w,l=c.then,o=function(){l.call(c,r)}):o=v?function(){b.nextTick(r)}:function(){p.call(d,r)}:(s=!0,u=m.createTextNode(""),new y(r).observe(u,{characterData:!0}),o=function(){u.data=s=!s})),e.exports=x||function(e){var t={fn:e,next:void 0};i&&(i.next=t),a||(a=t,o()),i=t}},function(e,t,n){var r=n(44);e.exports=/web0s(?!.*chrome)/i.test(r)},function(e,t,n){var r=n(3);e.exports=function(e,t){var n=r.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},function(e,t){e.exports="object"==typeof window},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(83),o=n(7),s=n(16),u=n(32),c=n(88),l=n(31);if(r({target:"Promise",proto:!0,real:!0,forced:!!i&&o((function(){i.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=u(this,s("Promise")),n="function"==typeof e;return this.then(n?function(n){return c(t,e()).then((function(){return n}))}:e,n?function(n){return c(t,e()).then((function(){throw n}))}:e)}}),!a&&"function"==typeof i){var d=s("Promise").prototype.finally;i.prototype.finally!==d&&l(i.prototype,"finally",d,{unsafe:!0})}},function(e,t,n){var r=n(42),a=n(36),i=function(e){return function(t,n){var i,o,s=String(a(t)),u=r(n),c=s.length;return u<0||u>=c?e?"":void 0:(i=s.charCodeAt(u))<55296||i>56319||u+1===c||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):i:e?s.slice(u,u+2):o-56320+(i-55296<<10)+65536}};e.exports={codeAt:i(!1),charAt:i(!0)}},function(e,t,n){"use strict";var r=n(92).IteratorPrototype,a=n(41),i=n(22),o=n(24),s=n(23),u=function(){return this};e.exports=function(e,t,n){var c=t+" Iterator";return e.prototype=a(r,{next:i(1,n)}),o(e,c,!1,!0),s[c]=u,e}},function(e,t,n){"use strict";var r=n(18),a=n(93),i=n(23),o=n(20),s=n(62),u=o.set,c=o.getterFor("Array Iterator");e.exports=s(Array,"Array",(function(e,t){u(this,{type:"Array Iterator",target:r(e),index:0,kind:t})}),(function(){var e=c(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),i.Arguments=i.Array,a("keys"),a("values"),a("entries")},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,n){n(75)},function(e,t,n){n(90)},function(e,t,n){"use strict";var r=n(0),a=n(33),i=n(49);r({target:"Promise",stat:!0},{try:function(e){var t=a.f(this),n=i(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}})},function(e,t,n){n(91)},function(e,t,n){e.exports=n(135)},function(e,t,n){var r=n(136);e.exports=r},function(e,t,n){var r=n(137),a=Array.prototype;e.exports=function(e){var t=e.splice;return e===a||e instanceof Array&&t===a.splice?r:t}},function(e,t,n){n(138);var r=n(21);e.exports=r("Array").splice},function(e,t,n){"use strict";var r=n(0),a=n(79),i=n(42),o=n(29),s=n(19),u=n(63),c=n(65),l=n(66)("splice"),d=Math.max,f=Math.min;r({target:"Array",proto:!0,forced:!l},{splice:function(e,t){var n,r,l,p,h,g,v=s(this),y=o(v.length),m=a(e,y),b=arguments.length;if(0===b?n=r=0:1===b?(n=0,r=y-m):(n=b-2,r=f(d(i(t),0),y-m)),y+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=u(v,r),p=0;p<r;p++)(h=m+p)in v&&c(l,p,v[h]);if(l.length=r,n<r){for(p=m;p<y-r;p++)g=p+n,(h=p+r)in v?v[g]=v[h]:delete v[g];for(p=y;p>y-r+n;p--)delete v[p-1]}else if(n>r)for(p=y-r;p>m;p--)g=p+n-1,(h=p+r-1)in v?v[g]=v[h]:delete v[g];for(p=0;p<n;p++)v[p+m]=arguments[p+2];return v.length=y-r+n,l}})},function(e,t,n){e.exports=n(140)},function(e,t,n){var r=n(141);e.exports=r},function(e,t,n){n(142);var r=n(9);e.exports=r.setTimeout},function(e,t,n){var r=n(0),a=n(3),i=n(44),o=[].slice,s=function(e){return function(t,n){var r=arguments.length>2,a=r?o.call(arguments,2):void 0;return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,a)}:t,n)}};r({global:!0,bind:!0,forced:/MSIE .\./.test(i)},{setTimeout:s(a.setTimeout),setInterval:s(a.setInterval)})},function(e,t,n){"use strict";var r=n(35),a=r(n(38)),i=r(n(144)),o=r(n(171)),s=r(n(26)),u=r(n(98)),c=r(n(178)),l=r(n(99)),d=function(e,t,n,r){return new(n||(n=a.default))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof i.default&&(s[o.default]=function(){return this}),s;function c(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){u.label=i[1];break}if(6===i[0]&&u.label<a[1]){u.label=a[1],a=i;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(i);break}a[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}};(0,s.default)(t,"__esModule",{value:!0});var p=n(188),h=function(){function e(e,t){void 0===t&&(t=86400),this.name=e,this.expire=t,this.dbVersion=2,this.name=e,this.expire=t,this.dbPromise=this.initDB()}return e.prototype.initDB=function(){return p.openDB(this.name,this.dbVersion,{upgrade:function(e,t,n,r){if(1===t)try{e.deleteObjectStore("log_detail")}catch(e){}e.createObjectStore("log_detail",{keyPath:"id",autoIncrement:!0}).createIndex("time","time")}})},e.prototype.getLogs=function(e){return d(this,void 0,void 0,(function(){var t,n,r,i,o,s,c,l;return f(this,(function(d){switch(d.label){case 0:return t=[],[4,this.dbPromise];case 1:return n=d.sent(),r=p.unwrap(n).transaction("log_detail","readonly").objectStore("log_detail"),i=function(e){var t=e.end,n=e.start,r=e.type,a=e.level,i=IDBKeyRange.bound(n||0,t||+new Date),o=function(e){return!0},s=0;switch(r&&(s+=2),a&&(s+=1),s){case 1:o=function(e){return e.level===a};break;case 2:o=function(e){return e.type===r};break;case 3:o=function(e){return e.type===r&&e.level===a}}return{indexName:"time",filter:o,keyRange:i}}(e),o=i.indexName,s=i.keyRange,c=(0,u.default)(i),l=r.index(o).openCursor(s),[2,new a.default((function(e,n){l.onsuccess=function(n){var r=n.target.result;r?(c(r.value)&&t.push(r.value),r.continue()):e(t)},l.onerror=function(e){n(e)}}))]}}))}))},e.prototype.deleteLogs=function(e){return d(this,void 0,void 0,(function(){var t,n,r,i,o;return f(this,(function(s){switch(s.label){case 0:return[4,this.dbPromise];case 1:return t=s.sent(),n=p.unwrap(t).transaction("log_detail","readwrite").objectStore("log_detail"),r=e.start,i=e.end,o=n.index("time").openKeyCursor(IDBKeyRange.bound(r,i)),[2,new a.default((function(e,t){o.onsuccess=function(){var t=o.result;t?(n.delete(t.primaryKey),t.continue()):e(null)},o.onerror=function(e){t(e)}}))]}}))}))},e.prototype.save=function(e){return d(this,void 0,void 0,(function(){var t,n;return f(this,(function(r){switch(r.label){case 0:return[4,this.dbPromise];case 1:return t=r.sent(),n=[],[2,this.deleteLogs({start:0,end:(0,c.default)()-this.expire}).then((function(){var r=t.transaction("log_detail","readwrite").objectStore("log_detail");return(0,l.default)(e).call(e,(function(e){n.push(r.put(e))})),a.default.all(n)}))]}}))}))},e}();t.default=h},function(e,t,n){e.exports=n(145)},function(e,t,n){var r=n(146);n(164),n(165),n(166),n(167),n(168),n(169),n(170),e.exports=r},function(e,t,n){n(94),n(46),n(95),n(148),n(149),n(150),n(151),n(97),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(160),n(161),n(162),n(163);var r=n(9);e.exports=r.Symbol},function(e,t,n){var r=n(18),a=n(67).f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==i.call(e)?function(e){try{return a(e)}catch(e){return o.slice()}}(e):a(r(e))}},function(e,t,n){n(5)("asyncIterator")},function(e,t){},function(e,t,n){n(5)("hasInstance")},function(e,t,n){n(5)("isConcatSpreadable")},function(e,t,n){n(5)("match")},function(e,t,n){n(5)("matchAll")},function(e,t,n){n(5)("replace")},function(e,t,n){n(5)("search")},function(e,t,n){n(5)("species")},function(e,t,n){n(5)("split")},function(e,t,n){n(5)("toPrimitive")},function(e,t,n){n(5)("toStringTag")},function(e,t,n){n(5)("unscopables")},function(e,t,n){var r=n(3);n(24)(r.JSON,"JSON",!0)},function(e,t){},function(e,t){},function(e,t,n){n(5)("asyncDispose")},function(e,t,n){n(5)("dispose")},function(e,t,n){n(5)("matcher")},function(e,t,n){n(5)("metadata")},function(e,t,n){n(5)("observable")},function(e,t,n){n(5)("patternMatch")},function(e,t,n){n(5)("replaceAll")},function(e,t,n){e.exports=n(172)},function(e,t,n){var r=n(173);e.exports=r},function(e,t,n){n(97),n(61),n(34);var r=n(68);e.exports=r.f("iterator")},function(e,t,n){var r=n(175);e.exports=r},function(e,t,n){var r=n(176),a=Array.prototype;e.exports=function(e){var t=e.filter;return e===a||e instanceof Array&&t===a.filter?r:t}},function(e,t,n){n(177);var r=n(21);e.exports=r("Array").filter},function(e,t,n){"use strict";var r=n(0),a=n(25).filter;r({target:"Array",proto:!0,forced:!n(66)("filter")},{filter:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){e.exports=n(179)},function(e,t,n){var r=n(180);e.exports=r},function(e,t,n){n(181);var r=n(9);e.exports=r.Date.now},function(e,t,n){n(0)({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},function(e,t,n){var r=n(183);e.exports=r},function(e,t,n){n(34);var r=n(184),a=n(45),i=Array.prototype,o={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===i||e instanceof Array&&t===i.forEach||o.hasOwnProperty(a(e))?r:t}},function(e,t,n){var r=n(185);e.exports=r},function(e,t,n){n(186);var r=n(21);e.exports=r("Array").forEach},function(e,t,n){"use strict";var r=n(0),a=n(187);r({target:"Array",proto:!0,forced:[].forEach!=a},{forEach:a})},function(e,t,n){"use strict";var r=n(25).forEach,a=n(69)("forEach");e.exports=a?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,n){"use strict";var r=n(189),a=n(193),i=n(98),o=n(196),s=n(99),u=n(200),c=n(205),l=n(26),d=n(35);l(t,"__esModule",{value:!0}),t.deleteDB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,r=indexedDB.deleteDatabase(e);return n&&r.addEventListener("blocked",(function(){return n()})),(0,y.w)(r).then((function(){}))},t.openDB=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,a=n.upgrade,i=n.blocking,o=n.terminated,s=indexedDB.open(e,t),u=(0,y.w)(s);return a&&s.addEventListener("upgradeneeded",(function(e){a((0,y.w)(s.result),e.oldVersion,e.newVersion,(0,y.w)(s.transaction))})),r&&s.addEventListener("blocked",(function(){return r()})),u.then((function(e){o&&e.addEventListener("close",(function(){return o()})),i&&e.addEventListener("versionchange",(function(){return i()}))})).catch((function(){})),u},l(t,"unwrap",{enumerable:!0,get:function(){return y.u}}),l(t,"wrap",{enumerable:!0,get:function(){return y.w}});var f=d(n(209)),p=d(n(211)),h=d(n(212)),g=d(n(213)),v=d(n(105)),y=n(250);function m(e,t){var n=r(e);if(a){var s=a(e);t&&(s=i(s).call(s,(function(t){return o(e,t).enumerable}))),n.push.apply(n,s)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)s(n=m(Object(r),!0)).call(n,(function(t){(0,p.default)(e,t,r[t])}));else if(u)c(e,u(r));else{var a;s(a=m(Object(r))).call(a,(function(t){l(e,t,o(r,t))}))}}return e}var w=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],x=new g.default;function k(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(x.get(t))return x.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,a=(0,v.default)(_).call(_,n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(a||(0,v.default)(w).call(w,n))){var i=function(){var e=(0,h.default)(f.default.mark((function e(t){var i,o,s,u,c,l,d,p=arguments;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=this.transaction(t,a?"readwrite":"readonly"),s=o.store,u=p.length,c=new Array(u>1?u-1:0),l=1;l<u;l++)c[l-1]=p[l];return r&&(s=s.index(c.shift())),e.next=6,(i=s)[n].apply(i,c);case 6:if(d=e.sent,!a){e.next=10;break}return e.next=10,o.done;case 10:return e.abrupt("return",d);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return x.set(t,i),i}}}(0,y.r)((function(e){return b(b({},e),{},{get:function(t,n,r){return k(t,n)||e.get(t,n,r)},has:function(t,n){return!!k(t,n)||e.has(t,n)}})}))},function(e,t,n){e.exports=n(190)},function(e,t,n){var r=n(191);e.exports=r},function(e,t,n){n(192);var r=n(9);e.exports=r.Object.keys},function(e,t,n){var r=n(0),a=n(19),i=n(56);r({target:"Object",stat:!0,forced:n(7)((function(){i(1)}))},{keys:function(e){return i(a(e))}})},function(e,t,n){e.exports=n(194)},function(e,t,n){var r=n(195);e.exports=r},function(e,t,n){n(95);var r=n(9);e.exports=r.Object.getOwnPropertySymbols},function(e,t,n){e.exports=n(197)},function(e,t,n){var r=n(198);e.exports=r},function(e,t,n){n(199);var r=n(9).Object,a=e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)};r.getOwnPropertyDescriptor.sham&&(a.sham=!0)},function(e,t,n){var r=n(0),a=n(7),i=n(18),o=n(27).f,s=n(11),u=a((function(){o(1)}));r({target:"Object",stat:!0,forced:!s||u,sham:!s},{getOwnPropertyDescriptor:function(e,t){return o(i(e),t)}})},function(e,t,n){e.exports=n(201)},function(e,t,n){var r=n(202);e.exports=r},function(e,t,n){n(203);var r=n(9);e.exports=r.Object.getOwnPropertyDescriptors},function(e,t,n){var r=n(0),a=n(11),i=n(204),o=n(18),s=n(27),u=n(65);r({target:"Object",stat:!0,sham:!a},{getOwnPropertyDescriptors:function(e){for(var t,n,r=o(e),a=s.f,c=i(r),l={},d=0;c.length>d;)void 0!==(n=a(r,t=c[d++]))&&u(l,t,n);return l}})},function(e,t,n){var r=n(16),a=n(67),i=n(96),o=n(1);e.exports=r("Reflect","ownKeys")||function(e){var t=a.f(o(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){e.exports=n(206)},function(e,t,n){var r=n(207);e.exports=r},function(e,t,n){n(208);var r=n(9).Object,a=e.exports=function(e,t){return r.defineProperties(e,t)};r.defineProperties.sham&&(a.sham=!0)},function(e,t,n){var r=n(0),a=n(11);r({target:"Object",stat:!0,forced:!a,sham:!a},{defineProperties:n(76)})},function(e,t,n){e.exports=n(210)},function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof d?t:d,i=Object.create(a.prototype),o=new k(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return{value:void 0,done:!0}}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function d(){}function f(){}function p(){}var h={};h[a]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(M([])));v&&v!==t&&n.call(v,a)&&(h=v);var y=p.prototype=d.prototype=Object.create(h);function m(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(a,i){function o(){return new t((function(r,o){!function r(a,i,o,s){var u=c(e[a],e,i);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,s)}))}s(u.arg)}(a,i,r,o)}))}return r=r?r.then(o,o):o()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function M(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=y.constructor=p,p.constructor=f,f.displayName=s(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},m(b.prototype),b.prototype[i]=function(){return this},e.AsyncIterator=b,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new b(u(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(y),s(y,o,"Generator"),y[a]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=M,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){var r=n(26);e.exports=function(e,t,n){return t in e?r(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var r=n(38);function a(e,t,n,a,i,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):r.resolve(c).then(a,i)}e.exports=function(e){return function(){var t=this,n=arguments;return new r((function(r,i){var o=e.apply(t,n);function s(e){a(o,r,i,s,u,"next",e)}function u(e){a(o,r,i,s,u,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){e.exports=n(214)},function(e,t,n){var r=n(215);n(219),n(220),n(221),n(222),n(223),n(225),n(226),n(227),n(228),n(229),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),e.exports=r},function(e,t,n){n(216),n(46),n(61),n(34);var r=n(9);e.exports=r.Map},function(e,t,n){"use strict";var r=n(100),a=n(218);e.exports=r("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),a)},function(e,t,n){var r=n(7);e.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(e,t,n){"use strict";var r=n(15).f,a=n(41),i=n(47),o=n(12),s=n(48),u=n(4),c=n(62),l=n(84),d=n(11),f=n(50).fastKey,p=n(20),h=p.set,g=p.getterFor;e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){s(e,l,t),h(e,{type:t,index:a(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=r&&u(r,e[c],{that:e,AS_ENTRIES:n})})),p=g(t),v=function(e,t,n){var r,a,i=p(e),o=y(e,t);return o?o.value=n:(i.last=o={index:a=f(t,!0),key:t,value:n,previous:r=i.last,next:void 0,removed:!1},i.first||(i.first=o),r&&(r.next=o),d?i.size++:e.size++,"F"!==a&&(i.index[a]=o)),e},y=function(e,t){var n,r=p(e),a=f(t);if("F"!==a)return r.index[a];for(n=r.first;n;n=n.next)if(n.key==t)return n};return i(l.prototype,{clear:function(){for(var e=p(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t=p(this),n=y(this,e);if(n){var r=n.next,a=n.previous;delete t.index[n.index],n.removed=!0,a&&(a.next=r),r&&(r.previous=a),t.first==n&&(t.first=r),t.last==n&&(t.last=a),d?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=p(this),r=o(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!y(this,e)}}),i(l.prototype,n?{get:function(e){var t=y(this,e);return t&&t.value},set:function(e,t){return v(this,0===e?0:e,t)}}:{add:function(e){return v(this,e=0===e?0:e,e)}}),d&&r(l.prototype,"size",{get:function(){return p(this).size}}),l},setStrong:function(e,t,n){var r=t+" Iterator",a=g(t),i=g(r);c(e,t,(function(e,t){h(this,{type:r,target:e,state:a(e),kind:t,last:void 0})}),(function(){for(var e=i(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),l(t)}}},function(e,t,n){n(0)({target:"Map",stat:!0},{from:n(101)})},function(e,t,n){n(0)({target:"Map",stat:!0},{of:n(102)})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(103);r({target:"Map",proto:!0,real:!0,forced:a},{deleteAll:function(){return i.apply(this,arguments)}})},function(e,t,n){"use strict";n(0)({target:"Map",proto:!0,real:!0,forced:n(2)},{emplace:n(104)})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(12),s=n(17),u=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{every:function(e){var t=i(this),n=s(t),r=o(e,arguments.length>1?arguments[1]:void 0,3);return!u(n,(function(e,n,a){if(!r(n,e,t))return a()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,n){var r=n(1),a=n(82);e.exports=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return r(t.call(e))}},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(16),o=n(1),s=n(8),u=n(12),c=n(32),l=n(17),d=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{filter:function(e){var t=o(this),n=l(t),r=u(e,arguments.length>1?arguments[1]:void 0,3),a=new(c(t,i("Map"))),f=s(a.set);return d(n,(function(e,n){r(n,e,t)&&f.call(a,e,n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),a}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(12),s=n(17),u=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{find:function(e){var t=i(this),n=s(t),r=o(e,arguments.length>1?arguments[1]:void 0,3);return u(n,(function(e,n,a){if(r(n,e,t))return a(n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(12),s=n(17),u=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{findKey:function(e){var t=i(this),n=s(t),r=o(e,arguments.length>1?arguments[1]:void 0,3);return u(n,(function(e,n,a){if(r(n,e,t))return a(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,n){"use strict";var r=n(0),a=n(4),i=n(8);r({target:"Map",stat:!0},{groupBy:function(e,t){var n=new this;i(t);var r=i(n.has),o=i(n.get),s=i(n.set);return a(e,(function(e){var a=t(e);r.call(n,a)?o.call(n,a).push(e):s.call(n,a,[e])})),n}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(17),s=n(230),u=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{includes:function(e){return u(o(i(this)),(function(t,n,r){if(s(n,e))return r()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){"use strict";var r=n(0),a=n(4),i=n(8);r({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;i(t);var r=i(n.set);return a(e,(function(e){r.call(n,t(e),e)})),n}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(17),s=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{keyOf:function(e){return s(o(i(this)),(function(t,n,r){if(n===e)return r(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(16),o=n(1),s=n(8),u=n(12),c=n(32),l=n(17),d=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{mapKeys:function(e){var t=o(this),n=l(t),r=u(e,arguments.length>1?arguments[1]:void 0,3),a=new(c(t,i("Map"))),f=s(a.set);return d(n,(function(e,n){f.call(a,r(n,e,t),n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),a}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(16),o=n(1),s=n(8),u=n(12),c=n(32),l=n(17),d=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{mapValues:function(e){var t=o(this),n=l(t),r=u(e,arguments.length>1?arguments[1]:void 0,3),a=new(c(t,i("Map"))),f=s(a.set);return d(n,(function(e,n){f.call(a,e,r(n,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),a}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(8),s=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{merge:function(e){for(var t=i(this),n=o(t.set),r=0;r<arguments.length;)s(arguments[r++],n,{that:t,AS_ENTRIES:!0});return t}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(8),s=n(17),u=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{reduce:function(e){var t=i(this),n=s(t),r=arguments.length<2,a=r?void 0:arguments[1];if(o(e),u(n,(function(n,i){r?(r=!1,a=i):a=e(a,i,n,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty map with no initial value");return a}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(12),s=n(17),u=n(4);r({target:"Map",proto:!0,real:!0,forced:a},{some:function(e){var t=i(this),n=s(t),r=o(e,arguments.length>1?arguments[1]:void 0,3);return u(n,(function(e,n,a){if(r(n,e,t))return a()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(1),o=n(8);r({target:"Map",proto:!0,real:!0,forced:a},{update:function(e,t){var n=i(this),r=arguments.length;o(t);var a=n.has(e);if(!a&&r<3)throw TypeError("Updating absent value");var s=a?n.get(e):o(r>2?arguments[2]:void 0)(e,n);return n.set(e,t(s,e,n)),n}})},function(e,t,n){"use strict";n(0)({target:"Map",proto:!0,real:!0,forced:n(2)},{upsert:n(70)})},function(e,t,n){"use strict";n(0)({target:"Map",proto:!0,real:!0,forced:n(2)},{updateOrInsert:n(70)})},function(e,t,n){var r=n(242);e.exports=r},function(e,t,n){var r=n(243),a=n(245),i=Array.prototype,o=String.prototype;e.exports=function(e){var t=e.includes;return e===i||e instanceof Array&&t===i.includes?r:"string"==typeof e||e===o||e instanceof String&&t===o.includes?a:t}},function(e,t,n){n(244);var r=n(21);e.exports=r("Array").includes},function(e,t,n){"use strict";var r=n(0),a=n(78).includes,i=n(93);r({target:"Array",proto:!0},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")},function(e,t,n){n(246);var r=n(21);e.exports=r("String").includes},function(e,t,n){"use strict";var r=n(0),a=n(247),i=n(36);r({target:"String",proto:!0,forced:!n(249)("includes")},{includes:function(e){return!!~String(i(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(248);e.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,n){var r=n(10),a=n(28),i=n(6)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[i])?!!t:"RegExp"==a(e))}},function(e,t,n){var r=n(6)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,n){"use strict";var r=n(26),a=n(35);r(t,"__esModule",{value:!0}),t.r=function(e){b=e(b)},t.w=_,t.u=t.i=t.a=void 0;var i,o,s=a(n(251)),u=a(n(256)),c=a(n(38)),l=a(n(266)),d=a(n(270)),f=a(n(105)),p=function(e,t){return(0,s.default)(t).call(t,(function(t){return e instanceof t}))};t.i=p;var h=new u.default,g=new u.default,v=new u.default,y=new u.default,m=new u.default;t.a=m;var b={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return g.get(e);if("objectStoreNames"===t)return e.objectStoreNames||v.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function w(e){return"function"==typeof e?function(e){var t;return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(0,f.default)(t=o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).call(t,e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(x(this),n),_(h.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return _(e.apply(x(this),n))}:function(t){for(var n,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];var o=e.call.apply(e,(0,l.default)(n=[x(this),t]).call(n,a));return v.set(o,(0,d.default)(t)?(0,d.default)(t).call(t):[t]),_(o)}}(e):(e instanceof IDBTransaction&&function(e){if(!g.has(e)){var t=new c.default((function(t,n){var r=function(){e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=function(){t(),r()},i=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)}));g.set(e,t)}}(e),p(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,b):e)}function _(e){if(e instanceof IDBRequest)return t=e,(n=new c.default((function(e,n){var r=function(){t.removeEventListener("success",a),t.removeEventListener("error",i)},a=function(){e(_(t.result)),r()},i=function(){n(t.error),r()};t.addEventListener("success",a),t.addEventListener("error",i)}))).then((function(e){e instanceof IDBCursor&&h.set(e,t)})).catch((function(){})),m.set(n,t),n;var t,n;if(y.has(e))return y.get(e);var r=w(e);return r!==e&&(y.set(e,r),m.set(r,e)),r}var x=function(e){return m.get(e)};t.u=x},function(e,t,n){e.exports=n(252)},function(e,t,n){var r=n(253);e.exports=r},function(e,t,n){var r=n(254),a=Array.prototype;e.exports=function(e){var t=e.some;return e===a||e instanceof Array&&t===a.some?r:t}},function(e,t,n){n(255);var r=n(21);e.exports=r("Array").some},function(e,t,n){"use strict";var r=n(0),a=n(25).some;r({target:"Array",proto:!0,forced:!n(69)("some")},{some:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){e.exports=n(257)},function(e,t,n){var r=n(258);n(261),n(262),n(263),n(264),n(265),e.exports=r},function(e,t,n){n(46),n(259),n(34);var r=n(9);e.exports=r.WeakMap},function(e,t,n){"use strict";var r,a=n(3),i=n(47),o=n(50),s=n(100),u=n(260),c=n(10),l=n(20).enforce,d=n(89),f=!a.ActiveXObject&&"ActiveXObject"in a,p=Object.isExtensible,h=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},g=e.exports=s("WeakMap",h,u);if(d&&f){r=u.getConstructor(h,"WeakMap",!0),o.REQUIRED=!0;var v=g.prototype,y=v.delete,m=v.has,b=v.get,w=v.set;i(v,{delete:function(e){if(c(e)&&!p(e)){var t=l(this);return t.frozen||(t.frozen=new r),y.call(this,e)||t.frozen.delete(e)}return y.call(this,e)},has:function(e){if(c(e)&&!p(e)){var t=l(this);return t.frozen||(t.frozen=new r),m.call(this,e)||t.frozen.has(e)}return m.call(this,e)},get:function(e){if(c(e)&&!p(e)){var t=l(this);return t.frozen||(t.frozen=new r),m.call(this,e)?b.call(this,e):t.frozen.get(e)}return b.call(this,e)},set:function(e,t){if(c(e)&&!p(e)){var n=l(this);n.frozen||(n.frozen=new r),m.call(this,e)?w.call(this,e,t):n.frozen.set(e,t)}else w.call(this,e,t);return this}})}},function(e,t,n){"use strict";var r=n(47),a=n(50).getWeakData,i=n(1),o=n(10),s=n(48),u=n(4),c=n(25),l=n(13),d=n(20),f=d.set,p=d.getterFor,h=c.find,g=c.findIndex,v=0,y=function(e){return e.frozen||(e.frozen=new m)},m=function(){this.entries=[]},b=function(e,t){return h(e.entries,(function(e){return e[0]===t}))};m.prototype={get:function(e){var t=b(this,e);if(t)return t[1]},has:function(e){return!!b(this,e)},set:function(e,t){var n=b(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=g(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,c){var d=e((function(e,r){s(e,d,t),f(e,{type:t,id:v++,frozen:void 0}),null!=r&&u(r,e[c],{that:e,AS_ENTRIES:n})})),h=p(t),g=function(e,t,n){var r=h(e),o=a(i(t),!0);return!0===o?y(r).set(t,n):o[r.id]=n,e};return r(d.prototype,{delete:function(e){var t=h(this);if(!o(e))return!1;var n=a(e);return!0===n?y(t).delete(e):n&&l(n,t.id)&&delete n[t.id]},has:function(e){var t=h(this);if(!o(e))return!1;var n=a(e);return!0===n?y(t).has(e):n&&l(n,t.id)}}),r(d.prototype,n?{get:function(e){var t=h(this);if(o(e)){var n=a(e);return!0===n?y(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return g(this,e,t)}}:{add:function(e){return g(this,e,!0)}}),d}}},function(e,t,n){"use strict";n(0)({target:"WeakMap",proto:!0,real:!0,forced:n(2)},{emplace:n(104)})},function(e,t,n){n(0)({target:"WeakMap",stat:!0},{from:n(101)})},function(e,t,n){n(0)({target:"WeakMap",stat:!0},{of:n(102)})},function(e,t,n){"use strict";var r=n(0),a=n(2),i=n(103);r({target:"WeakMap",proto:!0,real:!0,forced:a},{deleteAll:function(){return i.apply(this,arguments)}})},function(e,t,n){"use strict";n(0)({target:"WeakMap",proto:!0,real:!0,forced:n(2)},{upsert:n(70)})},function(e,t,n){e.exports=n(267)},function(e,t,n){var r=n(268);e.exports=r},function(e,t,n){var r=n(269),a=Array.prototype;e.exports=function(e){var t=e.concat;return e===a||e instanceof Array&&t===a.concat?r:t}},function(e,t,n){n(94);var r=n(21);e.exports=r("Array").concat},function(e,t,n){e.exports=n(271)},function(e,t,n){var r=n(272);e.exports=r},function(e,t,n){var r=n(273),a=Array.prototype;e.exports=function(e){var t=e.sort;return e===a||e instanceof Array&&t===a.sort?r:t}},function(e,t,n){n(274);var r=n(21);e.exports=r("Array").sort},function(e,t,n){"use strict";var r=n(0),a=n(8),i=n(19),o=n(7),s=n(69),u=[],c=u.sort,l=o((function(){u.sort(void 0)})),d=o((function(){u.sort(null)})),f=s("sort");r({target:"Array",proto:!0,forced:l||!d||!f},{sort:function(e){return void 0===e?c.call(i(this)):c.call(i(this),a(e))}})}]).default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSONStringify=void 0;var r=o(n(14)),a=o(n(19)),i=o(n(20));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return"[object Number]"==Object.prototype.toString.call(e)}function u(e){return"[object String]"==Object.prototype.toString.call(e)}function c(e){return"[object Array]"==Object.prototype.toString.call(e)}function l(e){return"[object Boolean]"==Object.prototype.toString.call(e)}function d(e){return void 0===e}function f(e){return null===e}function p(e){return"[object Symbol]"==Object.prototype.toString.call(e)}function h(e){return!("[object Object]"!=Object.prototype.toString.call(e)&&(s(e)||u(e)||l(e)||c(e)||f(e)||g(e)||d(e)||p(e)))}function g(e){return"[object Function]"==Object.prototype.toString.call(e)}function v(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,i.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,i.default)(e))&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function y(e){var t=Object.prototype.toString.call(e);return"[object global]"==t||"[object Window]"==t||"[object DOMWindow]"==t}t.getDate=function(e){var t=e>0?new Date(e):new Date,n=t.getDate()<10?"0"+t.getDate():t.getDate(),r=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,a=t.getFullYear(),i=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),s=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds(),u=t.getMilliseconds()<10?"0"+t.getMilliseconds():t.getMilliseconds();u<100&&(u="0"+u);return{time:+t,year:a,month:r,day:n,hour:i,minute:o,second:s,millisecond:u}},t.isNumber=s,t.isString=u,t.isArray=c,t.isBoolean=l,t.isUndefined=d,t.isNull=f,t.isSymbol=p,t.isObject=h,t.isFunction=g,t.isElement=v,t.isWindow=y,t.isPlainObject=function(e){var t=Object.prototype.hasOwnProperty;if(!e||"object"!==(void 0===e?"undefined":(0,i.default)(e))||e.nodeType||y(e))return!1;try{if(e.constructor&&!t.call(e,"constructor")&&!t.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var n=void 0;for(n in e);return void 0===n||t.call(e,n)},t.getObjAllKeys=function(e){if(!h(e)&&!c(e))return[];var t=[];for(var n in e)t.push(n);return t.sort()},t.getObjName=function(e){return Object.prototype.toString.call(e).replace("[object ","").replace("]","")},t.setStorage=function(e,t){if(!window.localStorage)return;e="vConsole_"+e,localStorage.setItem(e,t)},t.getStorage=function(e){if(!window.localStorage)return;return e="vConsole_"+e,localStorage.getItem(e)};t.JSONStringify=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(h(t)||Array.isArray(t)){if(v(t))return"[HTML Element]";if(m(t))return"[NIM Object]"}else try{return(0,a.default)(t)}catch(e){return""}var o="{",s="}";if(Array.isArray(t)&&(o="[",s="]"),n<1)return"typeof ["+(void 0===t?"undefined":(0,i.default)(t))+"]";var u=(0,r.default)(t);return o+u.map((function(r){return r+": "+e(t[r],n-1)})).join(",")+s};function m(e){return e&&("im"===e.subType||e.__isNimWhiteboard__)}},,,,,,,function(e,t){var n={utf8:{stringToBytes:function(e){return n.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=n},function(e,t,n){(function(e,r){var a;
/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */(function(){"use strict";var i={function:!0,object:!0},o=i[typeof window]&&window||this,s=i[typeof t]&&t,u=i[typeof e]&&e&&!e.nodeType&&e,c=s&&u&&"object"==typeof r&&r;!c||c.global!==c&&c.window!==c&&c.self!==c||(o=c);var l=Math.pow(2,53)-1,d=/\bOpera/,f=Object.prototype,p=f.hasOwnProperty,h=f.toString;function g(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function v(e){return e=_(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:g(e)}function y(e,t){for(var n in e)p.call(e,n)&&t(e[n],n,e)}function m(e){return null==e?g(e):h.call(e).slice(8,-1)}function b(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function w(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=l)for(;++n<r;)t(e[n],n,e);else y(e,t)}(e,(function(r,a){n=t(n,r,a,e)})),n}function _(e){return String(e).replace(/^ +| +$/g,"")}var x=function e(t){var n=o,r=t&&"object"==typeof t&&"String"!=m(t);r&&(n=t,t=null);var a=n.navigator||{},i=a.userAgent||"";t||(t=i);var s,u,c,l,f,p=r?!!a.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(h.toString()),g=r?"Object":"ScriptBridgingProxyObject",x=r?"Object":"Environment",k=r&&n.java?"JavaPackage":m(n.java),M=r?"Object":"RuntimeObject",S=/\bJava/.test(k)&&n.java,T=S&&m(n.environment)==x,I=S?"a":"α",O=S?"b":"β",P=n.document||{},E=n.operamini||n.opera,C=d.test(C=r&&E?E["[[Class]]"]:m(E))?C:E=null,N=t,D=[],A=null,L=t==i,R=L&&E&&"function"==typeof E.version&&E.version(),j=w([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||b(n))+"\\b","i").exec(t)&&(n.label||n)})),B=function(e){return w(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||b(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),z=W([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),F=function(e){return w(e,(function(e,n,r){return e||(n[z]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(z)]||RegExp("\\b"+b(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),U=function(e){return w(e,(function(e,n){var r=n.pattern||b(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=v(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function W(e){return w(e,(function(e,n){var r=n.pattern||b(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=v(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function Y(e){return w(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(j&&(j=[j]),/\bAndroid\b/.test(U)&&!z&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(z=_(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),F&&!z?z=W([F]):F&&z&&(z=z.replace(RegExp("^("+b(F)+")[-_.\\s]","i"),F+" ").replace(RegExp("^("+b(F)+")[-_.]?(\\w)","i"),F+" $2")),(s=/\bGoogle TV\b/.exec(z))&&(z=s[0]),/\bSimulator\b/i.test(t)&&(z=(z?z+" ":"")+"Simulator"),"Opera Mini"==B&&/\bOPiOS\b/.test(t)&&D.push("running in Turbo/Uncompressed mode"),"IE"==B&&/\blike iPhone OS\b/.test(t)?(F=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,z=s.product):/^iP/.test(z)?(B||(B="Safari"),U="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==B&&/^Linux\b/i.test(U)?U="Kubuntu":F&&"Google"!=F&&(/Chrome/.test(B)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(z))||/\bAndroid\b/.test(U)&&/^Chrome/.test(B)&&/\bVersion\//i.test(t)?(B="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==B?(/\bMobi/i.test(t)||(U="Android",D.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&D.unshift("accelerated")):"UC Browser"==B&&/\bUCWEB\b/.test(t)?D.push("speed mode"):"PaleMoon"==B&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?D.push("identifying as Firefox "+s[1]):"Firefox"==B&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(U||(U="Firefox OS"),z||(z=s[1])):!B||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(B))?(B&&!z&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(B=null),(s=z||F||U)&&(z||F||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(B=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:s)+" Browser")):"Electron"==B&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&D.push("Chromium "+s),R||(R=Y(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",b(B),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==j&&parseFloat(R)>3?"WebKit":/\bOpera\b/.test(B)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(j)&&"WebKit"||!j&&/\bMSIE\b/i.test(t)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==j&&/\bPlayStation\b(?! Vita\b)/i.test(B)&&"NetFront")&&(j=[s]),"IE"==B&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(B+=" Mobile",U="Windows Phone "+(/\+$/.test(s)?s:s+".x"),D.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(B="IE Mobile",U="Windows Phone 8.x",D.unshift("desktop mode"),R||(R=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=B&&"Trident"==j&&(s=/\brv:([\d.]+)/.exec(t))&&(B&&D.push("identifying as "+B+(R?" "+R:"")),B="IE",R=s[1]),L){if(l="global",f=null!=(c=n)?typeof c[l]:"number",/^(?:boolean|number|string|undefined)$/.test(f)||"object"==f&&!c[l])m(s=n.runtime)==g?(B="Adobe AIR",U=s.flash.system.Capabilities.os):m(s=n.phantom)==M?(B="PhantomJS",R=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof P.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(R=[R,P.documentMode],(s=+s[1]+4)!=R[1]&&(D.push("IE "+R[1]+" mode"),j&&(j[1]=""),R[1]=s),R="IE"==B?String(R[1].toFixed(1)):R[0]):"number"==typeof P.documentMode&&/^(?:Chrome|Firefox)\b/.test(B)&&(D.push("masking as "+B+" "+R),B="IE",R="11.0",j=["Trident"],U="Windows");else if(S&&(N=(s=S.lang.System).getProperty("os.arch"),U=U||s.getProperty("os.name")+" "+s.getProperty("os.version")),T){try{R=n.require("ringo/engine").version.join("."),B="RingoJS"}catch(e){(s=n.system)&&s.global.system==n.system&&(B="Narwhal",U||(U=s[0].os||null))}B||(B="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(s=n.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(D.push("Node "+s.versions.node),B="Electron",R=s.versions.electron):"string"==typeof s.versions.nw&&(D.push("Chromium "+R,"Node "+s.versions.node),B="NW.js",R=s.versions.nw)),B||(B="Node.js",N=s.arch,U=s.platform,R=(R=/[\d.]+/.exec(s.version))?R[0]:null));U=U&&v(U)}if(R&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(R)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(L&&a.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(A=/b/i.test(s)?"beta":"alpha",R=R.replace(RegExp(s+"\\+?$"),"")+("beta"==A?O:I)+(/\d+\+?/.exec(s)||"")),"Fennec"==B||"Firefox"==B&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(U))B="Firefox Mobile";else if("Maxthon"==B&&R)R=R.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(z))"Xbox 360"==z&&(U=null),"Xbox 360"==z&&/\bIEMobile\b/.test(t)&&D.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(B)&&(!B||z||/Browser|Mobi/.test(B))||"Windows CE"!=U&&!/Mobi/i.test(t))if("IE"==B&&L)try{null===n.external&&D.unshift("platform preview")}catch(e){D.unshift("embedded")}else(/\bBlackBerry\b/.test(z)||/\bBB10\b/.test(t))&&(s=(RegExp(z.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||R)?(U=((s=[s,/BB10/.test(t)])[1]?(z=null,F="BlackBerry"):"Device Software")+" "+s[0],R=null):this!=y&&"Wii"!=z&&(L&&E||/Opera/.test(B)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==B&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==B&&(U&&!/^Win/.test(U)&&R>5.5||/\bWindows XP\b/.test(U)&&R>8||8==R&&!/\bTrident\b/.test(t)))&&!d.test(s=e.call(y,t.replace(d,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),d.test(B)?(/\bIE\b/.test(s)&&"Mac OS"==U&&(U=null),s="identify"+s):(s="mask"+s,B=C?v(C.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(U=null),L||(R=null)),j=["Presto"],D.push(s));else B+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==B&&"+"==s[1].slice(-1)?(B="WebKit Nightly",A="alpha",R=s[1].slice(0,-1)):R!=s[1]&&R!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(R=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==j&&(j=["Blink"]),L&&(p||s[1])?(j&&(j[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=j?"27":"28")):(j&&(j[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),j&&(j[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==B&&(!R||parseInt(R)>45)?R=s:"Chrome"==B&&/\bHeadlessChrome/i.test(t)&&D.unshift("headless")),"Opera"==B&&(s=/\bzbov|zvav$/.exec(U))?(B+=" ",D.unshift("desktop mode"),"zvav"==s?(B+="Mini",R=null):B+="Mobile",U=U.replace(RegExp(" *"+s+"$"),"")):"Safari"==B&&/\bChrome\b/.exec(j&&j[1])?(D.unshift("desktop mode"),B="Chrome Mobile",R=null,/\bOS X\b/.test(U)?(F="Apple",U="iOS 4.3+"):U=null):/\bSRWare Iron\b/.test(B)&&!R&&(R=Y("Chrome")),R&&0==R.indexOf(s=/[\d.]+$/.exec(U))&&t.indexOf("/"+s+"-")>-1&&(U=_(U.replace(s,""))),U&&-1!=U.indexOf(B)&&!RegExp(B+" OS").test(U)&&(U=U.replace(RegExp(" *"+b(B)+" *"),"")),j&&!/\b(?:Avant|Nook)\b/.test(B)&&(/Browser|Lunascape|Maxthon/.test(B)||"Safari"!=B&&/^iOS/.test(U)&&/\bSafari\b/.test(j[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(B)&&j[1])&&(s=j[j.length-1])&&D.push(s),D.length&&(D=["("+D.join("; ")+")"]),F&&z&&z.indexOf(F)<0&&D.push("on "+F),z&&D.push((/^on /.test(D[D.length-1])?"":"on ")+z),U&&(s=/ ([\d.+]+)$/.exec(U),u=s&&"/"==U.charAt(U.length-s[0].length-1),U={architecture:32,family:s&&!u?U.replace(s[0],""):U,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!u?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+s),"")),B&&(/\bWOW64\b/i.test(t)||L&&/\w(?:86|32)$/.test(a.cpuClass||a.platform)&&!/\bWin64; x64\b/i.test(t))&&D.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==B&&parseFloat(R)>=39&&(U.architecture=64),t||(t=null);var H={};return H.description=t,H.layout=j&&j[0],H.manufacturer=F,H.name=B,H.prerelease=A,H.product=z,H.ua=t,H.version=B&&R,H.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},H.parse=e,H.toString=function(){return this.description||""},H.version&&D.unshift(R),H.name&&D.unshift(B),U&&B&&(U!=String(U).split(" ")[0]||U!=B.split(" ")[0]&&!z)&&D.push(z?"("+U+")":"on "+U),D.length&&(H.description=D.join(" ")),H}();o.platform=x,void 0===(a=function(){return x}.call(t,n,t,e))||(e.exports=a)}).call(this)}).call(this,n(119)(e),n(73))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RECONNECTING_THRESHOLD=8e3,t.HeartBeatTimeout=4e3,t.HeartBeatInterval=4e3,t.LoginAckTimeout=3e3,t.LoginMaxRetry=4},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SocketConnClosedError=t.SocketInUseError=void 0;var r=s(n(2)),a=s(n(0)),i=s(n(3)),o=s(n(4));function s(e){return e&&e.__esModule?e:{default:e}}t.SocketInUseError=function(e){function t(e){(0,a.default)(this,t);var n=(0,i.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return n.name="SocketInUseError",n}return(0,o.default)(t,e),t}(Error),t.SocketConnClosedError=function(e){function t(e){(0,a.default)(this,t);var n=(0,i.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return n.name="SocketConnClosedError",n}return(0,o.default)(t,e),t}(Error)},,,,,,,,,,,,,,,,function(e,t,n){e.exports=n(413)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteBoardSDK=void 0;var r=_(n(70)),a=_(n(5)),i=_(n(20)),o=_(n(13)),s=_(n(19)),u=_(n(0)),c=_(n(1));n(414);var l=_(n(252)),d=n(29),f=n(415),p=n(416),h=n(96),g=_(n(32)),v=_(n(419)),y=_(n(237)),m=_(n(384)),b=n(98),w=_(b);function _(e){return e&&e.__esModule?e:{default:e}}var x={roomServerAddr:"https://roomserver.netease.im/v1/g2/whiteboard/getChannelInfo",sdkLogNosAddr:"https://statistic.live.126.net/sdklog/getToken",dataReportAddr:"https://statistic.live.126.net/statics/report/common/form",directNosAddr:"https://wanproxy-web.127.net",mediaUploadAddr:"https://vcloud.163.com",docTransAddr:"https://vcloud.163.com",fontDownloadUrl:"https://wb.vod.126.net/courseware/pptview/fonts/"},k=void 0,M=function(){function e(t){var n=this;if((0,u.default)(this,e),this.socketState="disconnected",this.joinRoomCallback={},this.ntpTimeDiff=0,this.joinRoom=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.logger.log("[白板] joinRoom"),n.joinRoomCallback=t,n.joinRoomParams=e,n.channel=e.channel,n.getChannelInfo(e).catch((function(e){var t=(0,s.default)({code:e&&e.code,message:e&&(e.error||e.message||e.msg)}),r=Number(e&&e.code);return isNaN(r)&&(r=0),r+=1e3,n._dataReportUtil("v3_login",{time:Date.now(),time_elapsed:0,result:{code:r,message:"getChannelInfo: "+t}}),o.default.reject(e)})).then((function(e){return n.channelInfo={cid:e.cid,wbUrls:e.ips.whiteboardarray,token:e.token},n.startSession()})).catch((function(t){n.logger.warn("[白板] 加入房间("+e.channel+")失败",t);var r=(0,f.getErrorCodeMsgFromEvent)(t,"加入房间失败"),a=r.code,i=r.message;return o.default.reject({type:"JoinRoomError",message:i,code:a})}))},this._getDrawPluginParams=function(){var e,t=null===(e=n.opt)||void 0===e?void 0:e.drawPluginParams;return"object"===(void 0===t?"undefined":(0,i.default)(t))&&null!==t||(t={}),n.joinRoomParams&&n.joinRoomParams.hasOwnProperty("cameraBound")&&(t.cameraBound=n.joinRoomParams.cameraBound),t},this.startSession=function(){var e,t;if(!n.channelInfo)return o.default.reject("为获取channelInfo");var r=[];return 0===(r=(null===(e=n.opt.testParams)||void 0===e?void 0:e.wsUrl)?[null===(t=n.opt.testParams)||void 0===t?void 0:t.wsUrl]:n.channelInfo.wbUrls).length?o.default.reject("urlArray is empty"):n.wbSocketClient.startSession({uid:n.uid.toString(),cid:n.channelInfo.cid.toString(),whiteboardVersion:"3.7.5",urlArray:r,token:n.channelInfo.token,record:n.opt.record,from_g2:!0}).then((function(){n.logger.log("[白板] startSession成功");var e=n._getDrawPluginParams();return n.drawPlugin=l.default.getInstance((0,a.default)({container:n.opt.container,account:n.opt.uid.toString(),uid:n.opt.uid,nickname:n.opt.nickname?n.opt.nickname:n.uid.toString(),platform:n.opt.platform,nim:null,connector:n.wbSocketClient,appkey:n.opt.appKey,logger:n.logger,isG1:!1,serviceConf:n.serviceConf,ntpTimeDiff:n.ntpTimeDiff},e)),n.opt.getAuthInfo||n.logger.error("G2白板初始化时必须提供getAuthInfo"),n.drawPlugin.getAuthInfo=n.opt.getAuthInfo,n.drawPlugin.setDataReportParams(n.serviceConf.dataReportAddr,{uid:n.opt.uid.toString(),cid:n.getChannelId().toString(),ws_url:n.wbSocketClient.urlBeingUsed,channel_name:n.channel,appkey:n.opt.appKey}),n.bindSocketStateChange(),n.drawPlugin.setIsConnected(!0),n.socketState="connected",n._syncFinishPromise(n.drawPlugin).then((function(){return setTimeout((function(){var e;n.joinRoomCallback.onconnected&&n.joinRoomCallback.onconnected(!1),n._onSyncFinish(),null===(e=n.drawPlugin)||void 0===e||e.on("event:sync_finished",(function(){n._onSyncFinish()}))}),0),n.drawPlugin})).catch((function(){return n.logger.error("[白板] 同步超时，无法进入房间"),o.default.reject({message:"同步超时"})}))})).catch((function(e){return n.logger.error("[白板] startSession失败",e),n.destroy({reason:"joinRoomFail",message:"加入房间失败"}),o.default.reject(e)}))},this.bindSocketStateChange=function(){n.wbSocketClient.on("connected",(function(){n.onSocketStateChange("connected")})),n.wbSocketClient.on("willreconnect",(function(){n.onSocketStateChange("willreconnect")})),n.wbSocketClient.on("reconnecting",(function(){n.onSocketStateChange("willreconnect")})),n.wbSocketClient.on("disconnected",(function(e){n.onSocketStateChange("disconnected",e)}))},this.onSocketStateChange=function(e,t){n.logger.warn("[白板] client.onSocketStateChange set state::"+e+". Current state:"+n.socketState),e!==n.socketState&&(n.socketState=e,"willreconnect"===e?n._onwillreconnect():"disconnected"===e?n._ondisconnected(t):"connected"===e&&n._onconnected(!1))},this.logger=new m.default(t.uid),this.dispatcher=this.logger.dispatcher,this.opt=t,this.uid=Number(t.uid),this.serviceConf=(0,a.default)({},x,t.privateConf||{}),isNaN(this.uid)||this.uid<=0||!(0,r.default)(this.uid))throw new Error("uid必须为正整数");this.wbSocketClient=new v.default(this),(0,h.setLOG)(void 0===t.debug||t.debug),k=this}return(0,c.default)(e,[{key:"getChannelInfo",value:function(e){var t=this,n=void 0;if(!this.opt.hasOwnProperty("isSecureMode")||this.opt.isSecureMode)n=this.opt.getAuthInfo().then((function(e){return{secureType:"1",checksum:e.checksum,nonce:e.nonce,curtime:e.curTime.toString()}}));else{var r=Math.ceil(Date.now()/1e3),i=(0,y.default)(this.opt.appKey+"."+this.uid+"."+r);n=o.default.resolve({secureType:"2",curtime:r.toString(),checksum:i})}var u=void 0;return n.then((function(n){return u=Date.now(),fetch(t.serviceConf.roomServerAddr,{method:"post",headers:{"Content-Type":"application/json"},cache:"no-cache",body:(0,s.default)((0,a.default)({uid:t.uid,appkey:t.opt.appKey,channelName:e.channel,mode:"4",version:"3.7.5"},n))})})).then((function(e){return e.json()})).then((function(e){if(!e||200!==e.code&&"200"!==e.code)return o.default.reject(e);if(e.time.hasOwnProperty("T2")&&e.time.hasOwnProperty("T3")){var n=Date.now(),r=n-u-(e.time.T3-e.time.T2),a=e.time.T3+r/2;t.ntpTimeDiff=a-n}return e}))}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{reason:"manualDestroy",message:"手动调用destroy断开连接"};this.logger.log("[白板] destroy. reason: "+e.reason+", msg: "+e.message),this.drawPlugin&&this.drawPlugin.destroy(),this.wbSocketClient&&(this.wbSocketClient.destroy(e),this.wbSocketClient.removeAllListeners())}},{key:"isConnected",value:function(){return this.drawPlugin&&this.drawPlugin.isConnected}},{key:"isSynchronizing",value:function(){return this.drawPlugin&&this.drawPlugin.dataHub.isSynchronizing}},{key:"getUid",value:function(){return this.uid}},{key:"getChannelId",value:function(){var e;return null===(e=this.channelInfo)||void 0===e?void 0:e.cid}},{key:"_syncFinishPromise",value:function(e){var t=this,n=void 0;return e.once("event:sync_finished",(function(){t.logger.log("[白板] 加入房间时的sync_finished"),(0,d.hideToast)(),"function"==typeof n&&n()})),this._onSyncData(),new o.default((function(e,r){var a=setTimeout((function(){t._dataReportUtil("v3_conn_error",{error:{code:b.DataReportConnError.Sync_Timeout,message:"joinRoom时同步数据超时"}}),r()}),8e4);n=function(){clearTimeout(a),e()}}))}},{key:"_onSyncData",value:function(){this.drawPlugin&&(this.logger.log("[白板] 开始同步数据"),this.drawPlugin.readyToSyncData(),(0,d.showToast)({msg:"同步数据中...",time:1e3,type:"info",top:30,msgType:g.default.SYNCHRONIZING}),"function"==typeof this.joinRoomCallback.onSyncStart&&this.joinRoomCallback.onSyncStart())}},{key:"_onSyncFinish",value:function(){this.logger.log("[白板] sync_finished"),(0,d.hideToast)(),"function"==typeof this.joinRoomCallback.onSyncFinish&&this.joinRoomCallback.onSyncFinish()}},{key:"_onconnected",value:function(e){if(this.logger.warn("[白板] onconnected, isreconnecting",e),(0,d.hideToast)(),e&&!this.drawPlugin&&(0,d.showToast)({msg:"重新连接成功",time:3,type:"success",top:30,msgType:g.default.ON_CONNECTED}),!this.drawPlugin)throw new Error("[白板] connected时drawPlugin未创建");this.drawPlugin.setDataReportParams(this.serviceConf.dataReportAddr,{uid:this.opt.uid.toString(),cid:this.getChannelId().toString(),ws_url:this.wbSocketClient.urlBeingUsed,channel_name:this.channel,appkey:this.opt.appKey}),this.drawPlugin.setIsConnected(!0),this._onSyncData(),"function"==typeof this.joinRoomCallback.onconnected&&this.joinRoomCallback.onconnected(e)}},{key:"_onwillreconnect",value:function(){this.logger.warn("[白板] onwillreconnect"),(0,d.showToast)({msg:"网络状况不稳定，正在重新连接...",time:1e3,type:"warn",msgType:g.default.ON_WILL_RECONNECT}),this.drawPlugin&&(this.drawPlugin.setIsConnected(!1),this.drawPlugin.stopSyncData()),"function"==typeof this.joinRoomCallback.onwillreconnect&&this.joinRoomCallback.onwillreconnect()}},{key:"_ondisconnected",value:function(e){this.logger.warn("[白板] ondisconnected",e),(0,d.showToast)({msg:"连接已断开...",time:1e3,type:"error",msgType:g.default.ON_DISCONNECTED}),this.drawPlugin&&(this.drawPlugin.setIsConnected(!1),this.drawPlugin.stopSyncData()),this.destroy({reason:"websocketClose",message:"连接已关闭"}),"function"==typeof this.joinRoomCallback.ondisconnected&&this.joinRoomCallback.ondisconnected(e)}},{key:"_dataReportUtil",value:function(e,t){(0,w.default)(this.serviceConf.dataReportAddr,e,this.opt.appKey+"-"+this.getChannelId(),(0,a.default)({uid:this.getUid(),cid:this.getChannelId(),ws_url:this.wbSocketClient.urlBeingUsed,channel_name:this.channel,appkey:this.opt.appKey,from_g2:!0,time:Date.now()},t))}}]),e}(),S={getInstance:function(e){return new M(e)},showToast:d.showToast,hideToast:d.hideToast,interceptShowToast:d.interceptShowToast,removeToastIntercept:d.removeToastIntercept};window.yunxinWbLogUpload=function(){return(0,p.uploadLog)(k,{appkey:k.opt.appKey,uid:k.getUid().toString(),channel:k.channel})},window.addEventListener("error",(function(e){if(k){var t=e.message,n=e.filename,r=e.lineno,a=e.colno,i=e.error,o=void 0;o=i&&i.stack?i.stack:i?null==i?void 0:i.message:"\n        message: "+t+",\n        filename: "+n+",\n        lineno: "+r+",\n        colno: "+a+"\n      ",console.error(o),k.logger.error(o)}})),t.WhiteBoardSDK=M,t.default=S},function(e,t,n){"use strict";n.r(t),n.d(t,"Headers",(function(){return h})),n.d(t,"Request",(function(){return _})),n.d(t,"Response",(function(){return k})),n.d(t,"DOMException",(function(){return S})),n.d(t,"fetch",(function(){return T}));var r="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r&&r,a="URLSearchParams"in r,i="Symbol"in r&&"iterator"in Symbol,o="FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(e){return!1}}(),s="FormData"in r,u="ArrayBuffer"in r;if(u)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&c.indexOf(Object.prototype.toString.call(e))>-1};function d(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function f(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return i&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function g(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function v(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function y(e){var t=new FileReader,n=v(t);return t.readAsArrayBuffer(e),n}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:a&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():u&&o&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=g(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(y)}),this.text=function(){var e,t,n,r=g(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=v(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s&&(this.formData=function(){return this.text().then(x)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=d(e),t=f(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},h.prototype.delete=function(e){delete this.map[d(e)]},h.prototype.get=function(e){return e=d(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(d(e))},h.prototype.set=function(e,t){this.map[d(e)]=f(t)},h.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),p(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),p(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),p(e)},i&&(h.prototype[Symbol.iterator]=h.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function _(e,t){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var n,r,a=(t=t||{}).body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,a||null==e._bodyInit||(a=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),w.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&a)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(a),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function x(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),a=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(a))}})),t}function k(e,t){if(!(this instanceof k))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},b.call(_.prototype),b.call(k.prototype),k.prototype.clone=function(){return new k(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},k.error=function(){var e=new k(null,{status:0,statusText:""});return e.type="error",e};var M=[301,302,303,307,308];k.redirect=function(e,t){if(-1===M.indexOf(t))throw new RangeError("Invalid status code");return new k(null,{status:t,headers:{location:e}})};var S=r.DOMException;try{new S}catch(e){(S=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack}).prototype=Object.create(Error.prototype),S.prototype.constructor=S}function T(e,t){return new Promise((function(n,a){var i=new _(e,t);if(i.signal&&i.signal.aborted)return a(new S("Aborted","AbortError"));var s=new XMLHttpRequest;function c(){s.abort()}s.onload=function(){var e,t,r={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var a=n.join(":").trim();t.append(r,a)}})),t)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var a="response"in s?s.response:s.responseText;setTimeout((function(){n(new k(a,r))}),0)},s.onerror=function(){setTimeout((function(){a(new TypeError("Network request failed"))}),0)},s.ontimeout=function(){setTimeout((function(){a(new TypeError("Network request failed"))}),0)},s.onabort=function(){setTimeout((function(){a(new S("Aborted","AbortError"))}),0)},s.open(i.method,function(e){try{return""===e&&r.location.href?r.location.href:e}catch(t){return e}}(i.url),!0),"include"===i.credentials?s.withCredentials=!0:"omit"===i.credentials&&(s.withCredentials=!1),"responseType"in s&&(o?s.responseType="blob":u&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(s.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof h?i.headers.forEach((function(e,t){s.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){s.setRequestHeader(e,f(t.headers[e]))})),i.signal&&(i.signal.addEventListener("abort",c),s.onreadystatechange=function(){4===s.readyState&&i.signal.removeEventListener("abort",c)}),s.send(void 0===i._bodyInit?null:i._bodyInit)}))}T.polyfill=!0,r.fetch||(r.fetch=T,r.Headers=h,r.Request=_,r.Response=k)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getErrorCodeMsgFromEvent=function(e,t){var n=void 0,r=void 0;return e&&e.event&&e.event.code?n=e.event.code:e&&e.code&&(n=e.code),e&&e.event&&e.event.message?r=e.event.message:e&&e.message?r=e.message:e&&e.event&&e.event.msg?r=e.event.msg:e&&e.msg?r=e.msg:e&&e.error&&(r=e.error),r||(r=t),{code:n,message:r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(19)),a=d(n(13));t.uploadLog=function(e,t){if(!t.channel||!t.uid)return(0,c.showToast)({type:"warn",msg:"uid或者房间名无法找到"});var n=void 0;return(0,l.delay)(4e3).then((function(){return f(e.serviceConf.sdkLogNosAddr,t)})).then((function(e){n=e})).then((function(){return e.logger.getLogTilNow()})).then((function(e){var n=e.map((function(e){return e.logStr})),r=(0,l.stringToBlob)((0,l.formatLogs)(n,t.channel,t.uid),"whiteboardLog.txt");return new File([r],"whiteboardLog.txt",{type:"text/plain"})})).then((function(r){return p(e.serviceConf.directNosAddr,e.serviceConf.dataReportAddr,n,r,t)})).then((function(){var r="日志上传成功\n请告诉开发者你的appkey,uid: "+t.uid+", 以及上传时间: "+(new Date).toTimeString();return console.log(r),console.log("日志的object为: "+(n&&n.data&&n.data.fileName)),e.logger.deleteLogTilNow(),r})).catch((function(e){console.error(e),a.default.reject(e)}))};var i=n(142),o=d(n(417)),s=d(n(238)),u=d(n(98)),c=n(29),l=n(239);function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t){var n=(0,i.v4)(),s=Math.round(Date.now()/1e3),u=(0,r.default)({appkey:t.appkey,sdktype:"whiteboard",sdkver:"3.7.5",md5:n,ext:"log"});return fetch(e,{method:"post",headers:{"content-type":"application/json",Nonce:n,CurTime:s.toString(),CheckSum:(0,o.default)(u+n+s+"021cc0370d824a51b7c8180485c27b38")},body:u}).then((function(e){return e.json()})).then((function(e){return e&&200===e.code?e:a.default.reject(e)}))},p=function(e,t,n,r,i){return e=e||"https://wanproxy-web.127.net",new a.default((function(a,o){var c=s.default.createConfig({directUploadAddr:e,onError:function(e){o(e)},onComplete:function(e){(0,u.default)(t,"logUpload",i.appkey+"-"+i.channel,{uid:i.uid,appkey:i.appkey,channel:i.channel,filename:n.data.fileName,time:Date.now()}),a()}});s.default.createTask(r,{bucketName:n.data.bucket,objectName:n.data.fileName,token:n.data.xNosToken},c)}))}},function(e,t,n){(function(t){var r,a,i,o;r=n(418),a=n(393).utf8,i=n(393).bin,(o=function(e,n){var o=r.wordsToBytes(function(e){e.constructor==String?e=a.stringToBytes(e):void 0!==t&&"function"==typeof t.isBuffer&&t.isBuffer(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());var n=r.bytesToWords(e),i=8*e.length,o=[],s=1732584193,u=-271733879,c=-1732584194,l=271733878,d=-1009589776;n[i>>5]|=128<<24-i%32,n[15+(i+64>>>9<<4)]=i;for(var f=0;f<n.length;f+=16){for(var p=s,h=u,g=c,v=l,y=d,m=0;m<80;m++){if(m<16)o[m]=n[f+m];else{var b=o[m-3]^o[m-8]^o[m-14]^o[m-16];o[m]=b<<1|b>>>31}var w=(s<<5|s>>>27)+d+(o[m]>>>0)+(m<20?1518500249+(u&c|~u&l):m<40?1859775393+(u^c^l):m<60?(u&c|u&l|c&l)-1894007588:(u^c^l)-899497514);d=l,l=c,c=u<<30|u>>>2,u=s,s=w}s+=p,u+=h,c+=g,l+=v,d+=y}return[s,u,c,l,d]}(e));return n&&n.asBytes?o:n&&n.asString?i.bytesToString(o):r.bytesToHex(o)})._blocksize=16,o._digestsize=20,e.exports=o}).call(this,n(44).Buffer)},function(e,t){var n,r;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var t=[],r=0;r<e.length;r+=3)for(var a=e[r]<<16|e[r+1]<<8|e[r+2],i=0;i<4;i++)8*r+6*i<=8*e.length?t.push(n.charAt(a>>>6*(3-i)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],r=0,a=0;r<e.length;a=++r%4)0!=a&&t.push((n.indexOf(e.charAt(r-1))&Math.pow(2,-2*a+8)-1)<<2*a|n.indexOf(e.charAt(r))>>>6-2*a);return t}},e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=b(n(5)),a=b(n(20)),i=b(n(13)),o=b(n(2)),s=b(n(0)),u=b(n(1)),c=b(n(3)),l=b(n(4)),d=b(n(39)),f=b(n(420)),p=b(n(423)),h=n(424),g=n(395),v=n(98),y=b(v),m=n(396);function b(e){return e&&e.__esModule?e:{default:e}}var w=window,_=new p.default({min:3500,max:15e3,jitter:.7}),x=function(e){function t(e){(0,s.default)(this,t);var n=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return n.state="disconnected",n.isOnline=!0,n.params=null,n.onMessage=function(e,t){if("broadcast"===t)n.onbroadcast(e);else if("syncRequestAck"===t||"syncRequestResponse"===t||"broadcastAck"===t){var r=e.content&&e.content.params;n.emit(t,r)}else"roomClosed"===t?n.destroy({reason:"roomClosed",message:"房间关闭"}):"kicked"===t&&n.destroy({reason:"kickedBySameAccount",message:"当前账号在多处重复登录"})},n.reconnect=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t>6)return n.destroy({reason:"maxRetryExceed",message:"重试次数超过6次, 断开连接"});if("disconnected"===n.state)return i.default.resolve(!0);var r=_.duration();if("reconnecting"!==n.state){if(!n.isOnline){var a=1500;return(0,h.delay)(a).then((function(){n.reconnect("internetConnectionRecover")}))}n.setState("reconnecting");var o=void 0;return(0,h.delay)(r).then((function(){if(n.logger.log("白板--\x3e WBSocketClient.reconnect 重连原因:"+e+", "+(new Date).toTimeString()+",  current state: "+n.state+", reconnect after, "+r),"disconnected"!==n.state)return o=Date.now(),n.signal.reconnect(e)})).catch((function(e){return n._reportSocketConnClosed(e),i.default.reject(e)})).then((function(){return n.signal.login(n.params)})).then((function(){n._reportLoginSuccess(o),n.isOnline?n.setState("connected"):n.setState("willreconnect"),_.reset()})).catch((function(e){return n.logger.error("socket reconnect error",e),n._reportLoginFail(e,o),417===e.code||"417"===e.code?n.destroy({reason:"roomClosed",message:"房间已关闭"}):418===e.code||"418"===e.code||419===e.code||"419"===e.code?n.destroy({reason:"incompatibleClientVersion",message:"不同客户端版本登录同一个cid"}):e.code?n.destroy({reason:e.error||e.msg||e.message||"unknownReason",message:"login failed: "+e.code}):(n.logger.log("reconnect fail",e),"disconnected"!==n.state&&n.setState("reconnectFail"),n.reconnect("reconnectFail",t+1))}))}},n._handleOnline=function(){n.logger.log("白板--\x3e WBSocketClient._handleOnline"),n.isOnline=!0,_.reset()},n._handleOffline=function(){n.logger.log("白板--\x3e WBSocketClient._handleOffline"),n.isOnline=!1,"connected"===n.state&&n.setState("willreconnect")},n._reportSocketConnClosed=function(e){n._dataReportUtil("v3_conn_error",{error:{code:v.DataReportConnError.Socket_Conn_Closed,message:e.message}})},n._reportLoginSuccess=function(e){n._dataReportUtil("v3_login",{time:e,time_elapsed:Date.now()-e,result:{code:200,message:"Login Success"}})},n._reportLoginFail=function(e,t){var r=700,i="";e instanceof m.SocketConnClosedError?(r=701,i=e.toString()):e.code?(r=e.code,i=e.error||e.message||e.msg):"object"===(void 0===e?"undefined":(0,a.default)(e))&&e&&(i=e.name||e.error||e.message||e.msg),n._dataReportUtil("v3_login",{time:t,time_elapsed:Date.now()-t,result:{code:r,message:i}})},n._dataReportUtil=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!==n.params&&(0,y.default)(n.whiteboardSDK.serviceConf.dataReportAddr,e,n.whiteboardSDK.opt.appKey+"-"+n.whiteboardSDK.getChannelId(),(0,r.default)({uid:n.params.uid,cid:n.params.cid,from_g2:n.params.from_g2,appkey:n.whiteboardSDK.opt.appKey,channel_name:n.whiteboardSDK.channel,ws_url:n.urlBeingUsed,time:Date.now()},t))},n.signal=new f.default(n,e),n.whiteboardSDK=e,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:"startSession",value:function(e){var t=this;if(this.logger.log("白板--\x3e WBSocketClient.startSession, currentState: "+this.state),this.logger.log("白板startSession",e),this.params={cid:e.cid,uid:e.uid,whiteboardVersion:e.whiteboardVersion,record:e.record,token:e.token,from_g2:void 0===e.from_g2||e.from_g2},"disconnected"!==this.state)return i.default.reject({message:"session已经启动。如果需要重新启动session，请先destroy"});if(0===e.urlArray.length)return i.default.reject({message:"startSession时的urlArray长度为0"});var n=function(){"function"==typeof w.addEventListener&&(w.addEventListener("online",t._handleOnline),w.addEventListener("offline",t._handleOffline));for(var n=i.default.resolve(),r=!1,a=void 0,o=function(o){n=n.then((function(){return a=Date.now(),r?void 0:t.signal.connect({cid:e.cid,uid:e.uid,urlArray:e.urlArray,currIndex:o}).catch((function(e){return t._reportSocketConnClosed(e),i.default.reject(e)})).then((function(){return t.signal.login({whiteboardVersion:e.whiteboardVersion,record:e.record,token:e.token,from_g2:void 0===e.from_g2||e.from_g2})})).then((function(){r=!0,t.setState("connected"),t._reportLoginSuccess(a)})).catch((function(n){if(t.logger.log("startSession: "+e.urlArray[o]+"失败，错误原因为: ",n),t._reportLoginFail(n,a),o===e.urlArray.length-1)return i.default.reject(n)}))}))},s=0;s<e.urlArray.length;s++)o(s);return{v:n}}();return"object"===(void 0===n?"undefined":(0,a.default)(n))?n.v:void 0}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{reason:"manualDestroy",message:"手动调用destroy断开连接"};this.logger.log("白板--\x3e WBSocketClient.destroy, currentState: "+this.state+", reason: "+e.reason),"function"==typeof w.removeEventListener&&(w.removeEventListener("online",this._handleOnline),w.removeEventListener("offline",this._handleOffline)),"disconnected"!==this.state&&("kickedBySameAccount"!==e.reason&&"roomClosed"!==e.reason&&(this._dataReportUtil("v3_logout"),this.signal.logout()),this.signal.destroy(e.reason),this.setState("disconnected",{code:200,message:e.message}))}},{key:"broadcastData",value:function(e){e&&("connected"!==this.state?this.logger.log("白板--\x3e WBSocketClient.broadcastData 信令当前不处于连接状态, 当前状态: "+this.state):this.signal.sendMsg("broadcast",e))}},{key:"sendSyncRequest",value:function(e){"connected"!==this.state?this.logger.log("白板--\x3e WBSocketClient.sendSyncRequest 信令当前不处于连接状态, 当前状态: "+this.state):this.signal.sendMsg("syncRequest",{last_server_pkg_id:e})}},{key:"onHeartBeatTimeout",value:function(e){this.logger.log("白板--\x3e WBSocketClient.onHeartBeatTimeout, currentState: "+this.state),"willreconnect"!==this.state&&"connected"!==this.state||(e<g.RECONNECTING_THRESHOLD?this.setState("willreconnect"):(this._dataReportUtil("v3_conn_error",{error:{code:v.DataReportConnError.HeartBeat_Timeout,message:"心跳超时: "+e+"ms"}}),this.reconnect("heartbeatTimeout")))}},{key:"onHeartBeat",value:function(){"willreconnect"===this.state&&this.isOnline&&this.setState("connected")}},{key:"onSignalClosed",value:function(){this.logger.log("白板--\x3e WBSocketClient.onSignalClosed, currentState: "+this.state),"willreconnect"!==this.state&&"connected"!==this.state||(this._dataReportUtil("v3_conn_error",{error:{code:v.DataReportConnError.Socket_Closed,message:"socket连接断开"}}),this.reconnect("websocketClose"))}},{key:"onbroadcast",value:function(e){var t=e.content&&e.content.params&&e.content.params.data,n=e.content&&e.content.params&&e.content.params.server_pkg_id,r=e.content&&e.content.params&&e.content.params.client_pkg_id,a=e.uid;try{t=JSON.parse(t||null)}catch(e){}this.emit("data",{data:t,server_pkg_id:n,client_pkg_id:r,source_uid:a})}},{key:"setState",value:function(e,t){this.state!==e&&(this.logger.log("socketClient --\x3e setState from "+this.state+" to "+e),this.state=e,this.emit(e,t))}},{key:"logger",get:function(){return this.whiteboardSDK.logger}},{key:"urlBeingUsed",get:function(){return this.signal.urlBeingUsed}}]),t}(d.default);t.default=x},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=v(n(19)),a=v(n(13)),i=v(n(2)),o=v(n(0)),s=v(n(1)),u=v(n(3)),c=v(n(4)),l=v(n(39)),d=v(n(394)),f=n(421),p=n(395),h=n(396),g=n(422);function v(e){return e&&e.__esModule?e:{default:e}}var y=window,m=function(e){function t(e,n){(0,o.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.socket=null,r.recv_bytes=0,r.send_bytes=0,r.connectParams={cid:"",uid:"",urlArray:[],currIndex:-1},r.heartBeat={isBeating:!1,last:null,beatAckTimer:null,sendBeatTimer:null},r.onHeartBeat=function(e){r.logger.log("on heart beat ",(new Date).toTimeString()),r.heartBeat.last=Date.now(),clearTimeout(r.heartBeat.beatAckTimer),clearTimeout(r.heartBeat.sendBeatTimer),r.heartBeat.beatAckTimer=null,r.heartBeat.sendBeatTimer=null,r.handler.onHeartBeat(),r.heartBeat.sendBeatTimer=setTimeout(r.sendHeartBeat,p.HeartBeatInterval)},r.onMessageAsHeartBeatAck=function(){r.heartBeat.last=Date.now()},r.sendHeartBeat=function(){clearTimeout(r.heartBeat.sendBeatTimer),r.heartBeat.sendBeatTimer=null,r.sendMsg("keep_alive"),r.heartBeat.beatAckTimer=setTimeout(r.onHeartBeatTimeout,p.HeartBeatTimeout)},r.onHeartBeatTimeout=function(){null===r.heartBeat.last&&(r.heartBeat.last=Date.now());var e=Date.now()-r.heartBeat.last;r.sendHeartBeat(),e>p.HeartBeatTimeout-30&&(r.logger.log("白板--\x3e Signal.onHeartBeatTimeout socket error: heartbeat timeout",e,(new Date).toTimeString(),r.heartBeat.last),r.handler.onHeartBeatTimeout(e))},r.handler=e,r.whiteboardSDK=n,r}return(0,c.default)(t,e),(0,s.default)(t,[{key:"logout",value:function(){if(this.logger.log("白板--\x3e Signal logout"),this.stopHeartBeat(),null!==this.socket)if(this.socketStatus===y.WebSocket.OPEN)this.sendLogoutMsg();else{this.logger.log("白板--\x3e Signal.login socket不是连接状态")}else{this.logger.log("白板--\x3e Signal.logout socket尚未初始化")}}},{key:"login",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.logger.log("白板--\x3e Signal login"),null===this.socket){var r=this.connectParams,i=r.uid,o=r.cid,s=r.urlArray,u=r.currIndex,c=s[u],l="白板--\x3e Signal.login socket尚未初始化，请先连接socket: "+this.getFinalUrl(c,o,i);return this.logger.log(l),a.default.reject()}if(this.socketStatus!==y.WebSocket.OPEN){var d="白板--\x3e Signal.login socket不是连接状态";return this.logger.log(d),a.default.reject()}return this.sendLoginMsg(e),clearTimeout(this.loginAckTimer),new a.default((function(r,a){t.removeAllListeners("loginSuccess"),t.removeAllListeners("loginFailed"),t.once("loginSuccess",(function(e){clearTimeout(t.loginAckTimer),t.removeAllListeners("loginSuccess"),t.removeAllListeners("loginFailed"),t.logger.log("白板--\x3e Signal Login Success"),r()})),t.once("loginFailed",(function(e){clearTimeout(t.loginAckTimer),t.removeAllListeners("loginSuccess"),t.removeAllListeners("loginFailed"),t.logger.warn("白板--\x3e Login Failed",e),t.destroy("loginFailed"),a(e)})),t.loginAckTimer=setTimeout((function(){if(clearTimeout(t.loginAckTimer),t.removeAllListeners("loginSuccess"),t.removeAllListeners("loginFailed"),n<p.LoginMaxRetry)return t.login(e,n+1).then((function(){r()})).catch((function(e){a(e)}));t.logger.log("白板--\x3e Login Failed. Login Ack超时，且重试次数超过"+p.LoginMaxRetry+"次"),t.destroy("loginFailed"),a("Login Ack超时，且重试次数超过"+p.LoginMaxRetry+"次")}),p.LoginAckTimeout)}))}},{key:"reconnect",value:function(e){return this.destroy(e),this.connect(this.connectParams,!0)}},{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!==this.socket){var r="白板--\x3e Signal.connect socket正处于连接状态，请先销毁再重连";return this.logger.log(r),a.default.reject(new h.SocketInUseError(r))}n?this.connectParams.currIndex=(this.connectParams.currIndex+1)%this.connectParams.urlArray.length:this.connectParams=e;var i=this.connectParams,o=i.cid,s=i.uid,u=i.urlArray,c=i.currIndex,l=u[c];return this.urlBeingUsed=l,l=this.getFinalUrl(l,o,s),new a.default((function(e,n){try{t.logger.log("白板--\x3e Signal.connect url: "+l),t.socket=new y.WebSocket(l),t.socket.onopen=function(n){t.initSignal(),t.logger.log("白板--\x3e Signal onopen"),e(t)},t.socket.onclose=function(e){var r="白板--\x3e Signal onclose: "+l;t.stopHeartBeat(),t.logger.log(r),t.socket=null,t.handler.onSignalClosed(),n(new h.SocketConnClosedError(r))}}catch(e){t.logger.log("白板--\x3e Signal.connect 信令连接建立失败",e),n(e)}}))}},{key:"destroy",value:function(e){this.logger.log("白板--\x3e Signal.destroy 销毁原因: "+e),this.stopHeartBeat(),null!==this.socket&&(this.socket.onmessage=null,this.socket.onclose=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.close(),this.socket=null)}},{key:"getFinalUrl",value:function(e,t,n){return y.wsUrl,(e=-1!==e.indexOf("?")?e+"&cid="+t+"&uid="+n:"/"===e[e.length-1]?e+"?cid="+t+"&uid="+n:e+"/?cid="+t+"&uid="+n).startsWith("ws://")||e.startsWith("wss://")?e:"wss://"+e}},{key:"initSignal",value:function(){var e=this;null!==this.socket?this.socket.onmessage=function(t){var n=JSON.parse(t.data||null);if(n)return"loginAck"===n.type||n.type===f.serializeWb.gateWay.loginAck?e.onLoginAck(n):!e.heartBeat.isBeating||"keep_alive_ack"!==n.type&&n.type!==f.serializeWb.gateWay.keep_alive_ack?void(n&&e.onMessage(n)):e.onHeartBeat(n)}:this.logger.log("白板--\x3e Signal.initSignal ws is null")}},{key:"onLoginAck",value:function(e){var t=e.content.params,n=t.auth_result-0;if(200!==n){this.logger.log("白板--\x3e Signal.onLoginAck: 服务器验证不通过, 断开连接: "+n);var r="服务器验证不通过, 断开连接";return t.errmsg?r=t.errmsg:t.errMsg&&(r=t.errMsg),this.emit("loginFailed",{code:n,error:r})}this.logger.log("白板--\x3e Signal.onLoginAck: 白板服务器登录成功",e),this.emit("loginSuccess"),this.startHeartbeat()}},{key:"onMessage",value:function(e){e&&e.cid&&e.uid&&(e.cid=+e.cid,e.uid=+e.uid);var t=f.unserializeWb.gateWay[e.type];return t?"logout"!==t&&e.cid!==this.connectParams.cid&&e.cid!==Number(this.connectParams.cid)?this.logger.log("白板--\x3e Signal.onMessage: msg不属于当前cid: "+this.connectParams.cid,e):(this.onMessageAsHeartBeatAck(),void this.handler.onMessage(e,t)):this.logger.log("白板--\x3e Signal.onMessage: msg类型找不到"+e.type)}},{key:"startHeartbeat",value:function(){this.logger.log("白板--\x3e Signal.startHeartbeat:"+(new Date).toTimeString()),this.heartBeat.last=Date.now(),this.heartBeat.isBeating=!0,clearTimeout(this.heartBeat.beatAckTimer),clearTimeout(this.heartBeat.sendBeatTimer),this.heartBeat.beatAckTimer=null,this.heartBeat.sendBeatTimer=null,this.sendHeartBeat()}},{key:"stopHeartBeat",value:function(){this.logger.log("白板--\x3e Signal.stopHeartBeat at: "+(new Date).toLocaleString()),clearTimeout(this.heartBeat.beatAckTimer),clearTimeout(this.heartBeat.sendBeatTimer),this.heartBeat.beatAckTimer=null,this.heartBeat.sendBeatTimer=null,this.heartBeat.isBeating=!1,this.heartBeat.last=null}},{key:"sendLoginMsg",value:function(e){var t={cname:this.whiteboardSDK.channel,token:e.token,client_type:2,client_net:2,client_os:(0,g.getClientOs)(),client_sdk_version:e.whiteboardVersion,client_support_record:e.record};e.from_g2&&(t.from_g2=!0),this.logger.log("白板--\x3e Signal login",t),this.sendMsg("login",t)}},{key:"sendLogoutMsg",value:function(){this.sendMsg("logout",{recv_bytes:this.recv_bytes,send_bytes:this.send_bytes})}},{key:"sendMsg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r={type:e=f.serializeWb.gateWay[e],uid:+this.connectParams.uid,cid:+this.connectParams.cid,version:31,content:{params:t}},a=Date.now(),i=a;i=+a.toString().slice(0,-3),n&&(r.content.params.timestamp=i),this.send(r)}},{key:"receiveStats",value:function(){}},{key:"sendStats",value:function(){}},{key:"send",value:function(e){null!==this.socket&&this.socketStatus===y.WebSocket.OPEN?(e.browser={},e.browser.name=d.default.name,e.browser.version=d.default.version,this.socket.send((0,r.default)(e))):(this.logger.log("白板--\x3e Signal.send失败，socket是否为null: "+(null===this.socket)+", socketStatus: "+this.socketStatus),this.logger.log("白板--\x3e Signal.send失败，数据: "+(0,r.default)(e)))}},{key:"socketStatus",get:function(){return null===this.socket?-1:this.socket.readyState}},{key:"logger",get:function(){return this.whiteboardSDK.logger}}]),t}(l.default);t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.serializeWb={gateWay:{login:1,loginAck:2,join:3,keep_alive:4,keep_alive_ack:5,keep_alive_node:6,broadcast:7,toUser:8,logout:9,syncRequest:10,syncRequestAck:11,syncRequestResponse:12,broadcastAck:13,kicked:14,roomClosed:15}},t.unserializeWb={gateWay:{1:"login",2:"loginAck",3:"join",4:"keep_alive",5:"keep_alive_ack",6:"keep_alive_node",7:"broadcast",8:"toUser",9:"logout",10:"syncRequest",11:"syncRequestAck",12:"syncRequestResponse",13:"broadcastAck",14:"kicked",15:"roomClosed"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getClientOs=t.delay=void 0;var r=i(n(13)),a=i(n(394));function i(e){return e&&e.__esModule?e:{default:e}}t.delay=function(e){return new r.default((function(t){setTimeout((function(){t()}),e)}))},t.getClientOs=function(){var e="",t="";try{e=a.default.description.toLowerCase(),t=a.default.ua.toString().toLowerCase()}catch(e){console.warn(e)}var n=/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,r=/android/.test(e),i=/windows/.test(t),o=/os x/.test(t),s=/electron/.test(t),u=/qtwebengine/.test(t);return r?1:n?2:s||u?i?3:o?4:5:0}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0;var r,a=n(13),i=(r=a)&&r.__esModule?r:{default:r};t.delay=function(e){return new i.default((function(t){setTimeout((function(){t()}),e)}))}}]).default}));
//# sourceMappingURL=WhiteBoardSDK_v3.7.5.js.map